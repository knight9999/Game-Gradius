"use strict";const e={vicviper:{src:"images/gradius_vicviper.png",rate:1,obj:new Image},vicviper_back:{src:"images/gradius_vicviper_back.png",rate:1,obj:new Image},vicviper_bomb:{src:"images/gradius_vicviper_bomb.png",rate:1,obj:new Image},vicviper_bomb_red:{src:"images/gradius_vicviper_bomb_red.png",rate:1,obj:new Image},option:{src:"images/option.png",rate:1,obj:new Image},forcefield:{src:"images/gradius_forcefield.png",rate:1,obj:new Image},shield:{src:"images/gradius_shield.png",rate:1,obj:new Image},gradius_missile:{src:"images/gradius_missile.png",rate:1,obj:new Image},shot1:{src:"images/gradius_shot1.png",rate:1,obj:new Image},shot2:{src:"images/gradius_shot2.png",rate:1,obj:new Image},shot3:{src:"images/gradius_shot3.png",rate:1,obj:new Image},shot_laser_col:{src:"images/gradius_shot_laser_col.png",rate:1,obj:new Image},gradius_pc:{src:"images/gradius_pc.png",rate:1,obj:new Image},meter:{src:"images/gradius_meter.png",rate:1,obj:new Image},meter_c:{src:"images/gradius_meter_c.png",rate:1,obj:new Image},enemy_fan:{src:"images/gradius_enemy_fan.png",rate:1,obj:new Image},enemy_a:{src:"images/gradius_enemy_a.png",rate:1,obj:new Image},enemy_b:{src:"images/gradius_enemy_b.png",rate:1,obj:new Image},enemy_c:{src:"images/gradius_enemy_c.png",rate:1,obj:new Image},enemy_d:{src:"images/gradius_enemy_d.png",rate:1,obj:new Image},enemy_e:{src:"images/gradius_enemy_e.png",rate:1,obj:new Image},enemy_f:{src:"images/gradius_enemy_f.png",rate:1,obj:new Image},enemy_g:{src:"images/gradius_enemy_g.png",rate:1,obj:new Image},enemy_m1:{src:"images/gradius_enemy_m1.png",rate:1,obj:new Image},enemy_m2:{src:"images/gradius_enemy_m2.png",rate:1,obj:new Image},enemy_m_group:{src:"images/gradius_enemy_m_group.png",rate:1,obj:new Image},enemy_o:{src:"images/gradius_enemy_o.png",rate:1,obj:new Image},enemy_p_1:{src:"images/gradius_enemy_p_1.png",rate:1,obj:new Image},enemy_p_2:{src:"images/gradius_enemy_p_2.png",rate:1,obj:new Image},enemy_p_3:{src:"images/gradius_enemy_p_3.png",rate:1,obj:new Image},enemy_p_4:{src:"images/gradius_enemy_p_4.png",rate:1,obj:new Image},enemy_p_5:{src:"images/gradius_enemy_p_5.png",rate:1,obj:new Image},enemy_p_6:{src:"images/gradius_enemy_p_6.png",rate:1,obj:new Image},enemy_moai_boss:{src:"images/gradius_enemy_moai_boss.png",rate:1,obj:new Image},enemy_moai_mini_boss:{src:"images/gradius_enemy_moai_mini_boss.png",rate:1,obj:new Image},enemy_moai_boss_ring:{src:"images/gradius_enemy_moai_boss_ring.png",rate:1,obj:new Image},enemy_m_a_1:{src:"images/gradius_enemy_m_a_1.png",rate:1,obj:new Image},enemy_m_a_2:{src:"images/gradius_enemy_m_a_2.png",rate:1,obj:new Image},enemy_m_b_1:{src:"images/gradius_enemy_m_b_1.png",rate:1,obj:new Image},enemy_m_b_2:{src:"images/gradius_enemy_m_b_2.png",rate:1,obj:new Image},enemy_m_z:{src:"images/gradius_enemy_m_z.png",rate:1,obj:new Image},enemy_moai_ring:{src:"images/gradius_enemy_moai_ring.png",rate:1,obj:new Image},enemy_cell_boss:{src:"images/gradius_enemy_cell_boss.png",rate:1,obj:new Image},enemy_cell_boss_eye:{src:"images/gradius_enemy_cell_boss_eye.png",rate:1,obj:new Image},enemy_cell_core:{src:"images/gradius_enemy_cell_core.png",rate:1,obj:new Image},enemy_cell_hand_1:{src:"images/gradius_enemy_cell_hand_1.png",rate:1,obj:new Image},enemy_cell_hand_2:{src:"images/gradius_enemy_cell_hand_2.png",rate:1,obj:new Image},enemy_cell_hand_3:{src:"images/gradius_enemy_cell_hand_3.png",rate:1,obj:new Image},enemy_cell_a:{src:"images/gradius_enemy_cell_a.png",rate:1,obj:new Image},enemy_cell_b:{src:"images/gradius_enemy_cell_b.png",rate:1,obj:new Image},enemy_frame_large:{src:"images/gradius_enemy_frame_large.png",rate:1,obj:new Image},enemy_frame_small:{src:"images/gradius_enemy_frame_small.png",rate:1,obj:new Image},enemy_frame_mini:{src:"images/gradius_enemy_frame_mini.png",rate:1,obj:new Image},enemy_frame_head1:{src:"images/gradius_enemy_frame_head_1.png",rate:1,obj:new Image},enemy_frame_head2:{src:"images/gradius_enemy_frame_head_2.png",rate:1,obj:new Image},enemy_frame_head3:{src:"images/gradius_enemy_frame_head_3.png",rate:1,obj:new Image},enemy_frame_head4:{src:"images/gradius_enemy_frame_head_4.png",rate:1,obj:new Image},enemy_frame_body1:{src:"images/gradius_enemy_frame_body_1.png",rate:1,obj:new Image},enemy_bigcore:{src:"images/gradius_enemy_bigcore.png",rate:1,obj:new Image},enemy_bigcore_1:{src:"images/gradius_enemy_bigcore_1.png",rate:1,obj:new Image},enemy_bigcore_2:{src:"images/gradius_enemy_bigcore_2.png",rate:1,obj:new Image},enemy_bigcore_core:{src:"images/gradius_enemy_bigcore_core.png",rate:1,obj:new Image},enemy_cristalcore:{src:"images/gradius_enemy_cristalcore.png",rate:1,obj:new Image},enemy_cristalcore_hand1:{src:"images/gradius_enemy_cristalcore_hand1.png",rate:.3,obj:new Image},enemy_cristalcore_hand2:{src:"images/gradius_enemy_cristalcore_hand2.png",rate:.4,obj:new Image},enemy_cristalcore_wall1:{src:"images/gradius_enemy_cristalcore_wall1.png",rate:1,obj:new Image},enemy_cristalcore_wall2:{src:"images/gradius_enemy_cristalcore_wall2.png",rate:1,obj:new Image},enemy_cristalcore_shot:{src:"images/gradius_enemy_cristalcore_shot.png",rate:1,obj:new Image},enemy_cube:{src:"images/gradius_enemy_cube.png",rate:1,obj:new Image},enemy_bigcore2:{src:"images/gradius_enemy_bigcore2.png",rate:1,obj:new Image},enemy_bigcore2_hand:{src:"images/gradius_enemy_bigcore2_hand.png",rate:1,obj:new Image},enemy_bigcore2_wall:{src:"images/gradius_enemy_bigcore2_wall.png",rate:1,obj:new Image},enemy_bigcore2_core:{src:"images/gradius_enemy_bigcore2_core.png",rate:1,obj:new Image},enemy_bigcore2_back:{src:"images/gradius_enemy_bigcore2_back.png",rate:1,obj:new Image},enemy_death:{src:"images/gradius_enemy_death.png",rate:1,obj:new Image},enemy_death_front:{src:"images/gradius_enemy_death_front.png",rate:1,obj:new Image},enemy_death_shot:{src:"images/gradius_enemy_death_shot.png",rate:1,obj:new Image},enemy_death_shot2:{src:"images/gradius_enemy_death_shot2.png",rate:1,obj:new Image},enemy_boss_aian:{src:"images/gradius_enemy_boss_aian.png",rate:1,obj:new Image},enemy_collapes0:{src:"images/gradius_enemy_collapes0.png",rate:1,obj:new Image},enemy_collapes1:{src:"images/gradius_enemy_collapes1.png",rate:1,obj:new Image},enemy_collapes2:{src:"images/gradius_enemy_collapes2.png",rate:1,obj:new Image},enemy_collapes3:{src:"images/gradius_enemy_collapes3.png",rate:1,obj:new Image},enemy_collapes8:{src:"images/gradius_enemy_collapes8.png",rate:1,obj:new Image},enemy_collapes9:{src:"images/gradius_enemy_collapes9.png",rate:1,obj:new Image},enemy_bullet:{src:"images/gradius_enemy_bullet.png",rate:1,obj:new Image},enemy_bullet_cell:{src:"images/gradius_enemy_bullet_cell.png",rate:1,obj:new Image},enemy_bullet_z:{src:"images/gradius_enemy_bullet_z.png",rate:1,obj:new Image},enemy_bullet_laser:{src:"images/gradius_enemy_bullet_laser.png",rate:1,obj:new Image},map_cube_A:{src:"images/gradius_map_cube_A.png",rate:1,obj:new Image},map_cristal_up:{src:"images/gradius_map_cristal_up.png",rate:1,obj:new Image},map_cristal_down:{src:"images/gradius_map_cristal_down.png",rate:1,obj:new Image},map_moai_A:{src:"images/gradius_map_moai_A.png",rate:1,obj:new Image},map_moai_B:{src:"images/gradius_map_moai_B.png",rate:1,obj:new Image},map_volcano_A:{src:"images/gradius_map_volcano_A.png",rate:1,obj:new Image},map_volcano_B:{src:"images/gradius_map_volcano_B.png",rate:1,obj:new Image},map_volcano_C:{src:"images/gradius_map_volcano_C.png",rate:1,obj:new Image},map_volcano_D:{src:"images/gradius_map_volcano_D.png",rate:1,obj:new Image},map_volcano_E:{src:"images/gradius_map_volcano_E.png",rate:1,obj:new Image},map_volcano_F:{src:"images/gradius_map_volcano_F.png",rate:1,obj:new Image},map_volcano_G:{src:"images/gradius_map_volcano_G.png",rate:1,obj:new Image},map_volcano_H:{src:"images/gradius_map_volcano_H.png",rate:1,obj:new Image},map_volcano_I:{src:"images/gradius_map_volcano_I.png",rate:1,obj:new Image},map_volcano_J:{src:"images/gradius_map_volcano_J.png",rate:1,obj:new Image},map_volcano_K:{src:"images/gradius_map_volcano_K.png",rate:1,obj:new Image},map_volcano_L:{src:"images/gradius_map_volcano_L.png",rate:1,obj:new Image},map_volcano_M:{src:"images/gradius_map_volcano_M.png",rate:1,obj:new Image},map_volcano_N:{src:"images/gradius_map_volcano_N.png",rate:1,obj:new Image},map_volcano_O:{src:"images/gradius_map_volcano_O.png",rate:1,obj:new Image},map_volcano_P:{src:"images/gradius_map_volcano_P.png",rate:1,obj:new Image},map_frame_A:{src:"images/gradius_map_frame_A.png",rate:1,obj:new Image},map_frame_B:{src:"images/gradius_map_frame_B.png",rate:1,obj:new Image},map_frame_C:{src:"images/gradius_map_frame_C.png",rate:1,obj:new Image},map_frame_D:{src:"images/gradius_map_frame_D.png",rate:1,obj:new Image},map_frame_E:{src:"images/gradius_map_frame_E.png",rate:1,obj:new Image},map_frame_F:{src:"images/gradius_map_frame_F.png",rate:1,obj:new Image},map_cell_A:{src:"images/gradius_map_cell_A.png",rate:1,obj:new Image},map_cell_B:{src:"images/gradius_map_cell_B.png",rate:1,obj:new Image},map_cell_C:{src:"images/gradius_map_cell_C.png",rate:1,obj:new Image},map_cell_D:{src:"images/gradius_map_cell_D.png",rate:1,obj:new Image},map_cell_V:{src:"images/gradius_map_cell_V.png",rate:1,obj:new Image},map_cell_W:{src:"images/gradius_map_cell_W.png",rate:1,obj:new Image},map_cell_Y:{src:"images/gradius_map_cell_Y.png",rate:1,obj:new Image},map_cell_Z:{src:"images/gradius_map_cell_Z.png",rate:1,obj:new Image},map_cell_wall:{src:"images/gradius_map_cell_wall.png",rate:1,obj:new Image}},t={gradius_background:{src:"images/gradius_background.jpg",rate:1,obj:new Image},gradius_logo:{src:"images/gradius_logo.png",rate:1,obj:new Image},font:{src:"images/gradius_font.png",rate:1,obj:new Image},gradius_powermeterselect:{src:"images/gradius_powermeterselect.png",rate:1,obj:new Image},gradius_powermeterselect_selected:{src:"images/gradius_powermeterselect_selected.png",rate:1,obj:new Image},gradius_powermeterselect_shield:{src:"images/gradius_powermeterselect_shield.png",rate:1,obj:new Image},gradius_powermeterselect_shield_selected:{src:"images/gradius_powermeterselect_shield_selected.png",rate:1,obj:new Image}},s={shot_laser:{src:"audios/shot_laser.mp3",volume:1,obj:null,buf:new Object},missile:{src:"audios/missile.mp3",volume:1,obj:null,buf:new Object},shot_normal:{src:"audios/shot_normal.mp3",volume:1,obj:null,buf:new Object},shot_ripple:{src:"audios/shot_ripple.mp3",volume:1,obj:null,buf:new Object},vicviper_bomb:{src:"audios/vicviper_bomb.mp3",volume:1,obj:null,buf:new Object},vicviper_shield_reduce:{src:"audios/vicviper_shield_reduce.mp3",volume:1,obj:null,buf:new Object},pc:{src:"audios/pc.mp3",volume:1,obj:null,buf:new Object},playerset:{src:"audios/playerset.mp3",volume:1,obj:null,buf:new Object},pms_select:{src:"audios/pms_select.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser:{src:"audios/enemy_bullet_laser.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser_long:{src:"audios/enemy_bullet_laser_long.mp3",volume:1,obj:null,buf:new Object},enemy_collision1:{src:"audios/enemy_collision1.mp3",volume:1,obj:null,buf:new Object},enemy_collision2:{src:"audios/enemy_collision2.mp3",volume:1,obj:null,buf:new Object},enemy_collision3:{src:"audios/enemy_collision3.mp3",volume:1,obj:null,buf:new Object},enemy_collision4:{src:"audios/enemy_collision4.mp3",volume:1,obj:null,buf:new Object},enemy_collision5:{src:"audios/enemy_collision5.mp3",volume:1,obj:null,buf:new Object},enemy_collision6:{src:"audios/enemy_collision6.mp3",volume:1,obj:null,buf:new Object},enemy_collision7:{src:"audios/enemy_collision7.mp3",volume:1,obj:null,buf:new Object},enemy_collision8:{src:"audios/enemy_collision8.mp3",volume:1,obj:null,buf:new Object},enemy_all_out:{src:"audios/enemy_all_out.mp3",volume:1,obj:null,buf:new Object},enemy_cube:{src:"audios/enemy_cube.mp3",volume:1,obj:null,buf:new Object},map_cell_wall:{src:"audios/map_cell_wall.mp3",volume:1,obj:null,buf:new Object},bg_powermeterselect:{src:"audios/bg_powermeterselect.mp3",volume:1,obj:null,buf:new Object},bg_boss:{src:"audios/bg_boss.mp3",volume:1,obj:null,buf:new Object},bg_type1:{src:"audios/bg_moai.mp3",volume:1,obj:null,buf:new Object},bg_type2:{src:"audios/bg_volcano.mp3",volume:1,obj:null,buf:new Object},bg_type3:{src:"audios/bg_crystal.mp3",volume:1,obj:null,buf:new Object},bg_type4:{src:"audios/bg_frame.mp3",volume:1,obj:null,buf:new Object},bg_type5:{src:"audios/bg_thunderbolt.mp3",volume:1,obj:null,buf:new Object},bg_type6:{src:"audios/bg_cell.mp3",volume:1,obj:null,buf:new Object}};let i=!1,_=0,o=0,n=null;const a=null===window.ontouchstart,r=60,h=document.getElementById("game")||{width:1e3,height:500};let l,m=new Array,c=new Array,d=new Array,g=4,p="",y="",u="",w=new Array,x="38,38,40,40,37,39,37,39,66,65";const b=0,v=1,f=2,I={_U:0,_D:1,_R:2,_L:3,_LU:4,_LD:5,_RU:6,_RD:7};let P=0,j=[];const M=()=>{P=Ft._option_count>2?1:0,P+=Ft._shot_type===Ft._shot_type_def.LASER?1:0,P+=Ft._players_force_obj.isalive()?1:0,P+=parseInt(g)},C=()=>parseInt(j[P]._MOAI_RING_INT),S=()=>parseFloat(j[P]._shot_rate),E=()=>parseInt(j[P]._shot_speed),D=()=>parseInt(j[P]._enemy_speed),k=()=>parseInt(j[P]._hache_rate),A=()=>parseFloat(j[P]._volcano_rate),L=function(e){return new Promise((t,s)=>{let i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status?(console.log(e.url+":OK"),t(i.response)):(console.log("NG"),s(new Error(i.statusText))))},i.open("GET",e.url+"?date="+(new Date).getTime()),i.responseType=e.type||"json",i.onerror=(()=>{s(new Error(i.statusText))}),i.send(null)})},O={_img_loaded_count:0,_init_imgs(e,t){return new Promise((s,i)=>{let _=this,o=!1;for(let n in e){let a=e[n];a.obj.src=e[n].src,a.obj.onload=function(){if(a.obj.width*=a.rate,a.obj.height*=a.rate,_._img_loaded_count++,_._img_loaded_count>=Object.keys(e).length)s();else if(void 0!==t){let s=parseInt(_._img_loaded_count/Object.keys(e).length*100);t(s)}},a.obj.onabort=function(){i()},a.obj.onerror=function(){o||(o=!0,alert("一部画像読み込みに失敗しました。再度立ち上げなおしてください"),Promise.reject())}}})}},T={_audio_context:null,_audio_buffer_loader:null,_audio_now_obj_bg:null,_audio_context_source_bg:null,_audio_settimeout:null,_audio_loaded_count:0,_is_audio_context_source_bg:!1,_init(){this._audio_context=new(window.AudioContext||window.webkitAudioContext)},_init_audios(e,t){return new Promise((s,i)=>{let _=this;for(let o in e){let n=new XMLHttpRequest;n.open("GET",e[o].src,!0),n.responseType="arraybuffer",n.onload=function(){_._audio_context.decodeAudioData(n.response,function(i){e[o].buf=i,_._audio_loaded_count++,_._audio_loaded_count>=Object.keys(e).length?s():void 0!==t&&t(_._audio_loaded_count/Object.keys(e).length*100)},function(e){alert("一部音声読み込みに失敗しました。再度立ち上げなおしてください:"+e),i()})},n.send()}})},_reset(){this._audio_context=null,this._audio_buffer_loader=null,this._audio_now_obj_bg=null,this._audio_context_source_bg=null,this._is_audio_context_source_bg=!1,this._audio_settimeout=null,this._audio_loaded_count=0},_setPlay(e,t){if(null===e||void 0===e)return;let s=this;return new Promise((i,_)=>{var o=s._audio_context.createBufferSource();o.buffer=e.buf,o.loop=!1,o.connect(s._audio_context.destination),o.start(0),void 0!==t&&(s._audio_settimeout=setTimeout(()=>{i()},t))})},_setPlayOnBG(e,t,s){if(null===e||void 0===e)return;let i=this;return t=void 0===t,new Promise((_,o)=>{!0===i._is_audio_context_source_bg&&(i._audio_context_source_bg.stop(),i._is_audio_context_source_bg=!1);let n=i._audio_context.createBufferSource();n.buffer=e.buf,i._audio_now_obj_bg=e,n.loop=t,n.loopStart=0,n.connect(i._audio_context.destination),n.start(0),i._audio_context_source_bg=n,i._is_audio_context_source_bg=!0,void 0!==s&&(i._audio_settimeout=setTimeout(()=>{_()},s))})},_setStopOnBG(){this._is_audio_context_source_bg&&(this._audio_context_source_bg.stop(),this._is_audio_context_source_bg=!1,clearTimeout(this._audio_settimeout))}},R={_url_params:new Array,_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_ac:{_get:function(e,t,s){return e>=t.length*s-1?0:e+1}},getRad(e,t){if(void 0!==e&&void 0!==t)return Math.atan2(e.y-t.y,e.x-t.x)},getDeg(e,t){if(void 0===e||void 0===t)return;return Math.atan2(e.y-t.y,e.x-t.x)/Math.PI*180},getRadToDeg:e=>void 0===e||""===e?null:e/Math.PI*180,getBit:(e,t)=>("0".repeat(t)+e).slice(-1*t),getOrBit(e,t,s){let i=(parseInt(e,2)|parseInt(t,2)).toString(2);return this.getBit(i,s)},setUrlParams(){for(var e=location.search.slice(1).split(/(&|&amp;)/),t=0;t<e.length;t++){var s=e[t].replace("amp;","").split("=");""!==s[0]&&void 0!==s[0]&&("&"!==s[0]&&(this._url_params[s[0]]=s[1]))}},isShotCanvasOut:e=>e.x<-u.t||e.x>h.width+u.t||e.y<-u.t||e.y>h.height+u.t,isEnemyCanvasOut(e,t,s){let i=e.getEnemyCenterPosition(),_=t||{up:!0,down:!0,left:!0,right:!0},o=e.width,n=e.height,a=s||{up:0,down:0,left:0,right:0},r=a.up||0,l=a.right||0,m=a.down||0,c=a.left||0;return i._x<0-o-c&&!0===_.left||i._x>h.width+o+l&&!0===_.right||i._y<0-n-r&&!0===_.up||i._y>h.height+n+m&&!0===_.down},isSqCollision(e,t,s,i,_){return this.isSqCollision_laser(e,t,s,i,_).ret},isSqCollision_laser(e,t,s,i,_){let o=parseInt(void 0===t?0:t.split(",")[0]),n=parseInt(void 0===t?0:t.split(",")[1]),a=parseInt(void 0===i?0:i.split(",")[0]),r=parseInt(void 0===i?0:i.split(",")[1]),l=e.split(","),m=parseInt(l[2])-parseInt(l[0]),c=parseInt(l[3])-parseInt(l[1]),d=(Math.sqrt(Math.pow(m,2)+Math.pow(c,2)),m/2+o+parseInt(l[0])),g=c/2+n+parseInt(l[1]);_&&console.log(d+":"+g);for(let e=0;e<s.length;e++){let t=s[e].split(","),i=parseInt(t[2])-parseInt(t[0]),_=parseInt(t[3])-parseInt(t[1]),o=void 0===t[4],n=(Math.sqrt(Math.pow(i,2)+Math.pow(_,2)),i/2+a+parseInt(t[0])),h=_/2+r+parseInt(t[1]),l=Math.abs(n-d),p=Math.abs(h-g),y=(Math.sqrt(Math.pow(l,2)+Math.pow(p,2)),a+parseInt(t[0]));if(m/2+i/2>l&&c/2+_/2>p)return o?{ret:b,val:y}:{ret:v,val:y}}return{ret:f,val:h.width}},_setDrawToText(e){if(void 0===e)return;let s=this;const i=t.font.obj,_=i.height;e.r=e.r||1,e.alpha=void 0===e.alpha||null===e.alpha?1:e.alpha;let o=(()=>"left"===e.x?0:"center"===e.x?parseInt(h.width/2)-parseInt(e.s.length*(_*e.r)/2):"right"===e.x?h.width-parseInt(e.s.length*_*e.r):e.x)(),n=(()=>"top"===e.y?0:"center"===e.y?parseInt(h.height/2)-parseInt(_*e.r/2):"bottom"===e.y?h.height-parseInt(_*e.r):e.y)();for(let t=0;t<e.s.length;t++)" "!==e.s[t]&&R._setDrawImage({img:i,x:o+_*e.r*t,y:n,imgPosx:parseInt(s._txt[e.s[t]]),width:_,height:_,scale:e.r,basePoint:1,alpha:e.alpha})},_setTextToFont(e,t,s){if(void 0===e||null===e)return;let i=this;s=s||30;let _="";for(let e=0;e<t.length;e++){if(" "===t[e]){_+='<img src="./images/gradius_spacer.png" width="'+s+'">';continue}_+='<div style="background:url(./images/gradius_font.png) no-repeat;width:'+s+"px;height:"+s+"px;background-position:"+parseInt(i._txt[t[e]])*(s/60)*-1+'px 0px;background-size:cover;display:inline-block;"></div>'}e.innerHTML=_},_setDrawImage(e){if(void 0===e||void 0===e.img||0===e.scale)return;let t=e.width||e.img.width,s=e.height||e.img.height,i=e.t_width||t,_=e.t_height||s,o=e.deg||0,n=e.imgPosx||0,a=e.imgPosy||0,r=e.scale||1,h=e.x||0,m=e.y||0,c=e.basePoint||5,d=void 0===e.alpha?1:e.alpha;if(1===e.basePoint&&void 0===e.imgPosx&&void 0===e.alpha&&void 0===e.scale&&void 0===e.deg)return void l.drawImage(e.img,h,m,t,s);const g=[{x:0,y:0},{x:0,y:0},{x:-t/2,y:0},{x:-t,y:0},{x:0,y:-s/2},{x:-t/2,y:-s/2},{x:-t,y:-s/2},{x:0,y:-s},{x:-t/2,y:-s},{x:-t,y:-s}];l.save(),l.globalAlpha=d,l.translate(h,m),l.rotate(o*Math.PI/180),l.scale(r,r),l.drawImage(e.img,n,a,i,_,g[c].x,g[c].y,t,s),l.restore()},_multilineText(e,t,s){let i=t.length,_=[],o="";if(i<1)return _;for(let n=0;n<i;n++){let i=t.charAt(n);"\n"!==i?e.measureText(o+i).width<=s?o+=i:(_.push(o),o=i):(_.push(o),o="")}return o.length>0&&_.push(o),_}};class Y{constructor(e){this.id=m.length,this.gid=0,this.img=e.img,this.imgPos=e.imgPos||[0],this.aniItv=e.aniItv||10,this.width=e.width||this.img.width,this.height=e.height||this.img.height,this.x=e.x||0,this.y=e.y||0,this.direct=void 0===e.direct?I._D:e.direct,this._s=e.s||"0",this.audio_collision=s.enemy_collision1,this.audio_alive=s.enemy_collision3,this._DEF_SHOTSTATUS={_SHOTTYPE_NORMAL:1,_SHOTTYPE_MISSILE:2,_SHOTTYPE_DOUBLE:1,_SHOTTYPE_RIPPLE_LASER:1.5,_SHOTTYPE_LASER:1},this.alpha=1,this._c=0,this.speed=0,this.getscore=200,this._standby=!0,this._isshow=!0,this._status=1,this.haspc=!1,this._collision_type="t0",this.is_ignore=e.is_ignore||!1,this.is_able_collision=!0,this.is_ignore_collision=!1,this.is_collision_player_init=!1,this.shotColMap=["0,0,"+this.width+","+this.height],this.col_date=null,this.col_canint=150}init(){this._status=0,this._isshow=!1}collision(e,t){return!!this.isCollision()&&(!this.is_able_collision||(this.setStatus(e,t),!0))}isAbleCollision(){return this.is_able_collision}isIgnore(){return this.is_ignore}isIgnoreCollision(){return this.is_ignore_collision}isCollision(){let e=this;return null===e.col_date?(e.col_date=new Date,!0):new Date-e.col_date>e.col_canint&&(e.col_date=new Date,!0)}setAlive(){let e=this;e.isalive()?T._setPlay(e.audio_alive):(Tt._set_score(e.getscore),e.showCollapes(),T._setPlay(e.audio_collision))}setStatus(e){this._status-=this._DEF_SHOTSTATUS[e]||1,this.setAlive()}getEnemyCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}isalive(){return this._status>0}isshow(){return this._isshow}isshot(){return Math.random()<S()}shot(){R.isEnemyCanvasOut(this)||this.isshot()&&c.push(new Te({x:this.getEnemyCenterPosition()._x,y:this.getEnemyCenterPosition()._y}))}get_move_bound_val(){return parseInt(1*Math.random()+1)*(Math.random()>.5?1:-1)}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]||0}setDrawImageDirect(){let e=this;e.direct===I._U&&l.setTransform(1,0,0,-1,0,2*e.y+e.height),e.direct===I._LU&&l.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height),e.direct===I._LD&&l.setTransform(-1,0,0,1,2*e.x+e.width,0)}setDrawImage(){let e=this;e.isMove()&&(l.save(),e.setDrawImageDirect(),l.globalAlpha=e.alpha,l.drawImage(e.img,e.get_imgPos(),0,e.width,e.height,e.x,e.y,e.width,e.height),i&&(l.strokeStyle="rgba(200,200,255,0.5)",l.beginPath(),l.rect(e.x,e.y,e.width,e.height),l.stroke()),l.restore())}setDrawImageDirect(){let e=this;e.direct===I._U&&l.setTransform(1,0,0,-1,0,2*e.y+e.img.height),e.direct===I._LU&&l.setTransform(-1,0,0,-1,2*e.x+e.img.width,2*e.y+e.img.height),e.direct===I._LD&&l.setTransform(-1,0,0,1,2*e.x+e.img.width,0)}isStandBy(){return this._standby}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1})}showCollapes(e,t){let s=this;s._isshow=!1,s.haspc?Tt._add_powercapsell({x:s.x,y:s.y}):d.push(new hs(e||s.x+s.width/2,t||s.y+s.height/2,s._collision_type))}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&!!e.isalive()}moveDraw(){}moveSet(){}move_standby(){let e=this;e.speed=D(),e.x<h.width-20&&(e._standby=!1)}move(){this.x=u.getX(this.x),this.y=u.getY(this.y),this.speed=D(),this.isMove()&&(this.moveSet(),this.shot())}}class U extends Y{constructor(t){super({img:e.enemy_fan.obj,x:t.x,y:t.y,imgPos:[0,25,50,75,100,125,150,175],aniItv:5,width:25,height:25,direct:t.direct});this.haspc=!0,this.parts=[],this.is_ignore=!0}move_standby(){let e=this;if(!(e.x>h.width)){e._standby=!1,e.parts=[new X({x:e.x+0*e.width,y:e.y}),new X({x:e.x+.5*e.width,y:e.y}),new X({x:e.x+1*e.width,y:e.y}),new X({x:e.x+1.5*e.width,y:e.y}),new X({x:e.x+2*e.width,y:e.y}),new X({x:e.x+2.5*e.width,y:e.y})];for(let t=0;t<e.parts.length;t++)m.push(e.parts[t])}}setDrawImage(){}moveSet(){let e=this;for(let t=e.parts.length-1;t>=0;t--){let s=e.parts[t];s.moveSet(),s.isalive()||e.parts.splice(t,1)}if(0===e.parts.length)return e.x<h.width&&e.showCollapes(),void e.init();e.x=e.parts[e.parts.length-1].x,e.y=e.parts[e.parts.length-1].y}}class X extends Y{constructor(t){super({img:e.enemy_fan.obj,x:t.x,y:t.y,imgPos:[0,25,50,75,100,125,150,175],aniItv:5,width:25,height:25});this._status=1,this.speed=2,this.pos_y=t.y>250,this.change_x=!1,this.change_y=!1}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:this.change_x})}moveSet(){let e=this;if(e.x=u.getX(e.x),e.y=u.getY(e.y),!e.isMove())return;const t=e.pos_y?275:200;e.change_x=e.change_x||e.x<500,e.x+=e.change_x?e.speed+u.getBackGroundSpeed():-1*e.speed,e.change_y=e.change_y||e.pos_y&&e.y<t||!e.pos_y&&e.y>t,e.y+=(()=>e.change_x?e.change_y?0:e.pos_y?-1*e.speed:e.speed:0)(),e.set_imgPos(),e.shot()}move(){}}class B extends Y{constructor(t){super({img:t.img||e.enemy_a.obj,x:t.x,y:t.y,imgPos:[0],width:25,direct:t.direct});this._status=1}setDrawImageDirect(){let e=this;e.direct===I._U&&(Ft._players_obj.x<e.x?l.setTransform(1,0,0,-1,0,2*e.y+e.height):l.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height)),e.direct===I._D&&(Ft._players_obj.x<e.x?l.setTransform(1,0,0,1,0,0):l.setTransform(-1,0,0,1,2*e.x+e.width,0))}moveSet(){this.imgPos=(e=>e>150?[0]:e<=150&&e>100?[25]:[50])(Math.abs(Ft._players_obj.y-this.y))}}class F extends B{constructor(t){super({img:e.enemy_b.obj,x:t.x,y:t.y,direct:t.direct});this.haspc=!0}}class q extends Y{constructor(t){super({img:e.enemy_c.obj,x:t.x,y:t.y,width:50,height:50,imgPos:[0,50,100,150,200,250,300],direct:t.direct});let s=this;s._st="_st1",s._shot=!1,s._status=1,s._docker_speed=0,s._collision_type="t3",s._count=0,s.y=t.direct===I._D?t.y-s.height-u.t:t.y,s.shotColMap=s.direct===I._D?["10,10,43,42"]:["0,0,43,32"],s._ene_status={_st1:{_f:function(){!0!==s._shot&&(s.imgPos=[0,50,100,150],s.set_imgPos())},_setX:function(){return s.x+2*s._docker_speed}},_st2:{_f:function(){if(!(s.x>=h.width))return s._shot=!0,s.imgPos=[200,250,300],s.set_imgPos(),s._c>=s.imgPos.length*s.aniItv-1?(s.shot(),s._shot=!1,void(s._st="_st1")):void 0},_setX:function(){return s.x}}}}map_collition(){let e=this,t=e.getEnemyCenterPosition(),s=u.getMapX(t._x),i=u.getMapY(t._y);u.isMapBefore(s,i)&&(e._docker_speed=Math.abs(e._docker_speed)),u.isMapLastSide(s,i)&&(e._docker_speed=-1*e._docker_speed);let _=u.t;_=2*Math.abs(e._docker_speed);let o=u.isMapCollision(s+1,i)||u.isMapCollision(s-1,i);var n;e.y=(n=e).direct===I._U?o?n.y+_:n.y:n.direct===I._D?o?n.y-_:n.y:void 0,e.y=function(e){return e.direct===I._U?u.isMapCollision(s,i-1)?e.y:e.y-_:e.direct===I._D?u.isMapCollision(s,i+1)?e.y:e.y+_:void 0}(e)}setDrawImageDirect(){let e=this;e.direct===I._U&&(Ft._players_obj.x<e.x?l.setTransform(1,0,0,-1,0,2*e.y+e.height):l.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height)),e.direct===I._D&&(Ft._players_obj.x<e.x?l.setTransform(1,0,0,1,0,0):l.setTransform(-1,0,0,1,2*e.x+e.width,0))}set_speed(){let e=this,t=Ft._players_obj.getPlayerCenterPosition();if(e._count>3e3*Math.random()&&(e._count=0),0!==e._count)return;let s=e._docker_speed>0?-1*(e.speed-1):e.speed-1;e._docker_speed=s,e._docker_speed=t._x<e.x?-1*e._docker_speed:Math.abs(e._docker_speed)}isshot(){return Math.random()<4*S()}shot(){if("_st1"===this._st)return;if(R.isEnemyCanvasOut(this))return;if(!this.isshot())return;let e=Ft._players_obj.getPlayerCenterPosition(),t=this.getEnemyCenterPosition(),s=R.getDeg({x:e._x,y:e._y},{x:t._x,y:t._y});c.push(new Te({x:t._x,y:t._y,deg:s-10})),c.push(new Te({x:t._x,y:t._y,deg:s+10}))}moveSet(){this.map_collition(),this.set_speed(),this._st=this.isshot()||this._shot?"_st2":"_st1",this._ene_status[this._st]._f(),this.x=this._ene_status[this._st]._setX(),this._count++}}class N extends Y{constructor(t){super({img:t.img||e.enemy_d.obj,x:t.x,y:t.y,width:25,imgPos:[0,25,50,75,100,125]})}moveSet(){this.x+=-1*this.speed;let e=this.x,t=Math.cos(e*Math.PI/180);this.y+=t,this.set_imgPos()}}class z extends N{constructor(t){super({img:e.enemy_e.obj,x:t.x,y:t.y,direct:t.direct});this.haspc=!0}}class H extends Y{constructor(t){super({img:t.img||e.enemy_f.obj,x:t.x,y:t.y,width:30,imgPos:[0,30,60,90],direct:t.direct});this._v=0,this.speed=t.direct===I._U?-.05:.05}getDir(){return this.x>h.width/2?-1:1}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!0,down:!0,left:!1,right:!1})}isshot(){return Math.random()<100*S()}shot(){if(!(this._v>0&&this._v<.05))return;if(!this.isshot())return;let e=this.getEnemyCenterPosition();for(let t=30;t<=360;t+=30)c.push(new Te({x:e._x,y:e._y,deg:t}))}move_standby(){let e=this;e.x+e.width<0&&(e._standby=!1)}moveSet(){let e=this;e.speed=e.direct===I._U?-.05:.05,e.x+=2*e.getDir(),e.y+=e._v,e._v+=e.speed;let t=e.getEnemyCenterPosition(),s=u.getMapX(t._x),i=u.getMapY(t._y);u.isMapCollision(s,i)&&(e._v+=e.speed,e._v*=-1),e.set_imgPos()}}class G extends H{constructor(t){super({img:e.enemy_g.obj,x:t.x,y:t.y,direct:t.direct});this.haspc=!0}}class K extends Y{constructor(t){super({img:e.enemy_m1.obj,x:t.x,y:t.y,imgPos:[0,50,100,150,100,50,0],width:50,height:24,aniItv:5,direct:t.direct});this._status=4,this._collision_type="t3",this.getscore=200,this._count=0}shot(){}moveSet(){let t=this;if(!t.isalive())return void t.showCollapes(0,t.direct===I._U?0:-u.t);if(t._count=t._count>=300?0:t._count+1,t.x<300&&t._count<=100)return void(t._count=99);if(t.img=t._status<=1?e.enemy_m2.obj:e.enemy_m1.obj,t._count<100||t>=300)return t.imgPos[0],void(t._c=0);if(t._count%300>100&&t._count%300<120&&(t.imgPos[150],t.set_imgPos()),t._count%300>280&&t._count%300<300&&(t.imgPos[0],t.set_imgPos()),t._count%300<120||t._count%300>=300)return;if(t._count%k()!=0)return;let s=new V({x:t.x+12.5,y:t.y+(t.direct===I._U?15:-10),direct:t.direct});m.push(s)}}class V extends Y{constructor(t){super({img:e.enemy_m_group.obj,x:t.x,y:t.y,imgPos:[0,25,50,75,100,125,150],aniItv:5,width:25,height:25,direct:t.direct});this.getscore=100,this._change=!1,this._moveX=0,this._moveY=0}isCanvasOut(){return R.isEnemyCanvasOut(this)}moveSet(){let e=this,t=Ft._players_obj.getPlayerCenterPosition();e._change=!!e._change||(e.direct===I._U&&t._y<e.y?(e._moveX=t._x<e.x?-1*e.speed:e.speed,!0):e.direct===I._D&&t._y>e.y&&(e._moveX=t._x<e.x?-1*e.speed:e.speed,!0)),e._moveY=e._change?0:e.direct===I._U?e.speed:e.direct===I._D?-1*e.speed:void 0,e.x+=e._moveX,e.y+=e._moveY,e.set_imgPos()}}class W extends Y{constructor(t){super({img:e.enemy_o.obj,x:t.x,y:t.y,width:25,direct:t.direct,is_ignore:!0})}isCanvasOut(){return this.x<400}isalive(){return!0}isshot(){return Math.random()<A()}shot(){}setDrawImage(){}moveSet(){if(!this.isshot())return;let e=new Q({x:this.x,y:this.y});m.push(e)}}class Z extends W{constructor(t){super({img:e.enemy_o.obj,x:t.x,y:t.y,direct:t.direct})}moveSet(){if(!this.isshot())return;let e=new J({x:this.x,y:this.y});m.push(e)}}class J extends Y{constructor(t){super({img:e.enemy_o.obj,x:t.x,y:t.y,imgPos:Math.random()>.5?[0]:[25],width:25,height:25,direct:t.direct});this._status=1,this.getscore=100,this.speedX=4*Math.random()+1,this.flagX=Math.random()>.5?1:-1,this.speedY=.2,this._v=-10,this._collision_type="t2"}map_collition(){let e=this,t=e.getEnemyCenterPosition(),s=u.getMapX(t._x),i=u.getMapY(t._y);u.isMapCollision(s,i)&&(e.showCollapes(),e.init())}shot(){}moveSet(){this.map_collition(),this.x-=this.speedX*this.flagX,this.y+=this._v,this._v+=this.speedY}}class Q extends J{constructor(e){super({x:e.x,y:e.y,direct:e.direct});this.speedY=-.2,this._v=10}}class $ extends Y{constructor(t){super({img:t.img||e.enemy_p_1.obj,x:t.x,y:t.y,direct:t.direct});this._status=4,this.getscore=100,this.speedx=u.getBackGroundSpeed(),this.speedy=this.get_move_bound_val(),this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this.audio_collision=s.enemy_collision4,this._s="0000,0000,0000,0000"}setAlive(){this.isalive()||(Tt._set_score(this.getscore),this.showCollapes())}map_collition(){let e=this,t=e.getEnemyCenterPosition(),s=u.getMapX(t._x),i=u.getMapY(t._y),_=!1;u.isMapCollision(s-1,i)&&(e.speedx=Math.abs(e.speedy),_=!0),u.isMapCollision(s+1,i)&&(e.speedx*=-1,_=!0),u.isMapCollision(s,i-1)&&(e.speedy=Math.abs(e.speedy),_=!0),u.isMapCollision(s,i+1)&&(e.speedy*=-1,_=!0),_&&((new Date).getTime()-e.col_date<500||(e.col_date=(new Date).getTime()))}move_bounds(){let e=this,t=m;if(e.isalive())for(let s=0;s<t.length;s++){if(!$.prototype.isPrototypeOf(t[s]))continue;if(!t[s].isalive())continue;if(t[s].x>h.width)continue;if(e.id===t[s].id)continue;R.isSqCollision(e.shotColMap[0],e.x+","+e.y,t[s].shotColMap,t[s].x+","+t[s].y)!==f&&((new Date).getTime()-e.col_date<200||(e.speedx=e.get_move_bound_val(),e.speedy=e.get_move_bound_val(),t[s].speedx=e.get_move_bound_val(),t[s].speedy=e.get_move_bound_val(),e.col_date=(new Date).getTime()))}}showCollapes(){this._isshow=!1;let t=this.getEnemyCenterPosition();const s=[{img:e.enemy_p_2.obj,x:-30,y:-30},{img:e.enemy_p_3.obj,x:0,y:-30},{img:e.enemy_p_4.obj,x:30,y:-30},{img:e.enemy_p_5.obj,x:-30,y:30},{img:e.enemy_p_6.obj,x:0,y:30},{img:e.enemy_p_3.obj,x:30,y:30}];for(let e=0;e<s.length;e++){let i=s[e];m.push(new ee({img:i.img,x:t._x+i.x,y:t._y+i.y}))}T._setPlay(this.audio_collision)}shot(){}moveSet(){this.map_collition(),this.move_bounds(),this.x-=(e=>(e.x+e.img.width>h.width&&(e.speedx=Math.abs(e.speedx)),e.speedx))(this),this.y+=(e=>(e.y<0?e.speedy=Math.abs(e.speedy):e.y+e.img.height>h.height&&(e.speedy=-1),e.speedy))(this)}}class ee extends ${constructor(e){super({img:e.img,x:e.x,y:e.y,direct:e.direct});this.audio_collision=s.enemy_collision5,this._status=5,this.getscore=500,this.speedx=this.get_move_bound_val(),this.speedy=this.get_move_bound_val(),this.col_date=new Date,this._collision_type="t1",this._DEF_SHOTSTATUS._SHOTTYPE_LASER=1}setAlive(){this.isalive()||(Tt._set_score(this.getscore),this.showCollapes(),T._setPlay(this.audio_collision))}showCollapes(e,t){this._isshow=!1,d.push(new hs(e||this.x+this.width/2,t||this.y+this.height/2,this._collision_type))}}class te extends Y{constructor(t){super({img:e.enemy_m_a_1.obj,x:t.x,y:t.y,direct:t.direct});let i=this;i._status=2,i.getscore=500,i._isSetMapDefCol=!1,i._isopen=!1,i._open_count=0,i.imgs=[e.enemy_m_a_1.obj,e.enemy_m_a_2.obj],i.audio_collision=s.enemy_collision5,i.audio_alive=s.enemy_collision8,i._collision_type="t8",i._collision_posy=i.direct===I._D?25:0,i._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,i.shotColMap=[i.direct===I._D?"0,50,35,85":i.direct===I._U?"0,25,35,50":i.direct===I._LD?"75,55,100,70":i.direct===I._LU?"75,35,100,50":void 0],i._s=(()=>i.direct===I._D?"0000,0011,0110,1111":i.direct===I._U?"1111,0110,0011,0000":i.direct===I._LD?"0000,1100,1110,1111":i.direct===I._LU?"1111,1110,1100,0000":void 0)()}collision(e,t){this._isopen&&this.isCollision()&&this.setStatus(e,t)}isRingShot(){let e=this;return!(e._status<=0)&&(!R.isEnemyCanvasOut(e)&&(!(Math.abs(Ft._players_obj.y-e.y)>100)&&(e.direct!==I._LU&&e.direct!==I._LD||!(Ft._players_obj.x<e.x))))}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(e.isalive(),!0)}shot(){let e=this;if(!e.isalive())return;if(!e._open_count>0&&!e.isRingShot()||e._open_count++,e._open_count>0&&(e.img=e.imgs[1],e._isopen=!0),e._open_count>200&&(e.img=e.imgs[0],e._isopen=!1,e._open_count=-100),e._open_count<=0)return;let t=C();e._open_count%t==0&&m.push(new ie({x:e.x+parseInt(e.shotColMap[0].split(",")[0]),y:e.y+parseInt(e.shotColMap[0].split(",")[1]),direct:e.direct}))}showCollapes(){let t=this;t.img=e.enemy_m_z.obj,t._isSetMapDefCol||(u.set_mapdef_col(u.getMapX(t.x),u.getMapY(t.y),t.direct===I._D?"0000,0000,0000,1111":t.direct===I._U?"1111,0000,0000,0000":t.direct===I._LD?"0000,0000,0000,1111":t.direct===I._LU?"1111,0000,0000,0000":void 0),d.push(new hs(t.x+t.img.width/2,t.y+t.img.height/2+t._collision_posy,t._collision_type)),t._isSetMapDefCol=!0)}}class se extends te{constructor(t){super({img:e.enemy_m_b_1.obj,x:t.x,y:t.y,direct:t.direct});let s=this;s._status=2,s.imgs=[e.enemy_m_b_1.obj,e.enemy_m_b_2.obj],s.img=s.imgs[0],s._collision_posy=s.direct===I._D?-10:0,s.shotColMap=[s.direct===I._D?"20,40,50,85":s.direct===I._U?"20,25,50,70":void 0],s._s=(()=>s.direct===I._D?"0000,0000,0010,1111":s.direct===I._U?"1111,0010,0000,0000":void 0)()}}class ie extends Y{constructor(t){super({img:t.img||e.enemy_moai_ring.obj,x:t.x,y:t.y,imgPos:t.imgPos||[0,25],aniItv:t.aniItv||5,width:t.width||25,height:t.height||25});this.audio_collision=s.enemy_collision2,this.rad=R.getRad(Ft._players_obj,{x:t.x,y:t.y}),this.sx=Math.cos(this.rad),this.sy=Math.sin(this.rad),this.speed=2,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this._collision_type="t2",this.direct,I._D}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!0})}map_collition(){let e=this,t=e.getEnemyCenterPosition(),s=u.getMapX(t._x),i=u.getMapY(t._y);u.isMapCollision(s,i)&&(d.push(new hs(t._x,t._y,e._collision_type)),e.init())}shot(){}moveSet(){this.speed-=1,this.map_collition(),this.x+=this.sx*this.speed,this.y+=this.sy*this.speed,this.set_imgPos()}}class _e extends Y{constructor(t){super({img:t.img||e.enemy_frame_large.obj,x:t.x,y:t.y,width:t.width||53,imgPos:t.imgPos||[0,53],direct:t.direct});this.getscore=100,this.speed=-1*E(),this.rad=0,this.speedx=0,this.speedy=0,this._isbroken=!1,this._c=0,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)]}setAlive(){this.isalive()||(Tt._set_score(this.getscore),this.showCollapes())}map_collition(){let e=this,t=e.getEnemyCenterPosition(),s=u.getMapX(t._x),i=u.getMapY(t._y);u.isMapCollision(s,i)&&e.init()}is_nearby(){let e=this.getEnemyCenterPosition(),t=Ft._players_obj.getPlayerCenterPosition();return Math.sqrt(Math.pow(t._x-e._x,2),Math.pow(t._y-e._y,2))<200}showCollapes(){let e=this;if(e._status>0)return;if(e._isbroken)return;let t=e.getEnemyCenterPosition();if(e.is_nearby())return;let i=0,_=m;for(let e=0;e<_.length;e++)oe.prototype.isPrototypeOf(_[e])&&i++;let o=i>20?1:2;for(let s=0;s<o;s++)m.push(new oe({x:t._x,y:t._y,direct:e.direct,rad:e.rad}));e._isbroken=!0,T._setPlay(s.enemy_collision1),e.init()}shot(){}move_standby(){this.x>=h.width||(this.rad=Math.atan2(700*Math.random()-100-this.y,0-this.x),this.deg=this.rad/Math.PI*180,this._standby=!1)}moveSet(){this.speed=E()+1.5,this.speedx=Math.cos(this.rad),this.speedy=Math.sin(this.rad),this.map_collition(),this.set_imgPos(),this.x+=this.speedx*this.speed,this.y+=this.speedy*this.speed}}class oe extends _e{constructor(t){super({img:t.img||e.enemy_frame_small.obj,x:t.x,y:t.y,direct:t.direct,width:t.width||35,imgPos:t.imgPos||[0,35]});this.rad=(t.rad||0)+(Math.random()-.5),this.deg=this.rad/Math.PI*180,this._isbroken=!1,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this._standby=!1}shot(){}setDrawImage(){this.isMove()&&R._setDrawImage({img:this.img,x:this.x,y:this.y,deg:this.deg+180,width:this.width,imgPosx:this.get_imgPos()})}showCollapes(){let e=this;if(e._status>0)return;if(e._isbroken)return;let t=e.getEnemyCenterPosition();if(e.is_nearby())return;let i=0,_=m;for(let e=0;e<_.length;e++)ne.prototype.isPrototypeOf(_[e])&&i++;let o=i>30?0:2;for(let s=0;s<o;s++)m.push(new ne({x:t._x,y:t._y,direct:e.direct,rad:e.rad}));e._isbroken=!0,T._setPlay(s.enemy_collision1),e.init()}}class ne extends oe{constructor(t){super({img:e.enemy_frame_mini.obj,x:t.x,y:t.y,direct:t.direct,width:30,imgPos:[0,30]});this._isbroken=!1,this.rad=(t.rad||0)+(Math.random()-.5),this.deg=this.rad/Math.PI*180,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this.is_able_collision=!1,this.is_ignore_collision=Math.random()>.05,this._standby=!1}}class ae extends Y{constructor(t){super({img:e.enemy_cell_core.obj,x:t.x,y:t.y,aniItv:20});this._status=10,this.getscore=500,this.audio_alive=s.enemy_collision7,this._collision_type="t9",this.rad=0,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this.hands_up_rad=[],this.hands_up=[],this.hands_up_count={c:0,max:parseInt(300*Math.random())+100},this.hands_down_rad=[],this.hands_down=[],this.hands_down_count={c:0,max:parseInt(300*Math.random())+100},this.hands_distance=12}set_hands_target(e,t){let s=Ft._players_obj.getPlayerCenterPosition();return e%t>0&&e%t<parseInt(t/2)?s:{_x:this.x+200,_y:this.y+100}}set_hands_rad(e,t,s,i){let _=i,o=s.getEnemyCenterPosition(),n=parseInt(100*Math.random())-50,a=_._x+n-o._x,r=_._y+n-o._y,h=(e=>{let t=Math.random()/50;return(e=(e=s.flag?Math.cos(e)>0?s.rad+t:s.rad-t:Math.cos(e)>0?s.rad-t:s.rad+t)<0?2*Math.PI+e:e)>=s.rad_min&&e<=s.rad_max?e:s.rad})(Math.atan2(r,a));s.rad=h,e.unshift(h)}set_hands_pos(e,t,s,i,_){t.x=(i||0)+s.x+Math.cos(e)*this.hands_distance,t.y=(_||0)+s.y+Math.sin(e)*this.hands_distance}is_hands_up_status(){let e=this;for(let t=0;t<e.hands_up.length;t++)if(he.prototype.isPrototypeOf(e.hands_up[t]))return e.hands_up[t].isalive()}is_hands_down_status(){let e=this;for(let t=0;t<e.hands_down.length;t++)if(he.prototype.isPrototypeOf(e.hands_down[t]))return e.hands_down[t].isalive()}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1},{left:200})}showCollapes(){let e=this,t=e.getEnemyCenterPosition();e._isshow=!1;for(let t=0;t<e.hands_up.length;t++)e.hands_up[t].showCollapes();for(let t=0;t<e.hands_down.length;t++)e.hands_down[t].showCollapes();d.push(new hs(t._x,t._y,e._collision_type)),T._setPlay(e.audio_collision)}move_standby(){let e=this;if(e.x<h.width-20){e._standby=!1,e.hands_up=[new re({x:e.x,y:e.y,rad:3*Math.PI/2,rad_min:Math.PI+1.5,rad_max:Math.PI+2,flag:!0,ignore_collision:!1}),new re({x:e.x,y:e.y,rad:3*Math.PI/2-.2,rad_min:Math.PI+1,rad_max:Math.PI+2.2,flag:!0,ignore_collision:!1}),new re({x:e.x,y:e.y,rad:3*Math.PI/2-.4,rad_min:Math.PI+.7,rad_max:Math.PI+2.4,flag:!0,ignore_collision:!1}),new re({x:e.x,y:e.y,rad:3*Math.PI/2-.4,rad_min:Math.PI+.7,rad_max:Math.PI+2.4,flag:!0,ignore_collision:!1}),new he({x:e.x,y:e.y,rad:3*Math.PI/2-.6,rad_min:Math.PI+.5,rad_max:Math.PI+2.6,flag:!0}),new re({x:e.x,y:e.y,rad:3*Math.PI/2-.8,rad_min:Math.PI+.5,rad_max:Math.PI+2.8,flag:!0}),new re({x:e.x,y:e.y,rad:3*Math.PI/2-1,rad_min:Math.PI+.3,rad_max:Math.PI+2.8,flag:!0}),new re({x:e.x,y:e.y,rad:3*Math.PI/2-1.2,rad_min:Math.PI+.3,rad_max:Math.PI+2.8,flag:!0}),new le({x:e.x,y:e.y,rad:3*Math.PI/2-1.4,rad_min:Math.PI+.3,rad_max:Math.PI+2.6,flag:!0})];for(let t=0;t<e.hands_up.length;t++)m.push(e.hands_up[t]);e.hands_down=[new re({x:e.x,y:e.y,rad:Math.PI-1,rad_min:Math.PI-2,rad_max:Math.PI-1,flag:!1,ignore_collision:!1}),new re({x:e.x,y:e.y,rad:Math.PI-1,rad_min:Math.PI-2.1,rad_max:Math.PI-.9,flag:!1,ignore_collision:!1}),new re({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.2,rad_max:Math.PI-.9,flag:!1,ignore_collision:!1}),new re({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.3,rad_max:Math.PI-.6,flag:!1,ignore_collision:!1}),new he({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.7,rad_max:Math.PI-.6,flag:!1}),new re({x:e.x,y:e.y,rad:Math.PI-.8,rad_min:Math.PI-2.7,rad_max:Math.PI-.6,flag:!1}),new re({x:e.x,y:e.y,rad:Math.PI-.8,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1}),new re({x:e.x,y:e.y,rad:Math.PI-.7,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1}),new le({x:e.x,y:e.y,rad:Math.PI-.7,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1})];for(let t=0;t<e.hands_down.length;t++)m.push(e.hands_down[t])}}shot(){}set_aniPos(){this._c=this._c>=this.ani.length*this.aniItv-1?0:this._c+1}get_aniPos(){return this.ani[parseInt(this._c/this.aniItv)]}setDrawImage(){let e=this;for(let t=0;t<e.hands_up.length;t++)0!==t?(e.set_hands_pos(e.hands_up_rad[t],e.hands_up[t],e.hands_up[t-1]),e.hands_up[t].moveDraw()):(e.set_hands_pos(e.hands_up_rad[t],e.hands_up[t],e,e.img.width/2-e.hands_up[t].img.width/2,10),e.hands_up[t].moveDraw());for(let t=0;t<e.hands_down.length;t++)0!==t?(e.set_hands_pos(e.hands_down_rad[t],e.hands_down[t],e.hands_down[t-1]),e.hands_down[t].moveDraw()):(e.set_hands_pos(e.hands_down_rad[t],e.hands_down[t],e,e.img.width/2-e.hands_down[t].img.width/2,e.img.height-30),e.hands_down[t].moveDraw());const t=e.getEnemyCenterPosition();R._setDrawImage({img:e.img,x:t._x,y:t._y,scale:e.get_aniPos().scale*(e._status/10>.7?e._status/10:.7)})}moveSet(){let e=this;e.set_aniPos();const t=e.getEnemyCenterPosition(),s=Ft._players_obj.getPlayerCenterPosition();let i=R.getRad({x:s._x,y:s._y},{x:t._x,y:t._y});if(e.y+=Math.sin(i)*(e.speed-1),!e.is_hands_up_status()&&0!==e.hands_up.length){for(let t=0;t<e.hands_up.length;t++)e.hands_up[t].showCollapes();e.hands_up=[]}if(!e.is_hands_down_status()&&0!==e.hands_down.length){for(let t=0;t<e.hands_down.length;t++)e.hands_down[t].showCollapes();e.hands_down=[]}e.hands_up_rad=[],e.hands_up_count.c=e.hands_up_count.c>e.hands_up_count.max?0:e.hands_up_count.c+1;let _=e.set_hands_target(e.hands_up_count.c,e.hands_up_count.max);for(let t=e.hands_up.length-1;t>=0;t--){if(void 0===e.hands_up[t-1]){e.set_hands_rad(e.hands_up_rad,e,e.hands_up[t],_);break}e.set_hands_rad(e.hands_up_rad,e.hands_up[t-1],e.hands_up[t],_),le.prototype.isPrototypeOf(e.hands_up[t])&&e.hands_up[t].shot()}e.hands_down_rad=[],e.hands_down_count.c=e.hands_down_count.c>e.hands_down_count.max?0:e.hands_down_count.c+1;let o=e.set_hands_target(e.hands_down_count.c,e.hands_down_count.max);for(let t=e.hands_down.length-1;t>=0;t--){if(void 0===e.hands_down[t-1]){e.set_hands_rad(e.hands_down_rad,e,e.hands_down[t],o);break}e.set_hands_rad(e.hands_down_rad,e.hands_down[t-1],e.hands_down[t],o),le.prototype.isPrototypeOf(e.hands_down[t])&&e.hands_down[t].shot()}let n=e.get_aniPos(),a=e.img.width/2-e.img.width*n.scale/2+","+(e.img.height/2-e.img.height*n.scale/2)+","+e.img.width*n.scale+","+e.img.height*n.scale;e.shotColMap=[a]}}class re extends Y{constructor(t){super({img:t.img||e.enemy_cell_hand_1.obj,x:t.x,y:t.y});this._initx=t.x||0,this._inity=t.y||0,this.rad=t.rad,this.rad_min=t.rad_min||-1,this.rad_max=t.rad_max||-2,this.flag=t.flag||!1,this.is_able_collision=!1,this._collision_type="t2",this.is_ignore_collision=t.ignore_collision||!0,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this._c=0}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1},{left:200})}showCollapes(){let e=this.getEnemyCenterPosition();d.push(new hs(e._x,e._y,this._collision_type)),this.init()}shot(){}setDrawImage(){}moveDraw(){this._c=this._c>=20*this.ani.length-1?0:this._c+1;const e=this.getEnemyCenterPosition();R._setDrawImage({img:this.img,x:e._x,y:e._y,scale:this.ani[parseInt(this._c/20)].scale}),this.shot()}move(){this.x=u.getX(this.x),this.y=u.getY(this.y),this.isMove()}}class he extends re{constructor(t){t.img=e.enemy_cell_hand_2.obj,super(t);this.is_able_collision=!0,this.audio_alive=s.enemy_collision7,this._status=10,this.is_ignore_collision=!1,this.shotColMap=["-10,-10,"+(this.img.width+10)+","+(this.img.height+10)]}shot(){}}class le extends re{constructor(t){t.img=e.enemy_cell_hand_3.obj,super(t)}shot(){if(R.isEnemyCanvasOut(this))return;if(!this.isshot())return;let t=this.getEnemyCenterPosition();c.push(new Te({x:t._x,y:t._y,img:e.enemy_bullet_cell.obj,imgPos:[0,15],width:15}))}moveDraw(){let e=Ft._players_obj.getPlayerCenterPosition(),t=this.getEnemyCenterPosition(),s=Math.atan2(t._y-e._y,t._x-e._x);R._setDrawImage({img:this.img,x:t._x,y:t._y,deg:s/Math.PI*180})}}class me extends B{constructor(t){super({img:e.enemy_cell_a.obj,x:t.x,y:t.y,direct:t.direct})}}class ce extends B{constructor(t){super({img:e.enemy_cell_b.obj,x:t.x,y:t.y,direct:t.direct});this.haspc=!0}}class de extends Y{constructor(e){super({img:e.img,x:e.x,y:e.y,width:e.width||e.img.width,height:e.height||e.img.height,imgPos:e.imgPos,aniItv:e.aniItv});this.speed=0,this.getscore=1e4,this._c_self_collision=4e3,this.audio_collision=s.enemy_collision6,this.audio_background=s.bg_boss,this.is_able_collision=!1,this._collision_type="t9",this._count=0,this.is_all_set=!1}shot(){}setSelfCollision(){if(!(this._count<this._c_self_collision)){for(let e=0;e<m.length;e++)m[e]._status=0;this.showCollapes(),T._setPlay(this.audio_collision)}}move_Allset(){}isAllset(){return!!this.is_all_set||(this.move_Allset(),!1)}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):!!e.isshow()&&!!e.isalive()}move(){this.x=u.getX(this.x),this.y=u.getY(this.y),this.setSelfCollision(),this.isMove()&&this.isAllset()&&(this.moveSet(),this.shot(),this._count++)}}class ge extends Y{constructor(e){super({img:e.img,x:e.x,y:e.y,width:e.width,height:e.height});this._initx=e.x||0,this._inity=e.y||0,this._boss=e.boss,this.x=this._boss.x+this._initx,this.y=this._boss.y+this._inity,this._status=10,this._standby=!1,this.getscore=500,this.is_able_collision=!1,this.audio_collision=s.enemy_collision5,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5}set_able_collision(){this.is_able_collision=!0}move(){let e=void 0===this._boss?0:this._boss.x,t=void 0===this._boss?0:this._boss.y;this.x=e+parseInt(this._initx),this.y=t+parseInt(this._inity)}}class pe extends de{constructor(t){super({img:e.enemy_bigcore.obj,x:t.x,y:t.y});this._status=1,this.speed=3,this.is_able_collision=!1,this.wall=[],this._wall_statuses="",this.tid=null,this._moveYStop=!1,this.shotColMap=["120,0,169,40,false","120,70,169,114,false"]}show_walls(){let e=this;for(let t=0;t<e.wall.length;t++)(void 0===e.wall[t-1]||e.wall[t-1]._status<=0)&&e.wall[t].set_able_collision()}shot(){let t=this;if(!(Math.random()>.02)){t._moveYStop=!0;for(let s=0;s<=105;s+=35)c.push(new Re({x:t.x,y:t.y+s,img:e.enemy_bullet_z.obj,width:45,imgPos:[0]}));T._setPlay(s.enemy_bullet_laser),t.tid=setTimeout(function(){t._moveYStop=!1,clearTimeout(t.tid)},100)}}move_Allset(){let e=this;e.x-=4,e.x<h.width-e.img.width-80&&(e.is_all_set=!0)}move_standby(){let t=this;0===t.wall.length&&(t.wall=[new ge({img:e.enemy_bigcore_1.obj,boss:t,x:15,y:51}),new ge({img:e.enemy_bigcore_1.obj,boss:t,x:25,y:51}),new ge({img:e.enemy_bigcore_1.obj,boss:t,x:35,y:51}),new ge({img:e.enemy_bigcore_2.obj,boss:t,x:45,y:53}),new ge({img:e.enemy_bigcore_core.obj,boss:t,x:70,y:43,width:30,height:30})],t.wall.map(e=>{m.push(e)})),t._standby=!1}moveSet(){let e=this;e.show_walls(),e.y+=e._moveYStop?0:e.speed,e.speed=e.y<50||e.y+e.img.height>450?-1*e.speed:e.speed,e.shot(),e.wall.every(e=>!e.isalive())&&(e._status=0,e.setAlive())}}class ye extends de{constructor(t){super({img:e.enemy_bigcore2.obj,x:t.x,y:t.y});let s=this;s.speed=0,s.speed_mount=2,s.is_able_collision=!1,s.wall_up=[],s.wall_down=[],s.hands_up=[],s.hands_down=[],s.back=[0,85,170,255,340,425],s.back_img_up={x:200,y:-50,st:0,flag:!0,s1:function(){this.st>=15&&(this.flag=!1),this.st<=6&&(this.flag=!0),this.st=this.flag?this.st+1:this.st-1},s2:function(){this.st>=6&&(this.flag=!1),this.st<=0&&(this.flag=!0),this.st=this.flag?this.st+1:this.st-1},f:function(){let t=e.enemy_bigcore2_back.obj,i=(t.height,t.height);l.drawImage(t,85*parseInt(this.st/3),0,85,i,s.x+this.x,s.y+this.y,85,i)}},s.back_img_down={x:200,y:-120,st:0,flag:!0,s1:function(){this.st>=15&&(this.flag=!1),this.st<=6&&(this.flag=!0),this.st=this.flag?this.st+1:this.st-1},s2:function(){this.st>=6&&(this.flag=!1),this.st<=0&&(this.flag=!0),this.st=this.flag?this.st+1:this.st-1},f:function(){let t=e.enemy_bigcore2_back.obj,i=(t.height,t.height);l.save(),l.setTransform(1,0,0,-1,0,2*s.y+t.height),l.drawImage(t,85*parseInt(this.st/3),0,85,i,s.x+this.x,s.y+this.y,85,i),l.restore()}},s.tid=null,s._moveYStop=!1,s.shotColMap=["130,0,240,156,false"],s._collision_type="t9",s._hands_open_flag=!1}shot(){let e=this,t=e.getEnemyCenterPosition(),i=Ft._players_obj.getPlayerCenterPosition();if(e._count%150==0&&(e._moveYStop=!1),e._count%150>50&&e._count%150<99&&(e._moveYStop=!0),e._count%150==51&&(e._hands_open_flag=Math.abs(i._y-t._y)<100,e._hands_open_flag&&(e.hands_up.reverse().map(e=>{e.isHandsOpen=!0}),e.hands_down.reverse().map(e=>{e.isHandsOpen=!0}))),e._count%150==70){let t=[];e._hands_open_flag?(e.wall_up.some(e=>e.isalive())&&(t=t.concat([{x:85,y:-75},{x:70,y:-45},{x:120,y:-20},{x:100,y:0},{x:80,y:25},{x:60,y:45},{x:0,y:55}])),e.wall_down.some(e=>e.isalive())&&(t=t.concat([{x:0,y:85},{x:60,y:95},{x:80,y:115},{x:100,y:135},{x:120,y:160},{x:70,y:170},{x:85,y:200}]))):(e.wall_up.some(e=>e.isalive())&&(t=t.concat([{x:60,y:20},{x:0,y:55}])),e.wall_down.some(e=>e.isalive())&&(t=t.concat([{x:0,y:95},{x:60,y:130}])));for(let s=0;s<t.length;s++)c.push(new Re({x:e.x+t[s].x,y:e.y+t[s].y}));T._setPlay(s.enemy_bullet_laser)}e._count%150==110&&(e.hands_up.reverse().map(e=>{e.isHandsClose=!0}),e.hands_down.reverse().map(e=>{e.isHandsClose=!0}))}move_Allset(){let e=this;e.x-=4,e.speed>0&&!e._moveYStop?e.back_img_up.s1():e.back_img_up.s2(),e.back_img_up.f(),e.speed<0&&!e._moveYStop?e.back_img_down.s1():e.back_img_down.s2(),e.back_img_down.f(),e.x<h.width-e.img.width-80&&(e.speed=2,e.is_all_set=!0)}move_standby(){let t=this;0===t.wall_up.length&&(t.wall_up=[new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:90,y:38}),new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:95,y:38}),new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:100,y:38}),new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:105,y:38}),new ge({img:e.enemy_bigcore2_core.obj,boss:t,x:110,y:36})],t.wall_up.map(e=>{m.push(e)})),0===t.wall_down.length&&(t.wall_down=[new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:90,y:95}),new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:95,y:95}),new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:100,y:95}),new ge({img:e.enemy_bigcore2_wall.obj,boss:t,x:105,y:95}),new ge({img:e.enemy_bigcore2_core.obj,boss:t,x:110,y:93})],t.wall_down.map(e=>{m.push(e)})),0===t.hands_up.length&&(t.hands_up=[new ue({_initx:-52,_inity:-30,_dir:I._U,_boss:t})],m.push(t.hands_up[0])),0===t.hands_down.length&&(t.hands_down=[new ue({_initx:-52,_inity:75,_dir:I._D,_boss:t})],m.push(t.hands_down[0])),t._standby=!1}show_walls(){this.wall_up.map((e,t,s)=>{(void 0===s[t-1]||s[t-1]._status<=0)&&(e.is_able_collision=!0)}),this.wall_down.map((e,t,s)=>{(void 0===s[t-1]||s[t-1]._status<=0)&&(e.is_able_collision=!0)})}moveSet(){let e=this;e.speed>0&&!e._moveYStop?e.back_img_up.s1():e.back_img_up.s2(),e.back_img_up.f(),e.speed<0&&!e._moveYStop?e.back_img_down.s1():e.back_img_down.s2(),e.back_img_down.f(),e.show_walls(),e.y+=e._moveYStop?0:e.speed,e.speed=(()=>{if(e.y<50)return e.speed_mount;if(e.y+e.img.height>450)return-1*e.speed_mount;if(e._count%150!=0)return e.speed;let t=e.getEnemyCenterPosition()._y,s=Ft._players_obj.getPlayerCenterPosition()._y;return t<s?e.speed_mount:t>=s?-1*e.speed_mount:void 0})(),e.hands_up.reverse().map(t=>{e.wall_up.every(e=>!e.isalive())&&!t.is_hand_stop()&&(T._setPlay(e.audio_collision),t.set_hand_stop())}),e.hands_down.reverse().map(t=>{e.wall_down.every(e=>!e.isalive())&&!t.is_hand_stop()&&(T._setPlay(e.audio_collision),t.set_hand_stop())}),e.wall_up.every(e=>!e.isalive())&&e.wall_down.every(e=>!e.isalive())&&(e.hands_up.reverse().map(e=>{e._status=0}),e.hands_down.reverse().map(e=>{e._status=0}),e._status=0,e.setAlive())}}class ue extends Y{constructor(t){super({img:e.enemy_bigcore2_hand.obj,x:t._initx,y:t._inity,imgPos:[0,250,500],aniItv:6});let s=this;s._initx=t._initx||0,s._inity=t._inity||0,s._boss=t._boss,s.x=s._initx+t._boss.x,s.y=s._inity+t._boss.y,s._standby=!1,s.is_able_collision=!1,s.width=250,s.isshot=void 0!==t._img,s.isHandsOpen=!1,s.isHandsClose=!1,s.isstop=!1,s.direct=t._dir||I._U,s.shotColMap=[s.direct===I._U?"90,30,250,70,false":s.direct===I._D?"90,40,250,100,false":void 0],s.shotColMapTmp=s.direct===I._U?[["25,70,250,110,false","90,30,250,70,false"],["180,30,250,90,false"],["50,10,225,20,false"]]:s.direct===I._D?[["25,0,250,40,false","90,40,250,100,false"],["180,20,250,60,false"],["50,90,225,100,false"]]:void 0,s.imgsPos=[{x:0,y:(s.direct,I._U,0)},{x:0,y:s.direct===I._U?-40:40},{x:-5,y:s.direct===I._U?-30:30}],s.imgs_x=0,s.imgs_y=0}init(){this._isshow=!1,this._status=0}shot(){}showCollapes(){}setStatus(){this._status=0}is_hand_stop(){return this.isstop}set_hand_stop(){this.isstop=!0}move_hands_open(){let e=this;if(!e.isHandsOpen)return;if(e.isstop)return;let t=e.imgsPos[parseInt(e._c/e.aniItv)];e.imgs_x=parseInt(t.x),e.imgs_y=parseInt(t.y),e.shotColMap=[];let s=e.shotColMapTmp[parseInt(e._c/e.aniItv)];for(let t=0;t<s.length;t++)e.shotColMap.push(s[t]);if(e._c>=6*e.imgPos.length-1)return e._c=6*e.imgPos.length-1,void(e.isHandsOpen=!1);e._c++}set_imgPos(){}move_hands_close(){let e=this;if(!e.isHandsClose)return;if(e.isstop)return;let t=e.imgsPos[parseInt(e._c/e.aniItv)];e.imgs_x=parseInt(t.x),e.imgs_y=parseInt(t.y),e.shotColMap=[];let s=e.shotColMapTmp[parseInt(e._c/e.aniItv)];for(let t=0;t<s.length;t++)e.shotColMap.push(s[t]);if(e._c<=0)return e._c=0,void(e.isHandsClose=!1);e._c--}move(){this.move_hands_open(),this.move_hands_close(),this.x=this._boss.x+parseInt(this._initx)+this.imgs_x,this.y=this._boss.y+parseInt(this._inity)+this.imgs_y}}class we extends de{constructor(t){super({img:e.enemy_cristalcore.obj,x:t.x,y:t.y});this._status=1,this.speed=3,this.wall=[],this.hands_up=[],this.hands_down=[],this.is_able_collision=!1,this._shot_count=0,this.shotColMap=["25,0,227,10,false","25,242,227,250,false","120,0,227,250,false"],this.wall=[],this.hands_up=[new xe({_boss:this,_ignore_collision:!0,_initx:50,_inity:80,_cmr:60,_cmsr:70,_initRad:40,_data:"0,0,180,10",_change:!0}),new xe({_boss:this,_ignore_collision:!0,_initx:50,_inity:80,_cmr:70,_cmsr:80,_initRad:70,_data:"0,0,185,5",_change:!0}),new xe({_boss:this,_initx:50,_inity:80,_cmr:80,_cmsr:100,_initRad:100,_data:"0,0,180,-10",_change:!0}),new xe({_boss:this,_initx:50,_inity:80,_cmr:89,_cmsr:125,_initRad:130,_data:"0,0,175,-25",_change:!0}),new xe({_boss:this,_initx:50,_inity:80,_cmr:97,_cmsr:145,_initRad:160,_data:"0,0,170,-40",_change:!0}),new xe({_boss:this,_initx:50,_inity:80,_cmr:106,_cmsr:160,_initRad:190,_data:"0,0,165,-55",_change:!0}),new xe({_boss:this,_img:e.enemy_cristalcore_hand2.obj,_initx:50,_inity:80,_cmr:115,_cmsr:170,_initRad:215,_data:"0,0,160,-70",_change:!0})],this.hands_up.map(e=>{m.push(e)}),this.hands_down=[new xe({_boss:this,_ignore_collision:!0,_initx:50,_inity:155,_cmr:60,_cmsr:70,_initRad:40,_data:"0,0,180,-10",_change:!1}),new xe({_boss:this,_ignore_collision:!0,_initx:50,_inity:155,_cmr:70,_cmsr:80,_initRad:70,_data:"0,0,175,-5",_change:!1}),new xe({_boss:this,_initx:50,_inity:155,_cmr:80,_cmsr:100,_initRad:100,_data:"0,0,180,10",_change:!1}),new xe({_boss:this,_initx:50,_inity:155,_cmr:89,_cmsr:125,_initRad:130,_data:"0,0,185,25",_change:!1}),new xe({_boss:this,_initx:50,_inity:155,_cmr:97,_cmsr:145,_initRad:160,_data:"0,0,190,40",_change:!1}),new xe({_boss:this,_initx:50,_inity:155,_cmr:106,_cmsr:160,_initRad:190,_data:"0,0,195,55",_change:!1}),new xe({_boss:this,_img:e.enemy_cristalcore_hand2.obj,_initx:50,_inity:155,_cmr:115,_cmsr:170,_initRad:215,_data:"0,0,200,70",_change:!1})],this.hands_down.map(e=>{m.push(e)})}show_walls(){let e=this;for(let t=0;t<e.wall.length;t++)(void 0===e.wall[t-1]||e.wall[t-1]._status<=0)&&e.wall[t].set_able_collision()}shot(){let e=this;if(e._shot_count++,e._count%1200>800){if(e._shot_count<10)return}else if(e._c%1200<=800&&e._shot_count<50)return;e._shot_count=0,c.push(new Re({x:e.x,y:e.y+111})),c.push(new Re({x:e.x,y:e.y+140})),T._setPlay(s.enemy_bullet_laser)}showCollapes(){let e=this;e._isshow=!1;for(let t=e.hands_up.length-1;t>=0;t--)e.hands_up[t].showCollapes(e.hands_up[t].x,e.hands_up[t].y),e.hands_up[t].init();for(let t=e.hands_down.length-1;t>=0;t--)e.hands_down[t].showCollapes(e.hands_down[t].x,e.hands_down[t].y),e.hands_down[t].init();d.push(new hs(e.x+e.img.width/2,e.y+e.img.height/2,e._collision_type))}move_Allset(){let e=this;e.y-=4,e.y<200&&(e.is_all_set=!0)}move_standby(){let t=this;0===t.wall.length&&(t.wall=[new ge({img:e.enemy_cristalcore_wall1.obj,boss:t,x:47,y:116}),new ge({img:e.enemy_cristalcore_wall2.obj,boss:t,x:62,y:116}),new ge({img:e.enemy_cristalcore_wall2.obj,boss:t,x:77,y:116}),new ge({img:e.enemy_cristalcore_wall2.obj,boss:t,x:92,y:116}),new ge({img:e.enemy_bigcore_core.obj,boss:t,x:102,y:115,width:30,height:30})],t.wall.map(e=>{m.push(e)}),t.hands_down.map(e=>{m.push(e)})),t._standby=!1}moveSet(){let e=this;e.show_walls();for(let t=e.hands_up.length-1;t>=0;t--)e.hands_up[t].moveDraw(e);for(let t=e.hands_down.length-1;t>=0;t--)e.hands_down[t].moveDraw(e);if(e.y+=e.speed,e._count%1200>800&&e._count%45==0&&(e.speed*=-1),(e.y+e.img.height>h.height||e.y<0)&&(e.speed*=-1),e.wall.every(e=>!e.isalive())){for(let t=e.hands_up.length-1;t>=0;t--)e.hands_up[t]._status=0;for(let t=e.hands_down.length-1;t>=0;t--)e.hands_down[t]._status=0;e._status=0,e.setAlive()}}}class xe extends Y{constructor(t){super({img:e.enemy_cristalcore_hand1.obj,x:t._initx,y:t._inity});this._initx=t._initx||0,this._inity=t._inity||0,this._boss=t._boss,this._c_move_round=t._cmr||0,this._c_move_self_round=t._cmsr||0,this._initRad=t._initRad||0,this._data=t._data||"0,0,0,0",this.img=t._img||e.enemy_cristalcore_hand1.obj,this._count_turn=0,this._change=t._change,this._standby=!1,this.is_able_collision=!1,this.is_ignore_collision=t._ignore_collision||!1,this.isshot=void 0!==t._img,this._shot_count=0,this._collision_type="t1",this._c=0;let s=this._data.split(","),i=parseInt(s[2])+(this._change?1:-1),_=this._initRad*Math.cos(i*(Math.PI/180)),o=this._initRad*Math.sin(i*(Math.PI/180)),n=parseInt(s[3])+(this._change?1:-1);this._data=_+","+o+","+i+","+n}collision(e,t){}setStatus(){this._status=0}shot(){if(!1===this.isshot)return;if(this._shot_count++,this._shot_count<20)return;this._shot_count=0;let e=this._data.split(",");c.push(new Ye({x:this.x+10,y:this.y+10,deg:parseInt(e[3])}))}move_hands(){let e=this;if(e._count_turn>=4)return void(e._c>400&&(e._c=0,e._count_turn=0));e._c>200&&(e._c=0,e._count_turn++,e._change=!e._change);let t=e._data.split(","),s=e._c_move_round,i=e._c_move_self_round;if(e._c>i)return;if(e._c<=i&&e._c>s){let s=parseInt(t[3])+(e._change?1:-1);return void(e._data=t[0]+","+t[1]+","+t[2]+","+s)}let _=parseInt(t[2])+(e._change?1:-1),o=e._initRad*Math.cos(_*(Math.PI/180)),n=e._initRad*Math.sin(_*(Math.PI/180)),a=parseInt(t[3])+(e._change?1:-1);e._data=o+","+n+","+_+","+a}setDrawImage(){let e=this._data.split(","),t=this._initx,s=this._inity,i=parseInt(e[3])*Math.PI/180,_=this._boss.x+parseInt(e[0])+t+this.img.width,o=this._boss.y+parseInt(e[1])+s+parseInt(this.img.height/1.5);this.x=this._boss.x+parseInt(e[0])+t,this.y=this._boss.y+parseInt(e[1])+s,l.save(),l.setTransform(Math.cos(i),Math.sin(i),-Math.sin(i),Math.cos(i),_-_*Math.cos(i)+o*Math.sin(i),o-_*Math.sin(i)-o*Math.cos(i)),l.drawImage(this.img,this._boss.x+parseInt(e[0])+t,this._boss.y+parseInt(e[1])+s,this.img.width,this.img.height),l.restore()}moveDraw(e){e.is_all_set&&(this.shot(),this.move_hands(),this._c++)}move(){}}class be extends de{constructor(t){super({img:e.enemy_cube.obj,x:t.x,y:t.y});this._standby=!1,this._standby_count=0,this._complete_cube_count=0,this._map_col_reset=!1,this._cube_shot_max=100,this.parts=[],this.is_all_set=!0}setSelfCollision(){}moveSet(){let e=this;if(e.parts.every(e=>e._stop)&&e._complete_cube_count++,e._standby_count%40==0&&e.parts.length<e._cube_shot_max){let t=new ve({x:1e3,y:400*Math.random()+50});m.push(t),e.parts.push(t)}if(0!==e._complete_cube_count)return e.parts.map(t=>{t.alpha=e.alpha}),50===e._complete_cube_count&&(e.alpha=.7),100===e._complete_cube_count&&(e.alpha=.3),150===e._complete_cube_count&&(u.set_mapdef_col_clear(),e.alpha=0),200===e._complete_cube_count?(e._status=0,!1):(e._standby_count++,!0)}}class ve extends Y{constructor(t){super({img:e.enemy_cube.obj,x:t.x,y:t.y,imgPos:[0,70,140,210],aniItv:10,width:70,height:70});this._standby=!1,this._status=1,this.speed=5,this.change_speed_c=parseInt(150*Math.random())+10,this._stop=!1,this.is_able_collision=!1,this.audio_collision=s.enemy_cube,this._col_c=0,this._count=0,this.tx=0,this.ty=0,this.rad=0,this.deg=0,this.sx=0,this.sy=0,this.shotColMap=["10,10,"+parseInt(this.width-10)+","+parseInt(this.height-10)]}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!0,down:!0,left:!0,right:!0})}shot(){}isMove(){let e=this;return 0===e.alpha?(e.init(),!1):e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()}move_bounds(){let e=this,t=m;for(let s=0;s<t.length;s++){if(!ve.prototype.isPrototypeOf(t[s]))continue;if(e.id===t[s].id)continue;if(!t[s]._stop)continue;if(R.isSqCollision("12,12,38,38",e.x+","+e.y,["12,12,38,38"],t[s].x+","+t[s].y)!==f)return!0}return!1}moveSet(){let e=this;if(!0!==e._stop){if(e.x<0||e.y<0||e.y+50>h.height||e.move_bounds()){let t=e.getEnemyCenterPosition();return u.set_mapdef_col(u.getMapX(t._x),u.getMapY(t._y),"11,11"),e._status=0,e._stop=!0,void T._setPlay(e.audio_collision)}e._count<e.change_speed_c&&(e.x-=e.speed),e._count===e.change_speed_c&&(e.tx=Ft._players_obj.getPlayerCenterPosition()._x,e.ty=Ft._players_obj.getPlayerCenterPosition()._y,e.rad=Math.atan2(e.ty-e.y,e.tx-e.x),e.deg=180*e.rad/Math.PI,e.sx=Math.cos(e.rad),e.sy=Math.sin(e.rad),e.speed=6*E()),e._count>e.change_speed_c&&(e.x+=e.sx*e.speed,e.y+=e.sy*e.speed),e._count++,e.set_imgPos()}}move(){let e=this;0!==e.alpha?e.isMove()&&e.moveSet():e.init()}}class fe extends de{constructor(t){super({img:e.enemy_frame_body1.obj,x:t.x,y:t.y});let s=this;s._status=1,s.speed=3,s.moves_interval=15,s.shotColMap=[parseInt(s.img.width/2)+","+parseInt(s.img.height/2)+","+parseInt(s.img.width/2+1)+","+parseInt(s.img.height/2+1)],s._radX=0,s._radY=0,s._rad=100,s._deg=16,s._f=!1,s._mpt=0,s._collision_type="t9",s._collision_set=!1,s.movePos={_pos:0,_pos_same_count:0,_getPos:function(){return this._pos},_setPos:function(){let e=s.getEnemyCenterPosition();e._x<200?e._y<150?this._pos=1:e._y>h.height-150?this._pos=7:this._pos=4:e._x>h.width-200?e._y<150?this._pos=3:e._y>h.height-150?this._pos=9:this._pos=6:e._y<150?this._pos=2:e._y>h.height-150?this._pos=8:this._pos=5},move:function(){let e=this._getPos();if(this._setPos(),e===this._pos){if(this._pos_same_count++,this._pos_same_count<70)return;let e=5===(t=this)._pos?Math.random()>.4?2:1:3===t._pos&&1===s._mpt&&s._deg<190&&s._deg>=180?0:3===t._pos&&2===s._mpt&&s._deg<90&&s._deg>=80?0:6===t._pos&&1===s._mpt&&s._deg<270&&s._deg>=260?0:6===t._pos&&2===s._mpt&&s._deg<100&&s._deg>=90?0:9===t._pos&&1===s._mpt&&s._deg<280&&s._deg>=270?0:9===t._pos&&2===s._mpt&&s._deg<190&&s._deg>=180?0:2===t._pos&&1===s._mpt&&s._deg<180&&s._deg>=170?0:2===t._pos&&2===s._mpt&&s._deg<10&&s._deg>=0?0:8===t._pos&&1===s._mpt&&s._deg<360&&s._deg>=350?0:8===t._pos&&2===s._mpt&&s._deg<190&&s._deg>=180?0:1===t._pos&&1===s._mpt&&s._deg<180&&s._deg>=170?0:1===t._pos&&2===s._mpt&&s._deg<280&&s._deg>=270?0:4===t._pos&&1===s._mpt&&s._deg<90&&s._deg>=80?0:4===t._pos&&2===s._mpt&&s._deg<280&&s._deg>=270?0:7===t._pos&&1===s._mpt&&s._deg<360&&s._deg>=350?0:7===t._pos&&2===s._mpt&&s._deg<90&&s._deg>=80?0:s._mpt;return s.x<-s._rad||s.x>h.width+s._rad||s.y<-s._rad||s.y>h.height+s._rad?(s.deg=s.setDegAdd(180),s.moves_pt[s._mpt].switch(0),void(s._mpt=0)):(e!==s._mpt&&(this._pos_same_count=0),s.moves_pt[s._mpt].switch(e),void(s._mpt=e))}var t;let i=function(t){return 5===t._pos?0:1===e&&2===t._pos?2:1===e&&4===t._pos?1:4===e&&1===t._pos?2:4===e&&7===t._pos?1:7===e&&4===t._pos?2:7===e&&8===t._pos?1:2===e&&1===t._pos?1:2===e&&3===t._pos?2:8===e&&7===t._pos?2:8===e&&9===t._pos?1:3===e&&2===t._pos?1:3===e&&6===t._pos?2:6===e&&3===t._pos?1:6===e&&9===t._pos?2:9===e&&6===t._pos?1:9===e&&8===t._pos?2:parseInt(2*Math.random()+1)}(this);s.moves_pt[s._mpt].switch(i),s._mpt=i}},s.parts=[new Ie({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Pe({o:null,x:1500,y:250}),new Ie({o:null,x:1500,y:250,d:I._L})],s.moves=[];for(let e=0;e<s.parts.length;e++)m.push(s.parts[e]);s.moves_pt=[{switch:function(e){1===e?s._deg=s.setDegAdd(90):2===e&&(s._deg=s.setDegAdd(-90)),0!==e&&(s._radX=s.x+Math.cos(s._deg*Math.PI/180)*s._rad*-1,s._radY=s.y+Math.sin(s._deg*Math.PI/180)*s._rad*-1),s._mpt=e},move:function(){s.x+=s.speed*Math.cos(s._deg*Math.PI/180),s.y+=s.speed*Math.sin(s._deg*Math.PI/180)},setDeg:0},{switch:function(e){0===e?s._deg=s.setDegAdd(-90):2===e&&(s._deg=s.setDegAdd(-180)),1!==e&&(s._radX=s.x+Math.cos(s._deg*Math.PI/180)*s._rad*-1,s._radY=s.y+Math.sin(s._deg*Math.PI/180)*s._rad*-1),s._mpt=e},move:function(){s._deg=s.setDegAdd(-1*s.speed/2),s.x=s._radX+Math.cos(s._deg*Math.PI/180)*s._rad,s.y=s._radY+Math.sin(s._deg*Math.PI/180)*s._rad},setDeg:-90},{switch:function(e){0===e?s._deg=s.setDegAdd(90):1===e&&(s._deg=s.setDegAdd(-180)),2!==e&&(s._radX=s.x+Math.cos(s._deg*Math.PI/180)*s._rad*-1,s._radY=s.y+Math.sin(s._deg*Math.PI/180)*s._rad*-1),s._mpt=e},move:function(){s._deg=s.setDegAdd(s.speed/2),s.x=s._radX+Math.cos(s._deg*Math.PI/180)*s._rad,s.y=s._radY+Math.sin(s._deg*Math.PI/180)*s._rad},setDeg:90}],s.is_able_collision=!1,s._standby=!0,s._heads_statuses="",s._bodies_statuses=""}setSelfCollision(){let e=this;if(e._c>e._c_self_collision&&(e._heads_statuses="00"),-1===e._heads_statuses.indexOf("1")){for(let t=0;t<e.parts.length;t++)Ie.prototype.isPrototypeOf(e.parts[t])?e.parts[t]._status=0:(e._collision_set||(e.parts[t]._deg=15*t),e.parts[t].is_frame_heads_collision=!0);e._collision_set=!0,-1===e._bodies_statuses.indexOf("1")&&e.init()}}set_heads_bodies_status(){let e=this;e._heads_statuses="",e._bodies_statuses="";for(let t=0;t<e.parts.length;t++)Ie.prototype.isPrototypeOf(e.parts[t])?e._heads_statuses+=e.parts[t].isalive()?1:0:e._bodies_statuses+=e.parts[t].isalive()?1:0}setDegAdd(e){let t=(this._deg+e)%360;return t<0?360+t:t}isAllPartsCanvasOut(){return this.parts.every(e=>R.isEnemyCanvasOut(e))}move_standby(){let e=this;e._deg=190,e.x+=e.speed*Math.cos(e._deg*Math.PI/180),e.y+=e.speed*Math.sin(e._deg*Math.PI/180),e.moves.unshift({x:e.x,y:e.y,deg:e._deg}),e.moves.length>e.parts.length*e.moves_interval&&e.moves.pop();for(let t=0;t<e.parts.length;t++){let s=e.moves[t*e.moves_interval];if(void 0===s)break;e.parts[t].moveDraw({x:s.x,y:s.y,deg:s.deg})}e.x<h.width-300&&(e.movePos._setPos(),e._standby=!1)}setDrawImage(){let e=this;for(let t=0;t<e.parts.length&&void 0!==e.moves[t*e.moves_interval];t++){let s=e.moves[t*e.moves_interval];e.parts[t].moveDraw({x:s.x,y:s.y,deg:s.deg})}}move(){let e=this;e.isMove()&&((()=>{if(e._c%100==0&&e.isAllPartsCanvasOut()){const t=[{x:h.width/2,y:-30,deg:90},{x:h.width/2,y:h.height-30,deg:270},{x:-30,y:h.height/2,deg:0},{x:h.width-30,y:h.height/2,deg:180}],s=parseInt(4*Math.random());e.x=t[s].x,e.y=t[s].y,e._deg=t[s].deg,e._mpt=0}})(),e.set_heads_bodies_status(),e.moves.unshift({x:e.x,y:e.y,deg:e.setDegAdd(e.moves_pt[e._mpt].setDeg)}),e.moves.length>e.parts.length*e.moves_interval&&e.moves.pop(),e._f||e.parts[0].isalive()||(e._f=!0,e.parts.reverse(),e.moves.reverse(),e.parts[0].setDirect(I._R),e.parts=e.parts.map(e=>(e._deg=(e._deg+180)%360,e)),e.moves=e.moves.map(e=>(e.deg=(e.deg+180)%360,e)),e.parts.pop(),e.x=e.moves[0].x,e.y=e.moves[0].y,e._deg=e.moves[0].deg,e._mpt=0),e.movePos.move(),e.moves_pt[e._mpt].move(),e.setSelfCollision(),e._c++)}}class Ie extends Y{constructor(t){super({img:e.enemy_frame_head1.obj,x:t.x,y:t.y,direct:t.d});this.img=this.direct===I._L?e.enemy_frame_head3.obj:e.enemy_frame_head1.obj,this._standby=!1,this._status=70,this.getscore=5e3,this._deg=0,this.shotColMap=["30,30,"+(this.img.width-60)+","+(this.img.height-60)],this._collision_type="t9",this.audio_collision=s.enemy_collision6,this.num_col=6}showCollapes(){let e=this,t=e.getEnemyCenterPosition();e._isshow=!1;for(let s=0;s<(e.num_col||1);s++)d.push(new hs(t._x+Math.random()*(Math.random()>.5?100:-100),t._y+Math.random()*(Math.random()>.5?100:-100),e._collision_type));T._setPlay(e.audio_collision)}setDirect(e){this.direct=e}shot(){let t=this;t.img=t._c%200<150&&t._c%200>0?t.direct===I._L?e.enemy_frame_head3.obj:e.enemy_frame_head1.obj:t.direct===I._L?e.enemy_frame_head4.obj:e.enemy_frame_head2.obj,t._c%200==150&&c.push(new Ue({x:t.x,y:t.y,deg:t._deg+90,img:e.enemy_frame_small.obj,imgPos:[0,35],width:35}))}setDrawImage(){this.isshow()&&this.isalive()&&R._setDrawImage({img:this.img,x:this.x+this.img.width/4,y:this.y+this.img.height/4,deg:this._deg})}moveDraw(e){let t=this;t.isshow()&&(t.isalive()?(t.shot(),t.x=e.x,t.y=e.y,t._deg=e.deg):t.showCollapes())}move(){this._c=this._c>200?0:this._c+1}}class Pe extends Y{constructor(t){super({img:e.enemy_frame_body1.obj,x:t.x,y:t.y});this._standby=!1,this.is_able_collision=!1,this.shotColMap=["5,5,"+(this.img.width-10)+","+(this.img.height-10)],this._deg=0,this.speed=Math.random>.4?-10:10,this.is_frame_heads_collision=!1,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this._deg_col=0}showCollapes(){let e=this;if(R.isEnemyCanvasOut(e))return e._status=0,void(e._isshow=!1);e.x+=Math.cos(e._deg*Math.PI/180)*e.speed,e.y+=Math.sin(e._deg*Math.PI/180)*e.speed,e._deg_col+=10,R._setDrawImage({img:e.img,x:e.getEnemyCenterPosition()._x,y:e.getEnemyCenterPosition()._y,deg:e._deg_col})}setDrawImage(){this.isshow()&&(this.is_frame_heads_collision||R._setDrawImage({img:this.img,x:this.getEnemyCenterPosition()._x,y:this.getEnemyCenterPosition()._y,deg:this._deg,scale:this.ani[parseInt(this._c/20)].scale}))}moveDraw(e){let t=this;if(t.isshow()){if(t.is_frame_heads_collision)return t._standby=!0,void t.showCollapes();t.x=e.x,t.y=e.y,t._deg=e.deg,t._deg_col=e.deg}}move(){this._c=this._c>=20*this.ani.length-1?0:this._c+1}}class je extends de{constructor(t){super({img:e.enemy_cell_boss.obj,x:t.x,y:t.y});this.rad=Math.random()*Math.PI-Math.PI/2,this._standby=!1,this.is_all_set=!1,this.ani=[0,180,360],this.ani_c=0,this.ani_c_intv=20,this.moves=[],this.speed=1,this.moves_interval=50,this.parts=[new Me({x:this.x,y:this.y,dark:!1}),new Me({x:this.x,y:this.y,dark:!0}),new Me({x:this.x,y:this.y,dark:!0}),new Me({x:this.x,y:this.y,dark:!0}),new Me({x:this.x,y:this.y,dark:!0}),new Me({x:this.x,y:this.y,dark:!0}),new Me({x:this.x,y:this.y,dark:!0})],this.parts_eye=new Ce({x:this.x,y:this.y}),this.width=200,this.height=this.img.height,this.shotColMap=["50,0,"+this.width+","+this.height],this.is_able_collision=!1,this._collision_type="t9",this._col_c=0}is_parts_eye_status(){return this.parts_eye.isalive()}setSelfCollision(){this._c<this._c_self_collision||(this.parts_eye._status=0,this.setCollapes())}setCollapes(){let e=this;if(0===e.parts.length)return e._status=0,void Tt._set_score(e.getscore);for(let t=e.parts.length-1;t>=0;t--)e.parts[t].moveDraw();let t=e.parts[e.parts.length-1];0===e._col_c?(t.showCollapes(),e.parts.pop()):e._col_c%8==0&&(d.push(new hs(t.x+100*Math.random(),t.y+100*Math.random(),e._collision_type)),T._setPlay(e.audio_collision)),e._col_c=e._col_c>40?0:e._col_c+1}isAllset(){return!!this.is_all_set||(this.move_Allset(),!1)}move_Allset(){let e=this;e.x-=2;for(let t=0;t<e.parts.length;t++)e.parts[t].moveSet({x:e.x,y:e.y});if(!(e.x>=h.width-300)){e.is_all_set=!0;for(let t=0;t<e.parts.length;t++)m.push(e.parts[t]);m.push(e.parts_eye)}}showCollapes(){}move_standby(){}setDrawImage(){let e=this;for(let t=e.parts.length-1;t>=0;t--)e.parts[t].moveDraw();let t=e.moves[0];void 0!==t&&e.parts_eye.moveDraw({x:t.x,y:t.y+e.height/2-e.parts_eye.height/2})}move(){let e=this;if(e.ani_c=e.ani_c>=e.ani.length*e.ani_c_intv-1?0:e.ani_c+1,e.isMove()&&e.isAllset())if(e.is_parts_eye_status()){(e.x<400||e.x>700||e.y<100||e.y>300)&&(e.rad+=Math.PI/2),e.x+=Math.cos(e.rad)*e.speed,e.y+=Math.sin(e.rad)*e.speed,e.moves.unshift({x:e.x,y:e.y}),e.moves.length>e.parts.length*e.moves_interval&&e.moves.pop();for(let t=0;t<e.parts.length;t++){let s=e.moves[t*e.moves_interval];if(void 0===s)break;e.parts[t].moveSet({x:s.x,y:s.y,standby:!1})}e._c%300>100&&e._c%300<200&&e.parts_eye.move_eye_open(),e._c%300>=200&&e._c%300<300&&e.parts_eye.move_eye_close(),e.setSelfCollision(),e._c++}else e.setCollapes()}}class Me extends Y{constructor(t){super({img:e.enemy_cell_boss.obj,x:t.x,y:t.y});this._status=1,this.alpha=1,this.speed=2,this._standby=!1,this.ani=t.dark?[480,640,800]:[0,160,320],this.ani_c=0,this.ani_c_intv=20,this.width=160,this.height=this.img.height,this.shotColMap=["50,0,"+this.width+","+this.height],this.is_able_collision=!1,this.is_ignore_collision=!1,this._collision_type="t9"}showCollapes(){let e=this.getEnemyCenterPosition();d.push(new hs(this.x+this.width/2,e._y,this._collision_type)),this.init()}moveSet(e){this.x=e.x,this.y=e.y,this.ani_c=this.ani_c>=this.ani.length*this.ani_c_intv-1?0:this.ani_c+1}setDrawImage(){}moveDraw(){R._setDrawImage({img:this.img,x:this.x,y:this.y,imgPosx:this.ani[parseInt(this.ani_c/this.ani_c_intv)],width:this.width,basePoint:1,alpha:this.alpha})}move(){}}class Ce extends Y{constructor(t){super({img:e.enemy_cell_boss_eye.obj,x:t.x,y:t.y});this._status=100,this._standby=!1,this.audio_alive=s.enemy_collision7,this.is_able_collision=!1,this.ani=[0,48,96,144],this.ani_c=0,this.ani_c_intv=20,this.setAliveHit=!1,this.width=48,this.height=this.img.height,this.shotColMap=["0,0,"+this.width+","+this.height],this._collision_type="t1"}showCollapes(){this.init()}shot(){let t=this,s=R.getDeg(Ft._players_obj,t);for(let i=-30;i<=30;i+=30)c.push(new Te({x:t.x+20,y:this.getEnemyCenterPosition()._y,img:e.enemy_bullet_cell.obj,imgPos:[0,15],width:15,speed:3,aniItv:10,deg:s+i}))}move_eye_open(){let e=this;e.ani_c>=e.ani.length*e.ani_c_intv-1||(e.ani_c%10==0&&e.shot(),e.ani_c++)}move_eye_close(){let e=this;e.ani_c<0||(e.ani_c%10==0&&e.shot(),e.ani_c--)}setAlive(){R._setDrawImage({img:this.img,x:this.x+20,y:this.y,imgPosx:this.ani[parseInt(this.ani_c/this.ani_c_intv)],width:this.width,basePoint:1}),T._setPlay(this.audio_alive)}setDrawImage(){}moveDraw(e){let t=this;t.isMove()?(t.x=e.x,t.y=e.y,t.is_able_collision=t.ani_c>0,t.ani_c<=0||R._setDrawImage({img:t.img,x:t.x,y:t.y,imgPosx:t.ani[parseInt(t.ani_c/t.ani_c_intv)],width:t.width,basePoint:1})):t.init()}move(){}}class Se extends de{constructor(t){super({img:e.enemy_death.obj,x:t.x,y:t.y,width:202,height:140});this._status=100,this.tid=null,this.shotColMap=["0,0,40,100","40,0,230,140,false"],this._collision_type="t9",this.defSpeed=3,this._front_imgPosx=0,this._is_laser_status=!1,this._shot_count=0,this._shot_count_unit=5}setShotCountUnit(){let e=this;(e._count-e._shot_count)%(50*e._shot_count_unit)==50*e._shot_count_unit-1&&(e._shot_count_unit=e._is_laser_status?parseInt(3*Math.random()+3):e._shot_count_unit,e._shot_count=e._count)}setAlive(){let e=this;e.isalive()?T._setPlay(e.audio_alive):(Tt._set_score(e.getscore),T._setPlay(e.audio_collision),e.showCollapes())}isShooting(){let e=this._count-this._shot_count;return e%(50*this._shot_count_unit)>=50*(this._shot_count_unit-1)&&e%(50*this._shot_count_unit)<50*this._shot_count_unit}isShot(){return(this._count-this._shot_count)%(50*this._shot_count_unit)==50*(this._shot_count_unit-1)+10}shot(){let e=this;if(0===e._count)return;if(e._is_laser_status)return e._front_imgPosx=126,void(e.isShot()&&(m.unshift(new Ee({x:e.x+50,y:e.y+35})),T._setPlay(s.enemy_bullet_laser_long)));let t=e._count-e._shot_count,i=50*e._shot_count_unit;if(t%i>200&&t%i<210&&(e._front_imgPosx=42),t%i>210&&t%i<230&&(e._front_imgPosx=84),t%i>230&&t%i<240&&(e._front_imgPosx=42),t%i>240&&t%i<250&&(e._front_imgPosx=0),e.isShot())for(let t=0;t<5;t++)c.push(new Be({x:e.x+50,y:e.y+45+10*t,deg:[40,20,1,-20,-40][t]}))}move_Allset(){let e=this;e.x-=4,e.x<h.width-e.img.width-80&&(e.is_all_set=!0,e.is_able_collision=!0)}move_standby(){let e=this;e.x-=4,e.x<h.width&&(e._standby=!1)}setDrawImage(){R._setDrawImage({img:this.img,x:this.x,y:this.y,deg:this.deg+180,basePoint:1}),R._setDrawImage({img:e.enemy_death_front.obj,x:this.x,y:this.y+34,imgPosx:this._front_imgPosx,basePoint:1,width:42})}moveSet(){let e=this;!1===e._is_laser_status&&(e._count>=e._c_self_collision/2||e._status<=75)&&(e._is_laser_status=!0,d.push(new hs(e.x,e.y+65,"t1")),T._setPlay(e.audio_collision));let t=Ft._players_obj.getPlayerCenterPosition();e.speed=(()=>e.isShooting()?0:e._count%50>=40&&e._count%50<50?0:e._count%50==0?t._y<e.y+e.height?-1*e.defSpeed:e.defSpeed:e.y<0&&e.speed<0?e.defSpeed:e.y+e.height>h.height&&e.speed>0?-1*e.defSpeed:e.speed)(),e.y+=e.speed,e.setShotCountUnit()}}class Ee extends Y{constructor(t){super({img:e.enemy_death_shot2.obj,x:t.x,y:t.y,width:140,height:70});this.bossx=t.x,this.is_collision_player_init=!0,this.is_able_collision=!1,this.is_ignore_collision=!1,this._standby=!1}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!1,down:!1,left:!1,right:!1})}setDrawImage(){l.drawImage(this.img,0,0,40,this.height,this.x,this.y,40,this.height),l.drawImage(this.img,40,0,10,this.height,this.x+40,this.y,this.bossx-this.x-25,this.height),l.drawImage(this.img,70,0,70,this.height,this.bossx,this.y,70,this.height)}move(){let e=this;e.bossx<=0?e.init():(e.x=e.x<=-1e3?-1e3:e.x-30,e.bossx=e.x>=0?e.bossx:e.bossx-30,e.width=e.bossx-e.x+25,e.shotColMap=["0,0,"+e.width+","+e.height+",false"])}}class De extends de{constructor(t){super({img:e.enemy_moai_boss.obj,x:t.x,y:t.y,width:135,height:150});this._status=15,this.speedx=2,this.speedy=2,this._standby=!1,this.is_all_set=!1,this.moai_mini=[],this.ani=[0,135,270,405,540,675,810],this.imgPosx=this.ani[6],this._isopen=!1,this._direct=I._L,this.shotColMapDir={3:["0,90,20,120","20,0,135,150,false"],2:["115,90,135,120","0,0,115,150,false"]},this.shotColMap=this.shotColMapDir[this._direct],this.audio_alive=s.enemy_collision8,this._collision_type="t9",this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5}collision(e,t){this._isopen&&this.isCollision()&&this.setStatus(e,t)}showCollapes(){let e=this.getEnemyCenterPosition();this._isshow=!1,d.push(new hs(e._x,e._y,this._collision_type));for(let e=0;e<m.length;e++){let t=m[e];De.prototype.isPrototypeOf(t)||(t.init(),t.showCollapes())}}set_direct(e){let t=this;0!==t._count&&(t._count%200>=170&&t._count%200<180?t.imgPosx=t._direct===I._L?t.ani[4]:t.ani[2]:t._count%200>=180&&t._count%200<190?t.imgPosx=t.ani[3]:t._count%200>=190&&t._count%200<200?t.imgPosx=t._direct===I._L?t.ani[2]:t.ani[4]:(t._count%200==0&&(t._direct=t._direct===I._L?I._R:I._L),t.imgPosx=t._direct===I._L?t.ani[5]:t.ani[0]))}shot(){let e=this;if(e._count%200>=170&&e._count%200<200)return;let t=0;for(let e=0;e<m.length;e++){let s=m[e];if(ke.prototype.isPrototypeOf(s)&&++t>5*D())return}if(e._count%50>=30&&e._count%50<50?(e.imgPosx=e._direct===I._L?e.ani[5]:e.ani[0],e._isopen=!0):(e.imgPosx=e._direct===I._L?e.ani[6]:e.ani[1],e._isopen=!1),e._count%30==20){let t=e.getEnemyCenterPosition(),s=new ke({x:t._x,y:t._y});e.moai_mini.push(s),m.push(s)}}isAllset(){return!!this.is_all_set||(this.move_Allset(),!1)}move_Allset(){let e=this;e.x-=4,e.x<h.width-300&&(e.is_all_set=!0)}move_standby(){}setDrawImage(){R._setDrawImage({img:this.img,x:this.x,y:this.y,imgPosx:this.imgPosx,width:this.width,basePoint:1})}moveSet(){this.shotColMap=this.shotColMapDir[this._direct],this.x+=this.speedx,this.speedx=this.x<200||this.x+this.width>900?-1*this.speedx:this.speedx,this.y+=this.speedy,this.speedy=this.y<50||this.y+this.height>450?-1*this.speedy:this.speedy;let e=this.getEnemyCenterPosition();this.set_direct();for(let t=0;t<m.length;t++){let s=m[t];De.prototype.isPrototypeOf(s)||s.setPos({x:e._x,y:e._y})}}}class ke extends Y{constructor(t){super({img:e.enemy_moai_mini_boss.obj,x:t.x,y:t.y,width:27,height:30});this._status=3,this._radian=0,this._radius=0,this._standby=!1,this.audio_alive=s.enemy_collision3,this._collision_type="t2",this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this._count=0}shot(){0===this._count&&m.push(new Ae({x:this.x,y:this.y}))}setPos(e){this._radian+=.075,this._radius=this._radius<150?this._radius+5:this._radius,this.x=this._radius*Math.cos(this._radian)+e.x,this.y=this._radius*Math.sin(this._radian)+e.y}setDrawImage(){R._setDrawImage({img:this.img,x:this.x,y:this.y,basePoint:5})}moveSet(){this._count=this._count>3*C()?0:this._count+1}}class Ae extends ie{constructor(t){super({img:e.enemy_moai_boss_ring.obj,x:t.x,y:t.y,imgPos:[0,10],aniItv:5,width:10,height:10});this.audio_collision=s.enemy_collision2,this._collision_type="t2",this._DEF_SHOTSTATUS._SHOTTYPE_LASER=1,this.getscore=100}setPos(){}moveSet(){this.map_collition(),this.speed=3*E(),this.x+=this.sx*this.speed,this.y+=this.sy*this.speed,this.set_imgPos()}}class Le extends de{constructor(t){super({img:e.enemy_boss_aian.obj,x:t.x,y:t.y,width:100,height:87,imgPos:[0,100],aniItv:5});this._standby=!0,this._status=1,this.audio_collision=s.enemy_collision2,this._collision_type="t2",this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this.getscore=100,this.aians_max=50,this.aians_count=0,this.aians_clear_count=0,this.parts=[],this.is_all_set=!0}setSelfCollision(){}shot(){}move_standby(){let e=this;if(0===e.parts.length)for(let t=0;t<e.aians_max;t++){let t=new Oe({x:h.width,y:100});e.parts.push(t),m.push(t)}e._standby=!1}moveSet(){let e=this;if(e.parts.every(e=>!e.isalive()))return e.aians_clear_count++,void(e.aians_clear_count>200&&e.init());e.parts.map(e=>{e.moveSet()}),e._count%30==0&&(e.aians_count>=e.aians_max||(e.parts[e.aians_count]._standby=!1,e.aians_count++))}}class Oe extends Y{constructor(t){super({img:e.enemy_boss_aian.obj,x:t.x,y:t.y,width:75,height:65,imgPos:[0,75],aniItv:5});this.is_all_set=!0,this._status=5,this._collision_type="t3",this.getscore=500,this._move_status=0,this._rad=0}shot(){}move_standby(){}isCanvasOut(){return R.isEnemyCanvasOut(this,{up:!0,down:!0,left:!0,right:!1})}moveSet(){let e=this;if(e.x=u.getX(e.x),e.y=u.getY(e.y),e.isMove()){if(e.x+e.width<0&&e.init(),e.speed=2*D(),0===e._move_status){if(e.x<200)return void(e._move_status=1);e.x-=e.speed,e.y+=4*Math.sin(e._rad),e._rad+=.1}if(1===e._move_status){if(e.y>350)return void(e._move_status=2);e.y+=e.speed}if(2===e._move_status){if(e.x>750)return void(e._move_status=3);e.x+=e.speed}if(3===e._move_status){let t=Ft._players_obj.getPlayerCenterPosition();if(e.y>t._y-100&&e.y<t._y+0)return void(e._move_status=4);e.y-=e.speed}4===e._move_status&&(e.x-=e.speed),e.set_imgPos()}}move(){}}class Te{constructor(t){let s=this;s.x=t.x||500,s.y=t.y||300,s.tx=Ft._players_obj.getPlayerCenterPosition()._x,s.ty=Ft._players_obj.getPlayerCenterPosition()._y,s.img=t.img||e.enemy_bullet.obj,s.imgPos=t.imgPos||[0,18],s._c=0,s.aniItv=t.aniItv||5,s.basePoint=t.basePoint||1,s.width=t.width||18,s.height=t.height||s.img.height,s.speed=t.speed||E(),s.rad=void 0===t.deg?R.getRad({x:s.tx,y:s.ty},{x:s.x,y:s.y}):t.deg*Math.PI/180,s.deg=t.deg||R.getDeg({x:s.tx,y:s.ty},{x:s.x,y:s.y}),s.sx=Math.cos(s.rad),s.sy=Math.sin(s.rad),s.viewDeg=t.viewDeg||!1,s._isshow=!0,s.is_ignore_collision=!1,s.shotColMap=["1,1,"+(s.width-1)+","+(s.height-1)]}init(){this._isshow=!1}map_collition(){let e=this,t=u.getMapX(e.x),s=u.getMapY(e.y);u.isMapCollision(t,s)&&e.init()}getEnemyCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}isshow(){return this._isshow}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}setDrawImage(){let e=this;R._setDrawImage({img:e.img,x:e.x,y:e.y,deg:e.viewDeg?e.deg:0,width:e.width,basePoint:e.basePoint,imgPosx:e.get_imgPos()}),i&&(l.strokeStyle="rgba(200,200,255,0.5)",l.beginPath(),l.rect(e.x,e.y,e.width,e.height),l.stroke())}move(){let e=this;e.map_collition(),e.y=u.getY(e.y),R.isEnemyCanvasOut(e)?e.init():(e.x+=e.sx*e.speed,e.y+=e.sy*e.speed,e.set_imgPos())}}class Re extends Te{constructor(t){super({x:t.x,y:t.y,img:t.img||e.enemy_bullet_laser.obj,width:t.width||30}),this.speed=10}move(){let e=this;R.isEnemyCanvasOut(e)?e.init():(e.map_collition(),e.x-=e.speed)}}class Ye extends Te{constructor(t){super({x:t.x,y:t.y,deg:t.deg,viewDeg:!0,img:e.enemy_cristalcore_shot.obj});this.speed=10}move(){let e=this;R.isEnemyCanvasOut(e)?e.init():(e.map_collition(),e.x-=e.sx*e.speed,e.y-=e.sy*e.speed)}}class Ue extends Te{constructor(e){super({x:e.x,y:e.y,deg:e.deg,viewDeg:!0,width:e.width,imgPos:e.imgPos,basePoint:e.basePoint||5,img:e.img});this.ani_c=0,this.shotColMap=["-10,-10,10,10"],this.speed=E()-1}shot(){let t=this;if(100===t.ani_c){let s=t.getEnemyCenterPosition();for(let t=30;t<=360;t+=30)c.push(new Xe({x:s._x,y:s._y,deg:t,width:30,imgPos:[0,30],img:e.enemy_frame_mini.obj}));t.init()}}move(){let e=this;R.isEnemyCanvasOut(e)?e.init():(e.shot(),e.set_imgPos(),e.map_collition(),e.x-=e.sx*e.speed,e.y-=e.sy*e.speed,e.ani_c++)}}class Xe extends Ue{constructor(e){super({x:e.x,y:e.y,deg:e.deg,viewDeg:!0,img:e.img,imgPos:e.imgPos,basePoint:5,width:e.width});this.speed=2*E(),this.shotColMap=["-7,-7,7,7"]}shot(){}}class Be extends Te{constructor(t){super({x:t.x,y:t.y,width:25,height:10,deg:t.deg,viewDeg:!0});this.img=e.enemy_death_shot.obj,this.speed=1}move(){let e=this;if(R.isEnemyCanvasOut(e))return void e.init();e.map_collition(),e.speed+=.17;let t=Ft._players_obj.getPlayerCenterPosition();t._y<e.y&&e.deg++,t._y>e.y&&e.deg--,e.rad=e.deg*Math.PI/180,e.sx=Math.cos(e.rad),e.sy=Math.sin(e.rad),e.x-=parseInt(e.sx*e.speed),e.y-=parseInt(e.sy*e.speed),e._c++}}const Fe={_obj:new Object,_init(){this._obj=new Object},_reset(){this._obj=new Object},_optimized_maps(){let e=this;for(let t in e._obj)e._obj[t].isshow()||e._obj[t].isalive()||delete e._obj[t]},_init_maps(e,t){void 0!==e&&void 0!==t&&(this._obj[e]=t)},_move_maps(){let e=this;for(let t in e._obj)e._obj[t].move()},_draw_maps(){let e=this;for(let t in e._obj)e._obj[t].setDrawImage()}};class qe{constructor(e){void 0!==e&&(this.img=e.img,this.imgPos=e.imgPos||[0],this.aniItv=e.aniItv||1,this.width=e.width||this.img.width,this.height=e.height||this.img.height,this.dir=e.dir||1,this.x=e.x||0,this.y=e.y||0,this._s=e.s||"1",this._c=0,this._status=1,this._isshow=!0,this.is_able_collision=!1,this.is_ignore=!1,this._standby=!0,this.shotColMap=["0,0,"+this.width+","+this.height],this._DEF_SHOTSTATUS={_SHOTTYPE_NORMAL:1,_SHOTTYPE_MISSILE:2,_SHOTTYPE_DOUBLE:1,_SHOTTYPE_RIPPLE_LASER:1.5,_SHOTTYPE_LASER:1},this._c=0)}getImg(){return this.img.obj}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}collision(){}showCollapes(){}shot(){}isIgnore(){return this.is_ignore}isStandBy(){return this._standby}isshow(){return this._isshow}isalive(){return this._status>0}isCanvasOut(){return this.width+this.x<0}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(!!e.isalive()||(e.showCollapes(),!1))}moveSet(){}move_standby(){this.x>=h.width-20||(this._standby=!1)}setDrawImage(){this.x>h.width||0!==this._status&&R._setDrawImage({img:this.img,imgPosx:this.get_imgPos(),x:this.x,y:this.y,width:this.width,height:this.height,basePoint:1})}moveDraw(){}move(){this.x=u.getX(this.x),this.y=u.getY(this.y),this.speed=D(),this.isMove()&&(this.set_imgPos(),this.moveSet(),this.moveDraw(),this.shot())}}class Ne extends qe{constructor(t){super({img:e.map_cube_A.obj,width:25,height:25,x:t.x,y:t.y});this._s="1"}}class ze extends qe{constructor(t){super({img:e.enemy_p_1.obj,width:100,height:100,x:t.x,y:t.y});this._s="0111,1111,0111,0111"}}class He extends qe{constructor(t){super({img:e.map_cristal_up.obj,width:100,height:50,x:t.x,y:t.y});this._s="1111,1111"}}class Ge extends qe{constructor(t){super({img:e.map_cristal_down.obj,width:100,height:50,x:t.x,y:t.y});this._s="1111,1111"}}class Ke extends qe{constructor(t){super({img:e.map_moai_A.obj,width:250,height:100,x:t.x,y:t.y});this._s="0000000000,0111111111,0111111111,0000000000"}}class Ve extends qe{constructor(t){super({img:e.map_moai_B.obj,width:250,height:100,x:t.x,y:t.y});this._s="0000000000,1111111110,1111111110,0000000000"}}class We extends qe{constructor(t){super({img:e.map_volcano_A.obj,width:225,height:75,x:t.x,y:t.y});this._s="111111111,111111111,000000000"}}class Ze extends qe{constructor(t){super({img:e.map_volcano_B.obj,width:225,height:75,x:t.x,y:t.y});this._s="111111111,111111111,000000000"}}class Je extends qe{constructor(t){super({img:e.map_volcano_C.obj,width:225,height:75,x:t.x,y:t.y});this._s="000000000,111111111,111111111"}}class Qe extends qe{constructor(t){super({img:e.map_volcano_D.obj,width:225,height:75,x:t.x,y:t.y});this._s="000000000,111111111,111111111"}}class $e extends qe{constructor(t){super({img:e.map_volcano_F.obj,width:225,height:150,x:t.x,y:t.y});this._s="000110000,000110000,001111000,011111100,011111110,111111111"}}class et extends qe{constructor(t){super({img:e.map_volcano_G.obj,width:225,height:150,x:t.x,y:t.y});this._s="111111110,011111110,011111100,001111000,000110000,000110000"}}class tt extends qe{constructor(t){super({img:e.map_volcano_H.obj,width:500,height:325,x:t.x,y:t.y});this._s="00000000000000000000,00000111111111111110,00000111111110000000,00000000011110000000,00000000001100000000,00000000001100000000,00000000001100000000,11111111111111111100,01111111111111111100,00000000011000000000,00000000011000000000,00000000111000000000,00000001111110000000"}}class st extends qe{constructor(t){super({img:e.map_volcano_I.obj,width:375,height:250,x:t.x,y:t.y});this._s="000000010000000,000000010000000,000000111000000,000001111100000,000011111110000,000111111111000,001111111111100,001111111111100,011111111111110,111111111111111"}}class it extends qe{constructor(t){super({img:e.map_volcano_J.obj,width:375,height:250,x:t.x,y:t.y});this._s="111111111111111,011111111111110,001111111111100,001111111111100,000111111111000,000011111110000,000001111100000,000000111000000,000000010000000,000000010000000"}}class _t extends qe{constructor(t){super({img:e.map_volcano_K.obj,width:75,height:25,x:t.x,y:t.y});this._s="010"}}class ot extends qe{constructor(t){super({img:e.map_volcano_L.obj,width:75,height:25,x:t.x,y:t.y});this._s="010"}}class nt extends qe{constructor(t){super({img:e.map_volcano_M.obj,width:100,height:50,x:t.x,y:t.y});this._s="0111,1111"}}class at extends qe{constructor(t){super({img:e.map_volcano_N.obj,width:100,height:50,x:t.x,y:t.y});this._s="1111,0111"}}class rt extends qe{constructor(t){super({img:e.map_volcano_O.obj,width:100,height:50,x:t.x,y:t.y});this._s="1111,1110"}}class ht extends qe{constructor(t){super({img:e.map_volcano_P.obj,width:100,height:50,x:t.x,y:t.y});this._s="1110,1111"}}class lt extends qe{constructor(t){super({img:e.map_frame_A.obj,imgPos:[0,200,400,600,800],aniItv:10,width:200,height:75,x:t.x,y:t.y});this._s="000000000,11111111,11111111"}}class mt extends qe{constructor(t){super({img:e.map_frame_B.obj,imgPos:[0,200,400,600,800],aniItv:10,width:200,height:75,x:t.x,y:t.y});this._s="11111111,11111111,00000000"}}class ct extends qe{constructor(t){super({img:e.map_frame_C.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75,x:t.x,y:t.y});this._s="00,01,11",this.direct=I._LD}}class dt extends qe{constructor(t){super({img:e.map_frame_D.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75,x:t.x,y:t.y});this._s="11,01,00",this.direct=I._LU}}class gt extends qe{constructor(t){super({img:e.map_frame_E.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75,x:t.x,y:t.y});this._s="00,10,11",this.direct=I._LU}}class pt extends qe{constructor(t){super({img:e.map_frame_F.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75,x:t.x,y:t.y});this._s="11,10,00",this.direct=I._LU}}class yt extends qe{constructor(t){super({img:e.map_cell_A.obj,imgPos:[0,475,950],aniItv:20,width:475,height:100,x:t.x,y:t.y});this._s="0000000000000000000,0001111111111111000,0011111111111111100,1111111111111111111"}}class ut extends qe{constructor(t){super({img:e.map_cell_B.obj,imgPos:[0,475,950],aniItv:20,width:475,height:100,x:t.x,y:t.y});this._s="1111111111111111111,0011111111111111100,0001111111111111000,0000000000000000000"}}class wt extends qe{constructor(t){super({img:e.map_cell_C.obj,imgPos:[0,125,250],aniItv:20,width:125,height:100,x:t.x,y:t.y});this._s="00100,01110,01110,11111"}}class xt extends qe{constructor(t){super({img:e.map_cell_D.obj,imgPos:[0,125,250],aniItv:20,width:125,height:100,x:t.x,y:t.y});this._s="11111,01110,01110,00100"}}class bt extends qe{constructor(e){super({img:e.img,imgPos:[0,300,600],aniItv:20,width:300,height:50,x:e.x,y:e.y});this._s=e._s}}class vt extends bt{constructor(t){super({img:e.map_cell_V.obj,x:t.x,y:t.y,_s:"001111111100,111111111111"})}}class ft extends bt{constructor(t){super({img:e.map_cell_W.obj,x:t.x,y:t.y,_s:"111111111111,001111111100"})}}class It extends bt{constructor(t){super({img:e.map_cell_Y.obj,x:t.x,y:t.y,_s:"111111111111,111111111111"})}}class Pt extends bt{constructor(t){super({img:e.map_cell_Z.obj,x:t.x,y:t.y,_s:"111111111111,111111111111"})}}class jt extends qe{constructor(t){super({img:e.map_cell_wall.obj,imgPos:t.imgPos||[0],width:25,height:25,x:t.x,y:t.y});this._s="1",this.is_able_collision=!0,this._status=1,this._status_count=0,this.audio_collision=s.map_cell_wall,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.2}collision(e){this._status-=this._DEF_SHOTSTATUS[e]||1}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(!!e.isalive()||(e.showCollapes(),!0))}moveDraw(){let e=this;e._status_count>=200&&(e._status_count=0,e._status=1,u.set_mapdef_col(u.getMapX(e.x)+1,u.getMapY(e.y),"1")),e._status<=0&&(e._status=0,0===e._status_count&&(T._setPlay(e.audio_collision),u.set_mapdef_col(u.getMapX(e.x)+1,u.getMapY(e.y),"0")),e._status_count++)}}class Mt extends jt{constructor(e){super({imgPos:[0],x:e.x,y:e.y})}}class Ct extends jt{constructor(e){super({imgPos:[25],x:e.x,y:e.y})}}class St extends jt{constructor(e){super({imgPos:[50],x:e.x,y:e.y})}}class Et extends jt{constructor(e){super({imgPos:[75],x:e.x,y:e.y})}}class Dt extends jt{constructor(e){super({imgPos:[100],x:e.x,y:e.y})}}class kt extends jt{constructor(e){super({imgPos:[125],x:e.x,y:e.y})}}class At extends jt{constructor(e){super({imgPos:[150],x:e.x,y:e.y})}}class Lt extends jt{constructor(e){super({imgPos:[175],x:e.x,y:e.y})}}class Ot extends jt{constructor(e){super({imgPos:[200],x:e.x,y:e.y})}}const Tt={_pm:new Object,_stageselect:new Object,_score:new Object,_background_ar:new Array,_background_star_max:70,_powercapsell_ar:new Array,_reset(){this._pm=new Object,this._stageselect=new Object,this._background_ar=new Array,this._powercapsell_ar=new Array},_init_score(){this._score=new Ut},_draw_score(){this._score.setDrawImage()},_set_score(e){this._score.set(e)},_reset_score(){this._score.reset()},_init_background(){let e=this;for(let t=0;t<e._background_star_max;t++)e._background_ar.push(new Bt)},_move_background(){this._background_ar.map(e=>{e.move()})},_draw_background(){this._background_ar.map(e=>{e.setDrawImage()})},_add_powercapsell(e){if(void 0===e)return;this._powercapsell_ar.push(new Xt(e.x,e.y))},_optimized_powercapsell(){this._powercapsell_ar.map((e,t,s)=>{(e.x+e.width<0||e.gotpc)&&s.splice(t,1)})},_move_powercapsell(){this._powercapsell_ar.map(e=>{e.move()})},_draw_powercapsell(){this._powercapsell_ar.map(e=>{e.setDrawImage()})},_set_powercapsell(){let e=this;for(let i=0;i<e._powercapsell_ar.length;i++){let _=e._powercapsell_ar[i];if(_.gotpc)continue;let o=Ft._players_obj.getPlayerCenterPosition(),n=_.getPCCenterPosition();if(Math.sqrt(Math.pow(n._x-o._x,2)+Math.pow(n._y-o._y,2))<Math.sqrt(Math.pow(Ft._players_obj.width,2)+Math.pow(Ft._players_obj.height,2))/2)if(_.getPowerCapcell(),"red"!==_.type)if("blue"!==_.type);else{var t=m.concat();for(let e=0;e<t.length;e++){let s=t[e];R.isEnemyCanvasOut(s)||(s.isStandBy()||s.isAbleCollision()&&(s._status-=1,s.isalive()||(Tt._set_score(s.getscore),s.showCollapes())))}t=c.concat();for(let e=0;e<t.length;e++){let s=t[e];R.isEnemyCanvasOut(s)||s.init()}T._setPlay(s.enemy_all_out)}else p.move(),T._setPlay(s.pc),Tt._set_score(_.getscore)}}};class Rt{constructor(){let s=this;s.img=e.meter.obj,s.x=h.width/2-s.img.width/2,s.y=h.height-30,s.meterdef_status="111111",s.meterdef_current="000000",s.meterdef={n_32:{func:()=>{Ft._players_obj.accel>=10?s._set_meter_status():Ft._players_obj.accel+=2}},n_16:{func:()=>{Ft._shot_missle_isalive=!0,s._set_meter_status()}},n_8:{func:()=>{Ft._shot_type=Ft._shot_type_def.DOUBLE,s._set_meter_status()}},n_4:{func:()=>{Ft._shot_type=Ft._shot_type_def.LASER,s._set_meter_status()}},n_2:{func:()=>{Ft._option_obj[Ft._option_count].settruealive(),Ft._option_count++,Ft._option_count<Ft._option_max||s._set_meter_status()}},n_1:{func:()=>{Ft._players_force_obj.init(),s._set_meter_status()}}},s._c_pms=0,s.pms_img=t.gradius_powermeterselect.obj,s.pms_img_selected=t.gradius_powermeterselect_selected.obj,s.pms_selected=[19,91,163,235],s._c_pmss=0,s.pms_img_shield_selected=t.gradius_powermeterselect_shield_selected.obj,s.pmss_selected=[0,100]}_set_hide(){Ft._shot_type=Ft._shot_type_def.NORMAL,Ft._shot_missle_isalive=!0;for(let e=0;e<Ft._option_max;e++)Ft._option_obj[e].settruealive();Ft._option_count=4,Ft._players_force_obj.init(),w=[],this._set_current_reset(),this.meterdef_status="101100"}_set_current_reset(){this.meterdef_current="000000"}_set_meter_status(){let e=this.meterdef_status,t=(~parseInt(this.meterdef_current,2)>>>0).toString(2).slice(-6);this.meterdef_status=this._get_bit((parseInt(e,2)&parseInt(t,2)).toString(2));let s=parseInt(this.meterdef_current,2);8!==s&&4!==s||(this.meterdef_status=this._get_bit((parseInt(this.meterdef_status,2)|parseInt(8===s?"000100":"001000",2)).toString(2)))}_set_meter_on(e){this.meterdef_status=this._get_bit((parseInt(this.meterdef_status,2)|parseInt(e,2)).toString(2))}_get_bit(e){return("000000"+e).slice(-6)}_get_meter_current(e){return 0===parseInt(e,2)||1===parseInt(e,2)?"100000":("000000"+(parseInt(e,2)>>1).toString(2)).slice(-6)}move(){this.meterdef_current=this._get_meter_current(this.meterdef_current)}playerset(){if(Os())return;let e=parseInt(this.meterdef_current,2),t=parseInt(this.meterdef_status,2);0!==e&&0!=(e&t)&&(Ft._players_obj.set_equipped(),T._setPlay(s.playerset),this.meterdef_status=this._get_bit((parseInt(this.meterdef_status,2)|parseInt(this.meterdef_current,2)).toString(2)),this.meterdef["n_"+e].func(),this._set_current_reset())}show(){let t=this;l.drawImage(t.img,0,0,t.img.width-71,t.img.height,t.x+36,t.y,t.img.width-71,t.img.height);for(let e=0;e<this.meterdef_status.length;e++)"0"===this.meterdef_status[e]&&l.drawImage(t.img,t.img.width-72,0,72,t.img.height,t.x+36+72*e,t.y,72,t.img.height);let s=parseInt(this.meterdef_current,2);if(0===s)return;let i=parseInt(this.meterdef_status,2),_=e.meter_c.obj,o=0!=(s&i)?72*t.meterdef_current.indexOf("1"):_.width-72;l.drawImage(_,o,0,72,_.height,t.x+36+72*t.meterdef_current.indexOf("1"),t.y,72,_.height)}pms_disp(){l.clearRect(0,0,h.width,h.height),R._setDrawToText({s:"power meter select",x:"center",y:20,r:.6}),R._setDrawToText({s:"shield select",x:200,y:400,r:.3}),l.drawImage(this.pms_img,h.width/2-this.pms_img.width/2,70,this.pms_img.width,this.pms_img.height),l.drawImage(e.meter.obj,360,0,72,19,290,430,72,19);let s=t.gradius_powermeterselect_shield.obj;l.drawImage(s,470,390,s.width,s.height)}set_pms_status(e){if(void 0===e)return;let t=this._c_pms+e.num;t=(t=t<=0?0:t)>=this.pms_selected.length-1?this.pms_selected.length-1:t,this._c_pms=t}set_pmss_status(e){if(void 0===e)return;let t=this._c_pmss+e.num;t=(t=t<=0?0:t)>=this.pmss_selected.length-1?this.pmss_selected.length-1:t,this._c_pmss=t}pms_select(){this.pms_disp(),l.drawImage(this.pms_img_selected,0,this.pms_selected[this._c_pms],420,74,h.width/2-this.pms_img.width/2,this.pms_selected[this._c_pms]+70,420,74),l.drawImage(this.pms_img_shield_selected,this.pmss_selected[this._c_pmss],0,85,75,this.pmss_selected[this._c_pmss]+470,390,85,75)}}class Yt{constructor(){this.mapdef_status=0,this.mapdef=ls[this.mapdef_status]}init(){this.mapdef=ls[0],i?this.mapdef=ls[cs]:this.disp_thumb_map()}set_map_status(e){if(void 0===e)return;let t=this.mapdef_status+e.num;t=(t=t<=0?0:t)>=ls.length-1?ls.length-1:t,this.mapdef=ls[t],this.mapdef_status=t}disp_thumb_map(){l.clearRect(0,0,h.width,h.height),R._setDrawToText({s:"stage select",x:"center",y:20,r:.6});let e=500-(ls.length/2*20+10);for(let t=0;t<ls.length;t++)l.beginPath(),l.lineWidth=1,l.strokeStyle="rgba(255,255,255,1)",l.fillStyle="rgba(255,255,255,1)",t===this.mapdef_status?l.fillRect(e+20*t,85,10,10):l.strokeRect(e+20*t,85,10,10);u.mapdef=this.mapdef._map,u.map_theme=this.mapdef._theme,u.mapdef_col=[],u.set_gamestart_mapdef_col(),u.showMapForStageselect(this.mapdef),R._setDrawToText({s:"stage title",x:400,y:130,r:.3}),l.moveTo(400,160),l.lineTo(950,160),l.stroke(),l.font="20px sans-serif";let t=R._multilineText(l,this.mapdef._title,550);for(let e=0;e<(t.length>2?2:t.length);e++)l.fillText(t[e],400,190+26*e);R._setDrawToText({s:"difficult:"+this.mapdef._difficult,x:400,y:230,r:.3}),l.moveTo(400,260),l.lineTo(950,260),l.stroke(),R._setDrawToText({s:"detail",x:400,y:300,r:.3}),l.moveTo(400,330),l.lineTo(950,330),l.stroke(),t=R._multilineText(l,this.mapdef._body,520);for(let e=0;e<(t.length>4?4:t.length);e++)l.fillText(t[e],400,360+30*e)}}class Ut{constructor(){this.score1p=0,this.score2p=0,this.def_scorehi=57300,this.scorehi=this.def_scorehi}reset(){this.score1p=0,this.score2p=0}set(e){this.score1p+=e,this.scorehi>=this.score1p||(this.scorehi=this.score1p)}setDrawImage(){t.font.obj;let e="1p"+("        "+this.score1p).slice(-8);R._setDrawToText({s:e,x:180,y:10,r:.3}),e="hi"+("        "+this.scorehi).slice(-8),R._setDrawToText({s:e,x:400,y:10,r:.3}),e="2p"+("        "+this.score2p).slice(-8),R._setDrawToText({s:e,x:620,y:10,r:.3})}}class Xt{constructor(t,s){this.x=t||0,this.y=s||0,this.getscore=200,this.gotpc=!1,this.type=Math.random()>.1?"red":"blue",this._c=0,this.ani=[0,25,50,75],this.img=e.gradius_pc.obj,this.width=25,this.height=23}getPCCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}getPowerCapcell(){this.gotpc=!0}setDrawImage(){R._setDrawImage({img:this.img,x:this.x,y:this.y,imgPosx:this.ani[parseInt(this._c/5)]+("blue"===this.type?100:0),width:this.width,height:this.height,basePoint:1})}move(){this.gotpc||(this.x=u.getX(this.x),this.y=u.getY(this.y),this._c=this._c>=5*this.ani.length-1?0:this._c+1)}}class Bt{constructor(){this.x=h.width*Math.random(),this.y=h.height*Math.random(),this.rgb=parseInt(255*Math.random())+","+parseInt(255*Math.random())+","+parseInt(255*Math.random()),this.speed=5*Math.random(),this._c=parseInt(200*Math.random()),this._ar_alpha=[0,.2,.4,.6,.8,1,.8,.6,.4,.2],this._r=Math.random()+1}setDrawImage(){l.beginPath(),l.arc(this.x,this.y,this._r,0,2*Math.PI,!0),l.fillStyle="rgba("+this.rgb+","+this._ar_alpha[parseInt(this._c/20)]+")",l.fill()}move(){this.x=this.x<0?h.width:this.x,this.x-=0===u.getBackGroundSpeed()?0:this.speed,this._c=this._c>=199?0:this._c+1}}const Ft={_players_obj:"",_players_force_obj:"",_players_max:5,_players_main_isalive:!0,_is_finished_player_collision:!1,_option_obj:new Array,_option_count:0,_option_max:4,_option_ani_count:0,_option_ani_def:[{scale:.8},{scale:.7},{scale:.6},{scale:.5},{scale:.6},{scale:.7}],_shots:{shot:{_SHOTTYPE_NORMAL:new Array,_SHOTTYPE_DOUBLE:new Array,_SHOTTYPE_LASER:new Array},missile:new Array},_shot_type_def:{MISSILE:"_SHOTTYPE_MISSILE",NORMAL:"_SHOTTYPE_NORMAL",DOUBLE:"_SHOTTYPE_DOUBLE",LASER:"_SHOTTYPE_LASER",RIPPLE_LASER:"_SHOTTYPE_RIPPLE_LASER"},_shot_type:"",_shot_max:2,_shot_missle_isalive:!1,_move_drawX:new Array,_move_drawY:new Array,_move_draw_max:100,_reset(){this._players_obj="",this._players_force_obj="",this._is_finished_player_collision=!1,this._option_obj=new Array,this._option_count=0,this._shots={shot:{_SHOTTYPE_NORMAL:new Array,_SHOTTYPE_DOUBLE:new Array,_SHOTTYPE_LASER:new Array},missile:new Array},this._shot_type=this._shot_type_def.NORMAL,this._shot_missle_isalive=!1,this._move_drawX=new Array,this._move_drawY=new Array},_draw_players(){let e=this;e._players_force_obj.setDrawImage(),e._players_obj.isalive()&&e._players_obj.setDrawImage()},_set_move_players(e){this._players_obj.isalive()&&this._players_obj.set_move(e)},_set_stop_players(){this._players_obj.isalive()&&this._players_obj.set_stop()},_move_players(){let e=this;e._players_obj.isalive()&&e._players_force_obj.move(),e._players_obj.move()},_draw_option(){let e=this;e._set_option_count();for(let t=0;t<e._option_max;t++)e._players_obj.isalive()&&e._option_obj[t].move(10*(t+1)),e._option_obj[t].setDrawImage()},_get_option_scale(){return this._option_ani_def[this._get_option_count()].scale},_set_shot_type(e){this._shot_type=e},_is_shottype_laser(){let e=this._shots.shot._SHOTTYPE_LASER[0];return void 0!==e&&(this._shot_type===this._shot_type_def.LASER&&!(!ns.prototype.isPrototypeOf(e)&&!as.prototype.isPrototypeOf(e)))},_move_shots(){let e=this;if(e._players_obj.isalive())for(let t=0;t<e._players_max;t++)e._shot_missle_isalive&&e._shots.missile[t].move(),e._shots.shot[e._shot_type][t].move()},_draw_shots(){let e=this;for(let t=0;t<e._players_max;t++)e._shot_missle_isalive&&e._shots.missile[t].setDrawImage(),e._shots.shot[e._shot_type][t].setDrawImage()},_start_shots(){let e=this;for(var t=0;t<e._shots.shot[e._shot_type].length;t++){let i=e._shots.shot[e._shot_type][t];if(i.player._isalive)if(e._shot_type!==e._shot_type_def.DOUBLE){i._sq=i._sq===i.shots.length-1?0:i._sq+1;var s=i.shots[i._sq];s._shot_alive||(s._shot=!0,0===t&&T._setPlay(s._audio))}else{if(i.shots[0]._shot_alive||i.shots[1]._shot_alive)continue;if(i.shots[0]._shot=!0,i.shots[1]._shot=!0,0!==t)continue;T._setPlay(i.shots[0]._audio)}}},_stop_shots(){let e=this;for(var t=0;t<e._shots.shot[e._shot_type].length;t++){let s=e._shots.shot[e._shot_type][t];for(let e=0;e<s.shots.length;e++)s.shots[e]._shot=!1}},_start_missile_shots(){let e=this;if(e._shot_missle_isalive)for(var t=0;t<e._shots.missile.length;t++){let i=e._shots.missile[t];if(i.player._isalive)if(3!==_){i._sq=i._sq===i.shots.length-1?0:i._sq+1;var s=i.shots[i._sq];s._shot_alive||(s._shot=!0,0===t&&T._setPlay(s._audio))}else{if(i.shots[0]._shot_alive||i.shots[1]._shot_alive)continue;if(i.shots[0]._shot=!0,i.shots[1]._shot=!0,0!==t)continue;T._setPlay(i.shots[0]._audio)}}},_stop_missile_shots(){let e=this;for(var t=0;t<e._shots.missile.length;t++){let s=e._shots.missile[t];for(let e=0;e<s.shots.length;e++)s.shots[e]._shot=!1}},_draw_player_collision(){let e=this,t=e._players_obj;1===t._col_ani_c&&T._setPlay(s.vicviper_bomb),t._col_ani_c>=10*t.col_ani.length-1?e._is_finished_player_collision=!0:t._draw_collapes()},_enemy_collision(e){let t=this;t._init_laser_col_max();for(let s=0;s<e.length;s++){let i=e[s];if(!i.isIgnore()&&(!i.isStandBy()&&i.isalive())){for(let e=0;e<t._shots.shot[t._shot_type].length;e++){let s=t._shots.shot[t._shot_type][e];if(s.player._isalive)if(t._is_shottype_laser()){let e=s.enemy_collision(i);s.set_laser_col_max(e)}else s.enemy_collision(i)}if(t._players_obj.enemy_collision(i),t._players_force_obj.enemy_collision(i),t._shot_missle_isalive)for(let e=0;e<t._shots.missile.length;e++){let s=t._shots.missile[e];if(s.player.isalive())for(let e=0;e<s.shots.length;e++){let t=s.shots[e];s.enemy_collision(i,t)}}}}t._set_shot_laser_MaxX()},_enemy_shot_collision(e){let t=this;if(void 0!==e)for(let s=0;s<e.length;s++){let i=e[s];t._players_obj.enemy_shot_collision(i),t._players_force_obj.enemy_shot_collision(i)}},_init_laser_col_max(){let e=this;if(e._shot_type===e._shot_type_def.LASER&&e._is_shottype_laser())for(let t=0;t<e._shots.shot[e._shot_type].length;t++){let s=e._shots.shot[e._shot_type][t];s.player._isalive&&(s.shots[0]._laser_col_max=null)}},_set_shot_laser_MaxX(){let e=this;if(e._shot_type===e._shot_type_def.LASER&&e._is_shottype_laser())for(let t=0;t<e._shots.shot[e._shot_type].length;t++){let s=e._shots.shot[e._shot_type][t];if(!s.player._isalive)continue;let i=s.shots[0];0!==i._laser_col_max&&null!==i._laser_col_max?i.x>=i._laser_col_max+2*s.speed?s.setLaserMaxX(i,h.width):s.setLaserMaxX(i,i._laser_col_max+10):s.setLaserMaxX(i,h.width)}},_get_move_drawX(e){return this._move_drawX[e]},_get_move_drawY(e){return this._move_drawY[e]},_set_move_draw(){let e=this;if(!e._players_obj._ismove)return;let t=e._players_obj.width,s=e._players_obj.height,i=e._players_obj.x+parseInt(t/4),_=e._players_obj.y+parseInt(s/4),o=e._move_drawY;if(e._move_drawX.length===e._move_draw_max&&e._move_drawX.pop(),e._move_drawY.length===e._move_draw_max&&e._move_drawY.pop(),e._move_drawX.unshift(i),!u.map_infinite)return void o.unshift(_);let n=-1*u.getBackGroundSpeedY();if(0!==n)for(let t=0;t<e._move_draw_max;t++)void 0!==o[t]?n>0?o[t]=o[t]>=_+n*t?_+n*t:o[t]+n:n<0&&(o[t]=o[t]<=_+n*t?_+n*t:o[t]+n):o.push(_+n*t);else o.unshift(_)},_init_players_obj(e){this._players_obj=0===e||2===e?new Nt:new zt;const t=this._shot_type_def;var s;this._shots.shot[t.NORMAL].push(new ts(this._players_obj)),this._shots.shot[t.DOUBLE].push((s=this._players_obj,0===e||2===e?new ss(s):new is(s))),this._shots.shot[t.LASER].push(function(t){return 0===e?new ns(t):1===e?new as(t):2===e?new _s(t):3===e?new os(t):void 0}(this._players_obj)),this._shots.missile.push(function(t){return 0===e?new Jt(t):1===e?new $t(t):2===e?new Qt(t):3===e?new es(t):void 0}(this._players_obj))},_init_players_force_obj(e){this._players_force_obj=0===e||2===e?1===o?new Gt:new Vt:1===o?new Kt:new Wt},_init_option_obj(e){let t=this;const s=t._shot_type_def;for(let _=0;_<t._option_max;_++)t._option_obj.push(new Ht("option",110,70*(_+1),!1)),t._shots.shot[s.NORMAL].push(new ts(t._option_obj[_])),t._shots.shot[s.DOUBLE].push((i=t._option_obj[_],0===e||2===e?new ss(i):new is(i))),t._shots.shot[s.LASER].push(function(t){return 0===e?new ns(t):1===e?new as(t):2===e?new _s(t):3===e?new os(t):void 0}(t._option_obj[_])),t._shots.missile.push(function(t){return 0===e?new Jt(t):1===e?new $t(t):2===e?new Qt(t):3===e?new es(t):void 0}(t._option_obj[_]));var i},_get_option_count(){return parseInt(this._option_ani_count/3)},_set_option_count(){this._players_obj.isalive()&&(this._option_ani_count=this._option_ani_count>=3*this._option_ani_def.length-1?0:this._option_ani_count+1)}};class qt{constructor(t,s,i,_){this.img=e[t].obj,this.x=s||100,this.y=i||100,this._x=0,this._y=0,this._isalive=_||!1,this._scalechange=!0,this.width=0,this.height=0,this._c=0,this.accel=3}isalive(){return this._isalive}enemy_collision(){}getPlayerCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}setfalsealive(){this._isalive=!1}settruealive(){this._isalive=!0}}class Nt extends qt{constructor(){super("vicviper",100,200,!0);this._isequipped=!1,this._isequipped_count=0,this.img=e.vicviper.obj,this.imgsize=this.img.height,this.width=this.imgsize,this.height=this.imgsize,this.img_vb=e.vicviper_back.obj,this.imgsize_vb=this.img_vb.height,this.width_vb=this.imgsize_vb,this.height_vb=this.imgsize_vb,this.c_vv_ani=20,this.vv_ani=[120,60,0,180,240],this.vv_e_ani=[420,360,300,480,540],this._img_vv="",this.c_vb_ani=0,this.vb_ani=[0,14,28],this.vb_e_ani=[42,42,42],this._img_vb="",this._col_ani_c=0,this.col_img=e.vicviper_bomb.obj,this.col_ani=[{scale:.5},{scale:.7},{scale:.5},{scale:.4},{scale:.3}],this.map_col_date=null,this.map_col_canint=0,this._ismove=!1}_draw_collapes(){const e=this.getPlayerCenterPosition();R._setDrawImage({img:this.col_img,x:e._x,y:e._y,scale:this.col_ani[parseInt(this._col_ani_c/10)].scale}),this._col_ani_c=this._col_ani_c>=10*this.col_ani.length-1?0:this._col_ani_c+1}enemy_collision(e){1===o&&Ft._players_force_obj.isalive()||R.isSqCollision("25,28,45,35",this.x+","+this.y,e.shotColMap,e.x+","+e.y)!==f&&(e.collision(),this.setfalsealive())}enemy_shot_collision(e){1===o&&Ft._players_force_obj.isalive()||R.isSqCollision("25,28,45,35",this.x+","+this.y,e.shotColMap,e.x+","+e.y)!==f&&(e.init(),this.setfalsealive())}set_equipped(){this._isequipped_count=20}map_collition(){let e=this;1===o&&Ft._players_force_obj.isalive()||(()=>!!u.isMapCollision(u.getMapX(e.x+e.width/2),u.getMapY(e.y+e.height/2))&&(e.map_col_date=null,!0))()&&e.setfalsealive()}set_vv_ani(e){"ArrowUp"!==e&&"Up"!==e||(this.c_vv_ani-=2),"ArrowDown"!==e&&"Down"!==e||(this.c_vv_ani+=2)}set_moveamount(){let e=this;e._ismove?(e.x=function(t){let s=e.x+e._x;return s<=50?(e._x=0,50):s>=h.width-100?(e._x=0,h.width-100):s}(),e.y=function(t){let s=e.y+e._y;e.getPlayerCenterPosition();if(u.map_infinite){let t=100;return s<t?(u.setBackGroundSpeedY(e._y),t):s>h.height-e.height-t?(u.setBackGroundSpeedY(e._y),h.height-e.height-t):(u.setBackGroundSpeedY(0),s)}let i=1*e.height/2;return s<i?i:s>h.height-e.height-i?h.height-e.height-i:s}()):u.setBackGroundSpeedY(0)}set_move(e){if(void 0===e)return;let t=this;t._x=e.x*t.accel||0,t._y=e.y*t.accel||0,t._y>0&&t.set_vv_ani("Down"),t._y<0&&t.set_vv_ani("Up"),t._ismove=!0}set_stop(){this._x=0,this._y=0,this._ismove=!1}setDrawImage(){let e=this;l.drawImage(e.img,e._img_vv,0,e.imgsize,e.imgsize,e.x,e.y,e.imgsize,e.imgsize),l.drawImage(e.img_vb,e._img_vb,0,e.imgsize_vb,e.imgsize_vb,e.x,e.y+22,e.imgsize_vb,e.imgsize_vb),i&&(l.save(),l.fillStyle="rgba(0,0,255,0.5)",l.fillRect(e.x+25,e.y+28,20,7),l.restore())}move(){let e=this;e.isalive()&&(e.map_collition(),e.set_moveamount(),e._ismove?e.c_vv_ani>46?e.c_vv_ani=46:e.c_vv_ani<4&&(e.c_vv_ani=4):e.c_vv_ani>25?e.c_vv_ani-=1:e.c_vv_ani<25?e.c_vv_ani+=1:e.c_vv_ani=25,e._img_vv=(()=>{let t=parseInt(e.c_vv_ani/10);return e._isequipped_count<=0?e.vv_ani[t]:(e._isequipped_count--,e._isequipped_count>0&&e._isequipped_count%2==0?e.vv_e_ani[t]:e.vv_ani[t])})(),e._img_vb=(()=>{let t=parseInt(e.c_vb_ani/3);return e._isequipped_count>0&&e._isequipped_count%2==0?e.vb_e_ani[t]:e.vb_ani[t]})(),e.c_vb_ani=R._ac._get(e.c_vb_ani,e.vb_ani,3))}}class zt extends Nt{constructor(){super("vicviper1",100,200,!0),this.col_img=e.vicviper_bomb_red.obj}}class Ht extends qt{constructor(e,t,s,i){super(e,t,s,i),this.imgsize=this.img.height,this.width=this.imgsize,this.height=this.imgsize}setDrawImage(){if(!this._isalive)return;if(null===this.x||null===this.y||void 0===this.x||void 0===this.y)return;let e=this.getPlayerCenterPosition();R._setDrawImage({img:this.img,x:e._x,y:e._y,scale:Ft._get_option_scale()})}move(e){this.x=Ft._get_move_drawX(e),this.y=Ft._get_move_drawY(e)-2}}class Gt{constructor(){this.img=e.forcefield.obj,this.x=0,this.y=0,this.width=0,this.height=0,this._c=0,this._scale=0,this.reduce_scale_rate=.09,this.reduce_scale_min=.55,this.ani=[0,105],this.col_date=null,this.col_canint=25}init(){this._scale=1,this.width=this.img.width/4,this.height=this.img.height}reset(){this._scale=0,p._set_meter_on("000001")}isalive(){return 0!==this._scale}enemy_collision(e){this.isalive()&&R.isSqCollision(parseInt(this._scale*this.width/8)+","+parseInt(this._scale*this.height/8)+","+parseInt(this._scale*this.width*6/8)+","+parseInt(this._scale*this.height*6/8),this.x+","+this.y,e.shotColMap,e.x+","+e.y)!==f&&(e.collision(),this.reduce())}enemy_shot_collision(e){let t=this;t.isalive()&&R.isSqCollision(parseInt(t._scale*t.width/8)+","+parseInt(t._scale*t.height/8)+","+parseInt(t._scale*t.width*6/8)+","+parseInt(t._scale*t.height*6/8),t.x+","+t.y,e.shotColMap,e.x+","+e.y)!==f&&(e.is_ignore_collision?t.reset():(e.init(),t.reduce()))}getPlayerCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}map_collition(){let e=this.getPlayerCenterPosition(),t=u.getMapX(e._x),s=u.getMapY(e._y);u.isMapCollision(t,s)&&this.reduce()}isCollision(){let e=this;return null===e.col_date?(e.col_date=new Date,!0):new Date-e.col_date>e.col_canint&&(e.col_date=new Date,!0)}reduce(){let e=this;e.isalive()&&e.isCollision()&&(e._scale-=e.reduce_scale_rate,e._scale<=e.reduce_scale_min&&e.reset(),T._setPlay(s.vicviper_shield_reduce))}setDrawImage(){let e=Ft._players_obj,t=e.getPlayerCenterPosition()._x,s=e.getPlayerCenterPosition()._y;R._setDrawImage({img:this.img,x:t-6,y:s-2,imgPosx:this.ani[parseInt(this._c/5)],width:this.width,height:this.height,scale:this._scale})}move(){let e=Ft._players_obj;this.isalive()&&(this.map_collition(),this.x=e.x,this.y=e.y,this._c=this._c>=5*this.ani.length-1?0:this._c+1)}}class Kt extends Gt{constructor(){super(),this.ani=[210,315]}}class Vt extends Gt{constructor(){super();this.ani=[0,40],this.reduce_scale_rate=.04,this.reduce_scale_min=.35}getPlayerCenterPosition(){return{_x:this.x+this.width/2*this._scale,_y:this.y+this.height*this._scale}}init(){this._scale=1,this.img=e.shield.obj,this.width=this.img.width/4,this.height=this.img.height}isalive(){return 0!==this._scale}enemy_collision(e){this.isalive()&&R.isSqCollision("0,"+parseInt(this._scale*this.height*-1)+","+parseInt(this._scale*this.width)+","+parseInt(this._scale*this.height*2),this.x+","+this.y,e.shotColMap,e.x+","+e.y)!==f&&(e.collision(),this.reduce())}enemy_shot_collision(e){let t=this;t.isalive()&&R.isSqCollision("0,"+parseInt(t._scale*t.height*-1)+","+parseInt(t._scale*t.width)+","+parseInt(t._scale*t.height*2),t.x+","+t.y,e.shotColMap,e.x+","+e.y)!==f&&(e.is_ignore_collision?t.reset():(e.init(),t.reduce()))}map_collition(e){let t=this,s=u.getMapX(t.x),i=u.getMapY(t.y);u.isMapCollision(s,i)?t.reduce():(i=u.getMapY(t.y-t.height*t._scale+15),u.isMapCollision(s,i)?t.reduce():(i=u.getMapY(t.y+t.height*t._scale-15),u.isMapCollision(s,i)&&t.reduce()))}setDrawImage(){R._setDrawImage({img:this.img,x:this.x,y:this.y,imgPosx:this.ani[parseInt(this._c/5)],width:this.width,height:this.height,scale:this._scale,basePoint:7}),R._setDrawImage({img:this.img,x:this.x,y:this.y,imgPosx:this.ani[parseInt(this._c/5)],width:this.width,height:this.height,scale:this._scale,basePoint:1})}move(){if(!this.isalive())return;let e=Ft._players_obj,t=e.getPlayerCenterPosition();this.map_collition(e),this.x=e.x+e.width,this.y=t._y,this._c=this._c>=5*this.ani.length-1?0:this._c+1}}class Wt extends Vt{constructor(){super(),this.ani=[80,120]}}class Zt{constructor(e){this.shots=new Array,this.player=e,this._sq=0}enemy_collision(e){if(this.player.isalive())for(let t=0;t<this.shots.length;t++){let s=this.shots[t];if(!s._shot_alive)continue;if(e.x<this.player.x)continue;let i=R.isSqCollision("-10,-10,"+(s.img.width+10)+","+(s.img.height+10),s.x+","+s.y,e.shotColMap,e.x+","+e.y);i!==f&&(i===b&&e.collision(Ft._shot_type_def.NORMAL),s._init())}}map_collition(e){let t=u.getMapX(e.x+e.img.width/2),s=u.getMapY(e.y+e.img.height/2);if(u.isMapCollision(t,s))return e._init(),void u.setPlayersShotAbleCollision(t,s);u.isMapCollision(t+1,s)&&(e._init(),u.setPlayersShotAbleCollision(t+1,s))}getshottype(){}setDrawImage(){}move(){}}class Jt extends Zt{constructor(t){super(t),this.shots=new Array,this.col_mis=[{fs:"rgba(255,246,72,1)",scale:8},{fs:"rgba(255,131,62,1)",scale:10},{fs:"rgba(255,131,72,1)",scale:12},{fs:"rgba(255,131,62,1)",scale:14},{fs:"rgba(133,0,4,1)",scale:14},{fs:"rgba(100,0,4,1)",scale:16}],this.st={_st1:0,_st2:24,_st3:48,_st4:72,_st5:96,_st6:0,_st7:96,_st8:72},this.imgsize=e.gradius_missile.obj.height;for(let t=0;t<Ft._shot_max;t++)this.shots.push({sid:Ft._shot_type_def.MISSILE,id:t,x:0,y:0,_t:0,_st:"_st1",_img:e.gradius_missile.obj,_audio:s.missile,_c_mc:0,_c:0,_c_area:25,_enemyid:null,_shot:!1,_shot_alive:!1,_init:function(){this.x=0,this.y=0,this._t=0,this._c=0,this._c_mc=0,this._c_area=25,this._st="_st1",this._enemyid=null,this._shot=!1,this._shot_alive=!1}});let i=this;this.mis_status={_st1:function(e){let t=i.player.getPlayerCenterPosition();var s;e.x=(s=e.x,e._shot_alive?s+4:t._x),e.y=function(s){return e._shot_alive?s+8:t._y}(e.y)},_st2:function(e){e.x+=0,e.y+=8},_st3:function(e){e.x+=8,e.y+=0},_st4:function(e){e.x+=2,e.y+=3},_st5:function(e){e.x+=2,e.y+=2},_st6:function(e){e.x+=4,e.y+=4},_st7:function(e){e.x+=6,e.y+=4},_st8:function(e){e.x+=6,e.y+=3}}}enemy_collision(e,t){if(!this.player.isalive())return;if(!t._shot_alive)return;let s=R.isSqCollision(0-t._img.height/4+","+(0-t._img.height/4)+","+5*t._img.height/4+","+5*t._img.height/4,t.x+","+t.y,e.shotColMap,e.x+","+e.y);s!==f&&(t._c>0||(0===t._c&&(t._c=1),s!==v&&e.collision(Ft._shot_type_def.MISSILE)))}get_missile_status(e){return e._st}set_missile_status(e,t){e._c_mc=e._c_mc>=1?0:e._c_mc+1,1===e._c_mc&&(e._st=t)}map_collition(e){let t=this,s=u.getMapX(e.x+t.imgsize),i=u.getMapY(e.y);if(!u.isMapBefore(s,i)){if("_st4"===t.get_missile_status(e)&&t.set_missile_status(e,"_st5"),"_st6"===t.get_missile_status(e)&&t.set_missile_status(e,"_st7"),"_st7"===t.get_missile_status(e)&&t.set_missile_status(e,"_st8"),"_st8"===t.get_missile_status(e)&&t.set_missile_status(e,"_st3"),"_st5"===t.get_missile_status(e)){if(s=u.getMapX(e.x+t.imgsize),u.isMapCollision(s,i+1))return void t.set_missile_status(e,"_st6");e.x+=5,t.set_missile_status(e,"_st2")}if("_st3"===t.get_missile_status(e)){if(i=u.getMapY(e.y+t.imgsize),e.y=u.isMapCollision(s,i)?e.y-1:e.y+1,u.isMapOver(s,i))return void t.set_missile_status(e,"_st4");if(s=u.getMapX(e.x+t.imgsize),i=u.getMapY(e.y+t.imgsize/2),u.isMapCollision(s,i))return void e._init();if(!u.isMapCollision(s+1,i+1))return void t.set_missile_status(e,"_st4")}if("_st2"===t.get_missile_status(e)){if(u.isMapOver(s,i))return;if(i=u.getMapY(e.y+t.imgsize+25),u.isMapCollision(s,i))return void t.set_missile_status(e,"_st6")}if("_st1"===t.get_missile_status(e)){if(i=u.getMapY(e.y+t.imgsize+25),u.isMapCollision(s+1,i))return void t.set_missile_status(e,"_st6");if(u.isMapCollision(s,i))return void t.set_missile_status(e,"_st6")}}}collapse_missile(e){let t=this,s=u.getX(e.x+t.imgsize/2),i=u.getY(e.y+t.imgsize/2);if(e._c>=5*t.col_mis.length)return void e._init();let _=parseInt(e._c/5);e._c_area=t.col_mis[_].scale,l.fillStyle=t.col_mis[_].fs,l.beginPath(),l.arc(s,i,t.col_mis[_].scale,0,2*Math.PI,!1),l.fill(),void 0!==this.col_mis[_-1]&&(l.fillStyle=t.col_mis[_-1].fs,l.beginPath(),l.arc(s,i,t.col_mis[_-1].scale,0,2*Math.PI,!1),l.fill()),e._c++}setDrawImage(){let e=this;for(let t=0;t<e.shots.length;t++){let s=e.shots[t];s._shot_alive&&(s._c>0?e.collapse_missile(s):(l.drawImage(s._img,e.st[e.get_missile_status(s)],0,e.imgsize,e.imgsize,s.x,s.y,e.imgsize,e.imgsize),i&&(l.strokeStyle="rgba(200,200,255,0.5)",l.beginPath(),l.rect(s.x,s.y,e.imgsize,e.imgsize),l.stroke())))}}move(){let e=this,t=e.player;if(t.isalive()&&void 0!==t.x)for(let t=0;t<e.shots.length;t++){let s=e.shots[t];(s._shot||s._shot_alive)&&(s.y=u.getShotY(s.y),s._c>0?s.x=u.getX(s.x):R.isShotCanvasOut(s)?s._init():(e.mis_status[s._st](s),s._shot_alive=!0))}}}class Qt extends Jt{constructor(e){super(e);let t=this;this.st._st1=48,t.mis_status._st1=function(e){let s=t.player.getPlayerCenterPosition();var i;e.x=(i=e.x,e._shot_alive?i+4:s._x),e.y=function(t){return e._shot_alive?t+8:s._y}(e.y)}}enemy_collision(e,t){if(!this.player.isalive())return;if(!t._shot_alive)return;let s=R.isSqCollision(this.imgsize/4+","+this.imgsize/4+","+3*this.imgsize/4+","+3*this.imgsize/4,t.x+","+t.y,e.shotColMap,e.x+","+e.y);s!==f&&(t._c>0||(s!==v?(e.collision(Ft._shot_type_def.MISSILE),e.isalive()&&0===t._c&&(t._c=1)):0===t._c&&(t._c=1)))}}class $t extends Jt{constructor(e){super(e),this.col_mis=[{fs:"rgba(198,231,247,1)",scale:30},{fs:"rgba(71,127,228,1)",scale:40},{fs:"rgba(22,83,190,1)",scale:50},{fs:"rgba(4,9,161,1)",scale:60},{fs:"rgba(0,27,100,1)",scale:70}],this.st={_st1:72,_st2:96,_st3:0}}enemy_collision(e,t){let s=this;if(!s.player.isalive())return;if(!t._shot_alive)return;e.getEnemyCenterPosition();let i=function(){if(t._c>0){if(t._c%20!=0)return f;let s=2*t._c_area;Math.sqrt(2);return R.isSqCollision("0,0,"+s+","+s,parseInt(t.x-s/2)+","+parseInt(t.y-s/2),e.shotColMap,e.x+","+e.y)}return R.isSqCollision(s.imgsize/4+","+s.imgsize/4+","+3*s.imgsize/4+","+3*s.imgsize/4,t.x+","+t.y,e.shotColMap,e.x+","+e.y)}();i!==f&&(0===t._c&&(t._c=1),i!==v&&e.collision(Ft._shot_type_def.MISSILE))}map_collition(e){let t=u.getMapX(e.x),s=u.getMapY(e.y+this.imgsize);(u.isMapCollision(t,s)||u.isMapCollision(t+1,s))&&0===e._c&&(e._c=1)}move(){let e=this,t=e.player;if(!t.isalive())return;if(void 0===t.x)return;let s=t.getPlayerCenterPosition();for(let t=0;t<e.shots.length;t++){let _=e.shots[t];(_._shot||_._shot_alive)&&(_.y=u.getShotY(_.y),_._c>0?_.x=u.getX(_.x):(_._t++,_.x=(i=_.x,_._shot_alive?i+4:s._x),_.y=function(e){return _._shot_alive?e+_._t*_._t/200:s._y-8}(_.y),_._st=_._t>20&&_._t<30?"_st2":_._t>30?"_st3":"_st1",R.isShotCanvasOut(_)?_._init():_._shot_alive=!0))}var i}}class es extends Jt{constructor(e){super(e),this.st={_st1:72,_st2:96,_st3:0,_st4:120,_st5:144,_st6:168}}enemy_collision(e,t){if(!this.player.isalive())return;if(!t._shot_alive)return;let s=R.isSqCollision("-10,-10,"+(this.imgsize+10)+","+(this.imgsize+10),t.x+","+t.y,e.shotColMap,e.x+","+e.y);s!==f&&(t._c>0||(0===t._c&&(t._c=1),s!==v&&e.collision(Ft._shot_type_def.MISSILE)))}map_collition(e){let t=u.getMapX(e.x),s=u.getMapY(0===e.id?e.y:e.y+this.imgsize);u.isMapCollision(t,s)&&0===e._c&&(e._c=1)}move(){let e=this.player;if(!e.isalive())return;if(void 0===e.x)return;let t=e.getPlayerCenterPosition(),s=this.shots[0]._shot|this.shots[1]._shot,i=this.shots[0]._shot_alive|this.shots[1]._shot_alive;if(s||i){s&&!i&&(this.shots[0]._shot_alive=!0,this.shots[1]._shot_alive=!0);for(let e=0;e<this.shots.length;e++){let s=this.shots[e];s._shot_alive&&(s.y=u.getShotY(s.y),s._c>0?s.x=u.getX(s.x):(s._t+=1,s.x=(_=s.x,i?_+1:t._x),s.y=function(_){return 0===e?i?_+s._t*s._t/50*-1:t._y-20:i?_+s._t*s._t/50:t._y}(s.y),R.isShotCanvasOut(s)?s._init():(s._st=0===e?s._t>10&&s._t<20?"_st5":s._t>20?"_st6":"_st4":s._t>10&&s._t<20?"_st2":s._t>20?"_st3":"_st1",s._shot_alive=!0)))}var _}}}class ts extends Zt{constructor(t){super(t),this.shots=new Array,this.speed=20;for(let t=0;t<Ft._shot_max;t++)this.shots.push({sid:Ft._shot_type_def.NORMAL,x:0,y:0,img:e.shot1.obj,_audio:s.shot_normal,_shot:!1,_shot_alive:!1,_init:function(){this.x=0,this.y=0,this._shot=!1,this._shot_alive=!1}})}setDrawImage(){for(let t=0;t<this.shots.length;t++){let s=this.shots[t];if(!s._shot_alive)continue;let i=e.shot1.obj;l.drawImage(i,s.x,s.y,i.width,i.height)}}move(){let e=this.player;if(!e.isalive())return;if(void 0===e.x)return;let t=e.getPlayerCenterPosition();for(let e=0;e<this.shots.length;e++){let s=this.shots[e];if(!s._shot&&!s._shot_alive)continue;let i=this.speed;s.x=s._shot_alive?s.x+i:t._x,s.y=s._shot_alive?s.y:t._y-s.img.height/2,s.y=u.getShotY(s.y),R.isShotCanvasOut(s)?s._init():s._shot_alive=!0}}}class ss extends Zt{constructor(t){super(t);this.shots=new Array,this.speed=30,this.set=t.set||{imgs:[e.shot1.obj,e.shot2.obj],setX:[function(e,t,s){return e?s+30:t._x+this.img.width/2},function(e,t,s){return e?s+30:t._x+this.img.width/2}],setY:[function(e,t,s){return e?s:t._y-this.img.height/2},function(e,t,s){return e?s-23:t._y-23-this.img.height/2}]};for(let e=0;e<Ft._shot_max;e++)this.shots.push({sid:Ft._shot_type_def.DOUBLE,x:0,y:0,img:this.set.imgs[e],_audio:s.shot_normal,_enemyid:null,_shot:!1,_shot_alive:!1,_setX:this.set.setX[e],_setY:this.set.setY[e],_init:function(){this.x=0,this.y=0,this._enemyid=null,this._shot=!1,this._shot_alive=!1}})}enemy_collision(e){let t=this;if(!t.player.isalive())return;for(let s=0;s<t.shots.length;s++){let i=t.shots[s],_=R.isSqCollision("-10,-10,"+(i.img.width+10)+","+(i.img.height+10),i.x+","+i.y,e.shotColMap,e.x+","+e.y);_!==f&&(_!==v?e.isalive()&&(e.collision(Ft._shot_type_def.DOUBLE),i._init()):i._init())}}setDrawImage(){for(let e=0;e<this.shots.length;e++){let t=this.shots[e];t._shot_alive&&l.drawImage(t.img,t.x,t.y,t.img.width,t.img.height)}}move(){let e=this.player;if(!e.isalive())return;if(void 0===e.x)return;let t=e.getPlayerCenterPosition(),s=this.shots[0]._shot|this.shots[1]._shot,i=this.shots[0]._shot_alive|this.shots[1]._shot_alive;if(s||i){s&&!i&&(this.shots[0]._shot_alive=!0,this.shots[1]._shot_alive=!0);for(let e=0;e<this.shots.length;e++){let s=this.shots[e];s._shot_alive&&(s.x=s._setX(i,t,s.x),s.y=s._setY(i,t,s.y),s.y=u.getShotY(s.y),R.isShotCanvasOut(s)?s._init():s._shot_alive=!0)}}}}class is extends ss{constructor(t){t.set={imgs:[e.shot1.obj,e.shot3.obj],setX:[function(e,t,s){return e?s+30:t._x},function(e,t,s){return e?s-30:t._x}],setY:[function(e,t,s){return e?s:t._y-this.img.height/2},function(e,t,s){return e?s:t._y-this.img.height/2}]},super(t)}map_collition(e){let t=u.getMapX(e.x+e.img.width/2),s=u.getMapY(e.y+e.img.height/2);if(u.isMapCollision(t,s))return e._init(),void u.setPlayersShotAbleCollision(t,s);u.isMapCollision(t-1,s)&&(e._init(),u.setPlayersShotAbleCollision(t-1,s))}}class _s extends Zt{constructor(e){super(e),this.shots=new Array,this.speed=30,this.lineWidth_1=3,this.strokeStyle_1="rgba(40,70,255,1)",this.lineWidth_2=4,this.strokeStyle_2="rgba(100,180,255,0.7)";for(let e=0;e<Ft._shot_max;e++)this.shots.push({sid:Ft._shot_type_def.LASER,x:0,y:0,_t:0,_shot:!1,_shot_alive:!1,_width:0,_height:0,_audio:s.shot_ripple,_init:function(){this.x=0,this.y=0,this._t=0,this._shot=!1,this._shot_alive=!1,this._width=0,this._height=0}})}enemy_collision(e){if(this.player.isalive())for(let t=0;t<this.shots.length;t++){let s=this.shots[t];if(!s._shot_alive)continue;if(e.isIgnoreCollision())continue;let i=R.isSqCollision("0,-20,"+s._width+","+(2*s._height+20),s.x+","+(s.y-s._height),e.shotColMap,e.x+","+e.y);i!==f&&(i===b&&(e.collision(Ft._shot_type_def.RIPPLE_LASER),function(){let e=m;for(let t=0;t<e.length;t++){let i=e[t];i.isIgnore()||i.isalive()&&i.isshow()&&(i.isIgnoreCollision()||R.isSqCollision("0,0,"+s._width+","+2*s._height,s.x+","+(s.y-s._height),i.shotColMap,i.x+","+i.y)===b&&i.collision(Ft._shot_type_def.RIPPLE_LASER))}}()),s._init())}}map_collition(e){let t=u.getMapX(e.x),s=u.getMapY(e.y);if(u.isMapCollision(t,s)||u.isMapCollision(t+1,s)){let i=parseInt(e._height/u.t/2);for(let e=s-i;e<=s+i;e++)u.isMapCollision(t+1,e)&&u.setPlayersShotAbleCollision(t+1,e);e._init()}}setDrawImage(){let e=this;for(let t=0;t<e.shots.length;t++){let s=e.shots[t];s._shot_alive&&(l.beginPath(),l.lineWidth=e.lineWidth_2,l.strokeStyle=e.strokeStyle_2,l.ellipse(s.x+1,s.y+1,s._width,s._height,0,0,2*Math.PI),l.stroke(),l.beginPath(),l.lineWidth=e.lineWidth_1,l.strokeStyle=e.strokeStyle_1,l.ellipse(s.x,s.y,s._width,s._height,0,0,2*Math.PI),l.stroke())}}move(){let e=this,t=e.player;if(!t.isalive())return;if(void 0===t.x)return;let s=t.getPlayerCenterPosition();for(let t=0;t<e.shots.length;t++){let _=e.shots[t];if(!_._shot&&!_._shot_alive)continue;let o=e.speed;_.x=(i=_.x,_._shot_alive?i+o:s._x),_.y=function(e){return _._shot_alive?e:s._y}(_.y),_.y=u.getShotY(_.y),R.isShotCanvasOut(_)?_._init():(_._t=_._t<20?_._t+1:_._t,_._width=.4+_._t,_._height=8+_._t*_._t/6,_._shot_alive=!0)}var i}}class os extends _s{constructor(e){super(e),this.strokeStyle_1="rgba(255,80,50,1)",this.strokeStyle_2="rgba(255,180,100,0.7)"}}class ns extends Zt{constructor(t){super(t);let i=this;i.shots=new Array,i.speed=40,i.lineWidth=2,i.strokeStyle="rgba(50,80,255,1)",i.strokeStyle_u="rgba(120,150,255,1)",i.img_col=e.shot_laser_col.obj,i.imgsize_col=i.img_col.height,i.width_col=i.imgsize_col,i.height_col=i.imgsize_col,i.img_col_ani=[0,25];for(let e=0;e<1;e++)i.shots.push({sid:Ft._shot_type_def.LASER,x:0,sx:0,y:0,_c_col:0,laser_time:600,_enemy:null,_laser_t:0,_laser_ts:0,_laser_MaxX:h.width,_laser_col_max:null,_l_x:0,_l_sx:0,_shot:!1,_shot_alive:!1,_audio:s.shot_laser,_init:function(){this.x=0,this.sx=0,this.y=0,this._c_col=0,this._laser_t=0,this._laser_ts=0,this._enemy=null,this._l_x=0,this._l_sx=0,this._laser_MaxX=h.width,this._laser_col_max=null,this._shot=!1,this._shot_alive=!1}})}set_laser_col_max(e){let t=this;if(void 0!==e&&null!==e)for(let s=0;s<t.shots.length;s++){let i=t.shots[s];i._laser_col_max=i._laser_col_max<e||null===i._laser_col_max?e:i._laser_col_max}}laser_collision(e,t){e._laser_MaxX>=h.width||(e._c_col=e._c_col>=this.img_col_ani.length-1?0:e._c_col+1,l.drawImage(this.img_col,this.img_col_ani[e._c_col],0,this.imgsize_col,this.imgsize_col,e._laser_MaxX-this.width_col,e.y-this.img_col.height/2,this.imgsize_col,this.imgsize_col))}enemy_collision(e){let t=this,s=null;for(let i=0;i<this.shots.length;i++){if(e.x+e.width<this.player.x)continue;let _=this.shots[i];if(!_._shot_alive)continue;if((s=R.isSqCollision_laser("0,-6,"+parseInt(_.x-_.sx)+",6",_.sx+","+_.y,e.shotColMap,e.x+","+e.y)).ret===f)return null;let o=_.x-_.sx<this.speed?_.x-_.sx:this.speed;if(o<=0)return null;if(e.x<_.x-o)return e.is_collision_player_init&&_._init(),s.ret===v?s.val:(e.collision(Ft._shot_type_def.LASER),e.isalive()?s.val:_._laser_MaxX+t.speed);for(let i=_.x-o;i<=_.x;i+=5)if((s=R.isSqCollision_laser("0,-6,"+parseInt(i-_.sx)+",6",_.sx+","+_.y,e.shotColMap,e.x+","+e.y)).ret!==f)return e.is_collision_player_init&&_._init(),s.ret===v?s.val:(e.collision(Ft._shot_type_def.LASER),e.isalive()?s.val:_._laser_MaxX+t.speed)}return null}map_collition(e){let t=this;if(!e._shot_alive)return;let s=u.getMapX(e.x),i=u.getMapY(e.y);for(let s=e.x-t.speed;s<=e.x;s+=5)if(u.isMapCollision(u.getMapX(s),i)){t.setLaserMaxX(e,s);break}for(let t=u.getMapX(e.sx)+1;t<=s;t++)u.isMapCollision(t,i)&&u.setPlayersShotAbleCollision(t,i,Ft._shot_type_def.LASER)}setLaserLine(e,t,s){e.x=t,e.sx=s}setLaserMaxX(e,t){e._laser_MaxX=t>h.width?h.width:t}setDrawImage(){let e=this,t=e.player;if(!t.isalive())return;let s=t.getPlayerCenterPosition();s._x;l.lineWidth=e.lineWidth,l.strokeStyle=e.strokeStyle,l.lineCap="round";for(let t=0;t<e.shots.length;t++){let i=e.shots[t];i._shot_alive&&(i.x<i.sx||Math.abs(i.x-i.sx)<20||(l.beginPath(),l.strokeStyle=e.strokeStyle_u,l.moveTo(i.sx,s._y+1),l.lineTo(i.x,s._y+1),l.stroke(),l.beginPath(),l.strokeStyle=e.strokeStyle,l.moveTo(i.sx,s._y),l.lineTo(i.x,s._y),l.stroke(),e.moveDrawLaser(i.x,i.sx,i.y),e.laser_collision(i)))}}moveDrawLaser(e,t,s){}move(){let e=this,t=e.player;if(!t.isalive())return;if(void 0===t.x)return;let s=t.getPlayerCenterPosition(),i=s._x;for(let t=0;t<e.shots.length;t++){let _=e.shots[t];(_._shot||_._shot_alive)&&(_._l_x=(t=>(t+=e.speed)>=_._laser_MaxX-s._x?(_._laser_t+=1e3/r,_._laser_MaxX-s._x):t)(_._l_x),_._l_sx=(t=>_._shot?_._laser_t<=_.laser_time-200?t:(_._laser_ts+=1e3/r,_._laser_ts>_.laser_time-200?(_._init(),0):t>=_._l_x?_._l_x:t+e.speed):t>=_._l_x?(_._init(),0):t+e.speed)(_._l_sx),_.y=s._y,e.setLaserLine(_,i+_._l_x,i+_._l_sx),_._l_x>0&&(_._shot_alive=!0))}}}class as extends ns{constructor(e){super(e);this.lineWidth=5,this.strokeStyle="rgba(255,80,50,1)",this.strokeStyle_u="rgba(255,200,150,1)",this.img_col_ani=[50,75]}moveDrawLaser(e,t,s){let i=this;for(let _=t;_<e;_+=20)l.beginPath(),l.lineCap="round",l.lineWidth=3,l.strokeStyle="rgba(100,20,10,1)",l.moveTo(_,s-1),l.lineTo(_-i.lineWidth,s+2),l.stroke()}}const rs={t0:{intv:5,imgPos:[0,30,60,90,120],img:e.enemy_collapes0.obj},t1:{intv:5,imgPos:[0,55,110,165,220],img:e.enemy_collapes1.obj},t2:{intv:5,imgPos:[0,30,60,90,120,150,180],img:e.enemy_collapes2.obj},t3:{intv:5,imgPos:[0,50,100,150,200],img:e.enemy_collapes3.obj},t8:{intv:5,imgPos:[0,90,180,270,360,450,540],img:e.enemy_collapes8.obj},t9:{intv:5,imgPos:[0,200,400,600,800],img:e.enemy_collapes9.obj}};class hs{constructor(e,t,s){this._c_anime_collosion=0,this.x=e||0,this.y=t||0,this.type=s||"t0",this._status=!0,this.img=rs[this.type].img,this.imgPos=rs[this.type].imgPos,this.aniItv=rs[this.type].intv,this.width=this.imgPos[1],this.height=this.img.height,this._c=0}isalive(){return this._status}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}setDrawImage(){R._setDrawImage({img:this.img,imgPosx:this.get_imgPos(),x:this.x,y:this.y,width:this.width,height:this.height})}move(){let e=this;e._c>=e.imgPos.length*e.aniItv-1?e._status=!1:(e.set_imgPos(),e.x=u.getX(e.x),e.y=u.getY(e.y))}}let ls="",ms="",cs=3,ds=0,gs=0;const ps={enemy_cristalcore:{_obj:function(e){return new we({x:e.x,y:e.y})}},enemy_bigcore:{_obj:function(e){return new pe({x:e.x,y:e.y})}},enemy_bigcore2:{_obj:function(e){return new ye({x:e.x,y:e.y})}},enemy_frame:{_obj:function(e){return new fe({x:e.x,y:e.y})}},enemy_cell:{_obj:function(e){return new je({x:e.x,y:e.y})}},enemy_moai:{_obj:function(e){return new De({x:e.x,y:e.y})}},enemy_death:{_obj:function(e){return new Se({x:e.x,y:e.y})}},enemy_cube:{_obj:function(e){return new be({x:e.x,y:e.y})}},enemy_aian:{_obj:function(e){return new Le({x:e.x,y:e.y})}}},ys={MAP_CRISTAL:{_obj:function(e){return new ze({x:e.x,y:e.y})}},MAP_CRISTAL_UP:{_obj:function(e){return new He({x:e.x,y:e.y})}},MAP_CRISTAL_DOWN:{_obj:function(e){return new Ge({x:e.x,y:e.y})}},MAP_VOLCANO_A:{_obj:function(e){return new We({x:e.x,y:e.y})}},MAP_VOLCANO_B:{_obj:function(e){return new Ze({x:e.x,y:e.y})}},MAP_VOLCANO_C:{_obj:function(e){return new Je({x:e.x,y:e.y})}},MAP_VOLCANO_D:{_obj:function(e){return new Qe({x:e.x,y:e.y})}},MAP_VOLCANO_E:{_obj:function(e){return new MAP_VOLCANO_E({x:e.x,y:e.y})}},MAP_VOLCANO_F:{_obj:function(e){return new $e({x:e.x,y:e.y})}},MAP_VOLCANO_G:{_obj:function(e){return new et({x:e.x,y:e.y})}},MAP_VOLCANO_H:{_obj:function(e){return new tt({x:e.x,y:e.y})}},MAP_VOLCANO_I:{_obj:function(e){return new st({x:e.x,y:e.y})}},MAP_VOLCANO_J:{_obj:function(e){return new it({x:e.x,y:e.y})}},MAP_VOLCANO_K:{_obj:function(e){return new _t({x:e.x,y:e.y})}},MAP_VOLCANO_L:{_obj:function(e){return new ot({x:e.x,y:e.y})}},MAP_VOLCANO_M:{_obj:function(e){return new nt({x:e.x,y:e.y})}},MAP_VOLCANO_N:{_obj:function(e){return new at({x:e.x,y:e.y})}},MAP_VOLCANO_O:{_obj:function(e){return new rt({x:e.x,y:e.y})}},MAP_VOLCANO_P:{_obj:function(e){return new ht({x:e.x,y:e.y})}},MAP_CUBE_A:{_obj:function(e){return new Ne(void 0===e?{}:{x:e.x,y:e.y})}},MAP_MOAI_A:{_obj:function(e){return new Ke({x:e.x,y:e.y})}},MAP_MOAI_B:{_obj:function(e){return new Ve({x:e.x,y:e.y})}},MAP_FRAME_A:{_obj:function(e){return new lt({x:e.x,y:e.y})}},MAP_FRAME_B:{_obj:function(e){return new mt({x:e.x,y:e.y})}},MAP_FRAME_C:{_obj:function(e){return new ct({x:e.x,y:e.y})}},MAP_FRAME_D:{_obj:function(e){return new dt({x:e.x,y:e.y})}},MAP_FRAME_E:{_obj:function(e){return new gt({x:e.x,y:e.y})}},MAP_FRAME_F:{_obj:function(e){return new pt({x:e.x,y:e.y})}},MAP_CELL_A:{_obj:function(e){return new yt({x:e.x,y:e.y})}},MAP_CELL_B:{_obj:function(e){return new ut({x:e.x,y:e.y})}},MAP_CELL_C:{_obj:function(e){return new wt({x:e.x,y:e.y})}},MAP_CELL_D:{_obj:function(e){return new xt({x:e.x,y:e.y})}},MAP_CELL_G:{_obj:function(e){return new Mt({x:e.x,y:e.y})}},MAP_CELL_H:{_obj:function(e){return new Ct({x:e.x,y:e.y})}},MAP_CELL_I:{_obj:function(e){return new St({x:e.x,y:e.y})}},MAP_CELL_J:{_obj:function(e){return new Et({x:e.x,y:e.y})}},MAP_CELL_K:{_obj:function(e){return new Dt({x:e.x,y:e.y})}},MAP_CELL_L:{_obj:function(e){return new kt({x:e.x,y:e.y})}},MAP_CELL_M:{_obj:function(e){return new At({x:e.x,y:e.y})}},MAP_CELL_N:{_obj:function(e){return new Lt({x:e.x,y:e.y})}},MAP_CELL_O:{_obj:function(e){return new Ot({x:e.x,y:e.y})}},MAP_CELL_V:{_obj:function(e){return new vt({x:e.x,y:e.y})}},MAP_CELL_W:{_obj:function(e){return new ft({x:e.x,y:e.y})}},MAP_CELL_Y:{_obj:function(e){return new It({x:e.x,y:e.y})}},MAP_CELL_Z:{_obj:function(e){return new Pt({x:e.x,y:e.y})}}},us={ENEMY_a:{_obj:function(e,t,s){return new B({x:e,y:t,direct:s})},_st:""},ENEMY_b:{_obj:function(e,t,s){return new F({x:e,y:t,direct:s})},_st:""},ENEMY_c:{_obj:function(e,t,s){let i=u.isMapCollision(u.getMapX(e),u.getMapY(t)-1)?I._U:I._D;return i=u.isMapCollision(u.getMapX(e),u.getMapY(t)+2)?I._D:I._U,new q({x:e,y:t,direct:s})},_st:""},ENEMY_d:{_obj:function(e,t,s){return new N({x:e,y:t,direct:s})},_st:""},ENEMY_e:{_obj:function(e,t,s){return new z({x:e,y:t,direct:s})},_st:""},ENEMY_f:{_obj:function(e,t,s){return s=t<h.height/2?I._U:I._D,new H({x:e,y:t,direct:s})},_st:""},ENEMY_g:{_obj:function(e,t,s){return s=t<h.height/2?I._U:I._D,new G({x:e,y:t,direct:s})},_st:""},ENEMY_m:{_obj:function(e,t,s){return new K({x:e,y:t,direct:s})},_st:""},ENEMY_n:{_obj:function(e,t,s){return new W({x:e,y:t,direct:s})},_st:""},ENEMY_o:{_obj:function(e,t,s){return new Z({x:e,y:t,direct:s})},_st:""},ENEMY_p:{_obj:function(e,t,s){return new $({x:e,y:t,direct:I._D})},_st:""},ENEMY_FAN:{_obj:function(e,t,s){return new U({x:e,y:t,direct:s})},_st:""},ENEMY_MOAI_Q_U:{_obj:function(e,t,s){return new te({x:e,y:t,direct:I._U})},_st:"transform:scale(1,-1);"},ENEMY_MOAI_Q_D:{_obj:function(e,t,s){return new te({x:e,y:t,direct:I._D})},_st:""},ENEMY_MOAI_Q_LD:{_obj:function(e,t,s){return new te({x:e,y:t,direct:I._LD})},_st:"transform:scale(-1,1);"},ENEMY_MOAI_Q_LU:{_obj:function(e,t,s){return new te({x:e,y:t,direct:I._LU})},_st:"transform:scale(-1,-1);"},ENEMY_MOAI_R_U:{_obj:function(e,t,s){return new se({x:e,y:t,direct:I._U})},_st:"transform:scale(1,-1);"},ENEMY_MOAI_R_D:{_obj:function(e,t,s){return new se({x:e,y:t,direct:I._D})},_st:""},ENEMY_FRAME_1:{_obj:function(e,t,s){return new _e({x:e,y:t,direct:s})},_st:""},ENEMY_CELL_CORE:{_obj:function(e,t,s){return new ae({x:e,y:t,direct:s})},_st:""},ENEMY_CELL_A:{_obj:function(e,t,s){return new me({x:e,y:t,direct:s})},_st:""},ENEMY_CELL_B:{_obj:function(e,t,s){return new ce({x:e,y:t,direct:s})},_st:""}},ws={},xs={};class bs{constructor(e){this.pt=e||0,this.initx=0,this.inity=0,this.x=this.initx,this.y=this.inity,this.collision=new RegExp("[1A-Z]"),this.collision_enemies=new RegExp("[a-z]","g"),this.collision_map=new RegExp("[A-Z]"),this.collision_map_d=new RegExp("[BD]"),this.t=25,this.mapdef=new Array,this.mapdef_col=new Array,this.map_theme=0,this.map_pettern=0,this.map_difficult=0,this.map_background_speed=0,this.map_backgroundY_speed=0,this.map_infinite=!1,this.map_bgmusic="",this.map_boss="",this.map_enemies_boss=new Object,this.isboss=!1}init(){return new Promise((e,t)=>{L({url:"./gradius_map.json"}).then(t=>{ls=t,e()},()=>{t()})})}init_map_theme(e){if(void 0!==e)for(let t in e){xs[t]={},xs[t]._map={},xs[t]._enemies={};for(let s in e[t].map)xs[t]._map[s]={_gamestart(i,_,o){Fe._init_maps(o,ys[e[t].map[s]]._obj({x:i,y:_}))},_getObj:ys[e[t].map[s]]._obj};for(let s in e[t].enemies)xs[t]._enemies[s]={_gamestart(i,_,o){m.push(us[e[t].enemies[s]]._obj(i,_,o))},_st:us[e[t].enemies[s]]._st,_getObj:us[e[t].enemies[s]]._obj}}}init_map_enemies_boss(e){if(void 0!==e)for(let t in e)ws[t]=[],e[t].map(e=>{ws[t].push({_point:{x:e.obj.x||h.width,y:e.obj.y||h.height/2},_obj:function(){return ps[e.obj.img]._obj(this._point)},_movex:e.movex||0,_left:e.left||!1,_bgmusic:null===e.bgmusic||void 0===e.bgmusic?function(){}:function(){T._setPlayOnBG(s[e.bgmusic||"bg_boss"])}})})}setInifinite(e){this.map_infinite=e}set_stage_map_pattern(e){this.map_pettern=e}set_gamestart(){this.map_backgroundY_speed=0,this.x=parseInt(ls[this.map_pettern]._initx),this.y=this.inity,this.initx=parseInt(ls[this.map_pettern]._initx),this.mapdef=ls[this.map_pettern]._map,this.map_difficult=parseInt(ls[this.map_pettern]._difficult)-1,g=i?g:parseInt(ls[this.map_pettern]._difficult)-1,this.map_background_speed=parseInt(ls[this.map_pettern]._speed),cs=this.map_pettern,this.map_theme=ls[this.map_pettern]._theme,this.map_infinite="true"===ls[this.map_pettern]._map_infinite,this.map_bgmusic=ls[this.map_pettern]._bgmusic,this.map_boss=ls[this.map_pettern]._boss,this.map_enemies_boss=ws[this.map_boss],this.isboss=!1,this.set_gamestart_mapdef_col(),this.set_gamestart_map_theme_objs()}get_ememies_boss(){return this.map_enemies_boss}set_gamestart_map_theme_objs(){let e=this;for(let t=0;t<e.mapdef.length;t++){let s=e.mapdef[t];for(let i=0;i<s.length;i++)if(e.isEnemiesBit(s[i])){let _=u.get_enemy_dir(i,t);xs[e.map_theme]._enemies[s[i]]._gamestart(e.x+i*e.t,t*e.t,_)}else e.isCollisionBit(s[i])&&xs[e.map_theme]._map[s[i]]._gamestart(e.x+i*e.t,t*e.t,i+","+t)}}set_gamestart_mapdef_col(){let e=this;Object.assign(e.mapdef_col,e.mapdef);for(let t=0;t<e.mapdef_col.length;t++)e.mapdef_col[t]=e.mapdef_col[t].replace(/[a-zA-Z]/gi,"0");for(let i=0;i<e.mapdef.length;i++){let _=e.mapdef[i];for(let o=0;o<_.length;o++){if(null===_[o].match(/[A-Za-z]/))continue;let n=e.isEnemiesBit(_[o])?xs[e.map_theme]._enemies[_[o]]._getObj({}):xs[e.map_theme]._map[_[o]]._getObj({});if(void 0===n){console.log("テーマ:"+e.map_theme+"に対して "+_[o]+"の定義がありません。");continue}let a=n._s.split(",");for(let n=0;n<a.length;n++){let r=e.mapdef_col[i+n],h=e.mapdef[i+n];void 0!==r&&void 0!==h&&(e.mapdef_col[i+n]=r.substr(0,o)+(t=r.substr(o,a[n].length),s=a[n],e.setCollisionBit(s,t))+r.substr(o+a[n].length,_.length))}}e.mapdef_col[i]=e.mapdef_col[i].substr(0,e.mapdef[i].length)}var t,s}set_mapdef_col(e,t,s){let i=this;if(void 0===e||void 0===t||void 0===s)return;let _=s.split(",");for(let s=0;s<_.length;s++){let o=i.mapdef_col[t+s];void 0!==o&&(i.mapdef_col[t+s]=o.substr(0,e)+_[s]+o.substr(e+_[s].length))}}get_enemy_dir(e,t){let s=this.isMapCollision(e,t-1)?I._U:I._D;return s=this.isMapCollision(e,t+1)?I._D:I._U}getX(e){return e+-1*this.map_background_speed}getY(e){return this.map_infinite?e-u.map_backgroundY_speed<-250?750+(250+e-u.map_backgroundY_speed):e-u.map_backgroundY_speed>750?-250-(750-e+u.map_backgroundY_speed):(e-u.map_backgroundY_speed)%1e3:e}getShotY(e){return e-u.map_backgroundY_speed}setCollisionBit(e,t){let s="";for(let i=0;i<e.length;i++)"0"!==e[i]?s+="1":s+=t[i];return s}getCollisionFlag(){return this.collision}setBackGroundSpeedY(e){this.map_backgroundY_speed=e}getBackGroundSpeed(){return this.map_background_speed}getBackGroundSpeedY(){return this.map_backgroundY_speed}get_stage_map_pattern(e){return this.map_pettern}getMapXToPx(e){return e*this.t+this.initx-ds}getMapYToPx(e){return e*this.t}getMapX(e){return Math.floor((e+ds-this.initx)/this.t)}getMapY(e,t){return!0===t&&(console.log("_y:"+e),console.log("_MAP_SCROLL_POSITION_Y:"+gs)),Math.floor((e+gs)%1e3/this.t)}isCollisionBit(e){return null!==e.match(this.collision)}isEnemiesBit(e){return null!==e.match(this.collision_enemies)}isMapDouble(e){return null!==e.match(this.collision_map_d)}isMapBefore(e,t){return e<0}isMapLastSide(e,t){return void 0!==this.mapdef[t]&&(void 0===this.mapdef[t][e]||e===this.mapdef[t].length-1)}isMapOver(e,t){return void 0!==this.mapdef[t]&&(void 0===this.mapdef[t][e]||e>this.mapdef[t].length-1)}isMapCollision(e,t){return void 0!==this.mapdef_col[t]&&(void 0!==this.mapdef_col[t][e]&&!!this.isCollisionBit(this.mapdef_col[t][e]))}isMapGameClear(){if(""===this.map_boss||void 0===this.map_boss||void 0===ws[this.map_boss])return!0}setPlayersShotAbleCollision(e,t,s){let i=Fe._obj[e+","+t];void 0!==i&&i.is_able_collision&&i.collision(s)}isPlayersShotCollision(){for(let e=0;e<Ft._shots.shot[Ft._shot_type].length;e++){let t=Ft._shots.shot[Ft._shot_type][e];for(let e=0;e<t.shots.length;e++){let s=t.shots[e];s._shot_alive&&t.map_collition(s)}}for(let e=0;e<Ft._shots.missile.length;e++){let t=Ft._shots.missile[e];if(t.player.isalive())for(let e=0;e<t.shots.length;e++){let s=t.shots[e];s._shot_alive&&(s._c>0||t.map_collition(s))}}}show(){}showMapForStageselect(e){let t=this;if(null===e||void 0===e)return;let s=e._map.length;for(let i=0;i<(s>20?20:s);i++){let s=e._map[i].length;for(let _=0;_<(s>40?40:s);_++){let s=e._map[i][_+100];if(void 0!==s&&"0"!==s)if(null!==s.match(t.collision_enemies)){let t=xs[e._theme]._enemies[s]._getObj({});l.save();let o=null===t.direct?u.get_enemy_dir(_+100,i):t.direct,n=0+10*_,a=130+10*i,r=t.width/2.5,h=t.height/2.5;o===I._U&&l.setTransform(1,0,0,-1,0,2*a+h),o===I._LU&&l.setTransform(-1,0,0,-1,2*n+r,2*a+h),o===I._LD&&l.setTransform(-1,0,0,1,2*n+r,0),l.translate(0+10*_,130+10*i),l.scale(.25,.25),l.drawImage(t.img,t.imgPos[0],0,t.width,t.height,0,0,1.6*t.width,1.6*t.height),l.restore()}else{let t=xs[e._theme]._map[s]._getObj({});l.save(),l.translate(0+10*_,130+10*i),l.scale(.25,.25),l.drawImage(t.img,t.imgPos[0],0,t.width,t.height,0,0,1.6*t.width,1.6*t.height),l.restore()}}}l.fillStyle="rgba(0,0,0,1)",l.fillRect(0,130,50,500),l.fillRect(350,130,500,500),l.fillRect(50,330,500,500),l.beginPath(),l.lineWidth=1,l.strokeStyle="rgba(255,255,255,1)",l.fillStyle="rgba(255,255,255,1)",l.strokeRect(50,130,300,200)}set_mapdef_col_clear(){let e=this;for(let t=0;t<e.mapdef_col.length;t++){let s=e.mapdef_col[t];e.mapdef_col[t]=s.replace(/1/gi,"0")}}set_scroll_on_x(){this.map_background_speed=parseInt(ls[this.map_pettern]._speed)}set_scroll_off_x(){this.map_background_speed=0}move(){let e=this;ds+h.width>e.mapdef[0].length*e.t+e.initx&&(e.isboss=!0),ds-100>e.mapdef[0].length*e.t+e.initx&&(e.map_background_speed=0),e.x+=-1*e.map_background_speed,ds+=e.map_background_speed,e.y=e.getY(e.y),gs=function(){let t=gs+e.map_backgroundY_speed;return t<0?(1e3+t)%1e3:t%1e3}()}}const vs=null===window.ontouchstart?"touchstart":"keydown",fs=null===window.ontouchstart?"touchmove":"keydown",Is=null===window.ontouchstart?"touchend":"keyup";let Ps=!1,js=!1;const Ms={addKeydownStart:function(){a?Es._sp_bt_s.addEventListener(vs,Ss.keydown_start):document.addEventListener(vs,Cs.keydown_start)},removeKeydownStart:function(){a?Es._sp_bt_s.removeEventListener(vs,Ss.keydown_start):document.removeEventListener(vs,Cs.keydown_start)},addKeydownSelectStage:function(){a?(Es._sp_main_center.addEventListener(fs,Ss.keymove_select_stage),Es._sp_main_center.addEventListener(Is,Ss.keyend_select_stage),Es._sp_bt_a.addEventListener(vs,Ss.keydown_select_stage_a)):document.addEventListener(vs,Cs.keydown_select_stage)},removeKeydownSelectStage:function(){a?(Es._sp_main_center.removeEventListener(fs,Ss.keymove_select_stage),Es._sp_main_center.removeEventListener(Is,Ss.keyend_select_stage),Es._sp_bt_a.removeEventListener(vs,Ss.keydown_select_stage_a),Es._set_reset()):document.removeEventListener(vs,Cs.keydown_select_stage)},addKeydownSelectPowermeter:function(){a?(Es._sp_main_center.addEventListener(fs,Ss.keymove_select_powermeter),Es._sp_main_center.addEventListener(Is,Ss.keyend_select_powermeter),Es._sp_bt_a.addEventListener(vs,Ss.keydown_select_powermeter_a)):document.addEventListener(vs,Cs.keydown_select_powermeter)},removeKeydownSelectPowermeter:function(){a?(Es._sp_main_center.removeEventListener(fs,Ss.keymove_select_powermeter),Es._sp_main_center.removeEventListener(Is,Ss.keyend_select_powermeter),Es._sp_bt_a.removeEventListener(vs,Ss.keydown_select_powermeter_a),Es._set_reset()):document.removeEventListener(vs,Cs.keydown_select_powermeter)},addKeydownGame:function(){a?(Es._sp_bt_hide.addEventListener(vs,Ss.keydown_game_hide),Es._sp_bt_r.addEventListener(vs,Ss.keydown_game_r),Es._sp_bt_p.addEventListener(vs,Ss.keydown_game_p),Es._sp_bt_s.addEventListener(vs,Ss.keydown_game_s),Es._sp_bt_b.addEventListener(vs,Ss.keydown_game_b),Es._sp_bt_a.addEventListener(vs,Ss.keydown_game_a),Es._sp_main_center.addEventListener(vs,Ss.keymove_game_controller),Es._sp_main_center.addEventListener(fs,Ss.keymove_game_controller)):document.addEventListener(vs,Cs.keydown_game)},addKeyupGame:function(){a?(Es._sp_bt_a.addEventListener(Is,Ss.keyup_game_a),Es._sp_main_center.addEventListener(Is,Ss.keyend_game_controller),Es._set_reset()):document.addEventListener(Is,Cs.keyup_game)},removeKeydownGame:function(){a?(Es._sp_bt_hide.removeEventListener(vs,Ss.keydown_game_hide),Es._sp_bt_r.removeEventListener(vs,Ss.keydown_game_r),Es._sp_bt_p.removeEventListener(vs,Ss.keydown_game_p),Es._sp_bt_s.removeEventListener(vs,Ss.keydown_game_s),Es._sp_bt_b.removeEventListener(vs,Ss.keydown_game_b),Es._sp_bt_a.removeEventListener(vs,Ss.keydown_game_a),Es._sp_main_center.removeEventListener(vs,Ss.keymove_game_controller),Es._sp_main_center.removeEventListener(fs,Ss.keymove_game_controller)):document.removeEventListener(vs,Cs.keydown_game)},removeKeyupGame:function(){a?(Es._sp_bt_a.removeEventListener(Is,Ss.keyup_game_a),Es._sp_main_center.removeEventListener(Is,Ss.keyend_game_controller),Es._set_reset()):document.removeEventListener(Is,Cs.keyup_game)},addKeydownGameclear:function(){a?(Es._sp_bt_r.addEventListener(vs,Ss.keydown_gameclear_r),Es._sp_bt_s.addEventListener(vs,Ss.keydown_gameclear_s),Es._sp_bt_p.addEventListener(vs,Ss.keydown_gameclear_p)):document.addEventListener(vs,Cs.keydown_gameclear)},removeKeydownGameclear:function(){a?(Es._sp_bt_r.removeEventListener(vs,Ss.keydown_gameclear_r),Es._sp_bt_s.removeEventListener(vs,Ss.keydown_gameclear_s),Es._sp_bt_p.removeEventListener(vs,Ss.keydown_gameclear_p)):document.removeEventListener(vs,Cs.keydown_gameclear)},addKeydownGameover:function(){a?(Es._sp_bt_r.addEventListener(vs,Ss.keydown_gameover_r),Es._sp_bt_s.addEventListener(vs,Ss.keydown_gameover_s)):document.addEventListener(vs,Cs.keydown_gameover)},removeKeydownGameover:function(){a?(Es._sp_bt_r.removeEventListener(vs,Ss.keydown_gameover_r),Es._sp_bt_s.removeEventListener(vs,Ss.keydown_gameover_s)):document.removeEventListener(vs,Cs.keydown_gameover)}},Cs={keydown_start:function(e){"S"!==e.key&&"s"!==e.key||mi()},keydown_select_powermeter:function(e){if(cancelAnimationFrame(n),n=null,"Enter"===e.key||"enter"===e.key)return $s(),T._setPlay(s.playerset),!1;"ArrowUp"!==e.key&&"Up"!==e.key||p.set_pms_status({num:-1}),"ArrowDown"!==e.key&&"Down"!==e.key||p.set_pms_status({num:1}),"ArrowLeft"!==e.key&&"Left"!==e.key||p.set_pmss_status({num:-1}),"ArrowRight"!==e.key&&"Right"!==e.key||p.set_pmss_status({num:1}),p.pms_select(),T._setPlay(s.pms_select)},keydown_select_stage:function(e){if("Enter"===e.key||"enter"===e.key)return u.set_stage_map_pattern(y.mapdef_status),ri(),T._setPlay(s.playerset),!1;"ArrowLeft"!==e.key&&"Left"!==e.key||y.set_map_status({num:-1}),"ArrowRight"!==e.key&&"Right"!==e.key||y.set_map_status({num:1}),y.disp_thumb_map(),T._setPlay(s.pms_select)},keydown_gameclear:function(e){return"R"===e.key||"r"===e.key?(Ws(),ni(),ai(),!1):"S"===e.key||"s"===e.key?(Ws(),ni(),hi(),!1):"P"===e.key||"p"===e.key?(Os()?(w=[],Ys()):Zs(),!1):(" "!==e.key&&"Spacebar"!==e.key||Vs(),"ArrowLeft"!==e.key&&"Left"!==e.key||Ft._set_move_players({x:-1,y:0}),"ArrowRight"!==e.key&&"Right"!==e.key||Ft._set_move_players({x:1,y:0}),"ArrowUp"!==e.key&&"Up"!==e.key||Ft._set_move_players({x:0,y:-1}),"ArrowDown"!==e.key&&"Down"!==e.key||Ft._set_move_players({x:0,y:1}),void("B"!==e.key&&"b"!==e.key||p.playerset()))},keydown_gameover:function(e){return"R"===e.key||"r"===e.key?(Ws(),ni(),ai(),!1):"S"===e.key||"s"===e.key?(Ws(),ni(),hi(),!1):void 0},keydown_game:function(e){return!!Ft._players_obj.isalive()&&("R"===e.key||"r"===e.key?(Ws(),ni(),ai(),!1):"S"===e.key||"s"===e.key?(Ws(),ni(),hi(),!1):"P"===e.key||"p"===e.key?(Os()?(w=[],Ys()):Zs(),!1):Os()?(w.push(e.keyCode),x===w.toString()&&p._set_hide(),!1):(" "!==e.key&&"Spacebar"!==e.key||Vs(),"ArrowLeft"!==e.key&&"Left"!==e.key||Ft._set_move_players({x:-1,y:0}),"ArrowRight"!==e.key&&"Right"!==e.key||Ft._set_move_players({x:1,y:0}),"ArrowUp"!==e.key&&"Up"!==e.key||Ft._set_move_players({x:0,y:-1}),"ArrowDown"!==e.key&&"Down"!==e.key||Ft._set_move_players({x:0,y:1}),"B"!==e.key&&"b"!==e.key||p.playerset(),!!i&&("M"!==e.key&&"m"!==e.key||_i(),"N"!==e.key&&"n"!==e.key||oi(),void("V"!==e.key&&"v"!==e.key||p.move()))))},keyup_game:function(e){"ArrowLeft"!==e.key&&"Left"!==e.key||Ft._set_stop_players(),"ArrowRight"!==e.key&&"Right"!==e.key||Ft._set_stop_players(),"ArrowUp"!==e.key&&"Up"!==e.key||Ft._set_stop_players(),"ArrowDown"!==e.key&&"Down"!==e.key||Ft._set_stop_players()," "!==e.key&&"Spacebar"!==e.key||Ws()}},Ss={keydown_start:function(e){mi()},keydown_select_powermeter_a:function(e){return $s(),T._setPlay(s.playerset),!1},keymove_select_powermeter:function(e){cancelAnimationFrame(n),n=null,e.preventDefault();let t=Es._get_st(e);if(!0===Ps)return!1;Ps=!0,t===Es._DEF_DIR._L&&p.set_pmss_status({num:-1}),t===Es._DEF_DIR._U&&p.set_pms_status({num:-1}),t===Es._DEF_DIR._R&&p.set_pmss_status({num:1}),t===Es._DEF_DIR._D&&p.set_pms_status({num:1}),p.pms_select(),T._setPlay(s.pms_select)},keyend_select_powermeter:function(e){Es._set_reset(),Ps=!1},keymove_select_stage:function(e){if(e.preventDefault(),js)return;js=!0;let t=Es._get_st(e);return t?(t===Es._DEF_DIR._L&&y.set_map_status({num:-1}),t===Es._DEF_DIR._R&&y.set_map_status({num:1}),y.disp_thumb_map(),T._setPlay(s.pms_select),!1):void 0},keyend_select_stage:function(e){js=!1},keydown_select_stage_a:function(e){return u.set_stage_map_pattern(y.mapdef_status),ri(),T._setPlay(s.playerset),!1},keydown_gameclear_r:function(e){return Ws(),ni(),ai(),!1},keydown_gameclear_s:function(e){return Ws(),ni(),ai(),!1},keydown_gameclear_p:function(e){return Os()?(w=[],Ys()):Zs(),!1},keydown_gameover_r:function(e){return Ws(),ni(),ai(),!1},keydown_gameover_s:function(e){return Ws(),ni(),hi(),!1},keymove_game_controller:function(e){e.preventDefault();let t=Es._get_st(e);if(!1!==t)return t===Es._DEF_DIR._L&&Ft._set_move_players({x:-1,y:0}),t===Es._DEF_DIR._LU&&Ft._set_move_players({x:-1,y:-1}),t===Es._DEF_DIR._U&&Ft._set_move_players({x:0,y:-1}),t===Es._DEF_DIR._RU&&Ft._set_move_players({x:1,y:-1}),t===Es._DEF_DIR._R&&Ft._set_move_players({x:1,y:0}),t===Es._DEF_DIR._RD&&Ft._set_move_players({x:1,y:1}),t===Es._DEF_DIR._D&&Ft._set_move_players({x:0,y:1}),t===Es._DEF_DIR._LD&&Ft._set_move_players({x:-1,y:1}),!1},keyend_game_controller:function(e){Ft._set_stop_players()},keydown_game_hide:function(e){return p._set_hide(),!1},keydown_game_r:function(e){return ni(),ai(),!1},keydown_game_s:function(e){return ni(),hi(),!1},keydown_game_p:function(e){return Os()?(w=[],Ys()):Zs(),!1},keydown_game_a:function(e){return Vs(),!1},keydown_game_b:function(e){return p.playerset(),!1},keyup_game_a:function(e){return Ws(),!1}},Es={x:0,y:0,_main_dist_within:0,_sp_main_center:new Object,_sp_main:new Object,_sp_bt_hide:new Object,_sp_bt_r:new Object,_sp_bt_p:new Object,_sp_bt_s:new Object,_sp_bt_b:new Object,_sp_bt_a:new Object,_DEF_DIR:{_U:0,_D:1,_R:2,_L:3,_LU:4,_LD:5,_RU:6,_RD:7},_SP_CONTROLLER_SETINTERVAL:!1,_set_main_dist_within(e){void 0!==e&&(this._main_dist_within=e.num)},_set_sp_main_movePoint(e){let t=Es._sp_main.getBoundingClientRect();for(let s=0;s<e.touches.length;s++)Es._sp_main_center===e.touches[s].target&&(this.x=e.touches[s].clientX-t.left,this.y=e.touches[s].clientY-t.top)},_draw_sp_main(e){this._SP_CONTROLLER_SETINTERVAL&&(e.obj.target.style.left=parseInt(e.x)+"px",e.obj.target.style.top=parseInt(e.y)+"px")},_keymove_sp_main(e){let t=Es;t._SP_CONTROLLER_SETINTERVAL=!0,t._set_sp_main_movePoint(e);let s=t.x-parseInt(window.getComputedStyle(t._sp_main_center).width)/2,i=t.y-parseInt(window.getComputedStyle(t._sp_main_center).height)/2;t._draw_sp_main({obj:e,x:s,y:i}),e.stopPropagation(),e.preventDefault()},_keyup_sp_main(e){Es._SP_CONTROLLER_SETINTERVAL=!1,e.target.style.top="",e.target.style.left="",e.stopPropagation(),e.preventDefault()},_keydown_sp_bts(e){e.currentTarget.classList.add("on"),e.stopPropagation(),e.preventDefault()},_keyup_sp_bts(e){e.currentTarget.classList.remove("on"),e.stopPropagation(),e.preventDefault()},_get_st:function(e){let t=this._sp_main;this._set_sp_main_movePoint(e);let s=parseInt(window.getComputedStyle(t).width),i=parseInt(window.getComputedStyle(t).height),_=s/2-this.x,o=i/2-this.y;if(Math.sqrt(Math.pow(_,2)+Math.pow(o,2))<this._main_dist_within)return!1;let n=parseInt(180*Math.atan2(o,_)/Math.PI);return n>-40&&n<=40?this._DEF_DIR._L:n>40&&n<=50?this._DEF_DIR._LU:n>50&&n<=130?this._DEF_DIR._U:n>130&&n<=140?this._DEF_DIR._RU:n>140&&n<=180||n<-140&&n>=-180?this._DEF_DIR._R:n<-130&&n>=-140?this._DEF_DIR._RD:n<-50&&n>=-130?this._DEF_DIR._D:n<-40&&n>=-50?this._DEF_DIR._LD:void 0},_set_reset(){},_set_obj(){this._sp_main_center=document.querySelector(".sp_controller_main_center"),this._sp_main=document.querySelector(".sp_controller_main"),this._sp_bt_hide=document.querySelector(".sp_controller_bt.hide"),this._sp_bt_r=document.querySelector(".sp_controller_bt.r"),this._sp_bt_p=document.querySelector(".sp_controller_bt.p"),this._sp_bt_s=document.querySelector(".sp_controller_bt.s"),this._sp_bt_b=document.querySelector(".sp_controller_bt.b"),this._sp_bt_a=document.querySelector(".sp_controller_bt.a"),this._sp_main_center.addEventListener(fs,this._keymove_sp_main),this._sp_main_center.addEventListener(Is,this._keyup_sp_main);const e=document.querySelectorAll(".sp_controller_bt");for(let t=0;t<e.length;t++)e[t].addEventListener(vs,this._keydown_sp_bts),e[t].addEventListener(Is,this._keyup_sp_bts)}};let Ds=null,ks=null,As=null,Ls=!1;const Os=()=>null===Ds,Ts=()=>{for(let e=0;e<m.length;e++)m[e].isshow()||m[e].isalive()||m.splice(e,1);Ft._enemy_collision(m)},Rs=()=>{for(let e=0;e<c.length;e++)c[e].isshow()||c.splice(e,1);Ft._enemy_shot_collision(c)},Ys=()=>{Ms.addKeydownGame(),Ms.addKeyupGame(),T._setPlayOnBG(T._audio_now_obj_bg);const e=()=>{Ds=window.requestAnimationFrame(e),l.clearRect(0,0,h.width,h.height),Tt._move_background(),Tt._draw_background();for(let e=0;e<c.length;e++)Ft._players_obj.isalive()&&c[e].move(),c[e].setDrawImage();Ft._players_obj.isalive()&&(Fe._optimized_maps(),Fe._move_maps()),Ft._players_obj.isalive()&&u.move();for(let e=0;e<m.length;e++)void 0!==m[e]&&(Ft._players_obj.isalive()&&m[e].move(),m[e].setDrawImage());Tt._optimized_powercapsell(),Tt._set_powercapsell(),Ft._players_obj.isalive()&&Tt._move_powercapsell(),Tt._draw_powercapsell();for(let e=0;e<d.length;e++)Ft._players_obj.isalive()&&d[e].move(),d[e].setDrawImage();Ft._players_obj.isalive()&&(P=Ft._option_count>2?1:0,P+=Ft._shot_type===Ft._shot_type_def.LASER?1:0,P+=Ft._players_force_obj.isalive()?1:0,P+=parseInt(g),Rs(),Ts(),u.isPlayersShotCollision(),ii()),Ft._move_shots(),Ft._draw_shots(),Ft._draw_option(),Ft._move_players(),Ft._set_move_draw(),Ft._draw_players(),Fe._draw_maps(),p.show(),Tt._draw_score(),Ft._players_obj.isalive()?Hs():Gs()};Ds=window.requestAnimationFrame(e)};let Us=!1,Xs=0,Bs=!1,Fs=0,qs=0,Ns=0,zs=new Object;const Hs=()=>{if(u.isboss)if(u.isMapGameClear())ti();else if(Fs>=u.get_ememies_boss().length)ti();else{if(!Us){Us=!0;let e=u.get_ememies_boss()[Fs];e._left||(m=[],c=[]),_i(),zs=e._obj(),m.push(zs),e._bgmusic()}if(u.setBackGroundSpeedY(0),u.setInifinite(!1),Bs){return 0===Ns&&oi(),u.get_ememies_boss()[Fs-1]._movex<=Ns?(Ns=0,Bs=!1,void(Us=!1)):void Ns++}if(!zs.isalive())return Bs=!0,Fs++,void(qs=0);qs++}},Gs=()=>{if(Ms.removeKeydownGame(),Ms.removeKeyupGame(),T._setStopOnBG(),Ws(),_i(),Ft._is_finished_player_collision)return Zs(),void si();Ft._draw_player_collision()};let Ks=0;const Vs=()=>{if(null===Ds)return;if(null!==n)return;let e=new Date;Ks=0;const t=()=>{if(n=window.requestAnimationFrame(t),(Ks=Ks>10?Ks:Ks+1)>=10){if(new Date-e<50)return;e=new Date}else if(1!==Ks)return;Ft._start_shots(),Ft._start_missile_shots()};n=window.requestAnimationFrame(t)},Ws=()=>{window.cancelAnimationFrame(n),n=null,Ft._stop_shots(),Ft._stop_missile_shots()},Zs=()=>{T._setStopOnBG(),window.cancelAnimationFrame(Ds),Ds=null},Js=()=>{window.cancelAnimationFrame(As),As=null},Qs=()=>{window.cancelAnimationFrame(ks),ks=null},$s=()=>{Ws(),Ms.removeKeydownSelectPowermeter();let e=0,t=null;const s=()=>{t=window.requestAnimationFrame(s),l.clearRect(0,0,h.width,h.height),p.pms_disp(),e%5==0&&p.pms_select(),e>40&&(_=p._c_pms,o=p._c_pmss,window.cancelAnimationFrame(t),ai()),e++};t=window.requestAnimationFrame(s)},ei=()=>{if(Ms.removeKeydownGame(),Ms.removeKeyupGame(),Tt._init_background(),u.set_gamestart(),i)return void Ys();let e=0;const t=()=>{if(As=window.requestAnimationFrame(t),e>250)return window.cancelAnimationFrame(As),As=null,T._setPlayOnBG(s["bg_"+u.map_bgmusic]),void Ys();l.clearRect(0,0,h.width,h.height),Tt._move_background(),Tt._draw_background(),p.show(),Tt._draw_score(),parseInt(e/50)%2!=0||R._setDrawToText({s:"start",x:"center",y:h.height/2-30-20}),e++};As=window.requestAnimationFrame(t),T._setStopOnBG()},ti=()=>{Xs>100?(oi(),R._setDrawToText({s:"gameclear",x:"center",y:h.height/2-30-40}),R._setDrawToText({s:"press r to restart",x:"center",y:h.height/2+30,r:.3}),R._setDrawToText({s:"press s to change to another stage",x:"center",y:h.height/2+60,r:.3}),Ls=!0):Xs++},si=()=>{Ms.removeKeydownGame(),Ms.removeKeyupGame(),Zs(),Ms.addKeydownGameover(),l.clearRect(0,0,h.width,h.height),Tt._draw_background(),p.show(),Tt._draw_score(),R._setDrawToText({s:"gameover",x:"center",y:h.height/2-30-40}),R._setDrawToText({s:"press r to restart",x:"center",y:h.height/2+30,r:.3}),R._setDrawToText({s:"press s to change to another stage",x:"center",y:h.height/2+60,r:.3})},ii=()=>{for(let e=0;e<d.length;e++)d[e].isalive()||d.splice(e,1)},_i=()=>{u.set_scroll_off_x()},oi=()=>{u.set_scroll_on_x()},ni=()=>{Ms.removeKeydownGame(),Ms.removeKeyupGame(),Ms.removeKeydownGameover(),Ws(),Zs(),l.clearRect(0,0,h.width,h.height),Fe._init(),Ft._reset(),m=[],c=[],d=[],p="",P=0,Tt._reset(),ds=0,gs=0,Us=!1,Xs=0,Bs=!1,Fs=0,qs=0,Ns=0,zs=new Object},ai=()=>{Ms.removeKeydownSelectPowermeter(),Ft._init_players_obj(_),Ft._init_players_force_obj(_),Ft._init_option_obj(_),p=new Rt,Ls||Tt._reset_score(),Ls=!1,ei()},ri=()=>{Ws(),l.clearRect(0,0,h.width,h.height),Ms.removeKeydownSelectStage(),Ms.addKeydownSelectPowermeter(),(p=new Rt).pms_disp(),p.pms_select()},hi=()=>{Ws(),window.cancelAnimationFrame(ks),ks=null,l.clearRect(0,0,h.width,h.height),Ms.removeKeydownStart(),Ms.removeKeydownGame(),Ms.removeKeyupGame(),Ms.removeKeydownGameover(),(y=new Yt).init(),Ms.addKeydownSelectStage(),T._setPlayOnBG(s.bg_powermeterselect)};let li=0;const mi=()=>{O._init_imgs(e,e=>{li=e}).then(()=>{hi()}),T._setPlay(s.playerset)},ci=()=>{let e=0;const s=()=>{ks=window.requestAnimationFrame(s),l.clearRect(0,0,h.width,h.height),l.save(),l.globalAlpha=.5,l.drawImage(t.gradius_background.obj,0,0,1e3,500),l.restore(),R._setDrawImage({img:t.gradius_logo.obj,x:150,y:80,width:700,height:130,basePoint:1});let i="no pakuri";R._setDrawToText({s:i,x:h.width/2-42*i.length/2,y:h.height/2-20,r:.7}),i="press s to start",R._setDrawToText({s:i,x:"center",y:h.height/2+60,r:.5,alpha:parseFloat(e/100)}),e=e>=100?0:e+1,0!==li&&(i="now loading "+li,R._setDrawToText({s:i,x:"center",y:h.height/2+130,r:.4,alpha:e%2==0?1:0}))};ks=window.requestAnimationFrame(s)};window.addEventListener("load",()=>{l=h.getContext("2d"),T._init(),R.setUrlParams(),i="true"===R._url_params.debug,cs=R._url_params.mp||0,g=R._url_params.ed||0,a&&document.querySelector("body").classList.add("sp"),L({url:"./gradius_config.json"}).then(e=>{j=e.common.difficult,Es._set_main_dist_within({num:parseInt(e.controller_event.sp_controller_main_dist_within)}),(u=new bs).init(),u.init_map_theme(e.map.theme),u.init_map_enemies_boss(e.map.enemies_boss)}).then(()=>T._init_audios(s,e=>{document.querySelector("#game_start_loading .rate").innerHTML=parseInt(e)+"%"})).then(()=>O._init_imgs(t)).then(()=>{if(Ft._set_shot_type("_SHOTTYPE_NORMAL"),Tt._init_score(),document.querySelector("#game_start_loading").classList.remove("on"),document.querySelector("#game_wrapper").classList.add("on"),a){document.querySelector("#sp_controller").classList.add("on"),Es._set_obj()}if(i)return(y=new Yt).init(),u.set_stage_map_pattern(cs),void O._init_imgs(e).then(()=>{ri()});Ms.addKeydownStart(),ci()}).catch(()=>{console.log("json:error"),alert("エラーが発生しました。もう一度このアプリ再起動をお願いします。\nブラウザでキャッシュクリアの必要性があります")})}),window.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1});