"use strict";const _CANVAS_IMGS={vicviper:{src:"images/gradius_vicviper.png",rate:1,obj:new Image},vicviper_back:{src:"images/gradius_vicviper_back.png",rate:1,obj:new Image},vicviper_bomb:{src:"images/gradius_vicviper_bomb.png",rate:1,obj:new Image},vicviper_bomb_red:{src:"images/gradius_vicviper_bomb_red.png",rate:1,obj:new Image},option:{src:"images/option.png",rate:1,obj:new Image},forcefield:{src:"images/gradius_forcefield.png",rate:1,obj:new Image},shield:{src:"images/gradius_shield.png",rate:1,obj:new Image},gradius_missile:{src:"images/gradius_missile.png",rate:1,obj:new Image},shot1:{src:"images/gradius_shot1.png",rate:.4,obj:new Image},shot2:{src:"images/gradius_shot2.png",rate:.4,obj:new Image},shot3:{src:"images/gradius_shot3.png",rate:.4,obj:new Image},shot_laser_col:{src:"images/gradius_shot_laser_col.png",rate:1,obj:new Image},gradius_pc:{src:"images/gradius_pc.png",rate:1,obj:new Image},meter:{src:"images/gradius_meter.png",rate:1,obj:new Image},meter_c:{src:"images/gradius_meter_c.png",rate:1,obj:new Image},enemy_fan:{src:"images/gradius_enemy_fan.png",rate:1,obj:new Image},enemy_a:{src:"images/gradius_enemy_a.png",rate:1,obj:new Image},enemy_b:{src:"images/gradius_enemy_b.png",rate:1,obj:new Image},enemy_c:{src:"images/gradius_enemy_c.png",rate:1,obj:new Image},enemy_d:{src:"images/gradius_enemy_d.png",rate:1,obj:new Image},enemy_e:{src:"images/gradius_enemy_e.png",rate:1,obj:new Image},enemy_f:{src:"images/gradius_enemy_f.png",rate:1,obj:new Image},enemy_g:{src:"images/gradius_enemy_g.png",rate:1,obj:new Image},enemy_m1:{src:"images/gradius_enemy_m1.png",rate:1,obj:new Image},enemy_m2:{src:"images/gradius_enemy_m2.png",rate:1,obj:new Image},enemy_m_group:{src:"images/gradius_enemy_m_group.png",rate:1,obj:new Image},enemy_o:{src:"images/gradius_enemy_o.png",rate:1,obj:new Image},enemy_p_1:{src:"images/gradius_enemy_p_1.png",rate:1,obj:new Image},enemy_p_2:{src:"images/gradius_enemy_p_2.png",rate:1,obj:new Image},enemy_p_3:{src:"images/gradius_enemy_p_3.png",rate:1,obj:new Image},enemy_p_4:{src:"images/gradius_enemy_p_4.png",rate:1,obj:new Image},enemy_p_5:{src:"images/gradius_enemy_p_5.png",rate:1,obj:new Image},enemy_moai_boss:{src:"images/gradius_enemy_moai_boss.png",rate:1,obj:new Image},enemy_moai_mini_boss:{src:"images/gradius_enemy_moai_mini_boss.png",rate:1,obj:new Image},enemy_moai_boss_ring:{src:"images/gradius_enemy_moai_boss_ring.png",rate:1,obj:new Image},enemy_m_a_1:{src:"images/gradius_enemy_m_a_1.png",rate:1,obj:new Image},enemy_m_a_2:{src:"images/gradius_enemy_m_a_2.png",rate:1,obj:new Image},enemy_m_b_1:{src:"images/gradius_enemy_m_b_1.png",rate:1,obj:new Image},enemy_m_b_2:{src:"images/gradius_enemy_m_b_2.png",rate:1,obj:new Image},enemy_m_z:{src:"images/gradius_enemy_m_z.png",rate:1,obj:new Image},enemy_moai_ring:{src:"images/gradius_enemy_moai_ring.png",rate:1,obj:new Image},enemy_cell_boss:{src:"images/gradius_enemy_cell_boss.png",rate:1,obj:new Image},enemy_cell_boss_eye:{src:"images/gradius_enemy_cell_boss_eye.png",rate:1,obj:new Image},enemy_cell_core:{src:"images/gradius_enemy_cell_core.png",rate:1,obj:new Image},enemy_cell_hand_1:{src:"images/gradius_enemy_cell_hand_1.png",rate:1,obj:new Image},enemy_cell_hand_2:{src:"images/gradius_enemy_cell_hand_2.png",rate:1,obj:new Image},enemy_cell_hand_3:{src:"images/gradius_enemy_cell_hand_3.png",rate:1,obj:new Image},enemy_cell_a:{src:"images/gradius_enemy_cell_a.png",rate:1,obj:new Image},enemy_cell_b:{src:"images/gradius_enemy_cell_b.png",rate:1,obj:new Image},enemy_frame_large:{src:"images/gradius_enemy_frame_large.png",rate:1,obj:new Image},enemy_frame_small:{src:"images/gradius_enemy_frame_small.png",rate:1,obj:new Image},enemy_frame_mini:{src:"images/gradius_enemy_frame_mini.png",rate:1,obj:new Image},enemy_frame_head1:{src:"images/gradius_enemy_frame_head_1.png",rate:1,obj:new Image},enemy_frame_head2:{src:"images/gradius_enemy_frame_head_2.png",rate:1,obj:new Image},enemy_frame_head3:{src:"images/gradius_enemy_frame_head_3.png",rate:1,obj:new Image},enemy_frame_head4:{src:"images/gradius_enemy_frame_head_4.png",rate:1,obj:new Image},enemy_frame_body1:{src:"images/gradius_enemy_frame_body_1.png",rate:1,obj:new Image},enemy_bigcore:{src:"images/gradius_enemy_bigcore.png",rate:.6,obj:new Image},enemy_bigcore_1:{src:"images/gradius_enemy_bigcore_1.png",rate:.6,obj:new Image},enemy_bigcore_2:{src:"images/gradius_enemy_bigcore_2.png",rate:.6,obj:new Image},enemy_bigcore_3:{src:"images/gradius_enemy_bigcore_3.png",rate:.6,obj:new Image},enemy_bigcore_4_1:{src:"images/gradius_enemy_bigcore_4_1.png",rate:.6,obj:new Image},enemy_bigcore_4_2:{src:"images/gradius_enemy_bigcore_4_2.png",rate:.6,obj:new Image},enemy_bigcore_4_3:{src:"images/gradius_enemy_bigcore_4_3.png",rate:.6,obj:new Image},enemy_bigcore_4_4:{src:"images/gradius_enemy_bigcore_4_4.png",rate:.6,obj:new Image},enemy_bigcore_4_5:{src:"images/gradius_enemy_bigcore_4_5.png",rate:.6,obj:new Image},enemy_cristalcore:{src:"images/gradius_enemy_cristalcore.png",rate:1,obj:new Image},enemy_cristalcore_hand1:{src:"images/gradius_enemy_cristalcore_hand1.png",rate:.3,obj:new Image},enemy_cristalcore_hand2:{src:"images/gradius_enemy_cristalcore_hand2.png",rate:.4,obj:new Image},enemy_cristalcore_wall1:{src:"images/gradius_enemy_cristalcore_wall1.png",rate:1,obj:new Image},enemy_cristalcore_wall2:{src:"images/gradius_enemy_cristalcore_wall2.png",rate:1,obj:new Image},enemy_cristalcore_shot:{src:"images/gradius_enemy_cristalcore_shot.png",rate:1,obj:new Image},enemy_cube:{src:"images/gradius_enemy_cube.png",rate:1,obj:new Image},enemy_bigcore2:{src:"images/gradius_enemy_bigcore2.png",rate:1,obj:new Image},enemy_bigcore2_hand:{src:"images/gradius_enemy_bigcore2_hand.png",rate:1,obj:new Image},enemy_bigcore2_wall:{src:"images/gradius_enemy_bigcore2_wall.png",rate:1,obj:new Image},enemy_bigcore2_core:{src:"images/gradius_enemy_bigcore2_core.png",rate:1,obj:new Image},enemy_bigcore2_back:{src:"images/gradius_enemy_bigcore2_back.png",rate:1,obj:new Image},enemy_death:{src:"images/gradius_enemy_death.png",rate:1,obj:new Image},enemy_death_front:{src:"images/gradius_enemy_death_front.png",rate:1,obj:new Image},enemy_death_shot:{src:"images/gradius_enemy_death_shot.png",rate:1,obj:new Image},enemy_death_shot2:{src:"images/gradius_enemy_death_shot2.png",rate:1,obj:new Image},enemy_collapes0:{src:"images/gradius_enemy_collapes0.png",rate:1,obj:new Image},enemy_collapes1:{src:"images/gradius_enemy_collapes1.png",rate:1,obj:new Image},enemy_collapes2:{src:"images/gradius_enemy_collapes2.png",rate:1,obj:new Image},enemy_collapes8:{src:"images/gradius_enemy_collapes8.png",rate:1,obj:new Image},enemy_collapes9:{src:"images/gradius_enemy_collapes9.png",rate:1,obj:new Image},enemy_bullet:{src:"images/gradius_enemy_bullet.png",rate:1,obj:new Image},enemy_bullet_cell:{src:"images/gradius_enemy_bullet_cell.png",rate:1,obj:new Image},enemy_bullet_z:{src:"images/gradius_enemy_bullet_z.png",rate:1,obj:new Image},enemy_bullet_laser:{src:"images/gradius_enemy_bullet_laser.png",rate:1,obj:new Image},map_cube_A:{src:"images/gradius_map_cube_A.png",rate:1,obj:new Image},map_moai_A:{src:"images/gradius_map_moai_A.png",rate:1,obj:new Image},map_moai_B:{src:"images/gradius_map_moai_B.png",rate:1,obj:new Image},map_volcano_A:{src:"images/gradius_map_volcano_A.png",rate:1,obj:new Image},map_volcano_B:{src:"images/gradius_map_volcano_B.png",rate:1,obj:new Image},map_volcano_C:{src:"images/gradius_map_volcano_C.png",rate:1,obj:new Image},map_volcano_D:{src:"images/gradius_map_volcano_D.png",rate:1,obj:new Image},map_volcano_E:{src:"images/gradius_map_volcano_E.png",rate:1,obj:new Image},map_volcano_F:{src:"images/gradius_map_volcano_F.png",rate:1,obj:new Image},map_volcano_G:{src:"images/gradius_map_volcano_G.png",rate:1,obj:new Image},map_volcano_H:{src:"images/gradius_map_volcano_H.png",rate:1,obj:new Image},map_volcano_I:{src:"images/gradius_map_volcano_I.png",rate:1,obj:new Image},map_volcano_J:{src:"images/gradius_map_volcano_J.png",rate:1,obj:new Image},map_volcano_K:{src:"images/gradius_map_volcano_K.png",rate:1,obj:new Image},map_volcano_L:{src:"images/gradius_map_volcano_L.png",rate:1,obj:new Image},map_volcano_M:{src:"images/gradius_map_volcano_M.png",rate:1,obj:new Image},map_volcano_N:{src:"images/gradius_map_volcano_N.png",rate:1,obj:new Image},map_volcano_O:{src:"images/gradius_map_volcano_O.png",rate:1,obj:new Image},map_volcano_P:{src:"images/gradius_map_volcano_P.png",rate:1,obj:new Image},map_frame_A:{src:"images/gradius_map_frame_A.png",rate:1,obj:new Image},map_frame_B:{src:"images/gradius_map_frame_B.png",rate:1,obj:new Image},map_frame_C:{src:"images/gradius_map_frame_C.png",rate:1,obj:new Image},map_frame_D:{src:"images/gradius_map_frame_D.png",rate:1,obj:new Image},map_frame_E:{src:"images/gradius_map_frame_E.png",rate:1,obj:new Image},map_frame_F:{src:"images/gradius_map_frame_F.png",rate:1,obj:new Image},map_cell_A:{src:"images/gradius_map_cell_A.png",rate:1,obj:new Image},map_cell_B:{src:"images/gradius_map_cell_B.png",rate:1,obj:new Image},map_cell_C:{src:"images/gradius_map_cell_C.png",rate:1,obj:new Image},map_cell_D:{src:"images/gradius_map_cell_D.png",rate:1,obj:new Image},map_cell_V:{src:"images/gradius_map_cell_V.png",rate:1,obj:new Image},map_cell_W:{src:"images/gradius_map_cell_W.png",rate:1,obj:new Image},map_cell_Y:{src:"images/gradius_map_cell_Y.png",rate:1,obj:new Image},map_cell_Z:{src:"images/gradius_map_cell_Z.png",rate:1,obj:new Image},map_cell_wall:{src:"images/gradius_map_cell_wall.png",rate:1,obj:new Image}},_CANVAS_IMGS_INIT={font:{src:"images/gradius_font.png",rate:1,obj:new Image},gradius_powermeterselect:{src:"images/gradius_powermeterselect.png",rate:1,obj:new Image},gradius_powermeterselect_selected:{src:"images/gradius_powermeterselect_selected.png",rate:1,obj:new Image},gradius_powermeterselect_shield:{src:"images/gradius_powermeterselect_shield.png",rate:1,obj:new Image},gradius_powermeterselect_shield_selected:{src:"images/gradius_powermeterselect_shield_selected.png",rate:1,obj:new Image}},_CANVAS_AUDIOS={shot_laser:{src:"audios/shot_laser.mp3",volume:1,obj:null,buf:new Object},missile:{src:"audios/missile.mp3",volume:1,obj:null,buf:new Object},shot_normal:{src:"audios/shot_normal.mp3",volume:1,obj:null,buf:new Object},shot_ripple:{src:"audios/shot_ripple.mp3",volume:1,obj:null,buf:new Object},vicviper_bomb:{src:"audios/vicviper_bomb.mp3",volume:1,obj:null,buf:new Object},vicviper_shield_reduce:{src:"audios/vicviper_shield_reduce.mp3",volume:1,obj:null,buf:new Object},pc:{src:"audios/pc.mp3",volume:1,obj:null,buf:new Object},playerset:{src:"audios/playerset.mp3",volume:1,obj:null,buf:new Object},pms_select:{src:"audios/pms_select.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser:{src:"audios/enemy_bullet_laser.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser_long:{src:"audios/enemy_bullet_laser_long.mp3",volume:1,obj:null,buf:new Object},enemy_collision1:{src:"audios/enemy_collision1.mp3",volume:1,obj:null,buf:new Object},enemy_collision2:{src:"audios/enemy_collision2.mp3",volume:1,obj:null,buf:new Object},enemy_collision3:{src:"audios/enemy_collision3.mp3",volume:1,obj:null,buf:new Object},enemy_collision4:{src:"audios/enemy_collision4.mp3",volume:1,obj:null,buf:new Object},enemy_collision5:{src:"audios/enemy_collision5.mp3",volume:1,obj:null,buf:new Object},enemy_collision6:{src:"audios/enemy_collision6.mp3",volume:1,obj:null,buf:new Object},enemy_collision7:{src:"audios/enemy_collision7.mp3",volume:1,obj:null,buf:new Object},enemy_collision8:{src:"audios/enemy_collision8.mp3",volume:1,obj:null,buf:new Object},enemy_all_out:{src:"audios/enemy_all_out.mp3",volume:1,obj:null,buf:new Object},enemy_cube:{src:"audios/enemy_cube.mp3",volume:1,obj:null,buf:new Object},map_cell_wall:{src:"audios/map_cell_wall.mp3",volume:1,obj:null,buf:new Object},bg_powermeterselect:{src:"audios/bg_powermeterselect.mp3",volume:1,obj:null,buf:new Object},bg_boss:{src:"audios/bg_boss.mp3",volume:1,obj:null,buf:new Object},bg_type1:{src:"audios/bg_moai.mp3",volume:1,obj:null,buf:new Object},bg_type2:{src:"audios/bg_volcano.mp3",volume:1,obj:null,buf:new Object},bg_type3:{src:"audios/bg_crystal.mp3",volume:1,obj:null,buf:new Object},bg_type4:{src:"audios/bg_frame.mp3",volume:1,obj:null,buf:new Object},bg_type5:{src:"audios/bg_thunderbolt.mp3",volume:1,obj:null,buf:new Object},bg_type6:{src:"audios/bg_cell.mp3",volume:1,obj:null,buf:new Object}};let _ISDEBUG=!1,_PLAYERS_POWER_METER=0,_PLAYERS_POWER_METER_SHIELD=0,_DRAW_SETINTERVAL=null,_DRAW_GAMESTART_SETINTERVAL=null,_PLAYERS_SHOTS_SETINTERVAL=null,_DRAW_IS_MATCH_BOSS=!1,_DRAW_IS_MATCH_BOSS_COUNT=0;const _ISSP=null===window.ontouchstart,_FPS=60;let _CANVAS,_CONTEXT,_DRAW_IS_GAMECLEAR=!1;const _SHOTTYPE_MISSILE="_SHOTTYPE_MISSILE",_SHOTTYPE_NORMAL="_SHOTTYPE_NORMAL",_SHOTTYPE_DOUBLE="_SHOTTYPE_DOUBLE",_SHOTTYPE_LASER="_SHOTTYPE_LASER",_SHOTTYPE_RIPPLE_LASER="_SHOTTYPE_RIPPLE_LASER";let _SHOTTYPE=_SHOTTYPE_NORMAL,_SCORE="",_PLAYERS_MAIN="",_PLAYERS_MAIN_FORCE="",_PLAYERS_OPTION=new Array,_PLAYERS_OPTION_ISALIVE=0;const _PLAYERS_OPTION_MAX=4,_PLAYERS_MOVE_DRAW_MAX=100;let _PLAYERS_MOVE_FLAG=!1,_PLAYERS_MOVE_DRAW_X=new Array,_PLAYERS_MOVE_DRAW_Y=new Array;const _PLAYERS_MAX=5,_PLAYERS_SHOTS_MAX=2;let _PLAYERS_SHOTS={_SHOTTYPE_NORMAL:new Array,_SHOTTYPE_DOUBLE:new Array,_SHOTTYPE_LASER:new Array},_PLAYERS_MISSILE=new Array,_PLAYERS_MISSILE_ISALIVE=!1,_ENEMIES=new Array,_ENEMIES_SHOTS=new Array,_ENEMIES_COLLISIONS=new Array,_ENEMY_DIFFICULT=4,_POWERCAPSELLS=new Array,_POWERMETER="",_STAGESELECT="",_MAP="",_BACKGROUND=new Array;const _BACKGROUND_STAR_MAX=70;let _KEYSAFTERPAUSE=new Array,_DEF_KEYSAFTERPAUSE="38,38,40,40,37,39,37,39,66,65";const _DEF_DIFFICULT=[{_ENEMY_SHOT_RATE:1e-4,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:5e-4,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.002,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.005,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.01,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:2}],_IS_SQ_COL=0,_IS_SQ_COL_NONE=1,_IS_SQ_NOTCOL=2;let _AUDIO_CONTEXT=null;const _DEF_DIR={_U:0,_D:1,_R:2,_L:3,_LU:4,_LD:5,_RU:6,_RD:7},_AJAX=function(e){if(void 0===e)return;let t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(console.log("OK"),e.f(t.response,e.t)):console.log("NG"))},t.open("GET",e.url+"?date="+(new Date).getTime()),t.responseType=e.type||"json",t.send(null)},_GAME={_url_params:new Array,_init(){_SCORE=new GameObject_SCORE,(_MAP=new GameObject_MAP).init(_GAME._showGameStart)},_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_audio_buffer_loader:null,_audio_now_obj_bg:null,_audio_context_source_bg:null,_is_audio_context_source_bg:!1,_ac:{_get:function(e,t,_){return e>=t.length*_-1?0:e+1}},getRad(e,t){if(void 0!==e&&void 0!==t)return Math.atan2(e.y-t.y,e.x-t.x)},getDeg(e,t){if(void 0===e||void 0===t)return;return Math.atan2(e.y-t.y,e.x-t.x)/Math.PI*180},getRadToDeg:e=>void 0===e||""===e?null:e/Math.PI*180,getBit:(e,t)=>("0".repeat(t)+e).slice(-1*t),getOrBit(e,t,_){let s=(parseInt(e,2)|parseInt(t,2)).toString(2);return this.getBit(s,_)},setUrlParams(){for(var e=location.search.slice(1).split(/(&|&amp;)/),t=0;t<e.length;t++){var _=e[t].replace("amp;","").split("=");""!==_[0]&&void 0!==_[0]&&("&"!==_[0]&&(this._url_params[_[0]]=_[1]))}},isShotCanvasOut:e=>e.x<-_MAP.t||e.x>_CANVAS.width+_MAP.t||e.y<-_MAP.t||e.y>_CANVAS.height+_MAP.t,isEnemyCanvasOut(e,t,_){let s=e.getEnemyCenterPosition(),i=t||{up:!0,down:!0,left:!0,right:!0},a=e.width,n=e.height,o=_||{up:0,down:0,left:0,right:0},r=o.up||0,l=o.right||0,c=o.down||0,m=o.left||0;return s._x<0-a-m&&!0===i.left||s._x>_CANVAS.width+a+l&&!0===i.right||s._y<0-n-r&&!0===i.up||s._y>_CANVAS.height+n+c&&!0===i.down},isSqCollision(e,t,_,s,i){return this.isSqCollision_laser(e,t,_,s,i).ret},isSqCollision_laser(e,t,_,s,i){let a=parseInt(void 0===t?0:t.split(",")[0]),n=parseInt(void 0===t?0:t.split(",")[1]),o=parseInt(void 0===s?0:s.split(",")[0]),r=parseInt(void 0===s?0:s.split(",")[1]),l=e.split(","),c=parseInt(l[2])-parseInt(l[0]),m=parseInt(l[3])-parseInt(l[1]),g=(Math.sqrt(Math.pow(c,2)+Math.pow(m,2)),c/2+a+parseInt(l[0])),h=m/2+n+parseInt(l[1]);i&&console.log(g+":"+h);for(let e=0;e<_.length;e++){let t=_[e].split(","),s=parseInt(t[2])-parseInt(t[0]),i=parseInt(t[3])-parseInt(t[1]),a=void 0===t[4],n=(Math.sqrt(Math.pow(s,2)+Math.pow(i,2)),s/2+o+parseInt(t[0])),l=i/2+r+parseInt(t[1]),d=Math.abs(n-g),E=Math.abs(l-h),u=(Math.sqrt(Math.pow(d,2)+Math.pow(E,2)),o+parseInt(t[0]));if(c/2+s/2>d&&m/2+i/2>E)return a?{ret:0,val:u}:{ret:1,val:u}}return{ret:_IS_SQ_NOTCOL,val:_CANVAS.width}},_showGameStart(){if(document.querySelector("#game_start_loading").classList.remove("on"),_ISSP){document.querySelector("#sp_controller").classList.add("on"),_SP_CONTROLLER._set_obj()}if(_ISDEBUG){return document.querySelector("#game_wrapper").classList.add("on"),(_STAGESELECT=new GameObject_STAGESELECT).init(),_MAP.set_stage_map_pattern(_MAP_PETTERN),void _DRAW_INIT(_CANVAS_IMGS,_DRAW_POWER_METER_SELECT)}_KEYEVENT_MASTER.addKeydownStart(),document.querySelector("#game_start_wrapper").classList.add("on"),_GAME._setTextToFont(document.querySelector("#game_start>.title"),"no pakuri",50),_GAME._setTextToFont(document.querySelector("#game_start>.text"),"press s to start",30),_GAME._setTextToFont(document.querySelector("#game_start>.text_loading"),"now loading",30)},_setDrawTextToFont(e,t,_,s){let i=this;const a=_CANVAS_IMGS_INIT.font.obj,n=a.height;s=s||1;for(let o=0;o<e.length;o++)" "!==e[o]&&_GAME._setDrawImage({img:a,x:t+n*s*o,y:_,imgPosx:parseInt(i._txt[e[o]]),width:n,height:n,scale:s,basePoint:1})},_setTextToFont(e,t,_){if(null==e)return;let s=this;_=_||30;let i="";for(let e=0;e<t.length;e++){if(" "===t[e]){i+='<img src="./images/gradius_spacer.png" width="'+_+'">';continue}i+='<div style="background:url(./images/gradius_font.png) no-repeat;width:'+_+"px;height:"+_+"px;background-position:"+parseInt(s._txt[t[e]])*(_/60)*-1+'px 0px;background-size:cover;display:inline-block;"></div>'}e.innerHTML=i},_getPlayerMoveDrawX:e=>void 0===_PLAYERS_MOVE_DRAW_X[e]?null:_PLAYERS_MOVE_DRAW_X[e],_getPlayerMoveDrawY:e=>void 0===_PLAYERS_MOVE_DRAW_Y[e]?null:_PLAYERS_MOVE_DRAW_Y[e],_setPlayerMoveDraw(){let e=_PLAYERS_MAIN.width,t=_PLAYERS_MAIN.height,_=_PLAYERS_MAIN.x+parseInt(e/4),s=_PLAYERS_MAIN.y+parseInt(t/4),i=-1*_MAP.getBackGroundSpeedY(),a=_PLAYERS_MOVE_DRAW_Y;if(100===_PLAYERS_MOVE_DRAW_X.length&&_PLAYERS_MOVE_DRAW_X.pop(),100===_PLAYERS_MOVE_DRAW_Y.length&&_PLAYERS_MOVE_DRAW_Y.pop(),_PLAYERS_MOVE_DRAW_X.unshift(_),_MAP.map_infinite)if(0!==i)for(let e=0;e<100;e++)void 0!==a[e]?i>0?a[e]=a[e]>=s+i*e?s+i*e:a[e]+i:i<0&&(a[e]=a[e]<=s+i*e?s+i*e:a[e]+i):a.push(s+i*e);else a.unshift(s);else a.unshift(s)},_setPlay(e){if(null!=e){var t=_AUDIO_CONTEXT.createBufferSource();t.buffer=e.buf,t.loop=!1,t.connect(_AUDIO_CONTEXT.destination),t.start(0)}},_setPlayOnBG(e){if(null==e)return;!0===this._is_audio_context_source_bg&&(this._audio_context_source_bg.stop(),this._is_audio_context_source_bg=!1);let t=_AUDIO_CONTEXT.createBufferSource();t.buffer=e.buf,this._audio_now_obj_bg=e,t.loop=!0,t.loopStart=0,t.connect(_AUDIO_CONTEXT.destination),t.start(0),this._audio_context_source_bg=t,this._is_audio_context_source_bg=!0},_setStopOnBG(){this._is_audio_context_source_bg&&(this._audio_context_source_bg.stop(),this._is_audio_context_source_bg=!1)},_setDrawImage(e){if(void 0===e||void 0===e.img||0===e.scale)return;let t=e.width||e.img.width,_=e.height||e.img.height,s=e.deg||0,i=e.imgPosx||0,a=e.imgPosy||0,n=e.scale||1,o=e.x||0,r=e.y||0,l=e.basePoint||5,c=void 0===e.alpha?1:e.alpha;if(1===e.basePoint&&void 0===e.imgPosx&&void 0===e.alpha&&void 0===e.scale&&void 0===e.deg)return void _CONTEXT.drawImage(e.img,e.x,e.y,t,_);const m=[{x:0,y:0},{x:0,y:0},{x:-t/2,y:0},{x:-t,y:0},{x:0,y:-_/2},{x:-t/2,y:-_/2},{x:-t,y:-_/2},{x:0,y:-_},{x:-t/2,y:-_},{x:-t,y:-_}];_CONTEXT.save(),_CONTEXT.globalAlpha=c,_CONTEXT.translate(o,r),_CONTEXT.rotate(s*Math.PI/180),_CONTEXT.scale(n,n),_CONTEXT.drawImage(e.img,i,a,t,_,m[l].x,m[l].y,t,_),_CONTEXT.restore()},_multilineText(e,t,_){let s=t.length,i=[],a="";if(s<1)return i;for(let n=0;n<s;n++){let s=t.charAt(n);"\n"!==s?e.measureText(a+s).width<=_?a+=s:(i.push(a),a=s):(i.push(a),a="")}return a.length>0&&i.push(a),i}};class GameObject_ENEMY{constructor(e){this.id=_ENEMIES.length,this.gid=0,this.img=e.img,this.imgPos=e.imgPos||[0],this.aniItv=e.aniItv||10,this.width=e.width||this.img.width,this.height=e.height||this.img.height,this.x=e.x||0,this.y=e.y||0,this.direct=void 0===e.direct?_DEF_DIR._D:e.direct,this._s=e.s||"0",this.audio_collision=_CANVAS_AUDIOS.enemy_collision1,this.audio_alive=_CANVAS_AUDIOS.enemy_collision3,this.isshot=!1,this._DEF_SHOTSTATUS={_SHOTTYPE_NORMAL:1,_SHOTTYPE_MISSILE:2,_SHOTTYPE_DOUBLE:1,_SHOTTYPE_RIPPLE_LASER:1.5,_SHOTTYPE_LASER:1},this.alpha=1,this._c=0,this.speed=1,this.getscore=200,this._standby=!0,this._isshow=!0,this._status=1,this.haspc=!1,this._collision_type="t0",this.is_ignore=e.is_ignore||!1,this.is_able_collision=!0,this.is_ignore_collision=!1,this.is_collision_player_init=!1,this.shotColMap=["0,0,"+this.width+","+this.height],this.col_date=null,this.col_canint=150}init(){this._status=0,this._isshow=!1}collision(e,t){return!!this.isCollision()&&(!this.is_able_collision||(this.setStatus(e,t),!0))}isAbleCollision(){return this.is_able_collision}isIgnore(){return this.is_ignore}isIgnoreCollision(){return this.is_ignore_collision}isCollision(){let e=this;return null===e.col_date?(e.col_date=new Date,!0):new Date-e.col_date>e.col_canint&&(e.col_date=new Date,!0)}setAlive(){let e=this;e.isalive()?_GAME._setPlay(e.audio_alive):(_SCORE.set(e.getscore),_GAME._setPlay(e.audio_collision))}setStatus(e){this._status-=this._DEF_SHOTSTATUS[e]||1,this.setAlive()}getEnemyCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}isalive(){return this._status>0}isshow(){return this._isshow}shot(){_GAME.isEnemyCanvasOut(this)||Math.random()>=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE||_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:this.getEnemyCenterPosition()._x,y:this.getEnemyCenterPosition()._y}))}get_move_bound_val(){return parseInt(2*Math.random()+1)*(Math.random()>.5?1:-1)}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.height),e.direct===_DEF_DIR._LU&&_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height),e.direct===_DEF_DIR._LD&&_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.width,0)}setDrawImage(){let e=this;e.isMove()&&(_CONTEXT.save(),e.setDrawImageDirect(),_CONTEXT.drawImage(e.img,e.get_imgPos(),0,e.width,e.height,e.x,e.y,e.width,e.height),_ISDEBUG&&(_CONTEXT.strokeStyle="rgba(200,200,255,0.5)",_CONTEXT.beginPath(),_CONTEXT.rect(e.x,e.y,e.width,e.height),_CONTEXT.stroke()),_CONTEXT.restore())}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.img.height),e.direct===_DEF_DIR._LU&&_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.img.width,2*e.y+e.img.height),e.direct===_DEF_DIR._LD&&_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.img.width,0)}isStandBy(){return this._standby}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1})}showCollapes(e,t){let _=this;_._isshow=!1,_.haspc?_POWERCAPSELLS.push(new GameObject_POWERCAPSELL(_.x,_.y)):_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e||_.x+_.width/2,t||_.y+_.height/2,_._collision_type))}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(!!e.isalive()||(e.showCollapes(),!1))}moveDraw(){}moveSet(){}move_standby(){let e=this;e.x<_CANVAS.width-20&&(e._standby=!1)}move(){this.x=_MAP.getX(this.x),this.y=_MAP.getY(this.y),this.isMove()&&(this.moveSet(),this.shot())}}class ENEMY_FAN extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_fan.obj,x:e.x,y:e.y,imgPos:[0,25,50,75,100,125,150,175],aniItv:5,width:25,height:25,direct:e.direct});this.haspc=!0,this.parts=[],this.is_ignore=!0}move_standby(){let e=this;if(!(e.x>_CANVAS.width)){e._standby=!1,e.parts=[new ENEMY_FAN_MAIN({x:e.x+0*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+.5*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+1*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+1.5*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+2*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+2.5*e.width,y:e.y})];for(let t=0;t<e.parts.length;t++)_ENEMIES.push(e.parts[t])}}setDrawImage(){}moveSet(){let e=this;for(let t=e.parts.length-1;t>=0;t--){let _=e.parts[t];_.moveSet(),_.isalive()||e.parts.splice(t,1)}if(0===e.parts.length)return e.x<_CANVAS.width&&e.showCollapes(),void e.init();e.x=e.parts[e.parts.length-1].x,e.y=e.parts[e.parts.length-1].y}}class ENEMY_FAN_MAIN extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_fan.obj,x:e.x,y:e.y,imgPos:[0,25,50,75,100,125,150,175],aniItv:5,width:25,height:25});this._status=1,this.speed=2,this.pos_y=e.y>250,this.change_x=!1,this.change_y=!1}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:this.change_x})}moveSet(){let e=this;if(e.x=_MAP.getX(e.x),e.y=_MAP.getY(e.y),!e.isMove())return;const t=e.pos_y?275:200;e.change_x=e.change_x||e.x<500,e.x+=e.change_x?e.speed+_MAP.getBackGroundSpeed():-1*e.speed,e.change_y=e.change_y||e.pos_y&&e.y<t||!e.pos_y&&e.y>t,e.y+=(()=>e.change_x?e.change_y?0:e.pos_y?-1*e.speed:e.speed:0)(),e.set_imgPos(),e.shot()}move(){}}class ENEMY_a extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_a.obj,x:e.x,y:e.y,imgPos:[0],width:25,direct:e.direct});this._status=1}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.height):_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height)),e.direct===_DEF_DIR._D&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,1,0,0):_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.width,0))}moveSet(){this.imgPos=(e=>e>150?[0]:e<=150&&e>100?[25]:[50])(Math.abs(_PLAYERS_MAIN.y-this.y))}}class ENEMY_b extends ENEMY_a{constructor(e){super({img:_CANVAS_IMGS.enemy_b.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class ENEMY_c extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_c.obj,x:e.x,y:e.y,width:50,height:50,imgPos:[0,50,100,150,200,250,300],direct:e.direct});let t=this;t._st="_st1",t._shot=!1,t._status=1,t._collision_type="t1",t.speed=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SPEED,t.y=e.direct===_DEF_DIR._D?e.y-t.height-_MAP.t:e.y,t.shotColMap=t.direct===_DEF_DIR._D?["10,10,43,42"]:["0,0,43,32"],t._ene_status={_st1:{_f:function(){!0!==t._shot&&(t.imgPos=[0,50,100,150],t.set_imgPos())},_setX:function(){return t.x+2*t.speed}},_st2:{_f:function(){if(!(t.x>=_CANVAS.width))return t._shot=!0,t.imgPos=[200,250,300],t.set_imgPos(),t._c>=t.imgPos.length*t.aniItv-1?(t.shot(),t._shot=!1,void(t._st="_st1")):void 0},_setX:function(){return t.x}}}}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);_MAP.isMapBefore(_,s)&&(e.speed=Math.abs(e.speed)),_MAP.isMapLastSide(_,s)&&(e.speed=-1*e.speed);let i=_MAP.t;i=2*Math.abs(e.speed);let a=_MAP.isMapCollision(_+1,s)||_MAP.isMapCollision(_-1,s);var n;e.y=(n=e).direct===_DEF_DIR._U?a?n.y+i:n.y:n.direct===_DEF_DIR._D?a?n.y-i:n.y:void 0,e.y=function(e){return e.direct===_DEF_DIR._U?_MAP.isMapCollision(_,s-1)?e.y:e.y-i:e.direct===_DEF_DIR._D?_MAP.isMapCollision(_,s+1)?e.y:e.y+i:void 0}(e)}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.height):_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height)),e.direct===_DEF_DIR._D&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,1,0,0):_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.width,0))}set_speed(){let e=_PLAYERS_MAIN.getPlayerCenterPosition();this._c>5e3*Math.random()&&(this._c=0,this.speed=e._x<this.x?-1*this.speed:Math.abs(this.speed))}shot(){if("_st1"===this._st)return;if(_GAME.isEnemyCanvasOut(this))return;if(Math.random()>=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE)return;let e=_PLAYERS_MAIN.getPlayerCenterPosition(),t=this.getEnemyCenterPosition(),_=_GAME.getDeg({x:e._x,y:e._y},{x:t._x,y:t._y});_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:t._x,y:t._y,deg:_-10})),_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:t._x,y:t._y,deg:_+10}))}moveSet(){this.map_collition(),this.set_speed(),this._st=Math.random()<_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE||this._shot?"_st2":"_st1",this._ene_status[this._st]._f(),this.x=this._ene_status[this._st]._setX()}}class ENEMY_d extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_d.obj,x:e.x,y:e.y,width:25,imgPos:[0,25,50,75,100,125]});this.speed=2}moveSet(){this.x+=-1*this.speed;let e=this.x,t=Math.cos(e*Math.PI/180);this.y+=t,this.set_imgPos()}}class ENEMY_e extends ENEMY_d{constructor(e){super({img:_CANVAS_IMGS.enemy_e.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class ENEMY_f extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_f.obj,x:e.x,y:e.y,width:30,imgPos:[0,30,60,90],direct:e.direct});this._v=0,this.speed=e.direct===_DEF_DIR._U?-.05:.05}getDir(){return this.x>_CANVAS.width/2?-1:1}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!0,down:!0,left:!1,right:!1})}shot(){if(!(this._v>0&&this._v<.05))return;let e=this.getEnemyCenterPosition();for(let t=30;t<=360;t+=30)_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:e._x,y:e._y,deg:t}))}move_standby(){let e=this;e.x+e.width<0&&(e._standby=!1)}moveSet(){let e=this;e.x+=3*e.getDir(),e.y+=e._v,e._v+=e.speed;let t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);_MAP.isMapCollision(_,s)&&(e._v+=e.speed,e._v*=-1),e.set_imgPos()}}class ENEMY_g extends ENEMY_f{constructor(e){super({img:_CANVAS_IMGS.enemy_g.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class ENEMY_m extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_m1.obj,x:e.x,y:e.y,imgPos:[0,50,100,150,100,50,0],width:50,height:24,aniItv:5,direct:e.direct});this._status=4,this._collision_type="t1",this.getscore=200,this._isopen=!1,this._col_c=0,this._open_count=0}shot(){}moveSet(){let e=this;if(!e.isalive())return void e.showCollapes(0,e.direct===_DEF_DIR._U?0:-_MAP.t);if(e.img=e._status<=1?_CANVAS_IMGS.enemy_m2.obj:_CANVAS_IMGS.enemy_m1.obj,!e._isopen)return e.x>=690&&e.x<700&&(e._isopen=!0),e.x>=380&&e.x<400&&(e._isopen=!0),void e.imgPos[0];if(e._open_count++,(e._open_count>0&&e._open_count<20||e._open_count>200&&e._open_count<220)&&e.set_imgPos(),e._open_count>200&&e._c>=e.imgPos.length*e.aniItv-1)return e._open_count=0,void(e._isopen=!1);if(!e._isopen)return;if(e._open_count%15!=0)return;let t=new ENEMY_m_group({x:e.x+12.5,y:e.y+(e.direct===_DEF_DIR._U?15:-10),direct:e.direct});_ENEMIES.push(t)}}class ENEMY_m_group extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_m_group.obj,x:e.x,y:e.y,imgPos:[0,25,50,75,100,125,150],aniItv:5,width:25,height:25,direct:e.direct});this.speed=2,this.getscore=100,this._change=!1,this._moveX=0,this._moveY=0}isCanvasOut(){return _GAME.isEnemyCanvasOut(this)}moveSet(){let e=this,t=_PLAYERS_MAIN.getPlayerCenterPosition();e._change=!!e._change||(e.direct===_DEF_DIR._U&&t._y<e.y?(e._moveX=t._x<e.x?-1*e.speed:e.speed,!0):e.direct===_DEF_DIR._D&&t._y>e.y&&(e._moveX=t._x<e.x?-1*e.speed:e.speed,!0)),e._moveY=e._change?0:e.direct===_DEF_DIR._U?e.speed:e.direct===_DEF_DIR._D?-1*e.speed:void 0,e.x+=e._moveX,e.y+=e._moveY,e.set_imgPos()}}class ENEMY_n extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_o.obj,x:e.x,y:e.y,width:25,direct:e.direct,is_ignore:!0})}isCanvasOut(){return this.x<200}isalive(){return!0}shot(){}setDrawImage(){}moveSet(){if(Math.random()>.2)return;let e=new ENEMY_n_small({x:this.x,y:this.y});_ENEMIES.push(e)}}class ENEMY_o extends ENEMY_n{constructor(e){super({img:_CANVAS_IMGS.enemy_o.obj,x:e.x,y:e.y,direct:e.direct})}moveSet(){if(Math.random()>.1)return;let e=new ENEMY_o_small({x:this.x,y:this.y});_ENEMIES.push(e)}}class ENEMY_o_small extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_o.obj,x:e.x,y:e.y,imgPos:Math.random()>.5?[0]:[25],width:25,height:25,direct:e.direct});this._status=1,this.getscore=100,this.speedX=4*Math.random()+1,this.flagX=Math.random()>.5?1:-1,this.speedY=.2,this._v=-10,this._collision_type="t2"}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);_MAP.isMapCollision(_,s-1)&&(e._status=0)}shot(){}moveSet(){this.map_collition(),this.x-=this.speedX*this.flagX,this.y+=this._v,this._v+=this.speedY}}class ENEMY_n_small extends ENEMY_o_small{constructor(e){super({x:e.x,y:e.y,direct:e.direct});this.speedY=-.2,this._v=10}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);_MAP.isMapCollision(_,s+1)&&(e._status=0)}}class ENEMY_p extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_p_1.obj,x:e.x,y:e.y,direct:e.direct});this._status=4,this.getscore=100,this.speedx=_BACKGROUND_SPEED,this.speedy=(Math.random()+1)*(Math.random()>.5?1:-1),this._isbroken=!1,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this._s="000,000,000"}setAlive(){this.isalive()||_SCORE.set(this.getscore)}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);(_MAP.isMapCollision(_,s-1)||_MAP.isMapCollision(_,s+1))&&(e.speedx=Math.random()>.4?Math.abs(e.speedx):-1*e.speedx,e.speedy=Math.random()>.4?Math.abs(e.speedy):-1*e.speedy)}move_bounds(){let e=this,t=_ENEMIES;if(e.isalive())for(let _=0;_<t.length;_++){if(!ENEMY_p.prototype.isPrototypeOf(t[_]))continue;if(!t[_].isalive())continue;if(t[_].x>_CANVAS.width)continue;if(e.id===t[_].id)continue;_GAME.isSqCollision(e.shotColMap[0],e.x+","+e.y,t[_].shotColMap,t[_].x+","+t[_].y)!==_IS_SQ_NOTCOL&&(e.speedx=e.get_move_bound_val(),e.speedy=e.get_move_bound_val(),t[_].speedx=e.get_move_bound_val(),t[_].speedy=e.get_move_bound_val())}}showCollapes(){let e=this,t=e.getEnemyCenterPosition();if(e._status<=0&&!e._isbroken){for(let e=0;e<6;e++){let _=new ENEMY_p_small({img:_CANVAS_IMGS[["enemy_p_2","enemy_p_2","enemy_p_3","enemy_p_4","enemy_p_5","enemy_p_5"][e]].obj,x:t._x+[-30,0,30,-30,0,30][e],y:t._y+[-30,-30,-30,30,30,30][e]});_ENEMIES.push(_)}return e._isbroken=!0,_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision4),void e.init()}}shot(){}moveSet(){var e;this.map_collition(),this.move_bounds(),this.x-=((e=this).x+e.img.width>_CANVAS.width&&(e.speedx=Math.abs(e.speedx)),e.speedx),this.y+=function(e){return e.y<0?e.speedy=Math.abs(e.speedy):e.y+e.img.height>_CANVAS.height&&(e.speedy=-1),e.speedy}(this)}}class ENEMY_p_small extends GameObject_ENEMY{constructor(e){super({img:e.img,x:e.x,y:e.y,direct:e.direct});this.audio_collision=_CANVAS_AUDIOS.enemy_collision5,this._status=5,this.getscore=500,this.speedx=this.get_move_bound_val(),this.speedy=this.get_move_bound_val(),this.col_date=new Date,this._collision_type="t1"}setAlive(){this.isalive()||(_SCORE.set(this.getscore),_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision5))}move_bounds(){let e=this;if(new Date-e.col_date<1e3)return;let t=_ENEMIES;if(e.isalive())for(let _=0;_<t.length;_++){if(!ENEMY_p_small.prototype.isPrototypeOf(t[_]))continue;if(!t[_].isalive())continue;if(t[_].x>_CANVAS.width)continue;if(e.id===t[_].id)continue;_GAME.isSqCollision(e.shotColMap[0],e.x+","+e.y,t[_].shotColMap,t[_].x+","+t[_].y)!==_IS_SQ_NOTCOL&&(e.speedx=e.get_move_bound_val(),e.speedy=e.get_move_bound_val(),t[_].speedx=e.get_move_bound_val(),t[_].speedy=e.get_move_bound_val())}}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);(_MAP.isMapCollision(_,s-1)||_MAP.isMapCollision(_,s+1))&&(e.speedx=e.speedx<=0?Math.abs(e.speedx):-1*e.speedx,e.speedy=e.speedy<=0?Math.abs(e.speedy):-1*e.speedy)}shot(){}moveSet(){var e;this.map_collition(),this.move_bounds(),this.x-=((e=this).x+e.img.width>_CANVAS.width&&(e.speedx=1.5),e.speedx),this.y+=function(e){return e.y<0?e.speedy=Math.abs(e.speedy):e.y+e.img.height>_CANVAS.height&&(e.speedy=-1.5),e.speedy}(this)}}class ENEMY_q extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_m_a_1.obj,x:e.x,y:e.y,direct:e.direct});let t=this;t._status=2,t.getscore=500,t._isSetMapDefCol=!1,t._isopen=!1,t._open_count=0,t.imgs=[_CANVAS_IMGS.enemy_m_a_1.obj,_CANVAS_IMGS.enemy_m_a_2.obj],t.audio_collision=_CANVAS_AUDIOS.enemy_collision5,t.audio_alive=_CANVAS_AUDIOS.enemy_collision8,t._collision_type="t8",t._collision_posy=t.direct===_DEF_DIR._D?25:0,t._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,t.shotColMap=[t.direct===_DEF_DIR._D?"0,50,35,85":t.direct===_DEF_DIR._U?"0,25,35,50":t.direct===_DEF_DIR._LD?"75,55,100,70":t.direct===_DEF_DIR._LU?"75,35,100,50":void 0],t._s=(()=>t.direct===_DEF_DIR._D?"0000,0011,0110,1111":t.direct===_DEF_DIR._U?"1111,0110,0011,0000":t.direct===_DEF_DIR._LD?"0000,1100,1110,1111":t.direct===_DEF_DIR._LU?"1111,1110,1100,0000":void 0)()}collision(e,t){this._isopen&&this.isCollision()&&this.setStatus(e,t)}isShot(){let e=this;return!(e._status<=0)&&(!_GAME.isEnemyCanvasOut(e)&&(!(Math.abs(_PLAYERS_MAIN.y-e.y)>100)&&(e.direct!==_DEF_DIR._LU&&e.direct!==_DEF_DIR._LD||!(_PLAYERS_MAIN.x<e.x))))}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(!!e.isalive()||(e.showCollapes(),!0))}shot(){let e=this;e.isalive()&&(!e._open_count>0&&!e.isShot()||e._open_count++,e._open_count>0&&(e.img=e.imgs[1],e._isopen=!0),e._open_count>200&&(e.img=e.imgs[0],e._isopen=!1,e._open_count=-100),e._open_count<=0||e._open_count%10==0&&_ENEMIES.push(new ENEMY_moai_ring({x:e.x+parseInt(e.shotColMap[0].split(",")[0]),y:e.y+parseInt(e.shotColMap[0].split(",")[1]),direct:e.direct})))}showCollapes(){let e=this;e.img=_CANVAS_IMGS.enemy_m_z.obj,e._isSetMapDefCol||(_MAP.set_mapdef_col(_MAP.getMapX(e.x),_MAP.getMapY(e.y),e.direct===_DEF_DIR._D?"0000,0000,0000,1111":e.direct===_DEF_DIR._U?"1111,0000,0000,0000":e.direct===_DEF_DIR._LD?"0000,0000,0000,1111":e.direct===_DEF_DIR._LU?"1111,0000,0000,0000":void 0),_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e.x+e.img.width/2,e.y+e.img.height/2+e._collision_posy,e._collision_type)),e._isSetMapDefCol=!0)}}class ENEMY_r extends ENEMY_q{constructor(e){super({img:_CANVAS_IMGS.enemy_m_b_1.obj,x:e.x,y:e.y,direct:e.direct});let t=this;t._status=2,t.imgs=[_CANVAS_IMGS.enemy_m_b_1.obj,_CANVAS_IMGS.enemy_m_b_2.obj],t.img=t.imgs[0],t._collision_posy=t.direct===_DEF_DIR._D?-10:0,t.shotColMap=[t.direct===_DEF_DIR._D?"20,40,50,85":t.direct===_DEF_DIR._U?"20,25,50,70":void 0],t._s=(()=>t.direct===_DEF_DIR._D?"0000,0000,0010,1111":t.direct===_DEF_DIR._U?"1111,0010,0000,0000":void 0)()}}class ENEMY_moai_ring extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_moai_ring.obj,x:e.x,y:e.y,imgPos:e.imgPos||[0,25],aniItv:e.aniItv||5,width:e.width||25,height:e.height||25});this.audio_collision=_CANVAS_AUDIOS.enemy_collision2,this.rad=_GAME.getRad(_PLAYERS_MAIN,{x:e.x,y:e.y}),this.sx=Math.cos(this.rad),this.sy=Math.sin(this.rad),this.speed=1.5*_MAPDEFS[_MAP_PETTERN]._speed,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this._collision_type="t2",this.direct,_DEF_DIR._D}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!0})}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);_MAP.isMapCollision(_,s)&&(_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(t._x,t._y,e._collision_type)),e.init())}shot(){}moveSet(){this.map_collition(),this.x+=this.sx*this.speed,this.y+=this.sy*this.speed,this.set_imgPos()}}class ENEMY_frame_1 extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_frame_large.obj,x:e.x,y:e.y,width:53,imgPos:[0,53],direct:e.direct});this.getscore=100,this.speed=-1*(3*Math.random()+3),this.rad=0,this.speedx=0,this.speedy=0,this._isbroken=!1,this._c=0,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5}setAlive(){this.isalive()||_SCORE.set(this.getscore)}map_collition(){let e=this,t=e.getEnemyCenterPosition(),_=_MAP.getMapX(t._x),s=_MAP.getMapY(t._y);_MAP.isMapCollision(_,s)&&e.init()}showCollapes(){let e=this,t=e.getEnemyCenterPosition();if(e._status>0)return;if(e._isbroken)return;let _=0,s=_ENEMIES;for(let e=0;e<s.length;e++)ENEMY_frame_2.prototype.isPrototypeOf(s[e])&&_++;let i=_>20?1:2;for(let _=0;_<i;_++)_ENEMIES.push(new ENEMY_frame_2({x:t._x,y:t._y,direct:e.direct}));e._isbroken=!0,_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision1),e.init()}shot(){}move_standby(){this.x>=_CANVAS.width||(this.rad=Math.atan2(700*Math.random()-100-this.y,0-this.x),this.deg=this.rad/Math.PI*180,this.speedx=Math.cos(this.rad),this.speedy=Math.sin(this.rad),this._standby=!1)}moveSet(){this.map_collition(),this.set_imgPos(),this.x-=this.speedx*this.speed,this.y-=this.speedy*this.speed}}class ENEMY_frame_2 extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_frame_small.obj,x:e.x,y:e.y,direct:e.direct,width:e.width||35,imgPos:e.imgPos||[0,35]});this.speed=-1*(4*Math.random()+4),this.deg=110*Math.random()+125,this.speedx=Math.cos(this.deg*Math.PI/180),this.speedy=Math.sin(this.deg*Math.PI/180),this._isbroken=!1,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this._standby=!1}shot(){}setDrawImage(){this.isMove()&&_GAME._setDrawImage({img:this.img,x:this.x,y:this.y,deg:this.deg+180,width:this.width,imgPosx:this.get_imgPos()})}showCollapes(){let e=this,t=e.getEnemyCenterPosition();if(e._status>0)return;if(e._isbroken)return;let _=0,s=_ENEMIES;for(let e=0;e<s.length;e++)ENEMY_frame_3.prototype.isPrototypeOf(s[e])&&_++;let i=_>30?0:2;for(let _=0;_<i;_++)_ENEMIES.push(new ENEMY_frame_3({x:t._x,y:t._y,direct:e.direct}));e._isbroken=!0,_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision1),e.init()}moveSet(){this.set_imgPos(),this.x-=this.speedx*this.speed,this.y-=this.speedy*this.speed}}class ENEMY_frame_3 extends ENEMY_frame_2{constructor(e){super({img:_CANVAS_IMGS.enemy_frame_mini.obj,x:e.x,y:e.y,direct:e.direct,width:30,imgPos:[0,30]});this._isbroken=!1,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this.is_able_collision=!1,this.is_ignore_collision=Math.random()>.05,this._standby=!1}}class ENEMY_cell_core extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_cell_core.obj,x:e.x,y:e.y,aniItv:20});this._status=10,this.getscore=500,this.audio_alive=_CANVAS_AUDIOS.enemy_collision7,this._collision_type="t9",this.rad=0,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this.hands_up_rad=[],this.hands_up=[],this.hands_up_count={c:0,max:parseInt(300*Math.random())+100},this.hands_down_rad=[],this.hands_down=[],this.hands_down_count={c:0,max:parseInt(300*Math.random())+100},this.hands_distance=12}set_hands_target(e,t){let _=_PLAYERS_MAIN.getPlayerCenterPosition();return e%t>0&&e%t<parseInt(t/2)?_:{_x:this.x+200,_y:this.y+100}}set_hands_rad(e,t,_,s){let i=s,a=_.getEnemyCenterPosition(),n=parseInt(100*Math.random())-50,o=i._x+n-a._x,r=i._y+n-a._y,l=(e=>{let t=Math.random()/50;return(e=(e=_.flag?Math.cos(e)>0?_.rad+t:_.rad-t:Math.cos(e)>0?_.rad-t:_.rad+t)<0?2*Math.PI+e:e)>=_.rad_min&&e<=_.rad_max?e:_.rad})(Math.atan2(r,o));_.rad=l,e.unshift(l)}set_hands_pos(e,t,_,s,i){t.x=(s||0)+_.x+Math.cos(e)*this.hands_distance,t.y=(i||0)+_.y+Math.sin(e)*this.hands_distance}is_hands_up_status(){let e=this;for(let t=0;t<e.hands_up.length;t++)if(ENEMY_cell_hand_2.prototype.isPrototypeOf(e.hands_up[t]))return e.hands_up[t].isalive()}is_hands_down_status(){let e=this;for(let t=0;t<e.hands_down.length;t++)if(ENEMY_cell_hand_2.prototype.isPrototypeOf(e.hands_down[t]))return e.hands_down[t].isalive()}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1},{left:200})}showCollapes(){let e=this,t=e.getEnemyCenterPosition();e._isshow=!1;for(let t=0;t<e.hands_up.length;t++)e.hands_up[t].showCollapes();for(let t=0;t<e.hands_down.length;t++)e.hands_down[t].showCollapes();_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(t._x,t._y,e._collision_type)),_GAME._setPlay(e.audio_collision)}move_standby(){let e=this;if(e.x<_CANVAS.width-20){e._standby=!1,e.hands_up=[new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2,rad_min:Math.PI+1.5,rad_max:Math.PI+2,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.2,rad_min:Math.PI+1,rad_max:Math.PI+2.2,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.4,rad_min:Math.PI+.7,rad_max:Math.PI+2.4,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.4,rad_min:Math.PI+.7,rad_max:Math.PI+2.4,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_2({x:e.x,y:e.y,rad:3*Math.PI/2-.6,rad_min:Math.PI+.5,rad_max:Math.PI+2.6,flag:!0}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.8,rad_min:Math.PI+.5,rad_max:Math.PI+2.8,flag:!0}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-1,rad_min:Math.PI+.3,rad_max:Math.PI+2.8,flag:!0}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-1.2,rad_min:Math.PI+.3,rad_max:Math.PI+2.8,flag:!0}),new ENEMY_cell_hand_3({x:e.x,y:e.y,rad:3*Math.PI/2-1.4,rad_min:Math.PI+.3,rad_max:Math.PI+2.6,flag:!0})];for(let t=0;t<e.hands_up.length;t++)_ENEMIES.push(e.hands_up[t]);e.hands_down=[new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-1,rad_min:Math.PI-2,rad_max:Math.PI-1,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-1,rad_min:Math.PI-2.1,rad_max:Math.PI-.9,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.2,rad_max:Math.PI-.9,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.3,rad_max:Math.PI-.6,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_2({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.7,rad_max:Math.PI-.6,flag:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.8,rad_min:Math.PI-2.7,rad_max:Math.PI-.6,flag:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.8,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.7,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1}),new ENEMY_cell_hand_3({x:e.x,y:e.y,rad:Math.PI-.7,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1})];for(let t=0;t<e.hands_down.length;t++)_ENEMIES.push(e.hands_down[t])}}shot(){}set_aniPos(){this._c=this._c>=this.ani.length*this.aniItv-1?0:this._c+1}get_aniPos(){return this.ani[parseInt(this._c/this.aniItv)]}setDrawImage(){let e=this;for(let t=0;t<e.hands_up.length;t++)0!==t?(e.set_hands_pos(e.hands_up_rad[t],e.hands_up[t],e.hands_up[t-1]),e.hands_up[t].moveDraw()):(e.set_hands_pos(e.hands_up_rad[t],e.hands_up[t],e,e.img.width/2-e.hands_up[t].img.width/2,10),e.hands_up[t].moveDraw());for(let t=0;t<e.hands_down.length;t++)0!==t?(e.set_hands_pos(e.hands_down_rad[t],e.hands_down[t],e.hands_down[t-1]),e.hands_down[t].moveDraw()):(e.set_hands_pos(e.hands_down_rad[t],e.hands_down[t],e,e.img.width/2-e.hands_down[t].img.width/2,e.img.height-30),e.hands_down[t].moveDraw());const t=e.getEnemyCenterPosition();_GAME._setDrawImage({img:e.img,x:t._x,y:t._y,scale:e.get_aniPos().scale*(e._status/10>.7?e._status/10:.7)})}moveSet(){let e=this;e.set_aniPos();const t=e.getEnemyCenterPosition(),_=_PLAYERS_MAIN.getPlayerCenterPosition();let s=_GAME.getRad({x:_._x,y:_._y},{x:t._x,y:t._y});if(e.y+=Math.sin(s)*e.speed,!e.is_hands_up_status()&&0!==e.hands_up.length){for(let t=0;t<e.hands_up.length;t++)e.hands_up[t].showCollapes();e.hands_up=[]}if(!e.is_hands_down_status()&&0!==e.hands_down.length){for(let t=0;t<e.hands_down.length;t++)e.hands_down[t].showCollapes();e.hands_down=[]}e.hands_up_rad=[],e.hands_up_count.c=e.hands_up_count.c>e.hands_up_count.max?0:e.hands_up_count.c+1;let i=e.set_hands_target(e.hands_up_count.c,e.hands_up_count.max);for(let t=e.hands_up.length-1;t>=0;t--){if(void 0===e.hands_up[t-1]){e.set_hands_rad(e.hands_up_rad,e,e.hands_up[t],i);break}e.set_hands_rad(e.hands_up_rad,e.hands_up[t-1],e.hands_up[t],i)}e.hands_down_rad=[],e.hands_down_count.c=e.hands_down_count.c>e.hands_down_count.max?0:e.hands_down_count.c+1;let a=e.set_hands_target(e.hands_down_count.c,e.hands_down_count.max);for(let t=e.hands_down.length-1;t>=0;t--){if(void 0===e.hands_down[t-1]){e.set_hands_rad(e.hands_down_rad,e,e.hands_down[t],a);break}e.set_hands_rad(e.hands_down_rad,e.hands_down[t-1],e.hands_down[t],a)}let n=e.get_aniPos(),o=e.img.width/2-e.img.width*n.scale/2+","+(e.img.height/2-e.img.height*n.scale/2)+","+e.img.width*n.scale+","+e.img.height*n.scale;e.shotColMap=[o]}}class ENEMY_cell_hand_1 extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_cell_hand_1.obj,x:e.x,y:e.y});this._initx=e.x||0,this._inity=e.y||0,this.rad=e.rad,this.rad_min=e.rad_min||-1,this.rad_max=e.rad_max||-2,this.flag=e.flag||!1,this.is_able_collision=!1,this._collision_type="t2",this.is_ignore_collision=e.ignore_collision||!0,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this._c=0}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1},{left:200})}showCollapes(){let e=this.getEnemyCenterPosition();_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e._x,e._y,this._collision_type)),this.init()}shot(){}setDrawImage(){}moveDraw(){this._c=this._c>=20*this.ani.length-1?0:this._c+1;const e=this.getEnemyCenterPosition();_GAME._setDrawImage({img:this.img,x:e._x,y:e._y,scale:this.ani[parseInt(this._c/20)].scale}),this.shot()}move(){this.x=_MAP.getX(this.x),this.y=_MAP.getY(this.y),this.isMove()}}class ENEMY_cell_hand_2 extends ENEMY_cell_hand_1{constructor(e){e.img=_CANVAS_IMGS.enemy_cell_hand_2.obj,super(e);this.is_able_collision=!0,this.audio_alive=_CANVAS_AUDIOS.enemy_collision7,this._status=10,this.is_ignore_collision=!1,this.shotColMap=["-10,-10,"+(this.img.width+10)+","+(this.img.height+10)]}shot(){}}class ENEMY_cell_hand_3 extends ENEMY_cell_hand_1{constructor(e){e.img=_CANVAS_IMGS.enemy_cell_hand_3.obj,super(e)}shot(){if(_GAME.isEnemyCanvasOut(this))return;if(Math.random()>=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE)return;let e=this.getEnemyCenterPosition();_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:e._x,y:e._y,img:_CANVAS_IMGS.enemy_bullet_cell.obj,imgPos:[0,15],width:15}))}moveDraw(){let e=_PLAYERS_MAIN.getPlayerCenterPosition(),t=this.getEnemyCenterPosition(),_=Math.atan2(t._y-e._y,t._x-e._x);_GAME._setDrawImage({img:this.img,x:t._x,y:t._y,deg:_/Math.PI*180}),this.shot()}}class ENEMY_CELL_A extends ENEMY_a{constructor(e){super({img:_CANVAS_IMGS.enemy_cell_a.obj,x:e.x,y:e.y,direct:e.direct})}}class ENEMY_CELL_B extends ENEMY_a{constructor(e){super({img:_CANVAS_IMGS.enemy_cell_b.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class MAP_OBJECT{constructor(e){void 0!==e&&(this.img=e.img,this.imgPos=e.imgPos||[0],this.aniItv=e.aniItv||1,this.width=e.width||this.img.width,this.height=e.height||this.img.height,this.dir=e.dir||1,this.x=e.x||0,this.y=e.y||0,this._s=e.s||"1",this._c=0,this.is_able_collision=!1,this._DEF_SHOTSTATUS={_SHOTTYPE_NORMAL:1,_SHOTTYPE_MISSILE:2,_SHOTTYPE_DOUBLE:1,_SHOTTYPE_RIPPLE_LASER:1.5,_SHOTTYPE_LASER:1},this._c=0)}getImg(){return this.img.obj}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}collision(){}moveDraw(e,t){this.set_imgPos(),_GAME._setDrawImage({img:this.img,imgPosx:this.get_imgPos(),x:e,y:t,width:this.width,height:this.height,basePoint:1})}}class MAP_CUBE_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cube_A.obj,width:25,height:25});this._s="1"}}class MAP_CRISTAL extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.enemy_p_1.obj,width:84,height:83});this._s="011,111,110"}}class MAP_MOAI_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_moai_A.obj,width:250,height:100});this._s="0000000000,1111111111,1111111111,0000000000"}}class MAP_MOAI_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_moai_B.obj,width:250,height:100});this._s="0000000000,1111111111,1111111111,0000000000"}}class MAP_VOLCANO_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_A.obj,width:225,height:75});this._s="111111111,111111111,000000000"}}class MAP_VOLCANO_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_B.obj,width:225,height:75});this._s="111111111,111111111,000000000"}}class MAP_VOLCANO_C extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_C.obj,width:225,height:75});this._s="000000000,111111111,111111111"}}class MAP_VOLCANO_D extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_D.obj,width:225,height:75});this._s="000000000,111111111,111111111"}}class MAP_VOLCANO_F extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_F.obj,width:225,height:150});this._s="000110000,000110000,001111000,011111100,011111110,111111111"}}class MAP_VOLCANO_G extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_G.obj,width:225,height:150});this._s="111111110,011111110,011111100,001111000,000110000,000110000"}}class MAP_VOLCANO_H extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_H.obj,width:500,height:325});this._s="00000000000000000000,00000111111111111110,00000111111110000000,00000000011110000000,00000000001100000000,00000000001100000000,00000000001100000000,11111111111111111100,01111111111111111100,00000000011000000000,00000000011000000000,00000000111000000000,00000001111110000000"}}class MAP_VOLCANO_I extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_I.obj,width:375,height:250});this._s="000000010000000,000000010000000,000000111000000,000001111100000,000011111110000,000111111111000,001111111111100,001111111111100,011111111111110,111111111111111"}}class MAP_VOLCANO_J extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_J.obj,width:375,height:250});this._s="111111111111111,011111111111110,001111111111100,001111111111100,000111111111000,000011111110000,000001111100000,000000111000000,000000010000000,000000010000000"}}class MAP_VOLCANO_K extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_K.obj,width:75,height:25});this._s="010"}}class MAP_VOLCANO_L extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_L.obj,width:75,height:25});this._s="010"}}class MAP_VOLCANO_M extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_M.obj,width:100,height:50});this._s="0111,1111"}}class MAP_VOLCANO_N extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_N.obj,width:100,height:50});this._s="1111,0111"}}class MAP_VOLCANO_O extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_O.obj,width:100,height:50});this._s="1111,1110"}}class MAP_VOLCANO_P extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_P.obj,width:100,height:50});this._s="1110,1111"}}class MAP_FRAME_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_A.obj,imgPos:[0,200,400,600,800],aniItv:10,width:200,height:75});this._s="000000000,11111111,11111111"}}class MAP_FRAME_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_B.obj,imgPos:[0,200,400,600,800],aniItv:10,width:200,height:75});this._s="11111111,11111111,00000000"}}class MAP_FRAME_C extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_C.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="00,01,11",this.direct=_DEF_DIR._LD}}class MAP_FRAME_D extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_D.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="11,01,00",this.direct=_DEF_DIR._LU}}class MAP_FRAME_E extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_E.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="00,10,11",this.direct=_DEF_DIR._LU}}class MAP_FRAME_F extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_F.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="11,10,00",this.direct=_DEF_DIR._LU}}class MAP_CELL_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_A.obj,imgPos:[0,475,950],aniItv:20,width:475,height:100});this._s="0000000000000000000,0011111111111111100,0111111111111111110,1111111111111111111"}}class MAP_CELL_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_B.obj,imgPos:[0,475,950],aniItv:20,width:475,height:100});this._s="1111111111111111111,0111111111111111110,0011111111111111100,0000000000000000000"}}class MAP_CELL_C extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_C.obj,imgPos:[0,125,250],aniItv:20,width:125,height:100});this._s="00100,01110,01110,11111"}}class MAP_CELL_D extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_D.obj,imgPos:[0,125,250],aniItv:20,width:125,height:100});this._s="11111,01110,01110,00100"}}class MAP_CELL_VWYZ extends MAP_OBJECT{constructor(e){super({img:e.img,imgPos:[0,300,600],aniItv:20,width:300,height:50});this._s=e._s}}class MAP_CELL_V extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_V.obj,_s:"001111111100,111111111111"})}}class MAP_CELL_W extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_W.obj,_s:"111111111111,001111111100"})}}class MAP_CELL_Y extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_Y.obj,_s:"111111111111,111111111111"})}}class MAP_CELL_Z extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_Z.obj,_s:"111111111111,111111111111"})}}class MAP_CELL_WALL extends MAP_OBJECT{constructor(e){super({img:_CANVAS_IMGS.map_cell_wall.obj,imgPos:e.imgPos||[0],width:25,height:25});this._s="1",this.is_able_collision=!0,this._status=1,this._status_count=0,this.audio_collision=_CANVAS_AUDIOS.map_cell_wall,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.2}collision(e){this._status-=this._DEF_SHOTSTATUS[e]||1}moveDraw(e,t){let _=this;if(_._status_count>=200&&(_._status_count=0,_._status=1,_MAP.set_mapdef_col(_MAP.getMapX(e),_MAP.getMapY(t),"1")),_._status<=0)return 0===_._status_count&&_GAME._setPlay(_.audio_collision),_MAP.set_mapdef_col(_MAP.getMapX(e),_MAP.getMapY(t),"0"),void _._status_count++;_GAME._setDrawImage({img:_.img,x:e,y:t,width:_.width,imgPosx:_.imgPos[0],basePoint:1})}}class MAP_CELL_G extends MAP_CELL_WALL{constructor(){super({imgPos:[0]})}}class MAP_CELL_H extends MAP_CELL_WALL{constructor(){super({imgPos:[25]})}}class MAP_CELL_I extends MAP_CELL_WALL{constructor(){super({imgPos:[50]})}}class MAP_CELL_J extends MAP_CELL_WALL{constructor(){super({imgPos:[75]})}}class MAP_CELL_K extends MAP_CELL_WALL{constructor(){super({imgPos:[100]})}}class MAP_CELL_L extends MAP_CELL_WALL{constructor(){super({imgPos:[125]})}}class MAP_CELL_M extends MAP_CELL_WALL{constructor(){super({imgPos:[150]})}}class MAP_CELL_N extends MAP_CELL_WALL{constructor(){super({imgPos:[175]})}}class MAP_CELL_O extends MAP_CELL_WALL{constructor(){super({imgPos:[200]})}}let _MAPDEFS="",_MAPDEF="",_MAP_PETTERN=3,_BACKGROUND_SPEED=0,_MAP_SCROLL_POSITION_X=0,_MAP_SCROLL_POSITION_Y=0;const _MAP_ENEMIES={_setDir:function(e,t){let _=_MAP.isMapCollision(e,t-1)?_DEF_DIR._U:_DEF_DIR._D;return _=_MAP.isMapCollision(e,t+1)?_DEF_DIR._D:_DEF_DIR._U},_ENEMIES:{a:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_a({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_a({direct:null})},b:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_b({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_b({direct:null})},c:{_gamestart:(e,t,_)=>{let s=_MAP.isMapCollision(_MAP.getMapX(e),_MAP.getMapY(t)-1)?_DEF_DIR._U:_DEF_DIR._D;s=_MAP.isMapCollision(_MAP.getMapX(e),_MAP.getMapY(t)+2)?_DEF_DIR._D:_DEF_DIR._U,_ENEMIES.push(new ENEMY_c({x:e,y:t,direct:s}))},_st:"",_getObj:()=>new ENEMY_c({direct:null})},d:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_d({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_e({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},f:{_gamestart:(e,t,_)=>{_=t<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_f({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_f({direct:null})},g:{_gamestart:(e,t,_)=>{_=t<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_g({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_g({direct:null})},m:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_m({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_m({direct:null})},n:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_n({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_n({direct:null})},o:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_o({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_o({direct:null})},p:{_gamestart:(e,t,_)=>{let s=new ENEMY_p({x:e,y:t,direct:_DEF_DIR._D});_ENEMIES.push(s)},_st:"",_getObj:()=>new ENEMY_p({direct:null})},z:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_FAN({width:25,height:25,direct:null})}}},_MAP_ENEMIES_BOSS={enemy_cristalcore:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE({x:700,y:800})}},enemy_bigcore:{_f:function(){return new ENEMY_BOSS_BIGCORE({x:_CANVAS.width+200,y:200})}},enemy_cristalcore_pt2:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE_PT2({x:700,y:800})}},enemy_bigcore2:{_f:function(){return new ENEMY_BOSS_BIGCORE2({x:_CANVAS.width+200,y:200})}},enemy_frame:{_f:function(){return new ENEMY_BOSS_FRAME({x:1e3,y:200})}},enemy_cell:{_f:function(){return new ENEMY_BOSS_CELL({x:_CANVAS.width+200,y:200})}},enemy_moai:{_f:function(){return new ENEMY_BOSS_MOAI({x:_CANVAS.width+200,y:200})}},enemy_death:{_f:function(){return new ENEMY_BOSS_DEATH({x:_CANVAS.width+200,y:200})}}},_MAP_THEME={_THEME1:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_CRISTAL},objs:{},_getObj:()=>new MAP_CRISTAL}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME2:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_A},objs:{},_getObj:()=>new MAP_VOLCANO_A},B:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_B},objs:{},_getObj:()=>new MAP_VOLCANO_B},C:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_C},objs:{},_getObj:()=>new MAP_VOLCANO_C},D:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_D},objs:{},_getObj:()=>new MAP_VOLCANO_D},F:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_F},objs:{},_getObj:()=>new MAP_VOLCANO_F},G:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_G},objs:{},_getObj:()=>new MAP_VOLCANO_G},H:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_H},objs:{},_getObj:()=>new MAP_VOLCANO_H},I:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_I},objs:{},_getObj:()=>new MAP_VOLCANO_I},J:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_J},objs:{},_getObj:()=>new MAP_VOLCANO_J},K:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_K},objs:{},_getObj:()=>new MAP_VOLCANO_K},L:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_L},objs:{},_getObj:()=>new MAP_VOLCANO_L},M:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_M},objs:{},_getObj:()=>new MAP_VOLCANO_M},N:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_N},objs:{},_getObj:()=>new MAP_VOLCANO_N},O:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_O},objs:{},_getObj:()=>new MAP_VOLCANO_O},P:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_P},objs:{},_getObj:()=>new MAP_VOLCANO_P}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME3:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_CUBE_A},objs:{},_getObj:()=>new MAP_CUBE_A}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME5:{_map:{B:{_gamestart:function(e){this.objs[e]=new MAP_MOAI_A},objs:{},_getObj:()=>new MAP_MOAI_A},C:{_gamestart:function(e){this.objs[e]=new MAP_MOAI_B},objs:{},_getObj:()=>new MAP_MOAI_B}},_enemies:{a:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_a({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_a({direct:null})},b:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_b({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_b({direct:null})},d:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_d({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_e({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},f:{_gamestart:(e,t,_)=>{_=t<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_f({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_f({})},g:{_gamestart:(e,t,_)=>{_=t<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_g({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_g({})},m:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_m({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_m({})},l:{_gamestart:(e,t,_)=>{let s=new ENEMY_q({x:e,y:t,direct:_DEF_DIR._U});_ENEMIES.push(s)},_st:"transform:scale(1,-1);",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._U})},n:{_gamestart:(e,t,_)=>{let s=new ENEMY_q({x:e,y:t,direct:_DEF_DIR._D});_ENEMIES.push(s)},_st:"",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._D})},o:{_gamestart:(e,t,_)=>{let s=new ENEMY_r({x:e,y:t,direct:_DEF_DIR._U});_ENEMIES.push(s)},_st:"transform:scale(1,-1);",_getObj:()=>new ENEMY_r({x:0,y:0,direct:_DEF_DIR._U})},p:{_gamestart:(e,t,_)=>{let s=new ENEMY_r({x:e,y:t,direct:_DEF_DIR._D});_ENEMIES.push(s)},_st:"",_getObj:()=>new ENEMY_r({x:0,y:0,direct:_DEF_DIR._D})},q:{_gamestart:(e,t,_)=>{let s=new ENEMY_q({x:e,y:t,direct:_DEF_DIR._LD});_ENEMIES.push(s)},_st:"transform:scale(-1,1);",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._LD})},r:{_gamestart:(e,t,_)=>{let s=new ENEMY_q({x:e,y:t,direct:_DEF_DIR._LU});_ENEMIES.push(s)},_st:"transform:scale(-1,-1);",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._LU})},z:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_FAN({direct:null})}}},_THEME6:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_A},objs:{},_getObj:()=>new MAP_FRAME_A},B:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_B},objs:{},_getObj:()=>new MAP_FRAME_B},C:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_C},objs:{},_getObj:()=>new MAP_FRAME_C},D:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_D},objs:{},_getObj:()=>new MAP_FRAME_D},E:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_E},objs:{},_getObj:()=>new MAP_FRAME_E},F:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_F},objs:{},_getObj:()=>new MAP_FRAME_F}},_enemies:{a:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_frame_1({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_frame_1({})},d:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_d({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_e({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},z:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_FAN({})}}},_THEME7:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_CELL_A},objs:{},_getObj:()=>new MAP_CELL_A},B:{_gamestart:function(e){this.objs[e]=new MAP_CELL_B},objs:{},_getObj:()=>new MAP_CELL_B},C:{_gamestart:function(e){this.objs[e]=new MAP_CELL_C},objs:{},_getObj:()=>new MAP_CELL_C},D:{_gamestart:function(e){this.objs[e]=new MAP_CELL_D},objs:{},_getObj:()=>new MAP_CELL_D},G:{_gamestart:function(e){this.objs[e]=new MAP_CELL_G},objs:{},_getObj:()=>new MAP_CELL_G},H:{_gamestart:function(e){this.objs[e]=new MAP_CELL_H},objs:{},_getObj:()=>new MAP_CELL_H},I:{_gamestart:function(e){this.objs[e]=new MAP_CELL_I},objs:{},_getObj:()=>new MAP_CELL_I},J:{_gamestart:function(e){this.objs[e]=new MAP_CELL_J},objs:{},_getObj:()=>new MAP_CELL_J},K:{_gamestart:function(e){this.objs[e]=new MAP_CELL_K},objs:{},_getObj:()=>new MAP_CELL_K},L:{_gamestart:function(e){this.objs[e]=new MAP_CELL_L},objs:{},_getObj:()=>new MAP_CELL_L},M:{_gamestart:function(e){this.objs[e]=new MAP_CELL_M},objs:{},_getObj:()=>new MAP_CELL_M},N:{_gamestart:function(e){this.objs[e]=new MAP_CELL_N},objs:{},_getObj:()=>new MAP_CELL_N},O:{_gamestart:function(e){this.objs[e]=new MAP_CELL_O},objs:{},_getObj:()=>new MAP_CELL_O},V:{_gamestart:function(e){this.objs[e]=new MAP_CELL_V},objs:{},_getObj:()=>new MAP_CELL_V},W:{_gamestart:function(e){this.objs[e]=new MAP_CELL_W},objs:{},_getObj:()=>new MAP_CELL_W},Y:{_gamestart:function(e){this.objs[e]=new MAP_CELL_Y},objs:{},_getObj:()=>new MAP_CELL_Y},Z:{_gamestart:function(e){this.objs[e]=new MAP_CELL_Z},objs:{},_getObj:()=>new MAP_CELL_Z}},_enemies:{a:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_cell_core({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_cell_core({})},b:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_CELL_A({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_CELL_A({direct:null})},c:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_CELL_B({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_CELL_B({direct:null})},d:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_d({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_e({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},z:{_gamestart:(e,t,_)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:t,direct:_}))},_st:"",_getObj:()=>new ENEMY_FAN({direct:null})}}}};class GameObject_MAP{constructor(e){this.pt=e||0,this.initx=0,this.inity=0,this.x=this.initx,this.y=this.inity,this.collision=new RegExp("[1A-Z]"),this.collision_enemies=new RegExp("[a-z]","g"),this.collision_map=new RegExp("[A-Z]"),this.collision_map_d=new RegExp("[BD]"),this.t=25,this.mapdef=new Array,this.mapdef_col=new Array,this.map_theme=0,this.map_pettern=0,this.map_difficult=0,this.map_background_speed=0,this.map_backgroundY_speed=0,this.map_infinite=!1,this.map_bgmusic="",this.map_boss="",this.isboss=!1}init(e){_AJAX({url:"./gradius_map.json",f:function(t){_MAPDEFS=t,e()}})}setInifinite(e){this.map_infinite=e}set_stage_map_pattern(e){this.map_pettern=e}set_gamestart(){this.map_backgroundY_speed=0,this.x=parseInt(_MAPDEFS[this.map_pettern]._initx),this.y=this.inity,this.initx=parseInt(_MAPDEFS[this.map_pettern]._initx),this.mapdef=_MAPDEFS[this.map_pettern]._map,this.map_difficult=parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,_ENEMY_DIFFICULT=_ISDEBUG?_ENEMY_DIFFICULT:parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,this.map_background_speed=parseInt(_MAPDEFS[this.map_pettern]._speed),_BACKGROUND_SPEED=parseInt(_MAPDEFS[this.map_pettern]._speed),_MAP_PETTERN=this.map_pettern,this.map_theme=_MAPDEFS[this.map_pettern]._theme,this.map_infinite="true"===_MAPDEFS[this.map_pettern]._map_infinite,this.map_bgmusic=_MAPDEFS[this.map_pettern]._bgmusic,this.map_boss=_MAPDEFS[this.map_pettern]._boss,this.isboss=!1,this.set_gamestart_mapdef_col(),this.set_gamestart_map_theme_objs()}set_gamestart_map_theme_objs(){let e=this;for(let t=0;t<e.mapdef.length;t++){let _=e.mapdef[t];for(let s=0;s<_.length;s++)if(e.isEnemiesBit(_[s])){let i=_MAP_ENEMIES._setDir(s,t);_MAP_THEME[e.map_theme]._enemies[_[s]]._gamestart(e.x+s*e.t,t*e.t,i)}else e.isCollisionBit(_[s])&&_MAP_THEME[e.map_theme]._map[_[s]]._gamestart(s+","+t)}}set_gamestart_mapdef_col(){let e=this;Object.assign(e.mapdef_col,e.mapdef);for(let t=0;t<e.mapdef_col.length;t++)e.mapdef_col[t]=e.mapdef_col[t].replace(/[a-zA-Z]/gi,"0");for(let s=0;s<e.mapdef.length;s++){let i=e.mapdef[s];for(let a=0;a<i.length;a++){if(null===i[a].match(/[A-Za-z]/))continue;let n=e.isEnemiesBit(i[a])?_MAP_THEME[e.map_theme]._enemies[i[a]]._getObj():_MAP_THEME[e.map_theme]._map[i[a]]._getObj();void 0===n&&console.log(":"+e.map_theme+" "+i[a]+"");let o=n._s.split(",");for(let n=0;n<o.length;n++){let r=e.mapdef_col[s+n],l=e.mapdef[s+n];e.mapdef_col[s+n]=r.substr(0,a)+(l.substr(a,o[n].length),t=r.substr(a,o[n].length),_=o[n],e.setCollisionBit(_,t))+r.substr(a+o[n].length,i.length)}}}var t,_}set_mapdef_col(e,t,_){let s=this;if(void 0===e||void 0===t||void 0===_)return;let i=_.split(",");for(let _=0;_<i.length;_++){let a=s.mapdef_col[t+_];s.mapdef_col[t+_]=a.substr(0,e)+i[_]+a.substr(e+i[_].length)}}getX(e){return e+-1*_BACKGROUND_SPEED}getY(e){return this.map_infinite?e-_MAP.map_backgroundY_speed<-250?750+(250+e-_MAP.map_backgroundY_speed):e-_MAP.map_backgroundY_speed>750?-250-(750-e+_MAP.map_backgroundY_speed):(e-_MAP.map_backgroundY_speed)%1e3:e}getShotY(e){return e-_MAP.map_backgroundY_speed}setCollisionBit(e,t){let _="";for(let s=0;s<e.length;s++)"0"!==e[s]?_+="1":_+=t[s];return _}getCollisionFlag(){return this.collision}setBackGroundSpeedY(e){this.map_backgroundY_speed=e}getBackGroundSpeed(){return this.map_background_speed}getBackGroundSpeedY(){return this.map_backgroundY_speed}get_stage_map_pattern(e){return this.map_pettern}getMapXToPx(e){return e*this.t+this.initx-_MAP_SCROLL_POSITION_X}getMapYToPx(e){return e*this.t}getMapX(e){return Math.floor((e+_MAP_SCROLL_POSITION_X-this.initx)/this.t)}getMapY(e,t){return!0===t&&(console.log("_y:"+e),console.log("_MAP_SCROLL_POSITION_Y:"+_MAP_SCROLL_POSITION_Y)),Math.floor((e+_MAP_SCROLL_POSITION_Y)%1e3/this.t)}isCollisionBit(e){return null!==e.match(this.collision)}isEnemiesBit(e){return null!==e.match(this.collision_enemies)}isMapDouble(e){return null!==e.match(this.collision_map_d)}isMapBefore(e,t){return e<0}isMapLastSide(e,t){return void 0!==this.mapdef[t]&&(void 0===this.mapdef[t][e]||e===this.mapdef[t].length-1)}isMapOver(e,t){return void 0!==this.mapdef[t]&&(void 0===this.mapdef[t][e]||e>this.mapdef[t].length-1)}isMapCollision(e,t){return void 0!==this.mapdef_col[t]&&(void 0!==this.mapdef_col[t][e]&&!!this.isCollisionBit(this.mapdef_col[t][e]))}setPlayersShotAbleCollision(e,t,_){let s=_MAP_THEME[this.map_theme]._map;if(void 0===s)return;let i=this.mapdef[t][e];if(void 0===s[i])return;let a=s[i].objs[e+","+t];void 0!==a&&a.is_able_collision&&a.collision(_)}isPlayersShotCollision(){for(let e=0;e<_PLAYERS_SHOTS[_SHOTTYPE].length;e++){let t=_PLAYERS_SHOTS[_SHOTTYPE][e];for(let e=0;e<t.shots.length;e++){let _=t.shots[e];_._shot_alive&&t.map_collition(_)}}for(let e=0;e<_PLAYERS_MISSILE.length;e++){let t=_PLAYERS_MISSILE[e];if(t.player.isalive())for(let e=0;e<t.shots.length;e++){let _=t.shots[e];_._shot_alive&&(_._c>0||t.map_collition(_))}}}show(){}showMapForStageselect(e){let t=this;if(null==e)return;let _=e._map.length;for(let s=0;s<(_>20?20:_);s++){let _=e._map[s].length;for(let i=0;i<(_>40?40:_);i++){let _=e._map[s][i+100];if(void 0!==_&&"0"!==_)if(null!==_.match(t.collision_enemies)){let t=_MAP_THEME[e._theme]._enemies[_]._getObj();_CONTEXT.save();let a=null===t.direct?_MAP_ENEMIES._setDir(i+100,s):t.direct,n=0+10*i,o=130+10*s,r=t.width/2.5,l=t.height/2.5;a===_DEF_DIR._U&&_CONTEXT.setTransform(1,0,0,-1,0,2*o+l),a===_DEF_DIR._LU&&_CONTEXT.setTransform(-1,0,0,-1,2*n+r,2*o+l),a===_DEF_DIR._LD&&_CONTEXT.setTransform(-1,0,0,1,2*n+r,0),_CONTEXT.translate(0+10*i,130+10*s),_CONTEXT.scale(.25,.25),_CONTEXT.drawImage(t.img,t.imgPos[0],0,t.width,t.height,0,0,1.6*t.width,1.6*t.height),_CONTEXT.restore()}else{let t=_MAP_THEME[e._theme]._map[_]._getObj();_CONTEXT.save(),_CONTEXT.translate(0+10*i,130+10*s),_CONTEXT.scale(.25,.25),_CONTEXT.drawImage(t.img,t.imgPos[0],0,t.width,t.height,0,0,1.6*t.width,1.6*t.height),_CONTEXT.restore()}}}_CONTEXT.fillStyle="rgba(0,0,0,1)",_CONTEXT.fillRect(0,130,50,500),_CONTEXT.fillRect(350,130,500,500),_CONTEXT.fillRect(50,330,500,500),_CONTEXT.beginPath(),_CONTEXT.lineWidth=1,_CONTEXT.strokeStyle="rgba(255,255,255,1)",_CONTEXT.fillStyle="rgba(255,255,255,1)",_CONTEXT.strokeRect(50,130,300,200)}map_draw(){let e=this;for(let t=0;t<e.mapdef.length;t++)for(let _=0;_<e.mapdef[t].length;_++){let s=e.mapdef[t][_];if(!e.isCollisionBit(s))continue;if(e.x+_*e.t<-500||e.x+_*e.t>_CANVAS.width+100)continue;let i=_MAP_THEME[e.map_theme]._map[s];i.objs[_+","+t].moveDraw(e.x+_*e.t,e.y+t*e.t),e.map_infinite&&i.objs[_+","+t].moveDraw(e.x+_*e.t,e.y+t*e.t+(e.y>0?-1e3:1e3))}}set_mapdef_col_clear(){let e=this;for(let t=0;t<e.mapdef_col.length;t++){let _=e.mapdef_col[t];e.mapdef_col[t]=_.replace(/1/gi,"0")}}set_scroll_on_x(){_BACKGROUND_SPEED=this.map_background_speed}set_scroll_off_x(){_BACKGROUND_SPEED=0}move(){let e=this;_MAP_SCROLL_POSITION_X+_CANVAS.width>e.mapdef[0].length*e.t+e.initx&&(e.isboss=!0),_MAP_SCROLL_POSITION_X-100>e.mapdef[0].length*e.t+e.initx&&(_BACKGROUND_SPEED=0),e.x+=-1*_BACKGROUND_SPEED,_MAP_SCROLL_POSITION_X+=_BACKGROUND_SPEED,e.y=e.getY(e.y),_MAP_SCROLL_POSITION_Y=function(){let t=_MAP_SCROLL_POSITION_Y+e.map_backgroundY_speed;return t<0?(1e3+t)%1e3:t%1e3}()}}_MAP=new GameObject_MAP;let $_pb=null,$_ab=null,$_mp=null,$_mn=null,$_bm=null;_MAP_PETTERN=0;const _DATAAPI={_data_api:"",_blog_id:0,_url:"",_init_config:()=>{_AJAX({url:"./gradius_editing_stage_config.json",f:_DATAAPI._init})},_init:function(e){let t=_DATAAPI;t._blog_id=parseInt(e.blog_id),t._url=e.url,t._data_api=new MT.DataAPI({baseUrl:t._url,clientId:"api11entries"}),t._data_api.getToken(e=>e.error?(401===e.error.code&&(console.log("reload after 401 error occuered in updating."),location.href=t._data_api.getAuthorizationUrl(location.href)),!1):e.accessToken?void _GAME_STAGEEDIT._init_images(_CANVAS_IMGS,_GAME_STAGEEDIT._init):(alert("An accessToken error occurred."),void(location.href=t._data_api.getAuthorizationUrl(location.href))))},_set_entryupdate:function(e){let t=this;t._data_api.updateEntry(t._blog_id,e._eid,e,function(_){if(_.error)return alert(""),void(401===_.error.code&&(location.href=t._data_api.getAuthorizationUrl(location.href)));alert(""),_MAP.init(function(){_MAP_PETTERN=function(){for(let t=0;t<_MAPDEFS.length;t++)if(_MAPDEFS[t]._eid===e._eid)return t}(),_GAME_STAGEEDIT._setData(_MAP_PETTERN);const t=document.querySelectorAll("#area_parts .parts_block");for(var _=0;_<t.length;_++)t[_].setAttribute("draggable",!0),t[_].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),t[_].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1);const s=document.querySelectorAll('.form_group .col_r input[type="range"]');for(_=0;_<s.length;_++)s[_].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),s[_].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();const i=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<i.length;e++)_GAME_STAGEEDIT._setTextToFont(i[e],i[e].innerText,14)})})}},_GAME_STAGEEDIT={_ac:new(window.AudioContext||window.webkitAudioContext),_as:null,_theme:0,_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_setInitMap:function(e){this._theme=e._theme;let t=e._map,_="";for(let s=0;s<t.length;s++){_+='<div class="area_blocks_rows">';for(let i=0;i<t[s].length;i++)_+='<div class="area_block" data-val="'+t[s][i]+'" onmouseover="_GAME_STAGEEDIT_EVENTS._f_as_mouseover(event);" onmouseout="_GAME_STAGEEDIT_EVENTS._f_as_mouseout(event);" ondragenter="_GAME_STAGEEDIT_EVENTS._f_as_dragenter(event);" ondrop="_GAME_STAGEEDIT_EVENTS._f_as_drop(event);">'+function(t){if("0"===t)return"";let _="";if(null!==t.match(_MAP.collision_enemies)){let s=_MAP_THEME[e._theme]._enemies[t]._st,i=_MAP_THEME[e._theme]._enemies[t]._getObj();_='<div class="parts_block" style="width:'+parseInt(.8*i.width)+"px;height:"+parseInt(.8*i.height)+"px;background:url("+i.img.src+") no-repeat;background-size:cover;"+(""!==s?s:"")+"background-position:"+20/i.width*i.imgPos[0]*-1+'px 0px;" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">',_+="</div>"}else if(null!==t.match(_MAP.collision_map)){let s=_MAP_THEME[e._theme]._map[t]._getObj();_='<div class="parts_block" style="width:'+parseInt(.8*s.width)+"px;height:"+parseInt(.8*s.height)+"px;background:url("+s.img.src+") no-repeat;background-size:cover;background-position:"+20/s.width*s.imgPos[0]*-1+'px 0px;" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">',_+="</div>"}return _}(t[s][i])+"</div>\x3c!-- /.area_block --\x3e";_+="</div>\x3c!-- /.area_blocks_rows --\x3e"}document.querySelector(".area_blocks.drop").innerHTML=_},_setAudioInit:function(e,t){let _=this,s=0;for(let i in e){let a=new XMLHttpRequest;a.open("GET",e[i].src,!0),a.responseType="arraybuffer",a.onload=function(){_._ac.decodeAudioData(a.response,_=>{e[i].buf=_,++s>=Object.keys(e).length&&t()},e=>{alert(":"+e)})},a.send()}},_setAudioStop(e){null!==this._as&&(this._as.stop(),this._as=null)},_setAudioPlay(e){if(null!=e&&null===this._as){var t=this._ac.createBufferSource();t.buffer=e.buf,t.loop=!1,t.connect(this._ac.destination),t.start(0),this._as=t}},_setInitPartsBlocksWrapper:function(e){e._map;let t="";for(let[_,s]of Object.entries(_MAP_THEME[e._theme]._enemies)){let e=s._getObj(),i=s._st;t+='<div class="parts_block_wrapper" data-val="'+_+'"><div class="text">enemy '+_+'</div><div class="parts_block" style="width:100px;height:'+parseInt(100*e.height/e.width)+"px;background:url("+e.img.src+") no-repeat;background-size:cover;"+(""!==i?i:"")+"background-position:"+100/e.width*e.imgPos[0]*-1+'px 0px;"></div></div>\x3c!-- /.parts_block_wrapper --\x3e'}document.querySelector(".parts_blocks_wrapper.enemy .parts_blocks").innerHTML=t,t="";for(let[_,s]of Object.entries(_MAP_THEME[e._theme]._map)){let e=s._getObj();t+='<div class="parts_block_wrapper" data-val="'+_+'"><div class="text">MAP '+_+'</div><div class="parts_block" style="width:100px;height:'+parseInt(100*e.height/e.width)+"px;background:url("+e.img.src+") no-repeat;background-size:cover;background-position:"+100/e.width*e.imgPos[0]*-1+'px 0px;"></div></div>\x3c!-- /.parts_block_wrapper --\x3e'}document.querySelector(".parts_blocks_wrapper.map .parts_blocks").innerHTML=t},_clearMap:function(){document.querySelector(".area_blocks.drop").textContent=null},_getTextToFont:function(e){let t="",_=e.children;for(let e=0;e<_.length;e++)t+=_[e];return t},_setTextToFont:function(e,t,_){if(null==e)return;_=_||60;let s="";for(let e=0;e<t.length;e++){if(":"===t[e])continue;if(" "===t[e]){s+='<img src="./images/gradius_spacer.png" width="'+_+'">';continue}s+='<div style="background:url(./images/gradius_font.png) no-repeat;background-size:cover;background-position:'+parseInt(this._txt[t[e].toLowerCase()])*(_/60)*-1+"px 0px;display:inline-block;width:"+_+"px;height:"+_+'px;"></div>'}e.innerHTML=s},_clearData:function(){},_setData:function(e){let t=_MAPDEFS[e];this._setInitMap(t),this._setInitPartsBlocksWrapper(t),document.querySelector('#title input[name="title"]').value=t._title,document.querySelector('#body textarea[name="body"]').value=t._body;const _=document.querySelector("#bgmusic select");for(let e=0;e<_.length;e++)if(_[e].value===t._bgmusic){_[e].selected=!0;break}_.addEventListener("click",function(){_GAME_STAGEEDIT._setAudioStop()});const s=document.querySelector("#boss select");for(let e=0;e<s.length;e++)if(s[e].value===t._boss){s[e].selected=!0;break}const i=document.querySelector('#init input[name="init"]'),a=document.querySelector("#init .col_r .val");i.value=t._initx,a.setAttribute("data-val",t._initx),this._setTextToFont(a,t._initx,20);const n=document.querySelector('#speed input[name="speed"]'),o=document.querySelector("#speed .col_r .val");n.value=t._speed,o.setAttribute("data-val",t._speed),this._setTextToFont(o,t._speed,20);const r=document.querySelector('#difficult input[name="difficult"]'),l=document.querySelector("#difficult .col_r .val");r.value=t._difficult,l.setAttribute("data-val",t._difficult),this._setTextToFont(l,t._difficult,20);const c=document.querySelector('#map_infinite input[name="map_infinite"]'),m=document.querySelector("#map_infinite .col_r .val");c.value="true"===t._map_infinite?"1":"0",m.setAttribute("data-val",t._map_infinite),this._setTextToFont(m,t._map_infinite,20)},setDataForDataApi:function(){let e=function(e){let t="";t+='"_map":[';let _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++){let s=_[e].children;t+='"';for(let e=0;e<s.length;e++)t+=s[e].getAttribute("data-val");t+=e===_.length-1?'"':'",'}return t+="],",t+='"_theme":"'+e._theme+'",',t+='"_body":"'+document.querySelector('#body textarea[name="body"]').value+'",',t+='"_initx":"'+document.querySelector("#init .col_r .val").getAttribute("data-val")+'",',t+='"_bgmusic":"'+document.querySelector("#bgmusic select").value+'",',t+='"_boss":"'+document.querySelector("#boss select").value+'",',t+='"_speed":"'+document.querySelector("#speed .col_r .val").getAttribute("data-val")+'",',t+='"_difficult":"'+document.querySelector("#difficult .col_r .val").getAttribute("data-val")+'",',t+='"_map_infinite":"'+document.querySelector("#map_infinite .col_r .val").getAttribute("data-val")+'"'}(_MAPDEFS[_MAP_PETTERN]),t={title:document.querySelector('#title input[name="title"]').value,status:"Publish",_eid:_MAPDEFS[_MAP_PETTERN]._eid,body:e};_DATAAPI._set_entryupdate(t)},_setEntryLink:function(){$_mp.classList.remove("off"),$_mn.classList.remove("off"),0===_MAP_PETTERN&&$_mp.classList.add("off"),_MAP_PETTERN>=_MAPDEFS.length-1&&$_mn.classList.add("off")},_setPartsBlockEvent:function(){const e=document.querySelectorAll("#area_parts .parts_block");for(var t=0;t<e.length;t++)e[t].setAttribute("draggable",!0),e[t].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),e[t].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1)},_init_images:function(e,t){let _=0;for(let s in e){let i=e[s];i.obj.src=e[s].src,i.obj.onload=function(){i.obj.width*=i.rate,i.obj.height*=i.rate,++_>=Object.keys(e).length&&t()}}},_init:()=>{const e=_GAME_STAGEEDIT,t=document.querySelector("#bgmusic select");Object.keys(_CANVAS_AUDIOS).forEach(function(e){if(-1!==e.indexOf("bg_type")){var _=document.createElement("option");_.setAttribute("value",e.replace("bg_","")),_.innerHTML=e.replace("bg_",""),t.appendChild(_)}});const _=document.querySelector("#boss select");Object.keys(_MAP_ENEMIES_BOSS).forEach(function(e){var t=document.createElement("option");t.setAttribute("value",e),t.innerHTML=e,_.appendChild(t)}),_MAP.init(()=>{console.log("success"),e._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setPartsBlockEvent();const t=document.querySelectorAll('.form_group .col_r input[type="range"]');for(var _=0;_<t.length;_++)t[_].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),t[_].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();let s=document.querySelectorAll("h1");for(let t=0;t<s.length;t++)e._setTextToFont(s[t],s[t].innerText,40);s=document.querySelectorAll("h2,h3,#map_bts a,#entrylink a,label.col_l,div.col_r label span, #menu_inner a");for(let t=0;t<s.length;t++)e._setTextToFont(s[t],s[t].innerText,20);s=document.querySelectorAll(".parts_block_wrapper .text");for(let t=0;t<s.length;t++)e._setTextToFont(s[t],s[t].innerText,14)})}},_GAME_STAGEEDIT_EVENTS={$_do_area_parts_obj:null,$_start_area_parts_obj:null,$_mouseover_area_parts_obj:null,_e_entrylink_prev:function(e){if(0===_MAP_PETTERN)return;_MAP_PETTERN--,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const t=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<t.length;e++)_GAME_STAGEEDIT._setTextToFont(t[e],t[e].innerText,14);return!1},_e_entrylink_next:function(e){if(_MAP_PETTERN>=_MAPDEFS.length-1)return;_MAP_PETTERN++,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const t=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<t.length;e++)_GAME_STAGEEDIT._setTextToFont(t[e],t[e].innerText,14);return!1},_e_update:function(){return confirm("?")?_GAME_STAGEEDIT.setDataForDataApi():console.log("false"),!1},_e_scroll:function(e){const t=document.body,_=document.body.clientHeight,s=document.getElementById("menu").offsetHeight;t.scrollTop+window.innerHeight>_-s/2?t.classList.remove("ismenu"):t.classList.add("ismenu")},_f_fg_range:function(e){let t=e.target.parentNode.previousElementSibling,_="map_infinite"!==e.target.name?e.target.value:"1"===e.target.value?"true":"false";t.setAttribute("data-val",_),t.innerText=_,_GAME_STAGEEDIT._setTextToFont(t,_,20)},_f_map_add:function(e){const t=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<t.length;e++){let _=t[e].lastElementChild.cloneNode(!0);t[e].appendChild(_),_.children.length}return e.stopPropagation(),e.preventDefault(),!1},_f_map_remove:function(e){const t=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<t.length;e++)t[e].lastElementChild.remove();return e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseover:function(e){return"IMG"===e.target.tagName&&(_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj=e.target,e.target.classList.add("over")),e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseout:function(e){if(null!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj&&void 0!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj)return _GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj.classList.remove("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_dragenter:function(e){return null!==this.$_do_area_parts_obj&&this.$_do_area_parts_obj.classList.remove("over"),this.$_do_area_parts_obj=e.target,this.$_do_area_parts_obj.classList.add("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_drop:function(e){console.log("as_drop");let t=e.dataTransfer.getData("text"),_=e.currentTarget,s=this.$_start_area_parts_obj;if(_.classList.remove("over"),0!==_.childNodes.length&&(_.textContent=null),"move"===e.dataTransfer.effectAllowed)_.appendChild(this.$_start_area_parts_obj);else{let e=s.cloneNode(!0);if(_.appendChild(e),null!==t.match(_MAP.collision_enemies)){let _=_MAP_THEME[_GAME_STAGEEDIT._theme]._enemies[t]._st,s=_MAP_THEME[_GAME_STAGEEDIT._theme]._enemies[t]._getObj();e.setAttribute("style","width:"+parseInt(.8*s.width)+"px;height:"+parseInt(.8*s.height)+"px;background:url("+s.img.src+") no-repeat;background-size:cover;"+(""!==_?_:"")+"background-position:"+20/s.width*s.imgPos[0]*-1+"px 0px;")}if(null!==t.match(_MAP.collision_map)){let _=_MAP_THEME[_GAME_STAGEEDIT._theme]._map[t]._getObj();e.setAttribute("style","width:"+parseInt(.8*_.width)+"px;height:"+parseInt(.8*_.height)+"px;background:url("+_.img.src+") no-repeat;background-size:cover;background-position:"+20/_.width*_.imgPos[0]*-1+"px 0px;")}_.children[0].addEventListener("dragstart",this._f_pb_dragstart,!1)}return _.setAttribute("data-val",t),e.stopPropagation(),e.preventDefault(),!1},_f_i_dragover:function(e){return e.stopPropagation(),e.preventDefault(),!1},_f_i_drop:function(e){return console.log("form_inner drop"),"move"===e.dataTransfer.effectAllowed&&(this.$_start_area_parts_obj.parentNode.textContent=null,!1)},_f_ap_dragstart:function(e){_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),console.log("_f_ap_start")},_f_ap_dragend:function(e){return e.target.parentNode.classList.remove("drag"),e.stopPropagation(),e.preventDefault(),!1},_f_pb_dragstart:function(e){console.log("_f_pb_dragstart"),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),e.currentTarget.parentNode.setAttribute("data-val",0)},_f_bgmusic_play:function(e){let t=document.querySelector("#bgmusic select").value;_GAME_STAGEEDIT._setAudioPlay(_CANVAS_AUDIOS["bg_"+t])},_f_bgmusic_stop:function(e){_GAME_STAGEEDIT._setAudioStop()}};document.addEventListener("scroll",()=>{_GAME_STAGEEDIT_EVENTS._e_scroll()}),window.addEventListener("load",()=>{$_pb=document.getElementsByClassName("parts_block"),$_ab=document.getElementsByClassName("area_block"),$_mp=document.querySelector("#menu .prev"),$_mn=document.querySelector("#menu .next"),$_bm=document.querySelector("#bgmusic"),_AUDIO_CONTEXT=new(window.AudioContext||window.webkitAudioContext),_GAME_STAGEEDIT._setAudioInit(_CANVAS_AUDIOS,_DATAAPI._init_config)});