"use strict";const _CANVAS_IMGS={vicviper:{src:"images/gradius_vicviper.png",rate:1,obj:new Image},vicviper_back:{src:"images/gradius_vicviper_back.png",rate:1,obj:new Image},vicviper_bomb:{src:"images/gradius_vicviper_bomb.png",rate:1,obj:new Image},vicviper_bomb_red:{src:"images/gradius_vicviper_bomb_red.png",rate:1,obj:new Image},option:{src:"images/option.png",rate:1,obj:new Image},forcefield:{src:"images/gradius_forcefield.png",rate:1,obj:new Image},shield:{src:"images/gradius_shield.png",rate:1,obj:new Image},gradius_missile:{src:"images/gradius_missile.png",rate:1,obj:new Image},shot1:{src:"images/gradius_shot1.png",rate:.4,obj:new Image},shot2:{src:"images/gradius_shot2.png",rate:.4,obj:new Image},shot3:{src:"images/gradius_shot3.png",rate:.4,obj:new Image},shot_laser_col:{src:"images/gradius_shot_laser_col.png",rate:1,obj:new Image},gradius_pc:{src:"images/gradius_pc.png",rate:1,obj:new Image},meter:{src:"images/gradius_meter.png",rate:1,obj:new Image},meter_c:{src:"images/gradius_meter_c.png",rate:1,obj:new Image},enemy_fan:{src:"images/gradius_enemy_fan.png",rate:1,obj:new Image},enemy_a:{src:"images/gradius_enemy_a.png",rate:1,obj:new Image},enemy_b:{src:"images/gradius_enemy_b.png",rate:1,obj:new Image},enemy_c:{src:"images/gradius_enemy_c.png",rate:1,obj:new Image},enemy_d:{src:"images/gradius_enemy_d.png",rate:1,obj:new Image},enemy_e:{src:"images/gradius_enemy_e.png",rate:1,obj:new Image},enemy_f:{src:"images/gradius_enemy_f.png",rate:1,obj:new Image},enemy_g:{src:"images/gradius_enemy_g.png",rate:1,obj:new Image},enemy_m1:{src:"images/gradius_enemy_m1.png",rate:1,obj:new Image},enemy_m2:{src:"images/gradius_enemy_m2.png",rate:1,obj:new Image},enemy_m_group:{src:"images/gradius_enemy_m_group.png",rate:1,obj:new Image},enemy_o:{src:"images/gradius_enemy_o.png",rate:1,obj:new Image},enemy_p_1:{src:"images/gradius_enemy_p_1.png",rate:1,obj:new Image},enemy_p_2:{src:"images/gradius_enemy_p_2.png",rate:1,obj:new Image},enemy_p_3:{src:"images/gradius_enemy_p_3.png",rate:1,obj:new Image},enemy_p_4:{src:"images/gradius_enemy_p_4.png",rate:1,obj:new Image},enemy_p_5:{src:"images/gradius_enemy_p_5.png",rate:1,obj:new Image},enemy_p_6:{src:"images/gradius_enemy_p_6.png",rate:1,obj:new Image},enemy_moai_boss:{src:"images/gradius_enemy_moai_boss.png",rate:1,obj:new Image},enemy_moai_mini_boss:{src:"images/gradius_enemy_moai_mini_boss.png",rate:1,obj:new Image},enemy_moai_boss_ring:{src:"images/gradius_enemy_moai_boss_ring.png",rate:1,obj:new Image},enemy_m_a_1:{src:"images/gradius_enemy_m_a_1.png",rate:1,obj:new Image},enemy_m_a_2:{src:"images/gradius_enemy_m_a_2.png",rate:1,obj:new Image},enemy_m_b_1:{src:"images/gradius_enemy_m_b_1.png",rate:1,obj:new Image},enemy_m_b_2:{src:"images/gradius_enemy_m_b_2.png",rate:1,obj:new Image},enemy_m_z:{src:"images/gradius_enemy_m_z.png",rate:1,obj:new Image},enemy_moai_ring:{src:"images/gradius_enemy_moai_ring.png",rate:1,obj:new Image},enemy_cell_boss:{src:"images/gradius_enemy_cell_boss.png",rate:1,obj:new Image},enemy_cell_boss_eye:{src:"images/gradius_enemy_cell_boss_eye.png",rate:1,obj:new Image},enemy_cell_core:{src:"images/gradius_enemy_cell_core.png",rate:1,obj:new Image},enemy_cell_hand_1:{src:"images/gradius_enemy_cell_hand_1.png",rate:1,obj:new Image},enemy_cell_hand_2:{src:"images/gradius_enemy_cell_hand_2.png",rate:1,obj:new Image},enemy_cell_hand_3:{src:"images/gradius_enemy_cell_hand_3.png",rate:1,obj:new Image},enemy_cell_a:{src:"images/gradius_enemy_cell_a.png",rate:1,obj:new Image},enemy_cell_b:{src:"images/gradius_enemy_cell_b.png",rate:1,obj:new Image},enemy_frame_large:{src:"images/gradius_enemy_frame_large.png",rate:1,obj:new Image},enemy_frame_small:{src:"images/gradius_enemy_frame_small.png",rate:1,obj:new Image},enemy_frame_mini:{src:"images/gradius_enemy_frame_mini.png",rate:1,obj:new Image},enemy_frame_head1:{src:"images/gradius_enemy_frame_head_1.png",rate:1,obj:new Image},enemy_frame_head2:{src:"images/gradius_enemy_frame_head_2.png",rate:1,obj:new Image},enemy_frame_head3:{src:"images/gradius_enemy_frame_head_3.png",rate:1,obj:new Image},enemy_frame_head4:{src:"images/gradius_enemy_frame_head_4.png",rate:1,obj:new Image},enemy_frame_body1:{src:"images/gradius_enemy_frame_body_1.png",rate:1,obj:new Image},enemy_bigcore:{src:"images/gradius_enemy_bigcore.png",rate:.6,obj:new Image},enemy_bigcore_1:{src:"images/gradius_enemy_bigcore_1.png",rate:.6,obj:new Image},enemy_bigcore_2:{src:"images/gradius_enemy_bigcore_2.png",rate:.6,obj:new Image},enemy_bigcore_3:{src:"images/gradius_enemy_bigcore_3.png",rate:.6,obj:new Image},enemy_bigcore_4_1:{src:"images/gradius_enemy_bigcore_4_1.png",rate:.6,obj:new Image},enemy_bigcore_4_2:{src:"images/gradius_enemy_bigcore_4_2.png",rate:.6,obj:new Image},enemy_bigcore_4_3:{src:"images/gradius_enemy_bigcore_4_3.png",rate:.6,obj:new Image},enemy_bigcore_4_4:{src:"images/gradius_enemy_bigcore_4_4.png",rate:.6,obj:new Image},enemy_bigcore_4_5:{src:"images/gradius_enemy_bigcore_4_5.png",rate:.6,obj:new Image},enemy_cristalcore:{src:"images/gradius_enemy_cristalcore.png",rate:1,obj:new Image},enemy_cristalcore_hand1:{src:"images/gradius_enemy_cristalcore_hand1.png",rate:.3,obj:new Image},enemy_cristalcore_hand2:{src:"images/gradius_enemy_cristalcore_hand2.png",rate:.4,obj:new Image},enemy_cristalcore_wall1:{src:"images/gradius_enemy_cristalcore_wall1.png",rate:1,obj:new Image},enemy_cristalcore_wall2:{src:"images/gradius_enemy_cristalcore_wall2.png",rate:1,obj:new Image},enemy_cristalcore_shot:{src:"images/gradius_enemy_cristalcore_shot.png",rate:1,obj:new Image},enemy_cube:{src:"images/gradius_enemy_cube.png",rate:1,obj:new Image},enemy_bigcore2:{src:"images/gradius_enemy_bigcore2.png",rate:1,obj:new Image},enemy_bigcore2_hand:{src:"images/gradius_enemy_bigcore2_hand.png",rate:1,obj:new Image},enemy_bigcore2_wall:{src:"images/gradius_enemy_bigcore2_wall.png",rate:1,obj:new Image},enemy_bigcore2_core:{src:"images/gradius_enemy_bigcore2_core.png",rate:1,obj:new Image},enemy_bigcore2_back:{src:"images/gradius_enemy_bigcore2_back.png",rate:1,obj:new Image},enemy_death:{src:"images/gradius_enemy_death.png",rate:1,obj:new Image},enemy_death_front:{src:"images/gradius_enemy_death_front.png",rate:1,obj:new Image},enemy_death_shot:{src:"images/gradius_enemy_death_shot.png",rate:1,obj:new Image},enemy_death_shot2:{src:"images/gradius_enemy_death_shot2.png",rate:1,obj:new Image},enemy_collapes0:{src:"images/gradius_enemy_collapes0.png",rate:1,obj:new Image},enemy_collapes1:{src:"images/gradius_enemy_collapes1.png",rate:1,obj:new Image},enemy_collapes2:{src:"images/gradius_enemy_collapes2.png",rate:1,obj:new Image},enemy_collapes8:{src:"images/gradius_enemy_collapes8.png",rate:1,obj:new Image},enemy_collapes9:{src:"images/gradius_enemy_collapes9.png",rate:1,obj:new Image},enemy_bullet:{src:"images/gradius_enemy_bullet.png",rate:1,obj:new Image},enemy_bullet_cell:{src:"images/gradius_enemy_bullet_cell.png",rate:1,obj:new Image},enemy_bullet_z:{src:"images/gradius_enemy_bullet_z.png",rate:1,obj:new Image},enemy_bullet_laser:{src:"images/gradius_enemy_bullet_laser.png",rate:1,obj:new Image},map_cube_A:{src:"images/gradius_map_cube_A.png",rate:1,obj:new Image},map_cristal_up:{src:"images/gradius_map_cristal_up.png",rate:1,obj:new Image},map_cristal_down:{src:"images/gradius_map_cristal_down.png",rate:1,obj:new Image},map_moai_A:{src:"images/gradius_map_moai_A.png",rate:1,obj:new Image},map_moai_B:{src:"images/gradius_map_moai_B.png",rate:1,obj:new Image},map_volcano_A:{src:"images/gradius_map_volcano_A.png",rate:1,obj:new Image},map_volcano_B:{src:"images/gradius_map_volcano_B.png",rate:1,obj:new Image},map_volcano_C:{src:"images/gradius_map_volcano_C.png",rate:1,obj:new Image},map_volcano_D:{src:"images/gradius_map_volcano_D.png",rate:1,obj:new Image},map_volcano_E:{src:"images/gradius_map_volcano_E.png",rate:1,obj:new Image},map_volcano_F:{src:"images/gradius_map_volcano_F.png",rate:1,obj:new Image},map_volcano_G:{src:"images/gradius_map_volcano_G.png",rate:1,obj:new Image},map_volcano_H:{src:"images/gradius_map_volcano_H.png",rate:1,obj:new Image},map_volcano_I:{src:"images/gradius_map_volcano_I.png",rate:1,obj:new Image},map_volcano_J:{src:"images/gradius_map_volcano_J.png",rate:1,obj:new Image},map_volcano_K:{src:"images/gradius_map_volcano_K.png",rate:1,obj:new Image},map_volcano_L:{src:"images/gradius_map_volcano_L.png",rate:1,obj:new Image},map_volcano_M:{src:"images/gradius_map_volcano_M.png",rate:1,obj:new Image},map_volcano_N:{src:"images/gradius_map_volcano_N.png",rate:1,obj:new Image},map_volcano_O:{src:"images/gradius_map_volcano_O.png",rate:1,obj:new Image},map_volcano_P:{src:"images/gradius_map_volcano_P.png",rate:1,obj:new Image},map_frame_A:{src:"images/gradius_map_frame_A.png",rate:1,obj:new Image},map_frame_B:{src:"images/gradius_map_frame_B.png",rate:1,obj:new Image},map_frame_C:{src:"images/gradius_map_frame_C.png",rate:1,obj:new Image},map_frame_D:{src:"images/gradius_map_frame_D.png",rate:1,obj:new Image},map_frame_E:{src:"images/gradius_map_frame_E.png",rate:1,obj:new Image},map_frame_F:{src:"images/gradius_map_frame_F.png",rate:1,obj:new Image},map_cell_A:{src:"images/gradius_map_cell_A.png",rate:1,obj:new Image},map_cell_B:{src:"images/gradius_map_cell_B.png",rate:1,obj:new Image},map_cell_C:{src:"images/gradius_map_cell_C.png",rate:1,obj:new Image},map_cell_D:{src:"images/gradius_map_cell_D.png",rate:1,obj:new Image},map_cell_V:{src:"images/gradius_map_cell_V.png",rate:1,obj:new Image},map_cell_W:{src:"images/gradius_map_cell_W.png",rate:1,obj:new Image},map_cell_Y:{src:"images/gradius_map_cell_Y.png",rate:1,obj:new Image},map_cell_Z:{src:"images/gradius_map_cell_Z.png",rate:1,obj:new Image},map_cell_wall:{src:"images/gradius_map_cell_wall.png",rate:1,obj:new Image}},_CANVAS_IMGS_INIT={font:{src:"images/gradius_font.png",rate:1,obj:new Image},gradius_powermeterselect:{src:"images/gradius_powermeterselect.png",rate:1,obj:new Image},gradius_powermeterselect_selected:{src:"images/gradius_powermeterselect_selected.png",rate:1,obj:new Image},gradius_powermeterselect_shield:{src:"images/gradius_powermeterselect_shield.png",rate:1,obj:new Image},gradius_powermeterselect_shield_selected:{src:"images/gradius_powermeterselect_shield_selected.png",rate:1,obj:new Image}},_CANVAS_AUDIOS={shot_laser:{src:"audios/shot_laser.mp3",volume:1,obj:null,buf:new Object},missile:{src:"audios/missile.mp3",volume:1,obj:null,buf:new Object},shot_normal:{src:"audios/shot_normal.mp3",volume:1,obj:null,buf:new Object},shot_ripple:{src:"audios/shot_ripple.mp3",volume:1,obj:null,buf:new Object},vicviper_bomb:{src:"audios/vicviper_bomb.mp3",volume:1,obj:null,buf:new Object},vicviper_shield_reduce:{src:"audios/vicviper_shield_reduce.mp3",volume:1,obj:null,buf:new Object},pc:{src:"audios/pc.mp3",volume:1,obj:null,buf:new Object},playerset:{src:"audios/playerset.mp3",volume:1,obj:null,buf:new Object},pms_select:{src:"audios/pms_select.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser:{src:"audios/enemy_bullet_laser.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser_long:{src:"audios/enemy_bullet_laser_long.mp3",volume:1,obj:null,buf:new Object},enemy_collision1:{src:"audios/enemy_collision1.mp3",volume:1,obj:null,buf:new Object},enemy_collision2:{src:"audios/enemy_collision2.mp3",volume:1,obj:null,buf:new Object},enemy_collision3:{src:"audios/enemy_collision3.mp3",volume:1,obj:null,buf:new Object},enemy_collision4:{src:"audios/enemy_collision4.mp3",volume:1,obj:null,buf:new Object},enemy_collision5:{src:"audios/enemy_collision5.mp3",volume:1,obj:null,buf:new Object},enemy_collision6:{src:"audios/enemy_collision6.mp3",volume:1,obj:null,buf:new Object},enemy_collision7:{src:"audios/enemy_collision7.mp3",volume:1,obj:null,buf:new Object},enemy_collision8:{src:"audios/enemy_collision8.mp3",volume:1,obj:null,buf:new Object},enemy_all_out:{src:"audios/enemy_all_out.mp3",volume:1,obj:null,buf:new Object},enemy_cube:{src:"audios/enemy_cube.mp3",volume:1,obj:null,buf:new Object},map_cell_wall:{src:"audios/map_cell_wall.mp3",volume:1,obj:null,buf:new Object},bg_powermeterselect:{src:"audios/bg_powermeterselect.mp3",volume:1,obj:null,buf:new Object},bg_boss:{src:"audios/bg_boss.mp3",volume:1,obj:null,buf:new Object},bg_type1:{src:"audios/bg_moai.mp3",volume:1,obj:null,buf:new Object},bg_type2:{src:"audios/bg_volcano.mp3",volume:1,obj:null,buf:new Object},bg_type3:{src:"audios/bg_crystal.mp3",volume:1,obj:null,buf:new Object},bg_type4:{src:"audios/bg_frame.mp3",volume:1,obj:null,buf:new Object},bg_type5:{src:"audios/bg_thunderbolt.mp3",volume:1,obj:null,buf:new Object},bg_type6:{src:"audios/bg_cell.mp3",volume:1,obj:null,buf:new Object}};let _ISDEBUG=!1,_PLAYERS_POWER_METER=0,_PLAYERS_POWER_METER_SHIELD=0,_DRAW_SETINTERVAL=null,_DRAW_GAMESTART_SETINTERVAL=null,_PLAYERS_SHOTS_SETINTERVAL=null,_DRAW_IS_MATCH_BOSS=!1,_DRAW_IS_MATCH_BOSS_COUNT=0;const _ISSP=null===window.ontouchstart,_FPS=60;let _CANVAS,_CONTEXT,_DRAW_IS_GAMECLEAR=!1;const _SHOTTYPE_MISSILE="_SHOTTYPE_MISSILE",_SHOTTYPE_NORMAL="_SHOTTYPE_NORMAL",_SHOTTYPE_DOUBLE="_SHOTTYPE_DOUBLE",_SHOTTYPE_LASER="_SHOTTYPE_LASER",_SHOTTYPE_RIPPLE_LASER="_SHOTTYPE_RIPPLE_LASER";let _SHOTTYPE=_SHOTTYPE_NORMAL,_SCORE="",_PLAYERS_MAIN="",_PLAYERS_MAIN_FORCE="",_PLAYERS_OPTION=new Array,_PLAYERS_OPTION_ISALIVE=0;const _PLAYERS_OPTION_MAX=4,_PLAYERS_MOVE_DRAW_MAX=100;let _PLAYERS_MOVE_FLAG=!1,_PLAYERS_MOVE_DRAW_X=new Array,_PLAYERS_MOVE_DRAW_Y=new Array;const _PLAYERS_MAX=5,_PLAYERS_SHOTS_MAX=2;let _PLAYERS_SHOTS={_SHOTTYPE_NORMAL:new Array,_SHOTTYPE_DOUBLE:new Array,_SHOTTYPE_LASER:new Array},_PLAYERS_MISSILE=new Array,_PLAYERS_MISSILE_ISALIVE=!1,_ENEMIES=new Array,_ENEMIES_SHOTS=new Array,_ENEMIES_COLLISIONS=new Array,_ENEMY_DIFFICULT=4,_POWERCAPSELLS=new Array,_POWERMETER="",_STAGESELECT="",_MAP="",_BACKGROUND=new Array;const _BACKGROUND_STAR_MAX=70;let _KEYSAFTERPAUSE=new Array,_DEF_KEYSAFTERPAUSE="38,38,40,40,37,39,37,39,66,65";const _DEF_DIFFICULT=[{_ENEMY_SHOT_RATE:1e-4,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:5e-4,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.002,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.005,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.01,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:2}],_IS_SQ_COL=0,_IS_SQ_COL_NONE=1,_IS_SQ_NOTCOL=2;let _AUDIO_CONTEXT=null;const _DEF_DIR={_U:0,_D:1,_R:2,_L:3,_LU:4,_LD:5,_RU:6,_RD:7},_AJAX=function(e){if(void 0===e)return;let _=new XMLHttpRequest;_.onreadystatechange=function(){4===_.readyState&&(200===_.status?(console.log("OK"),e.f(_.response,e.t)):console.log("NG"))},_.open("GET",e.url+"?date="+(new Date).getTime()),_.responseType=e.type||"json",_.send(null)},_GAME={_url_params:new Array,_init(){_SCORE=new GameObject_SCORE,(_MAP=new GameObject_MAP).init(_GAME._showGameStart)},_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_audio_buffer_loader:null,_audio_now_obj_bg:null,_audio_context_source_bg:null,_is_audio_context_source_bg:!1,_ac:{_get:function(e,_,t){return e>=_.length*t-1?0:e+1}},getRad(e,_){if(void 0!==e&&void 0!==_)return Math.atan2(e.y-_.y,e.x-_.x)},getDeg(e,_){if(void 0===e||void 0===_)return;return Math.atan2(e.y-_.y,e.x-_.x)/Math.PI*180},getRadToDeg:e=>void 0===e||""===e?null:e/Math.PI*180,getBit:(e,_)=>("0".repeat(_)+e).slice(-1*_),getOrBit(e,_,t){let s=(parseInt(e,2)|parseInt(_,2)).toString(2);return this.getBit(s,t)},setUrlParams(){for(var e=location.search.slice(1).split(/(&|&amp;)/),_=0;_<e.length;_++){var t=e[_].replace("amp;","").split("=");""!==t[0]&&void 0!==t[0]&&("&"!==t[0]&&(this._url_params[t[0]]=t[1]))}},isShotCanvasOut:e=>e.x<-_MAP.t||e.x>_CANVAS.width+_MAP.t||e.y<-_MAP.t||e.y>_CANVAS.height+_MAP.t,isEnemyCanvasOut(e,_,t){let s=e.getEnemyCenterPosition(),i=_||{up:!0,down:!0,left:!0,right:!0},a=e.width,n=e.height,o=t||{up:0,down:0,left:0,right:0},r=o.up||0,l=o.right||0,c=o.down||0,m=o.left||0;return s._x<0-a-m&&!0===i.left||s._x>_CANVAS.width+a+l&&!0===i.right||s._y<0-n-r&&!0===i.up||s._y>_CANVAS.height+n+c&&!0===i.down},isSqCollision(e,_,t,s,i){return this.isSqCollision_laser(e,_,t,s,i).ret},isSqCollision_laser(e,_,t,s,i){let a=parseInt(void 0===_?0:_.split(",")[0]),n=parseInt(void 0===_?0:_.split(",")[1]),o=parseInt(void 0===s?0:s.split(",")[0]),r=parseInt(void 0===s?0:s.split(",")[1]),l=e.split(","),c=parseInt(l[2])-parseInt(l[0]),m=parseInt(l[3])-parseInt(l[1]),g=(Math.sqrt(Math.pow(c,2)+Math.pow(m,2)),c/2+a+parseInt(l[0])),h=m/2+n+parseInt(l[1]);i&&console.log(g+":"+h);for(let e=0;e<t.length;e++){let _=t[e].split(","),s=parseInt(_[2])-parseInt(_[0]),i=parseInt(_[3])-parseInt(_[1]),a=void 0===_[4],n=(Math.sqrt(Math.pow(s,2)+Math.pow(i,2)),s/2+o+parseInt(_[0])),l=i/2+r+parseInt(_[1]),d=Math.abs(n-g),E=Math.abs(l-h),u=(Math.sqrt(Math.pow(d,2)+Math.pow(E,2)),o+parseInt(_[0]));if(c/2+s/2>d&&m/2+i/2>E)return a?{ret:0,val:u}:{ret:1,val:u}}return{ret:_IS_SQ_NOTCOL,val:_CANVAS.width}},_showGameStart(){if(document.querySelector("#game_start_loading").classList.remove("on"),_ISSP){document.querySelector("#sp_controller").classList.add("on"),_SP_CONTROLLER._set_obj()}if(_ISDEBUG){return document.querySelector("#game_wrapper").classList.add("on"),(_STAGESELECT=new GameObject_STAGESELECT).init(),_MAP.set_stage_map_pattern(_MAP_PETTERN),void _DRAW_INIT(_CANVAS_IMGS,_DRAW_POWER_METER_SELECT)}_KEYEVENT_MASTER.addKeydownStart(),document.querySelector("#game_start_wrapper").classList.add("on"),_GAME._setTextToFont(document.querySelector("#game_start>.title"),"no pakuri",50),_GAME._setTextToFont(document.querySelector("#game_start>.text"),"press s to start",30),_GAME._setTextToFont(document.querySelector("#game_start>.text_loading"),"now loading",30)},_setDrawTextToFont(e,_,t,s){let i=this;const a=_CANVAS_IMGS_INIT.font.obj,n=a.height;s=s||1;for(let o=0;o<e.length;o++)" "!==e[o]&&_GAME._setDrawImage({img:a,x:_+n*s*o,y:t,imgPosx:parseInt(i._txt[e[o]]),width:n,height:n,scale:s,basePoint:1})},_setTextToFont(e,_,t){if(null==e)return;let s=this;t=t||30;let i="";for(let e=0;e<_.length;e++){if(" "===_[e]){i+='<img src="./images/gradius_spacer.png" width="'+t+'">';continue}i+='<div style="background:url(./images/gradius_font.png) no-repeat;width:'+t+"px;height:"+t+"px;background-position:"+parseInt(s._txt[_[e]])*(t/60)*-1+'px 0px;background-size:cover;display:inline-block;"></div>'}e.innerHTML=i},_getPlayerMoveDrawX:e=>void 0===_PLAYERS_MOVE_DRAW_X[e]?null:_PLAYERS_MOVE_DRAW_X[e],_getPlayerMoveDrawY:e=>void 0===_PLAYERS_MOVE_DRAW_Y[e]?null:_PLAYERS_MOVE_DRAW_Y[e],_setPlayerMoveDraw(){let e=_PLAYERS_MAIN.width,_=_PLAYERS_MAIN.height,t=_PLAYERS_MAIN.x+parseInt(e/4),s=_PLAYERS_MAIN.y+parseInt(_/4),i=-1*_MAP.getBackGroundSpeedY(),a=_PLAYERS_MOVE_DRAW_Y;if(100===_PLAYERS_MOVE_DRAW_X.length&&_PLAYERS_MOVE_DRAW_X.pop(),100===_PLAYERS_MOVE_DRAW_Y.length&&_PLAYERS_MOVE_DRAW_Y.pop(),_PLAYERS_MOVE_DRAW_X.unshift(t),_MAP.map_infinite)if(0!==i)for(let e=0;e<100;e++)void 0!==a[e]?i>0?a[e]=a[e]>=s+i*e?s+i*e:a[e]+i:i<0&&(a[e]=a[e]<=s+i*e?s+i*e:a[e]+i):a.push(s+i*e);else a.unshift(s);else a.unshift(s)},_setPlay(e){if(null!=e){var _=_AUDIO_CONTEXT.createBufferSource();_.buffer=e.buf,_.loop=!1,_.connect(_AUDIO_CONTEXT.destination),_.start(0)}},_setPlayOnBG(e){if(null==e)return;!0===this._is_audio_context_source_bg&&(this._audio_context_source_bg.stop(),this._is_audio_context_source_bg=!1);let _=_AUDIO_CONTEXT.createBufferSource();_.buffer=e.buf,this._audio_now_obj_bg=e,_.loop=!0,_.loopStart=0,_.connect(_AUDIO_CONTEXT.destination),_.start(0),this._audio_context_source_bg=_,this._is_audio_context_source_bg=!0},_setStopOnBG(){this._is_audio_context_source_bg&&(this._audio_context_source_bg.stop(),this._is_audio_context_source_bg=!1)},_setDrawImage(e){if(void 0===e||void 0===e.img||0===e.scale)return;let _=e.width||e.img.width,t=e.height||e.img.height,s=e.deg||0,i=e.imgPosx||0,a=e.imgPosy||0,n=e.scale||1,o=e.x||0,r=e.y||0,l=e.basePoint||5,c=void 0===e.alpha?1:e.alpha;if(1===e.basePoint&&void 0===e.imgPosx&&void 0===e.alpha&&void 0===e.scale&&void 0===e.deg)return void _CONTEXT.drawImage(e.img,e.x,e.y,_,t);const m=[{x:0,y:0},{x:0,y:0},{x:-_/2,y:0},{x:-_,y:0},{x:0,y:-t/2},{x:-_/2,y:-t/2},{x:-_,y:-t/2},{x:0,y:-t},{x:-_/2,y:-t},{x:-_,y:-t}];_CONTEXT.save(),_CONTEXT.globalAlpha=c,_CONTEXT.translate(o,r),_CONTEXT.rotate(s*Math.PI/180),_CONTEXT.scale(n,n),_CONTEXT.drawImage(e.img,i,a,_,t,m[l].x,m[l].y,_,t),_CONTEXT.restore()},_multilineText(e,_,t){let s=_.length,i=[],a="";if(s<1)return i;for(let n=0;n<s;n++){let s=_.charAt(n);"\n"!==s?e.measureText(a+s).width<=t?a+=s:(i.push(a),a=s):(i.push(a),a="")}return a.length>0&&i.push(a),i}};class GameObject_ENEMY{constructor(e){this.id=_ENEMIES.length,this.gid=0,this.img=e.img,this.imgPos=e.imgPos||[0],this.aniItv=e.aniItv||10,this.width=e.width||this.img.width,this.height=e.height||this.img.height,this.x=e.x||0,this.y=e.y||0,this.direct=void 0===e.direct?_DEF_DIR._D:e.direct,this._s=e.s||"0",this.audio_collision=_CANVAS_AUDIOS.enemy_collision1,this.audio_alive=_CANVAS_AUDIOS.enemy_collision3,this.isshot=!1,this._DEF_SHOTSTATUS={_SHOTTYPE_NORMAL:1,_SHOTTYPE_MISSILE:2,_SHOTTYPE_DOUBLE:1,_SHOTTYPE_RIPPLE_LASER:1.5,_SHOTTYPE_LASER:1},this.alpha=1,this._c=0,this.speed=1,this.getscore=200,this._standby=!0,this._isshow=!0,this._status=1,this.haspc=!1,this._collision_type="t0",this.is_ignore=e.is_ignore||!1,this.is_able_collision=!0,this.is_ignore_collision=!1,this.is_collision_player_init=!1,this.shotColMap=["0,0,"+this.width+","+this.height],this.col_date=null,this.col_canint=150}init(){this._status=0,this._isshow=!1}collision(e,_){return!!this.isCollision()&&(!this.is_able_collision||(this.setStatus(e,_),!0))}isAbleCollision(){return this.is_able_collision}isIgnore(){return this.is_ignore}isIgnoreCollision(){return this.is_ignore_collision}isCollision(){let e=this;return null===e.col_date?(e.col_date=new Date,!0):new Date-e.col_date>e.col_canint&&(e.col_date=new Date,!0)}setAlive(){let e=this;e.isalive()?_GAME._setPlay(e.audio_alive):(_SCORE.set(e.getscore),_GAME._setPlay(e.audio_collision))}setStatus(e){this._status-=this._DEF_SHOTSTATUS[e]||1,this.setAlive()}getEnemyCenterPosition(){return{_x:this.x+this.width/2,_y:this.y+this.height/2}}isalive(){return this._status>0}isshow(){return this._isshow}shot(){_GAME.isEnemyCanvasOut(this)||Math.random()>=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE||_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:this.getEnemyCenterPosition()._x,y:this.getEnemyCenterPosition()._y}))}get_move_bound_val(){return parseInt(2*Math.random()+1)*(Math.random()>.5?1:-1)}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.height),e.direct===_DEF_DIR._LU&&_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height),e.direct===_DEF_DIR._LD&&_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.width,0)}setDrawImage(){let e=this;e.isMove()&&(_CONTEXT.save(),e.setDrawImageDirect(),_CONTEXT.drawImage(e.img,e.get_imgPos(),0,e.width,e.height,e.x,e.y,e.width,e.height),_ISDEBUG&&(_CONTEXT.strokeStyle="rgba(200,200,255,0.5)",_CONTEXT.beginPath(),_CONTEXT.rect(e.x,e.y,e.width,e.height),_CONTEXT.stroke()),_CONTEXT.restore())}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.img.height),e.direct===_DEF_DIR._LU&&_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.img.width,2*e.y+e.img.height),e.direct===_DEF_DIR._LD&&_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.img.width,0)}isStandBy(){return this._standby}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1})}showCollapes(e,_){let t=this;t._isshow=!1,t.haspc?_POWERCAPSELLS.push(new GameObject_POWERCAPSELL(t.x,t.y)):_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e||t.x+t.width/2,_||t.y+t.height/2,t._collision_type))}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(!!e.isalive()||(e.showCollapes(),!1))}moveDraw(){}moveSet(){}move_standby(){let e=this;e.x<_CANVAS.width-20&&(e._standby=!1)}move(){this.x=_MAP.getX(this.x),this.y=_MAP.getY(this.y),this.isMove()&&(this.moveSet(),this.shot())}}class ENEMY_FAN extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_fan.obj,x:e.x,y:e.y,imgPos:[0,25,50,75,100,125,150,175],aniItv:5,width:25,height:25,direct:e.direct});this.haspc=!0,this.parts=[],this.is_ignore=!0}move_standby(){let e=this;if(!(e.x>_CANVAS.width)){e._standby=!1,e.parts=[new ENEMY_FAN_MAIN({x:e.x+0*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+.5*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+1*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+1.5*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+2*e.width,y:e.y}),new ENEMY_FAN_MAIN({x:e.x+2.5*e.width,y:e.y})];for(let _=0;_<e.parts.length;_++)_ENEMIES.push(e.parts[_])}}setDrawImage(){}moveSet(){let e=this;for(let _=e.parts.length-1;_>=0;_--){let t=e.parts[_];t.moveSet(),t.isalive()||e.parts.splice(_,1)}if(0===e.parts.length)return e.x<_CANVAS.width&&e.showCollapes(),void e.init();e.x=e.parts[e.parts.length-1].x,e.y=e.parts[e.parts.length-1].y}}class ENEMY_FAN_MAIN extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_fan.obj,x:e.x,y:e.y,imgPos:[0,25,50,75,100,125,150,175],aniItv:5,width:25,height:25});this._status=1,this.speed=2,this.pos_y=e.y>250,this.change_x=!1,this.change_y=!1}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:this.change_x})}moveSet(){let e=this;if(e.x=_MAP.getX(e.x),e.y=_MAP.getY(e.y),!e.isMove())return;const _=e.pos_y?275:200;e.change_x=e.change_x||e.x<500,e.x+=e.change_x?e.speed+_MAP.getBackGroundSpeed():-1*e.speed,e.change_y=e.change_y||e.pos_y&&e.y<_||!e.pos_y&&e.y>_,e.y+=(()=>e.change_x?e.change_y?0:e.pos_y?-1*e.speed:e.speed:0)(),e.set_imgPos(),e.shot()}move(){}}class ENEMY_a extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_a.obj,x:e.x,y:e.y,imgPos:[0],width:25,direct:e.direct});this._status=1}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.height):_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height)),e.direct===_DEF_DIR._D&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,1,0,0):_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.width,0))}moveSet(){this.imgPos=(e=>e>150?[0]:e<=150&&e>100?[25]:[50])(Math.abs(_PLAYERS_MAIN.y-this.y))}}class ENEMY_b extends ENEMY_a{constructor(e){super({img:_CANVAS_IMGS.enemy_b.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class ENEMY_c extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_c.obj,x:e.x,y:e.y,width:50,height:50,imgPos:[0,50,100,150,200,250,300],direct:e.direct});let _=this;_._st="_st1",_._shot=!1,_._status=1,_._collision_type="t1",_.speed=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SPEED,_.y=e.direct===_DEF_DIR._D?e.y-_.height-_MAP.t:e.y,_.shotColMap=_.direct===_DEF_DIR._D?["10,10,43,42"]:["0,0,43,32"],_._ene_status={_st1:{_f:function(){!0!==_._shot&&(_.imgPos=[0,50,100,150],_.set_imgPos())},_setX:function(){return _.x+2*_.speed}},_st2:{_f:function(){if(!(_.x>=_CANVAS.width))return _._shot=!0,_.imgPos=[200,250,300],_.set_imgPos(),_._c>=_.imgPos.length*_.aniItv-1?(_.shot(),_._shot=!1,void(_._st="_st1")):void 0},_setX:function(){return _.x}}}}map_collition(){let e=this,_=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapBefore(t,s)&&(e.speed=Math.abs(e.speed)),_MAP.isMapLastSide(t,s)&&(e.speed=-1*e.speed);let i=_MAP.t;i=2*Math.abs(e.speed);let a=_MAP.isMapCollision(t+1,s)||_MAP.isMapCollision(t-1,s);var n;e.y=(n=e).direct===_DEF_DIR._U?a?n.y+i:n.y:n.direct===_DEF_DIR._D?a?n.y-i:n.y:void 0,e.y=function(e){return e.direct===_DEF_DIR._U?_MAP.isMapCollision(t,s-1)?e.y:e.y-i:e.direct===_DEF_DIR._D?_MAP.isMapCollision(t,s+1)?e.y:e.y+i:void 0}(e)}setDrawImageDirect(){let e=this;e.direct===_DEF_DIR._U&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,-1,0,2*e.y+e.height):_CONTEXT.setTransform(-1,0,0,-1,2*e.x+e.width,2*e.y+e.height)),e.direct===_DEF_DIR._D&&(_PLAYERS_MAIN.x<e.x?_CONTEXT.setTransform(1,0,0,1,0,0):_CONTEXT.setTransform(-1,0,0,1,2*e.x+e.width,0))}set_speed(){let e=_PLAYERS_MAIN.getPlayerCenterPosition();this._c>5e3*Math.random()&&(this._c=0,this.speed=e._x<this.x?-1*this.speed:Math.abs(this.speed))}shot(){if("_st1"===this._st)return;if(_GAME.isEnemyCanvasOut(this))return;if(Math.random()>=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE)return;let e=_PLAYERS_MAIN.getPlayerCenterPosition(),_=this.getEnemyCenterPosition(),t=_GAME.getDeg({x:e._x,y:e._y},{x:_._x,y:_._y});_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:_._x,y:_._y,deg:t-10})),_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:_._x,y:_._y,deg:t+10}))}moveSet(){this.map_collition(),this.set_speed(),this._st=Math.random()<_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE||this._shot?"_st2":"_st1",this._ene_status[this._st]._f(),this.x=this._ene_status[this._st]._setX()}}class ENEMY_d extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_d.obj,x:e.x,y:e.y,width:25,imgPos:[0,25,50,75,100,125]});this.speed=2}moveSet(){this.x+=-1*this.speed;let e=this.x,_=Math.cos(e*Math.PI/180);this.y+=_,this.set_imgPos()}}class ENEMY_e extends ENEMY_d{constructor(e){super({img:_CANVAS_IMGS.enemy_e.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class ENEMY_f extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_f.obj,x:e.x,y:e.y,width:30,imgPos:[0,30,60,90],direct:e.direct});this._v=0,this.speed=e.direct===_DEF_DIR._U?-.05:.05}getDir(){return this.x>_CANVAS.width/2?-1:1}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!0,down:!0,left:!1,right:!1})}shot(){if(!(this._v>0&&this._v<.05))return;let e=this.getEnemyCenterPosition();for(let _=30;_<=360;_+=30)_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:e._x,y:e._y,deg:_}))}move_standby(){let e=this;e.x+e.width<0&&(e._standby=!1)}moveSet(){let e=this;e.x+=3*e.getDir(),e.y+=e._v,e._v+=e.speed;let _=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapCollision(t,s)&&(e._v+=e.speed,e._v*=-1),e.set_imgPos()}}class ENEMY_g extends ENEMY_f{constructor(e){super({img:_CANVAS_IMGS.enemy_g.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class ENEMY_m extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_m1.obj,x:e.x,y:e.y,imgPos:[0,50,100,150,100,50,0],width:50,height:24,aniItv:5,direct:e.direct});this._status=4,this._collision_type="t1",this.getscore=200,this._isopen=!1,this._col_c=0,this._open_count=0}shot(){}moveSet(){let e=this;if(!e.isalive())return void e.showCollapes(0,e.direct===_DEF_DIR._U?0:-_MAP.t);if(e.img=e._status<=1?_CANVAS_IMGS.enemy_m2.obj:_CANVAS_IMGS.enemy_m1.obj,!e._isopen)return e.x>=690&&e.x<700&&(e._isopen=!0),e.x>=380&&e.x<400&&(e._isopen=!0),void e.imgPos[0];if(e._open_count++,(e._open_count>0&&e._open_count<20||e._open_count>200&&e._open_count<220)&&e.set_imgPos(),e._open_count>200&&e._c>=e.imgPos.length*e.aniItv-1)return e._open_count=0,void(e._isopen=!1);if(!e._isopen)return;if(e._open_count%15!=0)return;let _=new ENEMY_m_group({x:e.x+12.5,y:e.y+(e.direct===_DEF_DIR._U?15:-10),direct:e.direct});_ENEMIES.push(_)}}class ENEMY_m_group extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_m_group.obj,x:e.x,y:e.y,imgPos:[0,25,50,75,100,125,150],aniItv:5,width:25,height:25,direct:e.direct});this.speed=2,this.getscore=100,this._change=!1,this._moveX=0,this._moveY=0}isCanvasOut(){return _GAME.isEnemyCanvasOut(this)}moveSet(){let e=this,_=_PLAYERS_MAIN.getPlayerCenterPosition();e._change=!!e._change||(e.direct===_DEF_DIR._U&&_._y<e.y?(e._moveX=_._x<e.x?-1*e.speed:e.speed,!0):e.direct===_DEF_DIR._D&&_._y>e.y&&(e._moveX=_._x<e.x?-1*e.speed:e.speed,!0)),e._moveY=e._change?0:e.direct===_DEF_DIR._U?e.speed:e.direct===_DEF_DIR._D?-1*e.speed:void 0,e.x+=e._moveX,e.y+=e._moveY,e.set_imgPos()}}class ENEMY_n extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_o.obj,x:e.x,y:e.y,width:25,direct:e.direct,is_ignore:!0})}isCanvasOut(){return this.x<200}isalive(){return!0}shot(){}setDrawImage(){}moveSet(){if(Math.random()>.2)return;let e=new ENEMY_n_small({x:this.x,y:this.y});_ENEMIES.push(e)}}class ENEMY_o extends ENEMY_n{constructor(e){super({img:_CANVAS_IMGS.enemy_o.obj,x:e.x,y:e.y,direct:e.direct})}moveSet(){if(Math.random()>.1)return;let e=new ENEMY_o_small({x:this.x,y:this.y});_ENEMIES.push(e)}}class ENEMY_o_small extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_o.obj,x:e.x,y:e.y,imgPos:Math.random()>.5?[0]:[25],width:25,height:25,direct:e.direct});this._status=1,this.getscore=100,this.speedX=4*Math.random()+1,this.flagX=Math.random()>.5?1:-1,this.speedY=.2,this._v=-10,this._collision_type="t2"}map_collition(){let e=this,_=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapCollision(t,s-1)&&(e._status=0)}shot(){}moveSet(){this.map_collition(),this.x-=this.speedX*this.flagX,this.y+=this._v,this._v+=this.speedY}}class ENEMY_n_small extends ENEMY_o_small{constructor(e){super({x:e.x,y:e.y,direct:e.direct});this.speedY=-.2,this._v=10}map_collition(){let e=this,_=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapCollision(t,s+1)&&(e._status=0)}}class ENEMY_p extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_p_1.obj,x:e.x,y:e.y,direct:e.direct});this._status=4,this.getscore=100,this.speedx=_BACKGROUND_SPEED,this.speedy=this.get_move_bound_val(),this._s="0000,0000,0000,0000"}setAlive(){this.isalive()||_SCORE.set(this.getscore)}map_collition(){let e=this,_=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapCollision(t-1,s)&&(e.speedx=Math.abs(e.speedy)),_MAP.isMapCollision(t+1,s)&&(e.speedx*=-1),_MAP.isMapCollision(t,s-1)&&(e.speedy=Math.abs(e.speedy)),_MAP.isMapCollision(t,s+1)&&(e.speedy*=-1)}move_bounds(){let e=this,_=_ENEMIES;if(e.isalive())for(let t=0;t<_.length;t++){if(!ENEMY_p.prototype.isPrototypeOf(_[t]))continue;if(!_[t].isalive())continue;if(_[t].x>_CANVAS.width)continue;if(e.id===_[t].id)continue;_GAME.isSqCollision(e.shotColMap[0],e.x+","+e.y,_[t].shotColMap,_[t].x+","+_[t].y)!==_IS_SQ_NOTCOL&&((new Date).getTime()-e.col_date<500||(e.speedx=e.get_move_bound_val(),e.speedy=e.get_move_bound_val(),_[t].speedx=e.get_move_bound_val(),_[t].speedy=e.get_move_bound_val(),e.col_date=(new Date).getTime()))}}showCollapes(){if(this._status>0)return;let e=this.getEnemyCenterPosition();const _=[{img:_CANVAS_IMGS.enemy_p_2.obj,x:-30,y:-30},{img:_CANVAS_IMGS.enemy_p_3.obj,x:0,y:-30},{img:_CANVAS_IMGS.enemy_p_4.obj,x:30,y:-30},{img:_CANVAS_IMGS.enemy_p_5.obj,x:-30,y:30},{img:_CANVAS_IMGS.enemy_p_6.obj,x:0,y:30},{img:_CANVAS_IMGS.enemy_p_3.obj,x:30,y:30}];for(let t=0;t<_.length;t++){let s=_[t];_ENEMIES.push(new ENEMY_p_small({img:s.img,x:e._x+s.x,y:e._y+s.y}))}_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision4),this.init()}shot(){}moveSet(){this.map_collition(),this.move_bounds(),this.x-=(e=>(e.x+e.img.width>_CANVAS.width&&(e.speedx=Math.abs(e.speedx)),e.speedx))(this),this.y+=(e=>(e.y<0?e.speedy=Math.abs(e.speedy):e.y+e.img.height>_CANVAS.height&&(e.speedy=-1),e.speedy))(this)}}class ENEMY_p_small extends ENEMY_p{constructor(e){super({img:e.img,x:e.x,y:e.y,direct:e.direct});this.audio_collision=_CANVAS_AUDIOS.enemy_collision5,this._status=5,this.getscore=500,this.speedx=this.get_move_bound_val(),this.speedy=this.get_move_bound_val(),this.col_date=new Date,this._collision_type="t1"}setAlive(){this.isalive()||(_SCORE.set(this.getscore),_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision5))}showCollapes(e,_){this._isshow=!1,_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e||this.x+this.width/2,_||this.y+this.height/2,this._collision_type))}}class ENEMY_q extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_m_a_1.obj,x:e.x,y:e.y,direct:e.direct});let _=this;_._status=2,_.getscore=500,_._isSetMapDefCol=!1,_._isopen=!1,_._open_count=0,_.imgs=[_CANVAS_IMGS.enemy_m_a_1.obj,_CANVAS_IMGS.enemy_m_a_2.obj],_.audio_collision=_CANVAS_AUDIOS.enemy_collision5,_.audio_alive=_CANVAS_AUDIOS.enemy_collision8,_._collision_type="t8",_._collision_posy=_.direct===_DEF_DIR._D?25:0,_._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,_.shotColMap=[_.direct===_DEF_DIR._D?"0,50,35,85":_.direct===_DEF_DIR._U?"0,25,35,50":_.direct===_DEF_DIR._LD?"75,55,100,70":_.direct===_DEF_DIR._LU?"75,35,100,50":void 0],_._s=(()=>_.direct===_DEF_DIR._D?"0000,0011,0110,1111":_.direct===_DEF_DIR._U?"1111,0110,0011,0000":_.direct===_DEF_DIR._LD?"0000,1100,1110,1111":_.direct===_DEF_DIR._LU?"1111,1110,1100,0000":void 0)()}collision(e,_){this._isopen&&this.isCollision()&&this.setStatus(e,_)}isShot(){let e=this;return!(e._status<=0)&&(!_GAME.isEnemyCanvasOut(e)&&(!(Math.abs(_PLAYERS_MAIN.y-e.y)>100)&&(e.direct!==_DEF_DIR._LU&&e.direct!==_DEF_DIR._LD||!(_PLAYERS_MAIN.x<e.x))))}isMove(){let e=this;return e.isStandBy()?(e.move_standby(),!1):e.isCanvasOut()?(e._status=0,e._isshow=!1,!1):!!e.isshow()&&(!!e.isalive()||(e.showCollapes(),!0))}shot(){let e=this;e.isalive()&&(!e._open_count>0&&!e.isShot()||e._open_count++,e._open_count>0&&(e.img=e.imgs[1],e._isopen=!0),e._open_count>200&&(e.img=e.imgs[0],e._isopen=!1,e._open_count=-100),e._open_count<=0||e._open_count%10==0&&_ENEMIES.push(new ENEMY_moai_ring({x:e.x+parseInt(e.shotColMap[0].split(",")[0]),y:e.y+parseInt(e.shotColMap[0].split(",")[1]),direct:e.direct})))}showCollapes(){let e=this;e.img=_CANVAS_IMGS.enemy_m_z.obj,e._isSetMapDefCol||(_MAP.set_mapdef_col(_MAP.getMapX(e.x),_MAP.getMapY(e.y),e.direct===_DEF_DIR._D?"0000,0000,0000,1111":e.direct===_DEF_DIR._U?"1111,0000,0000,0000":e.direct===_DEF_DIR._LD?"0000,0000,0000,1111":e.direct===_DEF_DIR._LU?"1111,0000,0000,0000":void 0),_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e.x+e.img.width/2,e.y+e.img.height/2+e._collision_posy,e._collision_type)),e._isSetMapDefCol=!0)}}class ENEMY_r extends ENEMY_q{constructor(e){super({img:_CANVAS_IMGS.enemy_m_b_1.obj,x:e.x,y:e.y,direct:e.direct});let _=this;_._status=2,_.imgs=[_CANVAS_IMGS.enemy_m_b_1.obj,_CANVAS_IMGS.enemy_m_b_2.obj],_.img=_.imgs[0],_._collision_posy=_.direct===_DEF_DIR._D?-10:0,_.shotColMap=[_.direct===_DEF_DIR._D?"20,40,50,85":_.direct===_DEF_DIR._U?"20,25,50,70":void 0],_._s=(()=>_.direct===_DEF_DIR._D?"0000,0000,0010,1111":_.direct===_DEF_DIR._U?"1111,0010,0000,0000":void 0)()}}class ENEMY_moai_ring extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_moai_ring.obj,x:e.x,y:e.y,imgPos:e.imgPos||[0,25],aniItv:e.aniItv||5,width:e.width||25,height:e.height||25});this.audio_collision=_CANVAS_AUDIOS.enemy_collision2,this.rad=_GAME.getRad(_PLAYERS_MAIN,{x:e.x,y:e.y}),this.sx=Math.cos(this.rad),this.sy=Math.sin(this.rad),this.speed=1.5*_MAPDEFS[_MAP_PETTERN]._speed,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this._collision_type="t2",this.direct,_DEF_DIR._D}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!0})}map_collition(){let e=this,_=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapCollision(t,s)&&(_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(_._x,_._y,e._collision_type)),e.init())}shot(){}moveSet(){this.map_collition(),this.x+=this.sx*this.speed,this.y+=this.sy*this.speed,this.set_imgPos()}}class ENEMY_frame_1 extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_frame_large.obj,x:e.x,y:e.y,width:53,imgPos:[0,53],direct:e.direct});this.getscore=100,this.speed=-1*(3*Math.random()+3),this.rad=0,this.speedx=0,this.speedy=0,this._isbroken=!1,this._c=0,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5}setAlive(){this.isalive()||_SCORE.set(this.getscore)}map_collition(){let e=this,_=e.getEnemyCenterPosition(),t=_MAP.getMapX(_._x),s=_MAP.getMapY(_._y);_MAP.isMapCollision(t,s)&&e.init()}showCollapes(){let e=this,_=e.getEnemyCenterPosition();if(e._status>0)return;if(e._isbroken)return;let t=0,s=_ENEMIES;for(let e=0;e<s.length;e++)ENEMY_frame_2.prototype.isPrototypeOf(s[e])&&t++;let i=t>20?1:2;for(let t=0;t<i;t++)_ENEMIES.push(new ENEMY_frame_2({x:_._x,y:_._y,direct:e.direct}));e._isbroken=!0,_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision1),e.init()}shot(){}move_standby(){this.x>=_CANVAS.width||(this.rad=Math.atan2(700*Math.random()-100-this.y,0-this.x),this.deg=this.rad/Math.PI*180,this.speedx=Math.cos(this.rad),this.speedy=Math.sin(this.rad),this._standby=!1)}moveSet(){this.map_collition(),this.set_imgPos(),this.x-=this.speedx*this.speed,this.y-=this.speedy*this.speed}}class ENEMY_frame_2 extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_frame_small.obj,x:e.x,y:e.y,direct:e.direct,width:e.width||35,imgPos:e.imgPos||[0,35]});this.speed=-1*(4*Math.random()+4),this.deg=110*Math.random()+125,this.speedx=Math.cos(this.deg*Math.PI/180),this.speedy=Math.sin(this.deg*Math.PI/180),this._isbroken=!1,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this._standby=!1}shot(){}setDrawImage(){this.isMove()&&_GAME._setDrawImage({img:this.img,x:this.x,y:this.y,deg:this.deg+180,width:this.width,imgPosx:this.get_imgPos()})}showCollapes(){let e=this,_=e.getEnemyCenterPosition();if(e._status>0)return;if(e._isbroken)return;let t=0,s=_ENEMIES;for(let e=0;e<s.length;e++)ENEMY_frame_3.prototype.isPrototypeOf(s[e])&&t++;let i=t>30?0:2;for(let t=0;t<i;t++)_ENEMIES.push(new ENEMY_frame_3({x:_._x,y:_._y,direct:e.direct}));e._isbroken=!0,_GAME._setPlay(_CANVAS_AUDIOS.enemy_collision1),e.init()}moveSet(){this.set_imgPos(),this.x-=this.speedx*this.speed,this.y-=this.speedy*this.speed}}class ENEMY_frame_3 extends ENEMY_frame_2{constructor(e){super({img:_CANVAS_IMGS.enemy_frame_mini.obj,x:e.x,y:e.y,direct:e.direct,width:30,imgPos:[0,30]});this._isbroken=!1,this.shotColMap=["5,5,"+(this.width-5)+","+(this.height-5)],this.is_able_collision=!1,this.is_ignore_collision=Math.random()>.05,this._standby=!1}}class ENEMY_cell_core extends GameObject_ENEMY{constructor(e){super({img:_CANVAS_IMGS.enemy_cell_core.obj,x:e.x,y:e.y,aniItv:20});this._status=10,this.getscore=500,this.audio_alive=_CANVAS_AUDIOS.enemy_collision7,this._collision_type="t9",this.rad=0,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.5,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this.hands_up_rad=[],this.hands_up=[],this.hands_up_count={c:0,max:parseInt(300*Math.random())+100},this.hands_down_rad=[],this.hands_down=[],this.hands_down_count={c:0,max:parseInt(300*Math.random())+100},this.hands_distance=12}set_hands_target(e,_){let t=_PLAYERS_MAIN.getPlayerCenterPosition();return e%_>0&&e%_<parseInt(_/2)?t:{_x:this.x+200,_y:this.y+100}}set_hands_rad(e,_,t,s){let i=s,a=t.getEnemyCenterPosition(),n=parseInt(100*Math.random())-50,o=i._x+n-a._x,r=i._y+n-a._y,l=(e=>{let _=Math.random()/50;return(e=(e=t.flag?Math.cos(e)>0?t.rad+_:t.rad-_:Math.cos(e)>0?t.rad-_:t.rad+_)<0?2*Math.PI+e:e)>=t.rad_min&&e<=t.rad_max?e:t.rad})(Math.atan2(r,o));t.rad=l,e.unshift(l)}set_hands_pos(e,_,t,s,i){_.x=(s||0)+t.x+Math.cos(e)*this.hands_distance,_.y=(i||0)+t.y+Math.sin(e)*this.hands_distance}is_hands_up_status(){let e=this;for(let _=0;_<e.hands_up.length;_++)if(ENEMY_cell_hand_2.prototype.isPrototypeOf(e.hands_up[_]))return e.hands_up[_].isalive()}is_hands_down_status(){let e=this;for(let _=0;_<e.hands_down.length;_++)if(ENEMY_cell_hand_2.prototype.isPrototypeOf(e.hands_down[_]))return e.hands_down[_].isalive()}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1},{left:200})}showCollapes(){let e=this,_=e.getEnemyCenterPosition();e._isshow=!1;for(let _=0;_<e.hands_up.length;_++)e.hands_up[_].showCollapes();for(let _=0;_<e.hands_down.length;_++)e.hands_down[_].showCollapes();_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(_._x,_._y,e._collision_type)),_GAME._setPlay(e.audio_collision)}move_standby(){let e=this;if(e.x<_CANVAS.width-20){e._standby=!1,e.hands_up=[new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2,rad_min:Math.PI+1.5,rad_max:Math.PI+2,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.2,rad_min:Math.PI+1,rad_max:Math.PI+2.2,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.4,rad_min:Math.PI+.7,rad_max:Math.PI+2.4,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.4,rad_min:Math.PI+.7,rad_max:Math.PI+2.4,flag:!0,ignore_collision:!1}),new ENEMY_cell_hand_2({x:e.x,y:e.y,rad:3*Math.PI/2-.6,rad_min:Math.PI+.5,rad_max:Math.PI+2.6,flag:!0}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-.8,rad_min:Math.PI+.5,rad_max:Math.PI+2.8,flag:!0}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-1,rad_min:Math.PI+.3,rad_max:Math.PI+2.8,flag:!0}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:3*Math.PI/2-1.2,rad_min:Math.PI+.3,rad_max:Math.PI+2.8,flag:!0}),new ENEMY_cell_hand_3({x:e.x,y:e.y,rad:3*Math.PI/2-1.4,rad_min:Math.PI+.3,rad_max:Math.PI+2.6,flag:!0})];for(let _=0;_<e.hands_up.length;_++)_ENEMIES.push(e.hands_up[_]);e.hands_down=[new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-1,rad_min:Math.PI-2,rad_max:Math.PI-1,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-1,rad_min:Math.PI-2.1,rad_max:Math.PI-.9,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.2,rad_max:Math.PI-.9,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.3,rad_max:Math.PI-.6,flag:!1,ignore_collision:!1}),new ENEMY_cell_hand_2({x:e.x,y:e.y,rad:Math.PI-.9,rad_min:Math.PI-2.7,rad_max:Math.PI-.6,flag:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.8,rad_min:Math.PI-2.7,rad_max:Math.PI-.6,flag:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.8,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1}),new ENEMY_cell_hand_1({x:e.x,y:e.y,rad:Math.PI-.7,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1}),new ENEMY_cell_hand_3({x:e.x,y:e.y,rad:Math.PI-.7,rad_min:Math.PI-2.8,rad_max:Math.PI-.1,flag:!1})];for(let _=0;_<e.hands_down.length;_++)_ENEMIES.push(e.hands_down[_])}}shot(){}set_aniPos(){this._c=this._c>=this.ani.length*this.aniItv-1?0:this._c+1}get_aniPos(){return this.ani[parseInt(this._c/this.aniItv)]}setDrawImage(){let e=this;for(let _=0;_<e.hands_up.length;_++)0!==_?(e.set_hands_pos(e.hands_up_rad[_],e.hands_up[_],e.hands_up[_-1]),e.hands_up[_].moveDraw()):(e.set_hands_pos(e.hands_up_rad[_],e.hands_up[_],e,e.img.width/2-e.hands_up[_].img.width/2,10),e.hands_up[_].moveDraw());for(let _=0;_<e.hands_down.length;_++)0!==_?(e.set_hands_pos(e.hands_down_rad[_],e.hands_down[_],e.hands_down[_-1]),e.hands_down[_].moveDraw()):(e.set_hands_pos(e.hands_down_rad[_],e.hands_down[_],e,e.img.width/2-e.hands_down[_].img.width/2,e.img.height-30),e.hands_down[_].moveDraw());const _=e.getEnemyCenterPosition();_GAME._setDrawImage({img:e.img,x:_._x,y:_._y,scale:e.get_aniPos().scale*(e._status/10>.7?e._status/10:.7)})}moveSet(){let e=this;e.set_aniPos();const _=e.getEnemyCenterPosition(),t=_PLAYERS_MAIN.getPlayerCenterPosition();let s=_GAME.getRad({x:t._x,y:t._y},{x:_._x,y:_._y});if(e.y+=Math.sin(s)*e.speed,!e.is_hands_up_status()&&0!==e.hands_up.length){for(let _=0;_<e.hands_up.length;_++)e.hands_up[_].showCollapes();e.hands_up=[]}if(!e.is_hands_down_status()&&0!==e.hands_down.length){for(let _=0;_<e.hands_down.length;_++)e.hands_down[_].showCollapes();e.hands_down=[]}e.hands_up_rad=[],e.hands_up_count.c=e.hands_up_count.c>e.hands_up_count.max?0:e.hands_up_count.c+1;let i=e.set_hands_target(e.hands_up_count.c,e.hands_up_count.max);for(let _=e.hands_up.length-1;_>=0;_--){if(void 0===e.hands_up[_-1]){e.set_hands_rad(e.hands_up_rad,e,e.hands_up[_],i);break}e.set_hands_rad(e.hands_up_rad,e.hands_up[_-1],e.hands_up[_],i),ENEMY_cell_hand_3.prototype.isPrototypeOf(e.hands_up[_])&&e.hands_up[_].shot()}e.hands_down_rad=[],e.hands_down_count.c=e.hands_down_count.c>e.hands_down_count.max?0:e.hands_down_count.c+1;let a=e.set_hands_target(e.hands_down_count.c,e.hands_down_count.max);for(let _=e.hands_down.length-1;_>=0;_--){if(void 0===e.hands_down[_-1]){e.set_hands_rad(e.hands_down_rad,e,e.hands_down[_],a);break}e.set_hands_rad(e.hands_down_rad,e.hands_down[_-1],e.hands_down[_],a),ENEMY_cell_hand_3.prototype.isPrototypeOf(e.hands_down[_])&&e.hands_down[_].shot()}let n=e.get_aniPos(),o=e.img.width/2-e.img.width*n.scale/2+","+(e.img.height/2-e.img.height*n.scale/2)+","+e.img.width*n.scale+","+e.img.height*n.scale;e.shotColMap=[o]}}class ENEMY_cell_hand_1 extends GameObject_ENEMY{constructor(e){super({img:e.img||_CANVAS_IMGS.enemy_cell_hand_1.obj,x:e.x,y:e.y});this._initx=e.x||0,this._inity=e.y||0,this.rad=e.rad,this.rad_min=e.rad_min||-1,this.rad_max=e.rad_max||-2,this.flag=e.flag||!1,this.is_able_collision=!1,this._collision_type="t2",this.is_ignore_collision=e.ignore_collision||!0,this.ani=[{scale:1},{scale:.95},{scale:.9},{scale:.85},{scale:.9},{scale:.95}],this._c=0}isCanvasOut(){return _GAME.isEnemyCanvasOut(this,{up:!1,down:!1,left:!0,right:!1},{left:200})}showCollapes(){let e=this.getEnemyCenterPosition();_ENEMIES_COLLISIONS.push(new GameObject_ENEMY_COLLISION(e._x,e._y,this._collision_type)),this.init()}shot(){}setDrawImage(){}moveDraw(){this._c=this._c>=20*this.ani.length-1?0:this._c+1;const e=this.getEnemyCenterPosition();_GAME._setDrawImage({img:this.img,x:e._x,y:e._y,scale:this.ani[parseInt(this._c/20)].scale}),this.shot()}move(){this.x=_MAP.getX(this.x),this.y=_MAP.getY(this.y),this.isMove()}}class ENEMY_cell_hand_2 extends ENEMY_cell_hand_1{constructor(e){e.img=_CANVAS_IMGS.enemy_cell_hand_2.obj,super(e);this.is_able_collision=!0,this.audio_alive=_CANVAS_AUDIOS.enemy_collision7,this._status=10,this.is_ignore_collision=!1,this.shotColMap=["-10,-10,"+(this.img.width+10)+","+(this.img.height+10)]}shot(){}}class ENEMY_cell_hand_3 extends ENEMY_cell_hand_1{constructor(e){e.img=_CANVAS_IMGS.enemy_cell_hand_3.obj,super(e)}shot(){if(_GAME.isEnemyCanvasOut(this))return;if(Math.random()>=_DEF_DIFFICULT[_ENEMY_DIFFICULT]._ENEMY_SHOT_RATE)return;let e=this.getEnemyCenterPosition();_ENEMIES_SHOTS.push(new GameObject_ENEMY_SHOT({x:e._x,y:e._y,img:_CANVAS_IMGS.enemy_bullet_cell.obj,imgPos:[0,15],width:15}))}moveDraw(){let e=_PLAYERS_MAIN.getPlayerCenterPosition(),_=this.getEnemyCenterPosition(),t=Math.atan2(_._y-e._y,_._x-e._x);_GAME._setDrawImage({img:this.img,x:_._x,y:_._y,deg:t/Math.PI*180})}}class ENEMY_CELL_A extends ENEMY_a{constructor(e){super({img:_CANVAS_IMGS.enemy_cell_a.obj,x:e.x,y:e.y,direct:e.direct})}}class ENEMY_CELL_B extends ENEMY_a{constructor(e){super({img:_CANVAS_IMGS.enemy_cell_b.obj,x:e.x,y:e.y,direct:e.direct});this.haspc=!0}}class MAP_OBJECT{constructor(e){void 0!==e&&(this.img=e.img,this.imgPos=e.imgPos||[0],this.aniItv=e.aniItv||1,this.width=e.width||this.img.width,this.height=e.height||this.img.height,this.dir=e.dir||1,this.x=e.x||0,this.y=e.y||0,this._s=e.s||"1",this._c=0,this.is_able_collision=!1,this._DEF_SHOTSTATUS={_SHOTTYPE_NORMAL:1,_SHOTTYPE_MISSILE:2,_SHOTTYPE_DOUBLE:1,_SHOTTYPE_RIPPLE_LASER:1.5,_SHOTTYPE_LASER:1},this._c=0)}getImg(){return this.img.obj}set_imgPos(){this._c=this._c>=this.imgPos.length*this.aniItv-1?0:this._c+1}get_imgPos(){return this.imgPos[parseInt(this._c/this.aniItv)]}collision(){}moveDraw(e,_){this.set_imgPos(),_GAME._setDrawImage({img:this.img,imgPosx:this.get_imgPos(),x:e,y:_,width:this.width,height:this.height,basePoint:1})}}class MAP_CUBE_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cube_A.obj,width:25,height:25});this._s="1"}}class MAP_CRISTAL extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.enemy_p_1.obj,width:100,height:100});this._s="0111,1111,0111,0111"}}class MAP_CRISTAL_UP extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cristal_up.obj,width:100,height:50});this._s="1111,1111"}}class MAP_CRISTAL_DOWN extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cristal_down.obj,width:100,height:50});this._s="1111,1111"}}class MAP_MOAI_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_moai_A.obj,width:250,height:100});this._s="0000000000,1111111111,1111111111,0000000000"}}class MAP_MOAI_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_moai_B.obj,width:250,height:100});this._s="0000000000,1111111111,1111111111,0000000000"}}class MAP_VOLCANO_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_A.obj,width:225,height:75});this._s="111111111,111111111,000000000"}}class MAP_VOLCANO_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_B.obj,width:225,height:75});this._s="111111111,111111111,000000000"}}class MAP_VOLCANO_C extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_C.obj,width:225,height:75});this._s="000000000,111111111,111111111"}}class MAP_VOLCANO_D extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_D.obj,width:225,height:75});this._s="000000000,111111111,111111111"}}class MAP_VOLCANO_F extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_F.obj,width:225,height:150});this._s="000110000,000110000,001111000,011111100,011111110,111111111"}}class MAP_VOLCANO_G extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_G.obj,width:225,height:150});this._s="111111110,011111110,011111100,001111000,000110000,000110000"}}class MAP_VOLCANO_H extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_H.obj,width:500,height:325});this._s="00000000000000000000,00000111111111111110,00000111111110000000,00000000011110000000,00000000001100000000,00000000001100000000,00000000001100000000,11111111111111111100,01111111111111111100,00000000011000000000,00000000011000000000,00000000111000000000,00000001111110000000"}}class MAP_VOLCANO_I extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_I.obj,width:375,height:250});this._s="000000010000000,000000010000000,000000111000000,000001111100000,000011111110000,000111111111000,001111111111100,001111111111100,011111111111110,111111111111111"}}class MAP_VOLCANO_J extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_J.obj,width:375,height:250});this._s="111111111111111,011111111111110,001111111111100,001111111111100,000111111111000,000011111110000,000001111100000,000000111000000,000000010000000,000000010000000"}}class MAP_VOLCANO_K extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_K.obj,width:75,height:25});this._s="010"}}class MAP_VOLCANO_L extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_L.obj,width:75,height:25});this._s="010"}}class MAP_VOLCANO_M extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_M.obj,width:100,height:50});this._s="0111,1111"}}class MAP_VOLCANO_N extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_N.obj,width:100,height:50});this._s="1111,0111"}}class MAP_VOLCANO_O extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_O.obj,width:100,height:50});this._s="1111,1110"}}class MAP_VOLCANO_P extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_volcano_P.obj,width:100,height:50});this._s="1110,1111"}}class MAP_FRAME_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_A.obj,imgPos:[0,200,400,600,800],aniItv:10,width:200,height:75});this._s="000000000,11111111,11111111"}}class MAP_FRAME_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_B.obj,imgPos:[0,200,400,600,800],aniItv:10,width:200,height:75});this._s="11111111,11111111,00000000"}}class MAP_FRAME_C extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_C.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="00,01,11",this.direct=_DEF_DIR._LD}}class MAP_FRAME_D extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_D.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="11,01,00",this.direct=_DEF_DIR._LU}}class MAP_FRAME_E extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_E.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="00,10,11",this.direct=_DEF_DIR._LU}}class MAP_FRAME_F extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_frame_F.obj,imgPos:[0,50,100,150],aniItv:10,width:50,height:75});this._s="11,10,00",this.direct=_DEF_DIR._LU}}class MAP_CELL_A extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_A.obj,imgPos:[0,475,950],aniItv:20,width:475,height:100});this._s="0000000000000000000,0011111111111111100,0111111111111111110,1111111111111111111"}}class MAP_CELL_B extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_B.obj,imgPos:[0,475,950],aniItv:20,width:475,height:100});this._s="1111111111111111111,0111111111111111110,0011111111111111100,0000000000000000000"}}class MAP_CELL_C extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_C.obj,imgPos:[0,125,250],aniItv:20,width:125,height:100});this._s="00100,01110,01110,11111"}}class MAP_CELL_D extends MAP_OBJECT{constructor(){super({img:_CANVAS_IMGS.map_cell_D.obj,imgPos:[0,125,250],aniItv:20,width:125,height:100});this._s="11111,01110,01110,00100"}}class MAP_CELL_VWYZ extends MAP_OBJECT{constructor(e){super({img:e.img,imgPos:[0,300,600],aniItv:20,width:300,height:50});this._s=e._s}}class MAP_CELL_V extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_V.obj,_s:"001111111100,111111111111"})}}class MAP_CELL_W extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_W.obj,_s:"111111111111,001111111100"})}}class MAP_CELL_Y extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_Y.obj,_s:"111111111111,111111111111"})}}class MAP_CELL_Z extends MAP_CELL_VWYZ{constructor(){super({img:_CANVAS_IMGS.map_cell_Z.obj,_s:"111111111111,111111111111"})}}class MAP_CELL_WALL extends MAP_OBJECT{constructor(e){super({img:_CANVAS_IMGS.map_cell_wall.obj,imgPos:e.imgPos||[0],width:25,height:25});this._s="1",this.is_able_collision=!0,this._status=1,this._status_count=0,this.audio_collision=_CANVAS_AUDIOS.map_cell_wall,this._DEF_SHOTSTATUS._SHOTTYPE_LASER=.2}collision(e){this._status-=this._DEF_SHOTSTATUS[e]||1}moveDraw(e,_){let t=this;if(t._status_count>=200&&(t._status_count=0,t._status=1,_MAP.set_mapdef_col(_MAP.getMapX(e),_MAP.getMapY(_),"1")),t._status<=0)return 0===t._status_count&&_GAME._setPlay(t.audio_collision),_MAP.set_mapdef_col(_MAP.getMapX(e),_MAP.getMapY(_),"0"),void t._status_count++;_GAME._setDrawImage({img:t.img,x:e,y:_,width:t.width,imgPosx:t.imgPos[0],basePoint:1})}}class MAP_CELL_G extends MAP_CELL_WALL{constructor(){super({imgPos:[0]})}}class MAP_CELL_H extends MAP_CELL_WALL{constructor(){super({imgPos:[25]})}}class MAP_CELL_I extends MAP_CELL_WALL{constructor(){super({imgPos:[50]})}}class MAP_CELL_J extends MAP_CELL_WALL{constructor(){super({imgPos:[75]})}}class MAP_CELL_K extends MAP_CELL_WALL{constructor(){super({imgPos:[100]})}}class MAP_CELL_L extends MAP_CELL_WALL{constructor(){super({imgPos:[125]})}}class MAP_CELL_M extends MAP_CELL_WALL{constructor(){super({imgPos:[150]})}}class MAP_CELL_N extends MAP_CELL_WALL{constructor(){super({imgPos:[175]})}}class MAP_CELL_O extends MAP_CELL_WALL{constructor(){super({imgPos:[200]})}}let _MAPDEFS="",_MAPDEF="",_MAP_PETTERN=3,_BACKGROUND_SPEED=0,_MAP_SCROLL_POSITION_X=0,_MAP_SCROLL_POSITION_Y=0;const _MAP_ENEMIES={_setDir:function(e,_){let t=_MAP.isMapCollision(e,_-1)?_DEF_DIR._U:_DEF_DIR._D;return t=_MAP.isMapCollision(e,_+1)?_DEF_DIR._D:_DEF_DIR._U},_ENEMIES:{a:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_a({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_a({direct:null})},b:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_b({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_b({direct:null})},c:{_gamestart:(e,_,t)=>{let s=_MAP.isMapCollision(_MAP.getMapX(e),_MAP.getMapY(_)-1)?_DEF_DIR._U:_DEF_DIR._D;s=_MAP.isMapCollision(_MAP.getMapX(e),_MAP.getMapY(_)+2)?_DEF_DIR._D:_DEF_DIR._U,_ENEMIES.push(new ENEMY_c({x:e,y:_,direct:s}))},_st:"",_getObj:()=>new ENEMY_c({direct:null})},d:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_d({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_e({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},f:{_gamestart:(e,_,t)=>{t=_<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_f({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_f({direct:null})},g:{_gamestart:(e,_,t)=>{t=_<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_g({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_g({direct:null})},m:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_m({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_m({direct:null})},n:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_n({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_n({direct:null})},o:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_o({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_o({direct:null})},p:{_gamestart:(e,_,t)=>{let s=new ENEMY_p({x:e,y:_,direct:_DEF_DIR._D});_ENEMIES.push(s)},_st:"",_getObj:()=>new ENEMY_p({direct:null})},z:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_FAN({width:25,height:25,direct:null})}}},_MAP_ENEMIES_BOSS={enemy_cristalcore:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE({x:700,y:800})}},enemy_bigcore:{_f:function(){return new ENEMY_BOSS_BIGCORE({x:_CANVAS.width+200,y:200})}},enemy_cristalcore_pt2:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE_PT2({x:700,y:800})}},enemy_bigcore2:{_f:function(){return new ENEMY_BOSS_BIGCORE2({x:_CANVAS.width+200,y:200})}},enemy_frame:{_f:function(){return new ENEMY_BOSS_FRAME({x:1e3,y:200})}},enemy_cell:{_f:function(){return new ENEMY_BOSS_CELL({x:_CANVAS.width+200,y:200})}},enemy_moai:{_f:function(){return new ENEMY_BOSS_MOAI({x:_CANVAS.width+200,y:200})}},enemy_death:{_f:function(){return new ENEMY_BOSS_DEATH({x:_CANVAS.width+200,y:200})}}},_MAP_THEME={_THEME1:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_CRISTAL},objs:{},_getObj:()=>new MAP_CRISTAL},B:{_gamestart:function(e){this.objs[e]=new MAP_CRISTAL_UP},objs:{},_getObj:()=>new MAP_CRISTAL_UP},C:{_gamestart:function(e){this.objs[e]=new MAP_CRISTAL_DOWN},objs:{},_getObj:()=>new MAP_CRISTAL_DOWN}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME2:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_A},objs:{},_getObj:()=>new MAP_VOLCANO_A},B:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_B},objs:{},_getObj:()=>new MAP_VOLCANO_B},C:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_C},objs:{},_getObj:()=>new MAP_VOLCANO_C},D:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_D},objs:{},_getObj:()=>new MAP_VOLCANO_D},F:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_F},objs:{},_getObj:()=>new MAP_VOLCANO_F},G:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_G},objs:{},_getObj:()=>new MAP_VOLCANO_G},H:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_H},objs:{},_getObj:()=>new MAP_VOLCANO_H},I:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_I},objs:{},_getObj:()=>new MAP_VOLCANO_I},J:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_J},objs:{},_getObj:()=>new MAP_VOLCANO_J},K:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_K},objs:{},_getObj:()=>new MAP_VOLCANO_K},L:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_L},objs:{},_getObj:()=>new MAP_VOLCANO_L},M:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_M},objs:{},_getObj:()=>new MAP_VOLCANO_M},N:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_N},objs:{},_getObj:()=>new MAP_VOLCANO_N},O:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_O},objs:{},_getObj:()=>new MAP_VOLCANO_O},P:{_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_P},objs:{},_getObj:()=>new MAP_VOLCANO_P}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME3:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_CUBE_A},objs:{},_getObj:()=>new MAP_CUBE_A}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME5:{_map:{B:{_gamestart:function(e){this.objs[e]=new MAP_MOAI_A},objs:{},_getObj:()=>new MAP_MOAI_A},C:{_gamestart:function(e){this.objs[e]=new MAP_MOAI_B},objs:{},_getObj:()=>new MAP_MOAI_B}},_enemies:{a:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_a({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_a({direct:null})},b:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_b({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_b({direct:null})},d:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_d({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_e({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},f:{_gamestart:(e,_,t)=>{t=_<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_f({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_f({})},g:{_gamestart:(e,_,t)=>{t=_<_CANVAS.height/2?_DEF_DIR._U:_DEF_DIR._D,_ENEMIES.push(new ENEMY_g({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_g({})},m:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_m({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_m({})},l:{_gamestart:(e,_,t)=>{let s=new ENEMY_q({x:e,y:_,direct:_DEF_DIR._U});_ENEMIES.push(s)},_st:"transform:scale(1,-1);",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._U})},n:{_gamestart:(e,_,t)=>{let s=new ENEMY_q({x:e,y:_,direct:_DEF_DIR._D});_ENEMIES.push(s)},_st:"",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._D})},o:{_gamestart:(e,_,t)=>{let s=new ENEMY_r({x:e,y:_,direct:_DEF_DIR._U});_ENEMIES.push(s)},_st:"transform:scale(1,-1);",_getObj:()=>new ENEMY_r({x:0,y:0,direct:_DEF_DIR._U})},p:{_gamestart:(e,_,t)=>{let s=new ENEMY_r({x:e,y:_,direct:_DEF_DIR._D});_ENEMIES.push(s)},_st:"",_getObj:()=>new ENEMY_r({x:0,y:0,direct:_DEF_DIR._D})},q:{_gamestart:(e,_,t)=>{let s=new ENEMY_q({x:e,y:_,direct:_DEF_DIR._LD});_ENEMIES.push(s)},_st:"transform:scale(-1,1);",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._LD})},r:{_gamestart:(e,_,t)=>{let s=new ENEMY_q({x:e,y:_,direct:_DEF_DIR._LU});_ENEMIES.push(s)},_st:"transform:scale(-1,-1);",_getObj:()=>new ENEMY_q({x:0,y:0,direct:_DEF_DIR._LU})},z:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_FAN({direct:null})}}},_THEME6:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_A},objs:{},_getObj:()=>new MAP_FRAME_A},B:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_B},objs:{},_getObj:()=>new MAP_FRAME_B},C:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_C},objs:{},_getObj:()=>new MAP_FRAME_C},D:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_D},objs:{},_getObj:()=>new MAP_FRAME_D},E:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_E},objs:{},_getObj:()=>new MAP_FRAME_E},F:{_gamestart:function(e){this.objs[e]=new MAP_FRAME_F},objs:{},_getObj:()=>new MAP_FRAME_F}},_enemies:{a:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_frame_1({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_frame_1({})},d:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_d({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_e({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},z:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_FAN({})}}},_THEME7:{_map:{A:{_gamestart:function(e){this.objs[e]=new MAP_CELL_A},objs:{},_getObj:()=>new MAP_CELL_A},B:{_gamestart:function(e){this.objs[e]=new MAP_CELL_B},objs:{},_getObj:()=>new MAP_CELL_B},C:{_gamestart:function(e){this.objs[e]=new MAP_CELL_C},objs:{},_getObj:()=>new MAP_CELL_C},D:{_gamestart:function(e){this.objs[e]=new MAP_CELL_D},objs:{},_getObj:()=>new MAP_CELL_D},G:{_gamestart:function(e){this.objs[e]=new MAP_CELL_G},objs:{},_getObj:()=>new MAP_CELL_G},H:{_gamestart:function(e){this.objs[e]=new MAP_CELL_H},objs:{},_getObj:()=>new MAP_CELL_H},I:{_gamestart:function(e){this.objs[e]=new MAP_CELL_I},objs:{},_getObj:()=>new MAP_CELL_I},J:{_gamestart:function(e){this.objs[e]=new MAP_CELL_J},objs:{},_getObj:()=>new MAP_CELL_J},K:{_gamestart:function(e){this.objs[e]=new MAP_CELL_K},objs:{},_getObj:()=>new MAP_CELL_K},L:{_gamestart:function(e){this.objs[e]=new MAP_CELL_L},objs:{},_getObj:()=>new MAP_CELL_L},M:{_gamestart:function(e){this.objs[e]=new MAP_CELL_M},objs:{},_getObj:()=>new MAP_CELL_M},N:{_gamestart:function(e){this.objs[e]=new MAP_CELL_N},objs:{},_getObj:()=>new MAP_CELL_N},O:{_gamestart:function(e){this.objs[e]=new MAP_CELL_O},objs:{},_getObj:()=>new MAP_CELL_O},V:{_gamestart:function(e){this.objs[e]=new MAP_CELL_V},objs:{},_getObj:()=>new MAP_CELL_V},W:{_gamestart:function(e){this.objs[e]=new MAP_CELL_W},objs:{},_getObj:()=>new MAP_CELL_W},Y:{_gamestart:function(e){this.objs[e]=new MAP_CELL_Y},objs:{},_getObj:()=>new MAP_CELL_Y},Z:{_gamestart:function(e){this.objs[e]=new MAP_CELL_Z},objs:{},_getObj:()=>new MAP_CELL_Z}},_enemies:{a:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_cell_core({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_cell_core({})},b:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_CELL_A({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_CELL_A({direct:null})},c:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_CELL_B({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_CELL_B({direct:null})},d:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_d({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_d({direct:null})},e:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_e({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_e({direct:null})},z:{_gamestart:(e,_,t)=>{_ENEMIES.push(new ENEMY_FAN({x:e,y:_,direct:t}))},_st:"",_getObj:()=>new ENEMY_FAN({direct:null})}}}};class GameObject_MAP{constructor(e){this.pt=e||0,this.initx=0,this.inity=0,this.x=this.initx,this.y=this.inity,this.collision=new RegExp("[1A-Z]"),this.collision_enemies=new RegExp("[a-z]","g"),this.collision_map=new RegExp("[A-Z]"),this.collision_map_d=new RegExp("[BD]"),this.t=25,this.mapdef=new Array,this.mapdef_col=new Array,this.map_theme=0,this.map_pettern=0,this.map_difficult=0,this.map_background_speed=0,this.map_backgroundY_speed=0,this.map_infinite=!1,this.map_bgmusic="",this.map_boss="",this.isboss=!1}init(e){_AJAX({url:"./gradius_map.json",f:function(_){_MAPDEFS=_,e()}})}setInifinite(e){this.map_infinite=e}set_stage_map_pattern(e){this.map_pettern=e}set_gamestart(){this.map_backgroundY_speed=0,this.x=parseInt(_MAPDEFS[this.map_pettern]._initx),this.y=this.inity,this.initx=parseInt(_MAPDEFS[this.map_pettern]._initx),this.mapdef=_MAPDEFS[this.map_pettern]._map,this.map_difficult=parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,_ENEMY_DIFFICULT=_ISDEBUG?_ENEMY_DIFFICULT:parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,this.map_background_speed=parseInt(_MAPDEFS[this.map_pettern]._speed),_BACKGROUND_SPEED=parseInt(_MAPDEFS[this.map_pettern]._speed),_MAP_PETTERN=this.map_pettern,this.map_theme=_MAPDEFS[this.map_pettern]._theme,this.map_infinite="true"===_MAPDEFS[this.map_pettern]._map_infinite,this.map_bgmusic=_MAPDEFS[this.map_pettern]._bgmusic,this.map_boss=_MAPDEFS[this.map_pettern]._boss,this.isboss=!1,this.set_gamestart_mapdef_col(),this.set_gamestart_map_theme_objs()}set_gamestart_map_theme_objs(){let e=this;for(let _=0;_<e.mapdef.length;_++){let t=e.mapdef[_];for(let s=0;s<t.length;s++)if(e.isEnemiesBit(t[s])){let i=_MAP_ENEMIES._setDir(s,_);_MAP_THEME[e.map_theme]._enemies[t[s]]._gamestart(e.x+s*e.t,_*e.t,i)}else e.isCollisionBit(t[s])&&_MAP_THEME[e.map_theme]._map[t[s]]._gamestart(s+","+_)}}set_gamestart_mapdef_col(){let e=this;Object.assign(e.mapdef_col,e.mapdef);for(let _=0;_<e.mapdef_col.length;_++)e.mapdef_col[_]=e.mapdef_col[_].replace(/[a-zA-Z]/gi,"0");for(let s=0;s<e.mapdef.length;s++){let i=e.mapdef[s];for(let a=0;a<i.length;a++){if(null===i[a].match(/[A-Za-z]/))continue;let n=e.isEnemiesBit(i[a])?_MAP_THEME[e.map_theme]._enemies[i[a]]._getObj():_MAP_THEME[e.map_theme]._map[i[a]]._getObj();void 0===n&&console.log("テーマ:"+e.map_theme+"に対して "+i[a]+"の定義がありません。");let o=n._s.split(",");for(let n=0;n<o.length;n++){let r=e.mapdef_col[s+n],l=e.mapdef[s+n];e.mapdef_col[s+n]=r.substr(0,a)+(l.substr(a,o[n].length),_=r.substr(a,o[n].length),t=o[n],e.setCollisionBit(t,_))+r.substr(a+o[n].length,i.length)}}}var _,t}set_mapdef_col(e,_,t){let s=this;if(void 0===e||void 0===_||void 0===t)return;let i=t.split(",");for(let t=0;t<i.length;t++){let a=s.mapdef_col[_+t];s.mapdef_col[_+t]=a.substr(0,e)+i[t]+a.substr(e+i[t].length)}}getX(e){return e+-1*_BACKGROUND_SPEED}getY(e){return this.map_infinite?e-_MAP.map_backgroundY_speed<-250?750+(250+e-_MAP.map_backgroundY_speed):e-_MAP.map_backgroundY_speed>750?-250-(750-e+_MAP.map_backgroundY_speed):(e-_MAP.map_backgroundY_speed)%1e3:e}getShotY(e){return e-_MAP.map_backgroundY_speed}setCollisionBit(e,_){let t="";for(let s=0;s<e.length;s++)"0"!==e[s]?t+="1":t+=_[s];return t}getCollisionFlag(){return this.collision}setBackGroundSpeedY(e){this.map_backgroundY_speed=e}getBackGroundSpeed(){return this.map_background_speed}getBackGroundSpeedY(){return this.map_backgroundY_speed}get_stage_map_pattern(e){return this.map_pettern}getMapXToPx(e){return e*this.t+this.initx-_MAP_SCROLL_POSITION_X}getMapYToPx(e){return e*this.t}getMapX(e){return Math.floor((e+_MAP_SCROLL_POSITION_X-this.initx)/this.t)}getMapY(e,_){return!0===_&&(console.log("_y:"+e),console.log("_MAP_SCROLL_POSITION_Y:"+_MAP_SCROLL_POSITION_Y)),Math.floor((e+_MAP_SCROLL_POSITION_Y)%1e3/this.t)}isCollisionBit(e){return null!==e.match(this.collision)}isEnemiesBit(e){return null!==e.match(this.collision_enemies)}isMapDouble(e){return null!==e.match(this.collision_map_d)}isMapBefore(e,_){return e<0}isMapLastSide(e,_){return void 0!==this.mapdef[_]&&(void 0===this.mapdef[_][e]||e===this.mapdef[_].length-1)}isMapOver(e,_){return void 0!==this.mapdef[_]&&(void 0===this.mapdef[_][e]||e>this.mapdef[_].length-1)}isMapCollision(e,_){return void 0!==this.mapdef_col[_]&&(void 0!==this.mapdef_col[_][e]&&!!this.isCollisionBit(this.mapdef_col[_][e]))}setPlayersShotAbleCollision(e,_,t){let s=_MAP_THEME[this.map_theme]._map;if(void 0===s)return;let i=this.mapdef[_][e];if(void 0===s[i])return;let a=s[i].objs[e+","+_];void 0!==a&&a.is_able_collision&&a.collision(t)}isPlayersShotCollision(){for(let e=0;e<_PLAYERS_SHOTS[_SHOTTYPE].length;e++){let _=_PLAYERS_SHOTS[_SHOTTYPE][e];for(let e=0;e<_.shots.length;e++){let t=_.shots[e];t._shot_alive&&_.map_collition(t)}}for(let e=0;e<_PLAYERS_MISSILE.length;e++){let _=_PLAYERS_MISSILE[e];if(_.player.isalive())for(let e=0;e<_.shots.length;e++){let t=_.shots[e];t._shot_alive&&(t._c>0||_.map_collition(t))}}}show(){}showMapForStageselect(e){let _=this;if(null==e)return;let t=e._map.length;for(let s=0;s<(t>20?20:t);s++){let t=e._map[s].length;for(let i=0;i<(t>40?40:t);i++){let t=e._map[s][i+100];if(void 0!==t&&"0"!==t)if(null!==t.match(_.collision_enemies)){let _=_MAP_THEME[e._theme]._enemies[t]._getObj();_CONTEXT.save();let a=null===_.direct?_MAP_ENEMIES._setDir(i+100,s):_.direct,n=0+10*i,o=130+10*s,r=_.width/2.5,l=_.height/2.5;a===_DEF_DIR._U&&_CONTEXT.setTransform(1,0,0,-1,0,2*o+l),a===_DEF_DIR._LU&&_CONTEXT.setTransform(-1,0,0,-1,2*n+r,2*o+l),a===_DEF_DIR._LD&&_CONTEXT.setTransform(-1,0,0,1,2*n+r,0),_CONTEXT.translate(0+10*i,130+10*s),_CONTEXT.scale(.25,.25),_CONTEXT.drawImage(_.img,_.imgPos[0],0,_.width,_.height,0,0,1.6*_.width,1.6*_.height),_CONTEXT.restore()}else{let _=_MAP_THEME[e._theme]._map[t]._getObj();_CONTEXT.save(),_CONTEXT.translate(0+10*i,130+10*s),_CONTEXT.scale(.25,.25),_CONTEXT.drawImage(_.img,_.imgPos[0],0,_.width,_.height,0,0,1.6*_.width,1.6*_.height),_CONTEXT.restore()}}}_CONTEXT.fillStyle="rgba(0,0,0,1)",_CONTEXT.fillRect(0,130,50,500),_CONTEXT.fillRect(350,130,500,500),_CONTEXT.fillRect(50,330,500,500),_CONTEXT.beginPath(),_CONTEXT.lineWidth=1,_CONTEXT.strokeStyle="rgba(255,255,255,1)",_CONTEXT.fillStyle="rgba(255,255,255,1)",_CONTEXT.strokeRect(50,130,300,200)}map_draw(){let e=this;for(let _=0;_<e.mapdef.length;_++)for(let t=0;t<e.mapdef[_].length;t++){let s=e.mapdef[_][t];if(!e.isCollisionBit(s))continue;if(e.x+t*e.t<-500||e.x+t*e.t>_CANVAS.width+100)continue;let i=_MAP_THEME[e.map_theme]._map[s];i.objs[t+","+_].moveDraw(e.x+t*e.t,e.y+_*e.t),e.map_infinite&&i.objs[t+","+_].moveDraw(e.x+t*e.t,e.y+_*e.t+(e.y>0?-1e3:1e3))}}set_mapdef_col_clear(){let e=this;for(let _=0;_<e.mapdef_col.length;_++){let t=e.mapdef_col[_];e.mapdef_col[_]=t.replace(/1/gi,"0")}}set_scroll_on_x(){_BACKGROUND_SPEED=this.map_background_speed}set_scroll_off_x(){_BACKGROUND_SPEED=0}move(){let e=this;_MAP_SCROLL_POSITION_X+_CANVAS.width>e.mapdef[0].length*e.t+e.initx&&(e.isboss=!0),_MAP_SCROLL_POSITION_X-100>e.mapdef[0].length*e.t+e.initx&&(_BACKGROUND_SPEED=0),e.x+=-1*_BACKGROUND_SPEED,_MAP_SCROLL_POSITION_X+=_BACKGROUND_SPEED,e.y=e.getY(e.y),_MAP_SCROLL_POSITION_Y=function(){let _=_MAP_SCROLL_POSITION_Y+e.map_backgroundY_speed;return _<0?(1e3+_)%1e3:_%1e3}()}}_MAP=new GameObject_MAP;let $_pb=null,$_ab=null,$_mp=null,$_mn=null,$_bm=null;_MAP_PETTERN=0;const _DATAAPI={_data_api:"",_blog_id:0,_url:"",_init_config:()=>{_AJAX({url:"./gradius_editing_stage_config.json",f:_DATAAPI._init})},_init:function(e){let _=_DATAAPI;_._blog_id=parseInt(e.blog_id),_._url=e.url,_._data_api=new MT.DataAPI({baseUrl:_._url,clientId:"api11entries"}),_._data_api.getToken(e=>e.error?(401===e.error.code&&(console.log("reload after 401 error occuered in updating."),location.href=_._data_api.getAuthorizationUrl(location.href)),!1):e.accessToken?void _GAME_STAGEEDIT._init_images(_CANVAS_IMGS,_GAME_STAGEEDIT._init):(alert("An accessToken error occurred."),void(location.href=_._data_api.getAuthorizationUrl(location.href))))},_set_entryupdate:function(e){let _=this;_._data_api.updateEntry(_._blog_id,e._eid,e,function(t){if(t.error)return alert("エントリ更新に失敗しました。"),void(401===t.error.code&&(location.href=_._data_api.getAuthorizationUrl(location.href)));alert("エントリ更新しました。"),_MAP.init(function(){_MAP_PETTERN=function(){for(let _=0;_<_MAPDEFS.length;_++)if(_MAPDEFS[_]._eid===e._eid)return _}(),_GAME_STAGEEDIT._setData(_MAP_PETTERN);const _=document.querySelectorAll("#area_parts .parts_block");for(var t=0;t<_.length;t++)_[t].setAttribute("draggable",!0),_[t].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),_[t].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1);const s=document.querySelectorAll('.form_group .col_r input[type="range"]');for(t=0;t<s.length;t++)s[t].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),s[t].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();const i=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<i.length;e++)_GAME_STAGEEDIT._setTextToFont(i[e],i[e].innerText,14)})})}},_GAME_STAGEEDIT={_ac:new(window.AudioContext||window.webkitAudioContext),_as:null,_theme:0,_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_setInitMap:function(e){this._theme=e._theme;let _=e._map,t="";for(let s=0;s<_.length;s++){t+='<div class="area_blocks_rows">';for(let i=0;i<_[s].length;i++)t+='<div class="area_block" data-val="'+_[s][i]+'" onmouseover="_GAME_STAGEEDIT_EVENTS._f_as_mouseover(event);" onmouseout="_GAME_STAGEEDIT_EVENTS._f_as_mouseout(event);" ondragenter="_GAME_STAGEEDIT_EVENTS._f_as_dragenter(event);" ondrop="_GAME_STAGEEDIT_EVENTS._f_as_drop(event);">'+function(_){if("0"===_)return"";let t="";if(null!==_.match(_MAP.collision_enemies)){let s=_MAP_THEME[e._theme]._enemies[_]._st,i=_MAP_THEME[e._theme]._enemies[_]._getObj();t='<div class="parts_block" style="width:'+parseInt(.8*i.width)+"px;height:"+parseInt(.8*i.height)+"px;background:url("+i.img.src+") no-repeat;background-size:cover;"+(""!==s?s:"")+"background-position:"+20/i.width*i.imgPos[0]*-1+'px 0px;" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">',t+="</div>"}else if(null!==_.match(_MAP.collision_map)){let s=_MAP_THEME[e._theme]._map[_]._getObj();t='<div class="parts_block" style="width:'+parseInt(.8*s.width)+"px;height:"+parseInt(.8*s.height)+"px;background:url("+s.img.src+") no-repeat;background-size:cover;background-position:"+20/s.width*s.imgPos[0]*-1+'px 0px;" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">',t+="</div>"}return t}(_[s][i])+"</div>\x3c!-- /.area_block --\x3e";t+="</div>\x3c!-- /.area_blocks_rows --\x3e"}document.querySelector(".area_blocks.drop").innerHTML=t},_setAudioInit:function(e,_){let t=this,s=0;for(let i in e){let a=new XMLHttpRequest;a.open("GET",e[i].src,!0),a.responseType="arraybuffer",a.onload=function(){t._ac.decodeAudioData(a.response,t=>{e[i].buf=t,++s>=Object.keys(e).length&&_()},e=>{alert("一部音声読み込みに失敗しました。再度立ち上げなおしてください:"+e)})},a.send()}},_setAudioStop(e){null!==this._as&&(this._as.stop(),this._as=null)},_setAudioPlay(e){if(null!=e&&null===this._as){var _=this._ac.createBufferSource();_.buffer=e.buf,_.loop=!1,_.connect(this._ac.destination),_.start(0),this._as=_}},_setInitPartsBlocksWrapper:function(e){e._map;let _="";for(let[t,s]of Object.entries(_MAP_THEME[e._theme]._enemies)){let e=s._getObj(),i=s._st;_+='<div class="parts_block_wrapper" data-val="'+t+'"><div class="text">enemy '+t+'</div><div class="parts_block" style="width:100px;height:'+parseInt(100*e.height/e.width)+"px;background:url("+e.img.src+") no-repeat;background-size:cover;"+(""!==i?i:"")+"background-position:"+100/e.width*e.imgPos[0]*-1+'px 0px;"></div></div>\x3c!-- /.parts_block_wrapper --\x3e'}document.querySelector(".parts_blocks_wrapper.enemy .parts_blocks").innerHTML=_,_="";for(let[t,s]of Object.entries(_MAP_THEME[e._theme]._map)){let e=s._getObj();_+='<div class="parts_block_wrapper" data-val="'+t+'"><div class="text">MAP '+t+'</div><div class="parts_block" style="width:100px;height:'+parseInt(100*e.height/e.width)+"px;background:url("+e.img.src+") no-repeat;background-size:cover;background-position:"+100/e.width*e.imgPos[0]*-1+'px 0px;"></div></div>\x3c!-- /.parts_block_wrapper --\x3e'}document.querySelector(".parts_blocks_wrapper.map .parts_blocks").innerHTML=_},_clearMap:function(){document.querySelector(".area_blocks.drop").textContent=null},_getTextToFont:function(e){let _="",t=e.children;for(let e=0;e<t.length;e++)_+=t[e];return _},_setTextToFont:function(e,_,t){if(null==e)return;t=t||60;let s="";for(let e=0;e<_.length;e++){if(":"===_[e])continue;if(" "===_[e]){s+='<img src="./images/gradius_spacer.png" width="'+t+'">';continue}s+='<div style="background:url(./images/gradius_font.png) no-repeat;background-size:cover;background-position:'+parseInt(this._txt[_[e].toLowerCase()])*(t/60)*-1+"px 0px;display:inline-block;width:"+t+"px;height:"+t+'px;"></div>'}e.innerHTML=s},_clearData:function(){},_setData:function(e){let _=_MAPDEFS[e];this._setInitMap(_),this._setInitPartsBlocksWrapper(_),document.querySelector('#title input[name="title"]').value=_._title,document.querySelector('#body textarea[name="body"]').value=_._body;const t=document.querySelector("#bgmusic select");for(let e=0;e<t.length;e++)if(t[e].value===_._bgmusic){t[e].selected=!0;break}t.addEventListener("click",function(){_GAME_STAGEEDIT._setAudioStop()});const s=document.querySelector("#boss select");for(let e=0;e<s.length;e++)if(s[e].value===_._boss){s[e].selected=!0;break}const i=document.querySelector('#init input[name="init"]'),a=document.querySelector("#init .col_r .val");i.value=_._initx,a.setAttribute("data-val",_._initx),this._setTextToFont(a,_._initx,20);const n=document.querySelector('#speed input[name="speed"]'),o=document.querySelector("#speed .col_r .val");n.value=_._speed,o.setAttribute("data-val",_._speed),this._setTextToFont(o,_._speed,20);const r=document.querySelector('#difficult input[name="difficult"]'),l=document.querySelector("#difficult .col_r .val");r.value=_._difficult,l.setAttribute("data-val",_._difficult),this._setTextToFont(l,_._difficult,20);const c=document.querySelector('#map_infinite input[name="map_infinite"]'),m=document.querySelector("#map_infinite .col_r .val");c.value="true"===_._map_infinite?"1":"0",m.setAttribute("data-val",_._map_infinite),this._setTextToFont(m,_._map_infinite,20)},setDataForDataApi:function(){let e=function(e){let _="";_+='"_map":[';let t=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<t.length;e++){let s=t[e].children;_+='"';for(let e=0;e<s.length;e++)_+=s[e].getAttribute("data-val");_+=e===t.length-1?'"':'",'}return _+="],",_+='"_theme":"'+e._theme+'",',_+='"_body":"'+document.querySelector('#body textarea[name="body"]').value+'",',_+='"_initx":"'+document.querySelector("#init .col_r .val").getAttribute("data-val")+'",',_+='"_bgmusic":"'+document.querySelector("#bgmusic select").value+'",',_+='"_boss":"'+document.querySelector("#boss select").value+'",',_+='"_speed":"'+document.querySelector("#speed .col_r .val").getAttribute("data-val")+'",',_+='"_difficult":"'+document.querySelector("#difficult .col_r .val").getAttribute("data-val")+'",',_+='"_map_infinite":"'+document.querySelector("#map_infinite .col_r .val").getAttribute("data-val")+'"'}(_MAPDEFS[_MAP_PETTERN]),_={title:document.querySelector('#title input[name="title"]').value,status:"Publish",_eid:_MAPDEFS[_MAP_PETTERN]._eid,body:e};_DATAAPI._set_entryupdate(_)},_setEntryLink:function(){$_mp.classList.remove("off"),$_mn.classList.remove("off"),0===_MAP_PETTERN&&$_mp.classList.add("off"),_MAP_PETTERN>=_MAPDEFS.length-1&&$_mn.classList.add("off")},_setPartsBlockEvent:function(){const e=document.querySelectorAll("#area_parts .parts_block");for(var _=0;_<e.length;_++)e[_].setAttribute("draggable",!0),e[_].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),e[_].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1)},_init_images:function(e,_){let t=0;for(let s in e){let i=e[s];i.obj.src=e[s].src,i.obj.onload=function(){i.obj.width*=i.rate,i.obj.height*=i.rate,++t>=Object.keys(e).length&&_()}}},_init:()=>{const e=_GAME_STAGEEDIT,_=document.querySelector("#bgmusic select");Object.keys(_CANVAS_AUDIOS).forEach(function(e){if(-1!==e.indexOf("bg_type")){var t=document.createElement("option");t.setAttribute("value",e.replace("bg_","")),t.innerHTML=e.replace("bg_",""),_.appendChild(t)}});const t=document.querySelector("#boss select");Object.keys(_MAP_ENEMIES_BOSS).forEach(function(e){var _=document.createElement("option");_.setAttribute("value",e),_.innerHTML=e,t.appendChild(_)}),_MAP.init(()=>{console.log("success"),e._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setPartsBlockEvent();const _=document.querySelectorAll('.form_group .col_r input[type="range"]');for(var t=0;t<_.length;t++)_[t].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),_[t].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();let s=document.querySelectorAll("h1");for(let _=0;_<s.length;_++)e._setTextToFont(s[_],s[_].innerText,40);s=document.querySelectorAll("h2,h3,#map_bts a,#entrylink a,label.col_l,div.col_r label span, #menu_inner a");for(let _=0;_<s.length;_++)e._setTextToFont(s[_],s[_].innerText,20);s=document.querySelectorAll(".parts_block_wrapper .text");for(let _=0;_<s.length;_++)e._setTextToFont(s[_],s[_].innerText,14)})}},_GAME_STAGEEDIT_EVENTS={$_do_area_parts_obj:null,$_start_area_parts_obj:null,$_mouseover_area_parts_obj:null,_e_entrylink_prev:function(e){if(0===_MAP_PETTERN)return;_MAP_PETTERN--,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const _=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<_.length;e++)_GAME_STAGEEDIT._setTextToFont(_[e],_[e].innerText,14);return!1},_e_entrylink_next:function(e){if(_MAP_PETTERN>=_MAPDEFS.length-1)return;_MAP_PETTERN++,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const _=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<_.length;e++)_GAME_STAGEEDIT._setTextToFont(_[e],_[e].innerText,14);return!1},_e_update:function(){return confirm("更新しますか?")?_GAME_STAGEEDIT.setDataForDataApi():console.log("false"),!1},_e_scroll:function(e){const _=document.body,t=document.body.clientHeight,s=document.getElementById("menu").offsetHeight;_.scrollTop+window.innerHeight>t-s/2?_.classList.remove("ismenu"):_.classList.add("ismenu")},_f_fg_range:function(e){let _=e.target.parentNode.previousElementSibling,t="map_infinite"!==e.target.name?e.target.value:"1"===e.target.value?"true":"false";_.setAttribute("data-val",t),_.innerText=t,_GAME_STAGEEDIT._setTextToFont(_,t,20)},_f_map_add:function(e){const _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++){let t=_[e].lastElementChild.cloneNode(!0);_[e].appendChild(t),t.children.length}return e.stopPropagation(),e.preventDefault(),!1},_f_map_remove:function(e){const _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++)_[e].lastElementChild.remove();return e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseover:function(e){return"IMG"===e.target.tagName&&(_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj=e.target,e.target.classList.add("over")),e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseout:function(e){if(null!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj&&void 0!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj)return _GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj.classList.remove("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_dragenter:function(e){return null!==this.$_do_area_parts_obj&&this.$_do_area_parts_obj.classList.remove("over"),this.$_do_area_parts_obj=e.target,this.$_do_area_parts_obj.classList.add("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_drop:function(e){console.log("as_drop");let _=e.dataTransfer.getData("text"),t=e.currentTarget,s=this.$_start_area_parts_obj;if(t.classList.remove("over"),0!==t.childNodes.length&&(t.textContent=null),"move"===e.dataTransfer.effectAllowed)t.appendChild(this.$_start_area_parts_obj);else{let e=s.cloneNode(!0);if(t.appendChild(e),null!==_.match(_MAP.collision_enemies)){let t=_MAP_THEME[_GAME_STAGEEDIT._theme]._enemies[_]._st,s=_MAP_THEME[_GAME_STAGEEDIT._theme]._enemies[_]._getObj();e.setAttribute("style","width:"+parseInt(.8*s.width)+"px;height:"+parseInt(.8*s.height)+"px;background:url("+s.img.src+") no-repeat;background-size:cover;"+(""!==t?t:"")+"background-position:"+20/s.width*s.imgPos[0]*-1+"px 0px;")}if(null!==_.match(_MAP.collision_map)){let t=_MAP_THEME[_GAME_STAGEEDIT._theme]._map[_]._getObj();e.setAttribute("style","width:"+parseInt(.8*t.width)+"px;height:"+parseInt(.8*t.height)+"px;background:url("+t.img.src+") no-repeat;background-size:cover;background-position:"+20/t.width*t.imgPos[0]*-1+"px 0px;")}t.children[0].addEventListener("dragstart",this._f_pb_dragstart,!1)}return t.setAttribute("data-val",_),e.stopPropagation(),e.preventDefault(),!1},_f_i_dragover:function(e){return e.stopPropagation(),e.preventDefault(),!1},_f_i_drop:function(e){return console.log("form_inner drop"),"move"===e.dataTransfer.effectAllowed&&(this.$_start_area_parts_obj.parentNode.textContent=null,!1)},_f_ap_dragstart:function(e){_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),console.log("_f_ap_start")},_f_ap_dragend:function(e){return e.target.parentNode.classList.remove("drag"),e.stopPropagation(),e.preventDefault(),!1},_f_pb_dragstart:function(e){console.log("_f_pb_dragstart"),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),e.currentTarget.parentNode.setAttribute("data-val",0)},_f_bgmusic_play:function(e){let _=document.querySelector("#bgmusic select").value;_GAME_STAGEEDIT._setAudioPlay(_CANVAS_AUDIOS["bg_"+_])},_f_bgmusic_stop:function(e){_GAME_STAGEEDIT._setAudioStop()}};document.addEventListener("scroll",()=>{_GAME_STAGEEDIT_EVENTS._e_scroll()}),window.addEventListener("load",()=>{$_pb=document.getElementsByClassName("parts_block"),$_ab=document.getElementsByClassName("area_block"),$_mp=document.querySelector("#menu .prev"),$_mn=document.querySelector("#menu .next"),$_bm=document.querySelector("#bgmusic"),_AUDIO_CONTEXT=new(window.AudioContext||window.webkitAudioContext),_GAME_STAGEEDIT._setAudioInit(_CANVAS_AUDIOS,_DATAAPI._init_config)});