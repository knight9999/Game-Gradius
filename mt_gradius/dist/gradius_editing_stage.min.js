"use strict";const _CANVAS_IMGS={vicviper:{src:"images/gradius_vicviper.png",rate:1,obj:new Image},vicviper_back:{src:"images/gradius_vicviper_back.png",rate:1,obj:new Image},vicviper_bomb:{src:"images/gradius_vicviper_bomb.png",rate:1,obj:new Image},vicviper_bomb_red:{src:"images/gradius_vicviper_bomb_red.png",rate:1,obj:new Image},option:{src:"images/option.png",rate:.3,obj:new Image},forcefield:{src:"images/gradius_forcefield.png",rate:1,obj:new Image},shield:{src:"images/gradius_shield.png",rate:1,obj:new Image},gradius_missile:{src:"images/gradius_missile.png",rate:1,obj:new Image},shot1:{src:"images/gradius_shot1.png",rate:.4,obj:new Image},shot2:{src:"images/gradius_shot2.png",rate:.4,obj:new Image},shot3:{src:"images/gradius_shot3.png",rate:.4,obj:new Image},shot_laser_col:{src:"images/gradius_shot_laser_col.png",rate:1,obj:new Image},meter:{src:"images/gradius_meter.png",rate:1,obj:new Image},meter_c:{src:"images/gradius_meter_c.png",rate:1,obj:new Image},enemy_a_1:{src:"images/gradius_enemy_a_1.png",rate:.55,obj:new Image},enemy_a_2:{src:"images/gradius_enemy_a_2.png",rate:.55,obj:new Image},enemy_b_1:{src:"images/gradius_enemy_b_1.png",rate:.55,obj:new Image},enemy_b_2:{src:"images/gradius_enemy_b_2.png",rate:.55,obj:new Image},enemy_c_1:{src:"images/gradius_enemy_c_1.png",rate:.4,obj:new Image},enemy_c_2:{src:"images/gradius_enemy_c_2.png",rate:.4,obj:new Image},enemy_c_3:{src:"images/gradius_enemy_c_3.png",rate:.4,obj:new Image},enemy_c_4:{src:"images/gradius_enemy_c_4.png",rate:.4,obj:new Image},enemy_d_1:{src:"images/gradius_enemy_d_1.png",rate:.2,obj:new Image},enemy_d_2:{src:"images/gradius_enemy_d_2.png",rate:.2,obj:new Image},enemy_d_3:{src:"images/gradius_enemy_d_3.png",rate:.2,obj:new Image},enemy_d_4:{src:"images/gradius_enemy_d_4.png",rate:.2,obj:new Image},enemy_e_1:{src:"images/gradius_enemy_e_1.png",rate:.2,obj:new Image},enemy_e_2:{src:"images/gradius_enemy_e_2.png",rate:.2,obj:new Image},enemy_e_3:{src:"images/gradius_enemy_e_3.png",rate:.2,obj:new Image},enemy_e_4:{src:"images/gradius_enemy_e_4.png",rate:.2,obj:new Image},enemy_f_1:{src:"images/gradius_enemy_f_1.png",rate:.4,obj:new Image},enemy_f_2:{src:"images/gradius_enemy_f_2.png",rate:.4,obj:new Image},enemy_f_3:{src:"images/gradius_enemy_f_3.png",rate:.4,obj:new Image},enemy_f_4:{src:"images/gradius_enemy_f_4.png",rate:.4,obj:new Image},enemy_g_1:{src:"images/gradius_enemy_g_1.png",rate:.4,obj:new Image},enemy_g_2:{src:"images/gradius_enemy_g_2.png",rate:.4,obj:new Image},enemy_g_3:{src:"images/gradius_enemy_g_3.png",rate:.4,obj:new Image},enemy_g_4:{src:"images/gradius_enemy_g_4.png",rate:.4,obj:new Image},enemy_m_1:{src:"images/gradius_enemy_m_1.png",rate:.24,obj:new Image},enemy_m_2:{src:"images/gradius_enemy_m_2.png",rate:.24,obj:new Image},enemy_m_3:{src:"images/gradius_enemy_m_3.png",rate:.24,obj:new Image},enemy_m_4:{src:"images/gradius_enemy_m_4.png",rate:.24,obj:new Image},enemy_m_5:{src:"images/gradius_enemy_m_5.png",rate:.24,obj:new Image},enemy_m_6:{src:"images/gradius_enemy_m_6.png",rate:.24,obj:new Image},enemy_m_7:{src:"images/gradius_enemy_m_7.png",rate:.24,obj:new Image},enemy_m_8:{src:"images/gradius_enemy_m_8.png",rate:.24,obj:new Image},enemy_m_11:{src:"images/gradius_enemy_m_11.png",rate:.22,obj:new Image},enemy_m_12:{src:"images/gradius_enemy_m_12.png",rate:.22,obj:new Image},enemy_m_13:{src:"images/gradius_enemy_m_13.png",rate:.22,obj:new Image},enemy_m_14:{src:"images/gradius_enemy_m_14.png",rate:.22,obj:new Image},enemy_m_15:{src:"images/gradius_enemy_m_15.png",rate:.22,obj:new Image},enemy_m_16:{src:"images/gradius_enemy_m_16.png",rate:.22,obj:new Image},enemy_m_17:{src:"images/gradius_enemy_m_17.png",rate:.22,obj:new Image},enemy_o_1:{src:"images/gradius_enemy_o_1.png",rate:.3,obj:new Image},enemy_o_2:{src:"images/gradius_enemy_o_2.png",rate:.3,obj:new Image},enemy_p_1:{src:"images/gradius_enemy_p_1.png",rate:1,obj:new Image},enemy_p_2:{src:"images/gradius_enemy_p_2.png",rate:.3,obj:new Image},enemy_p_3:{src:"images/gradius_enemy_p_3.png",rate:.3,obj:new Image},enemy_p_4:{src:"images/gradius_enemy_p_4.png",rate:.3,obj:new Image},enemy_p_5:{src:"images/gradius_enemy_p_5.png",rate:.3,obj:new Image},enemy_m_a_1:{src:"images/gradius_enemy_m_a_1.png",rate:.25,obj:new Image},enemy_m_a_2:{src:"images/gradius_enemy_m_a_2.png",rate:.25,obj:new Image},enemy_m_b_1:{src:"images/gradius_enemy_m_b_1.png",rate:.25,obj:new Image},enemy_m_b_2:{src:"images/gradius_enemy_m_b_2.png",rate:.25,obj:new Image},enemy_m_z:{src:"images/gradius_enemy_m_z.png",rate:.25,obj:new Image},enemy_m_y_1:{src:"images/gradius_enemy_m_y_1.png",rate:.5,obj:new Image},enemy_m_y_2:{src:"images/gradius_enemy_m_y_2.png",rate:.5,obj:new Image},enemy_cell_core:{src:"images/gradius_enemy_cell_core.png",rate:.3,obj:new Image},enemy_cell_hand_1:{src:"images/gradius_enemy_cell_hand_1.png",rate:.3,obj:new Image},enemy_cell_hand_2:{src:"images/gradius_enemy_cell_hand_2.png",rate:.3,obj:new Image},enemy_cell_hand_3:{src:"images/gradius_enemy_cell_hand_3.png",rate:.25,obj:new Image},enemy_frame_1:{src:"images/gradius_enemy_frame_1.png",rate:.3,obj:new Image},enemy_frame_2:{src:"images/gradius_enemy_frame_2.png",rate:.3,obj:new Image},enemy_frame_3:{src:"images/gradius_enemy_frame_3.png",rate:.3,obj:new Image},enemy_frame_4:{src:"images/gradius_enemy_frame_4.png",rate:.3,obj:new Image},enemy_frame_5:{src:"images/gradius_enemy_frame_5.png",rate:.3,obj:new Image},enemy_frame_6:{src:"images/gradius_enemy_frame_6.png",rate:.3,obj:new Image},enemy_frame_head1:{src:"images/gradius_enemy_frame_head_1.png",rate:1,obj:new Image},enemy_frame_head2:{src:"images/gradius_enemy_frame_head_2.png",rate:1,obj:new Image},enemy_frame_head3:{src:"images/gradius_enemy_frame_head_3.png",rate:1,obj:new Image},enemy_frame_head4:{src:"images/gradius_enemy_frame_head_4.png",rate:1,obj:new Image},enemy_frame_body1:{src:"images/gradius_enemy_frame_body_1.png",rate:1,obj:new Image},enemy_bigcore:{src:"images/gradius_enemy_bigcore.png",rate:.6,obj:new Image},enemy_bigcore_1:{src:"images/gradius_enemy_bigcore_1.png",rate:.6,obj:new Image},enemy_bigcore_2:{src:"images/gradius_enemy_bigcore_2.png",rate:.6,obj:new Image},enemy_bigcore_3:{src:"images/gradius_enemy_bigcore_3.png",rate:.6,obj:new Image},enemy_bigcore_4_1:{src:"images/gradius_enemy_bigcore_4_1.png",rate:.6,obj:new Image},enemy_bigcore_4_2:{src:"images/gradius_enemy_bigcore_4_2.png",rate:.6,obj:new Image},enemy_bigcore_4_3:{src:"images/gradius_enemy_bigcore_4_3.png",rate:.6,obj:new Image},enemy_bigcore_4_4:{src:"images/gradius_enemy_bigcore_4_4.png",rate:.6,obj:new Image},enemy_bigcore_4_5:{src:"images/gradius_enemy_bigcore_4_5.png",rate:.6,obj:new Image},enemy_cristalcore:{src:"images/gradius_enemy_cristalcore.png",rate:1,obj:new Image},enemy_cristalcore_hand1:{src:"images/gradius_enemy_cristalcore_hand1.png",rate:.3,obj:new Image},enemy_cristalcore_hand2:{src:"images/gradius_enemy_cristalcore_hand2.png",rate:.4,obj:new Image},enemy_cristalcore_wall1:{src:"images/gradius_enemy_cristalcore_wall1.png",rate:1,obj:new Image},enemy_cristalcore_wall2:{src:"images/gradius_enemy_cristalcore_wall2.png",rate:1,obj:new Image},enemy_cristalcore_shot:{src:"images/gradius_enemy_cristalcore_shot.png",rate:.2,obj:new Image},enemy_cube1:{src:"images/gradius_enemy_cube1.png",rate:.25,obj:new Image},enemy_cube2:{src:"images/gradius_enemy_cube2.png",rate:.25,obj:new Image},enemy_cube3:{src:"images/gradius_enemy_cube3.png",rate:.25,obj:new Image},enemy_cube4:{src:"images/gradius_enemy_cube4.png",rate:.25,obj:new Image},enemy_bigcore2:{src:"images/gradius_enemy_bigcore2.png",rate:1,obj:new Image},enemy_bigcore2_hand:{src:"images/gradius_enemy_bigcore2_hand.png",rate:1,obj:new Image},enemy_bigcore2_wall:{src:"images/gradius_enemy_bigcore2_wall.png",rate:1,obj:new Image},enemy_bigcore2_core:{src:"images/gradius_enemy_bigcore2_core.png",rate:1,obj:new Image},enemy_bigcore2_back:{src:"images/gradius_enemy_bigcore2_back.png",rate:1,obj:new Image},enemy_collapes0:{src:"images/gradius_enemy_collapes0.png",rate:1,obj:new Image},enemy_collapes1:{src:"images/gradius_enemy_collapes1.png",rate:1,obj:new Image},enemy_collapes2:{src:"images/gradius_enemy_collapes2.png",rate:1,obj:new Image},enemy_collapes8:{src:"images/gradius_enemy_collapes8.png",rate:1,obj:new Image},enemy_collapes9:{src:"images/gradius_enemy_collapes9.png",rate:1,obj:new Image},enemy_bullet:{src:"images/gradius_enemy_bullet.png",rate:1,obj:new Image},enemy_bullet_z:{src:"images/gradius_enemy_bullet_z.png",rate:.2,obj:new Image},enemy_bullet_laser:{src:"images/gradius_enemy_bullet_laser.png",rate:.25,obj:new Image},pc_red:{src:"images/gradius_pc_red.png",rate:1,obj:new Image},pc_blue:{src:"images/gradius_pc_blue.png",rate:1,obj:new Image},map_cube_A:{src:"images/gradius_map_cube_A.png",rate:1,obj:new Image},map_moai_A:{src:"images/gradius_map_moai_A.png",rate:1,obj:new Image},map_moai_B:{src:"images/gradius_map_moai_B.png",rate:1,obj:new Image},map_volcano_A:{src:"images/gradius_map_volcano_A.png",rate:1,obj:new Image},map_volcano_B:{src:"images/gradius_map_volcano_B.png",rate:1,obj:new Image},map_volcano_C:{src:"images/gradius_map_volcano_C.png",rate:1,obj:new Image},map_volcano_D:{src:"images/gradius_map_volcano_D.png",rate:1,obj:new Image},map_volcano_E:{src:"images/gradius_map_volcano_E.png",rate:1,obj:new Image},map_volcano_F:{src:"images/gradius_map_volcano_F.png",rate:1,obj:new Image},map_volcano_G:{src:"images/gradius_map_volcano_G.png",rate:1,obj:new Image},map_volcano_H:{src:"images/gradius_map_volcano_H.png",rate:1,obj:new Image},map_volcano_I:{src:"images/gradius_map_volcano_I.png",rate:1,obj:new Image},map_volcano_J:{src:"images/gradius_map_volcano_J.png",rate:1,obj:new Image},map_volcano_K:{src:"images/gradius_map_volcano_K.png",rate:1,obj:new Image},map_volcano_L:{src:"images/gradius_map_volcano_L.png",rate:1,obj:new Image},map_volcano_M:{src:"images/gradius_map_volcano_M.png",rate:1,obj:new Image},map_volcano_N:{src:"images/gradius_map_volcano_N.png",rate:1,obj:new Image},map_volcano_O:{src:"images/gradius_map_volcano_O.png",rate:1,obj:new Image},map_volcano_P:{src:"images/gradius_map_volcano_P.png",rate:1,obj:new Image},map_frame_A:{src:"images/gradius_map_frame_A.png",rate:1,obj:new Image},map_frame_B:{src:"images/gradius_map_frame_B.png",rate:1,obj:new Image},map_frame_C:{src:"images/gradius_map_frame_C.png",rate:1,obj:new Image},map_frame_D:{src:"images/gradius_map_frame_D.png",rate:1,obj:new Image},map_frame_E:{src:"images/gradius_map_frame_E.png",rate:1,obj:new Image},map_frame_F:{src:"images/gradius_map_frame_F.png",rate:1,obj:new Image},map_cell_A:{src:"images/gradius_map_cell_A.png",rate:1,obj:new Image},map_cell_B:{src:"images/gradius_map_cell_B.png",rate:1,obj:new Image},map_cell_C:{src:"images/gradius_map_cell_C.png",rate:1,obj:new Image},map_cell_D:{src:"images/gradius_map_cell_D.png",rate:1,obj:new Image},map_cell_E:{src:"images/gradius_map_cell_E.png",rate:1,obj:new Image},map_cell_F:{src:"images/gradius_map_cell_F.png",rate:1,obj:new Image},map_cell_G:{src:"images/gradius_map_cell_G.png",rate:1,obj:new Image},map_cell_Y:{src:"images/gradius_map_cell_Y.png",rate:1,obj:new Image},map_cell_Z:{src:"images/gradius_map_cell_Z.png",rate:1,obj:new Image}},_CANVAS_IMGS_INIT={font:{src:"images/gradius_font.png",rate:1,obj:new Image},gradius_powermeterselect:{src:"images/gradius_powermeterselect.png",rate:.28,obj:new Image},gradius_powermeterselect_shield:{src:"images/gradius_powermeterselect_shield.png",rate:.28,obj:new Image},gradius_powermeterselect_0:{src:"images/gradius_powermeterselect_0.png",rate:.28,obj:new Image},gradius_powermeterselect_1:{src:"images/gradius_powermeterselect_1.png",rate:.28,obj:new Image},gradius_powermeterselect_2:{src:"images/gradius_powermeterselect_2.png",rate:.28,obj:new Image},gradius_powermeterselect_3:{src:"images/gradius_powermeterselect_3.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_0:{src:"images/gradius_powermeterselect_shield_0.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_1:{src:"images/gradius_powermeterselect_shield_1.png",rate:.28,obj:new Image}},_CANVAS_AUDIOS={shot_laser:{src:"audios/shot_laser.mp3",volume:1,obj:null,buf:new Object},missile:{src:"audios/missile.mp3",volume:1,obj:null,buf:new Object},shot_normal:{src:"audios/shot_normal.mp3",volume:1,obj:null,buf:new Object},shot_ripple:{src:"audios/shot_ripple.mp3",volume:1,obj:null,buf:new Object},vicviper_bomb:{src:"audios/vicviper_bomb.mp3",volume:1,obj:null,buf:new Object},vicviper_shield_reduce:{src:"audios/vicviper_shield_reduce.mp3",volume:1,obj:null,buf:new Object},pc:{src:"audios/pc.mp3",volume:1,obj:null,buf:new Object},playerset:{src:"audios/playerset.mp3",volume:1,obj:null,buf:new Object},pms_select:{src:"audios/pms_select.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser:{src:"audios/enemy_bullet_laser.mp3",volume:1,obj:null,buf:new Object},enemy_collision1:{src:"audios/enemy_collision1.mp3",volume:1,obj:null,buf:new Object},enemy_collision2:{src:"audios/enemy_collision2.mp3",volume:1,obj:null,buf:new Object},enemy_collision3:{src:"audios/enemy_collision3.mp3",volume:1,obj:null,buf:new Object},enemy_collision4:{src:"audios/enemy_collision4.mp3",volume:1,obj:null,buf:new Object},enemy_collision5:{src:"audios/enemy_collision5.mp3",volume:1,obj:null,buf:new Object},enemy_collision6:{src:"audios/enemy_collision6.mp3",volume:1,obj:null,buf:new Object},enemy_collision7:{src:"audios/enemy_collision7.mp3",volume:1,obj:null,buf:new Object},enemy_all_out:{src:"audios/enemy_all_out.mp3",volume:1,obj:null,buf:new Object},enemy_cube:{src:"audios/enemy_cube.mp3",volume:1,obj:null,buf:new Object},map_cell_wall:{src:"audios/map_cell_wall.mp3",volume:1,obj:null,buf:new Object},bg_powermeterselect:{src:"audios/bg_powermeterselect.mp3",volume:1,obj:null,buf:new Object},bg_boss:{src:"audios/bg_boss.mp3",volume:1,obj:null,buf:new Object},bg_type1:{src:"audios/bg_moai.mp3",volume:1,obj:null,buf:new Object},bg_type2:{src:"audios/bg_volcano.mp3",volume:1,obj:null,buf:new Object},bg_type3:{src:"audios/bg_crystal.mp3",volume:1,obj:null,buf:new Object},bg_type4:{src:"audios/bg_frame.mp3",volume:1,obj:null,buf:new Object},bg_type5:{src:"audios/bg_thunderbolt.mp3",volume:1,obj:null,buf:new Object},bg_type6:{src:"audios/bg_cell.mp3",volume:1,obj:null,buf:new Object}};let _MAPDEFS="",_MAPDEF="",_MAP_PETTERN=3,_BACKGROUND_SPEED=0,_MAP_SCROLL_POSITION_X=0,_MAP_SCROLL_POSITION_Y=0;const _MAP_ENEMIES={_DEF_DIR:{_U:0,_D:1,_R:2,_L:3,_LU:4,_LD:5,_RU:6,_RD:7},_setDir:function(_mx,_my){let _d=_MAP.isMapCollision(_mx,_my-1)?this._DEF_DIR._U:this._DEF_DIR._D;return _d=_MAP.isMapCollision(_mx,_my+1)?this._DEF_DIR._D:this._DEF_DIR._U},_ENEMIES:{a:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_a(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_a_1},b:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_b(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_b_1},c:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_c(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_c_1},d:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_d(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_d_1},e:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_e(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_e_1},f:{_f:function(_mx,_my,_md){_md=_my<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_f(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_f_1},g:{_f:function(_mx,_my,_md){_md=_my<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_g(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_g_1},m:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_m(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_m_1},n:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_n(_mx,_my))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_o_1},o:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_o(_mx,_my))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_o_1},p:{_f:function(_mx,_my,_md){let _o=new ENEMY_p(_mx,_my);_ENEMIES.push(_o)},_st:"",_s:"000,000,000",_o:_CANVAS_IMGS.enemy_p_1}}},_MAP_ENEMIES_BOSS={enemy_cristalcore:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE(700,800)}},enemy_bigcore:{_f:function(){return new ENEMY_BOSS_BIGCORE(1300,200)}},enemy_cristalcore_pt2:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE_PT2(700,800)}},enemy_bigcore2:{_f:function(){return new ENEMY_BOSS_BIGCORE2(1300,200)}},enemy_frame:{_f:function(){return new ENEMY_BOSS_FRAME(1e3,200)}}},_MAP_THEME={_THEME1:{_map:{A:{_o:(new MAP_CRISTAL).img,_s:(new MAP_CRISTAL)._s,obj:function(_key){this.objs[_key]=new MAP_CRISTAL},objs:{},_obj:new MAP_CRISTAL}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME2:{_map:{A:{_o:(new MAP_VOLCANO_A).img,_s:(new MAP_VOLCANO_A)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_A},objs:{},_obj:new MAP_VOLCANO_A},B:{_o:(new MAP_VOLCANO_B).img,_s:(new MAP_VOLCANO_B)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_B},objs:{},_obj:new MAP_VOLCANO_B},C:{_o:(new MAP_VOLCANO_C).img,_s:(new MAP_VOLCANO_C)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_C},objs:{},_obj:new MAP_VOLCANO_C},D:{_o:(new MAP_VOLCANO_D).img,_s:(new MAP_VOLCANO_D)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_D},objs:{},_obj:new MAP_VOLCANO_D},F:{_o:(new MAP_VOLCANO_F).img,_s:(new MAP_VOLCANO_F)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_F},objs:{},_obj:new MAP_VOLCANO_F},G:{_o:(new MAP_VOLCANO_G).img,_s:(new MAP_VOLCANO_G)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_G},objs:{},_obj:new MAP_VOLCANO_G},H:{_o:(new MAP_VOLCANO_H).img,_s:(new MAP_VOLCANO_H)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_H},objs:{},_obj:new MAP_VOLCANO_H},I:{_o:(new MAP_VOLCANO_I).img,_s:(new MAP_VOLCANO_I)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_I},objs:{},_obj:new MAP_VOLCANO_I},J:{_o:(new MAP_VOLCANO_J).img,_s:(new MAP_VOLCANO_J)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_J},objs:{},_obj:new MAP_VOLCANO_J},K:{_o:(new MAP_VOLCANO_K).img,_s:(new MAP_VOLCANO_K)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_K},objs:{},_obj:new MAP_VOLCANO_K},L:{_o:(new MAP_VOLCANO_L).img,_s:(new MAP_VOLCANO_L)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_L},objs:{},_obj:new MAP_VOLCANO_L},M:{_o:(new MAP_VOLCANO_M).img,_s:(new MAP_VOLCANO_M)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_M},objs:{},_obj:new MAP_VOLCANO_M},N:{_o:(new MAP_VOLCANO_N).img,_s:(new MAP_VOLCANO_N)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_N},objs:{},_obj:new MAP_VOLCANO_N},O:{_o:(new MAP_VOLCANO_O).img,_s:(new MAP_VOLCANO_O)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_O},objs:{},_obj:new MAP_VOLCANO_O},P:{_o:(new MAP_VOLCANO_P).img,_s:(new MAP_VOLCANO_P)._s,obj:function(_key){this.objs[_key]=new MAP_VOLCANO_P},objs:{},_obj:new MAP_VOLCANO_P}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME3:{_map:{A:{_o:(new MAP_CUBE_A).img,_s:(new MAP_CUBE_A)._s,obj:function(_key){this.objs[_key]=new MAP_CUBE_A},objs:{},_obj:new MAP_CUBE_A}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME5:{_map:{B:{_o:(new MAP_MOAI_A).img,_s:(new MAP_MOAI_A)._s,obj:function(_key){this.objs[_key]=new MAP_MOAI_A},objs:{},_obj:new MAP_MOAI_A},C:{_o:(new MAP_MOAI_B).img,_s:(new MAP_MOAI_B)._s,obj:function(_key){this.objs[_key]=new MAP_MOAI_B},objs:{},_obj:new MAP_MOAI_B}},_enemies:{a:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_a(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_a_1},b:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_b(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_b_1},c:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_c(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_c_1},d:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_d(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_d_1},e:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_e(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_e_1},f:{_f:function(_mx,_my,_md){_md=_my<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_f(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_f_1},g:{_f:function(_mx,_my,_md){_md=_my<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_g(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_g_1},m:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_m(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_m_1},l:{_f:function(_mx,_my,_md){let _o=new ENEMY_q(_mx,_my,_MAP_ENEMIES._DEF_DIR._U);_ENEMIES.push(_o)},_st:"transform:scale(1,-1);",_s:"1111,0110,0011,0000",_o:_CANVAS_IMGS.enemy_m_a_1},n:{_f:function(_mx,_my,_md){let _o=new ENEMY_q(_mx,_my,_MAP_ENEMIES._DEF_DIR._D);_ENEMIES.push(_o)},_st:"",_s:"0000,0011,0110,1111",_o:_CANVAS_IMGS.enemy_m_a_1},o:{_f:function(_mx,_my,_md){let _o=new ENEMY_r(_mx,_my,_MAP_ENEMIES._DEF_DIR._U);_ENEMIES.push(_o)},_st:"transform:scale(1,-1);",_s:"1111,0010,0000,0000",_o:_CANVAS_IMGS.enemy_m_b_1},p:{_f:function(_mx,_my,_md){let _o=new ENEMY_r(_mx,_my,_MAP_ENEMIES._DEF_DIR._D);_ENEMIES.push(_o)},_st:"",_s:"0000,0000,0010,1111",_o:_CANVAS_IMGS.enemy_m_b_2},q:{_f:function(_mx,_my,_md){let _o=new ENEMY_q(_mx,_my,_MAP_ENEMIES._DEF_DIR._LD);_ENEMIES.push(_o)},_st:"transform:scale(-1,1);",_s:"0000,1100,1110,1111",_o:_CANVAS_IMGS.enemy_m_a_1},r:{_f:function(_mx,_my,_md){let _o=new ENEMY_q(_mx,_my,_MAP_ENEMIES._DEF_DIR._LU);_ENEMIES.push(_o)},_st:"transform:scale(-1,-1);",_s:"1111,1110,1100,0000",_o:_CANVAS_IMGS.enemy_m_a_1}}},_THEME6:{_map:{A:{_o:(new MAP_FRAME_A).img,_s:(new MAP_FRAME_A)._s,obj:function(_key){this.objs[_key]=new MAP_FRAME_A},objs:{},_obj:new MAP_FRAME_A},B:{_o:(new MAP_FRAME_B).img,_s:(new MAP_FRAME_B)._s,obj:function(_key){this.objs[_key]=new MAP_FRAME_B},objs:{},_obj:new MAP_FRAME_B},C:{_o:(new MAP_FRAME_C).img,_s:(new MAP_FRAME_C)._s,obj:function(_key){this.objs[_key]=new MAP_FRAME_C},objs:{},_obj:new MAP_FRAME_C},D:{_o:(new MAP_FRAME_D).img,_s:(new MAP_FRAME_D)._s,obj:function(_key){this.objs[_key]=new MAP_FRAME_D},objs:{},_obj:new MAP_FRAME_D},E:{_o:(new MAP_FRAME_E).img,_s:(new MAP_FRAME_E)._s,obj:function(_key){this.objs[_key]=new MAP_FRAME_E},objs:{},_obj:new MAP_FRAME_E},F:{_o:(new MAP_FRAME_F).img,_s:(new MAP_FRAME_F)._s,obj:function(_key){this.objs[_key]=new MAP_FRAME_F},objs:{},_obj:new MAP_FRAME_F}},_enemies:{a:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_frame_1(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_frame_1},d:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_d(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_d_1},e:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_e(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_e_1}}},_THEME7:{_map:{A:{_o:(new MAP_CELL_A).img,_s:(new MAP_CELL_A)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_A},objs:{},_obj:new MAP_CELL_A},B:{_o:(new MAP_CELL_B).img,_s:(new MAP_CELL_B)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_B},objs:{},_obj:new MAP_CELL_B},C:{_o:(new MAP_CELL_C).img,_s:(new MAP_CELL_C)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_C},objs:{},_obj:new MAP_CELL_C},D:{_o:(new MAP_CELL_D).img,_s:(new MAP_CELL_D)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_D},objs:{},_obj:new MAP_CELL_D},E:{_o:(new MAP_CELL_E).img,_s:(new MAP_CELL_E)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_E},objs:{},_obj:new MAP_CELL_E},F:{_o:(new MAP_CELL_F).img,_s:(new MAP_CELL_F)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_F},objs:{},_obj:new MAP_CELL_F},G:{_o:(new MAP_CELL_G).img,_s:(new MAP_CELL_G)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_G},objs:{},_obj:new MAP_CELL_G},H:{_o:(new MAP_CELL_H).img,_s:(new MAP_CELL_H)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_H},objs:{},_obj:new MAP_CELL_H},I:{_o:(new MAP_CELL_I).img,_s:(new MAP_CELL_I)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_I},objs:{},_obj:new MAP_CELL_I},J:{_o:(new MAP_CELL_J).img,_s:(new MAP_CELL_J)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_J},objs:{},_obj:new MAP_CELL_J},K:{_o:(new MAP_CELL_K).img,_s:(new MAP_CELL_K)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_K},objs:{},_obj:new MAP_CELL_K},L:{_o:(new MAP_CELL_L).img,_s:(new MAP_CELL_L)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_L},objs:{},_obj:new MAP_CELL_L},M:{_o:(new MAP_CELL_M).img,_s:(new MAP_CELL_M)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_M},objs:{},_obj:new MAP_CELL_M},N:{_o:(new MAP_CELL_N).img,_s:(new MAP_CELL_N)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_N},objs:{},_obj:new MAP_CELL_N},O:{_o:(new MAP_CELL_O).img,_s:(new MAP_CELL_O)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_O},objs:{},_obj:new MAP_CELL_O},Y:{_o:(new MAP_CELL_Y).img,_s:(new MAP_CELL_Y)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_Y},objs:{},_obj:new MAP_CELL_Y},Z:{_o:(new MAP_CELL_Z).img,_s:(new MAP_CELL_Z)._s,obj:function(_key){this.objs[_key]=new MAP_CELL_Z},objs:{},_obj:new MAP_CELL_Z}},_enemies:{a:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_cell_core(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_cell_core},b:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_cell_wall1(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.map_cell_G},d:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_d(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_d_1},e:{_f:function(_mx,_my,_md){_ENEMIES.push(new ENEMY_e(_mx,_my,_md))},_st:"",_s:"0",_o:_CANVAS_IMGS.enemy_e_1}}}};class GameObject_MAP{constructor(_pt){this.pt=_pt||0,this.initx=0,this.inity=0,this.x=this.initx,this.y=this.inity,this.collision=new RegExp("[1A-Z]"),this.collision_enemies=new RegExp("[a-z]","g"),this.collision_map=new RegExp("[A-Z]"),this.collision_map_d=new RegExp("[BD]"),this.t=25,this.mapdef=new Array,this.mapdef_col=new Array,this.map_theme=0,this.map_pettern=0,this.map_difficult=0,this.map_background_speed=0,this.map_backgroundY_speed=0,this.map_infinite=!1,this.map_bgmusic="",this.map_boss="",this.isboss=!1}init(_cb){_AJAX("./gradius_map.json","json",function(_d){_MAPDEFS=_d,_cb()})}setInifinite(_f){this.map_infinite=_f}set_stage_map_pattern(_n){this.map_pettern=_n}init_stage_map(){this.map_backgroundY_speed=0,this.x=parseInt(_MAPDEFS[this.map_pettern]._initx),this.y=this.inity,this.initx=parseInt(_MAPDEFS[this.map_pettern]._initx),this.mapdef=_MAPDEFS[this.map_pettern]._map,this.map_difficult=parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,_ENEMY_DIFFICULT=_ISDEBUG?_ENEMY_DIFFICULT:parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,this.map_background_speed=parseInt(_MAPDEFS[this.map_pettern]._speed),_BACKGROUND_SPEED=parseInt(_MAPDEFS[this.map_pettern]._speed),_MAP_PETTERN=this.map_pettern,this.map_theme=_MAPDEFS[this.map_pettern]._theme,this.map_infinite="true"===_MAPDEFS[this.map_pettern]._map_infinite,this.map_bgmusic=_MAPDEFS[this.map_pettern]._bgmusic,this.map_boss=_MAPDEFS[this.map_pettern]._boss,this.isboss=!1,this.init_map_anime(),this.init_mapdef_col()}init_map_anime(){let _this=this;for(let _i=0;_i<_this.mapdef.length;_i++){let _m=_this.mapdef[_i];for(let _j=0;_j<_m.length;_j++)null!==_m[_j].match(/[A-Z]/)&&_MAP_THEME[_this.map_theme]._map[_m[_j]].obj(_j+","+_i)}}init_enemies_location(){let _this=this;for(let _i=0;_i<_this.mapdef.length;_i++)for(let _j=0;_j<_this.mapdef[_i].length;_j++){let _md=_this.mapdef[_i][_j];if(_this.isCollisionBit(_md))continue;if("0"===_md)continue;let _d=function(){let _r=_MAP_ENEMIES._setDir(_j,_i),_e=_MAP_THEME[_this.map_theme]._enemies[_md];return _r=0===_r?_MAP_ENEMIES._setDir(_j,_i+parseInt(_e._o.obj.height/_MAP.t)):_r}();_MAP_THEME[_this.map_theme]._enemies[_md]._f(_this.x+_j*_this.t,_i*_this.t,_d)}}init_mapdef_col(){let _this=this;Object.assign(_this.mapdef_col,_this.mapdef);for(let _i=0;_i<_this.mapdef_col.length;_i++)_this.mapdef_col[_i]=_this.mapdef_col[_i].replace(/[a-zA-Z]/gi,"0");for(let _i=0;_i<_this.mapdef.length;_i++){let _m=_this.mapdef[_i];for(let _j=0;_j<_m.length;_j++){if(null===_m[_j].match(/[A-Za-z]/))continue;let _p=_this.isEnemiesBit(_m[_j])?_MAP_THEME[_this.map_theme]._enemies[_m[_j]]:_MAP_THEME[_this.map_theme]._map[_m[_j]];void 0===_p&&console.log("テーマ:"+_this.map_theme+"に対して "+_m[_j]+"の定義がありません。");let _p_s=_p._s.split(",");for(let _l=0;_l<_p_s.length;_l++){let _s_mapdef_col=_this.mapdef_col[_i+_l],_s_mapdef=_this.mapdef[_i+_l];_this.mapdef_col[_i+_l]=_s_mapdef_col.substr(0,_j)+(_s_mapdef.substr(_j,_p_s[_l].length),_s_mdc=_s_mapdef_col.substr(_j,_p_s[_l].length),_psl=_p_s[_l],_this.setCollisionBit(_psl,_s_mdc))+_s_mapdef_col.substr(_j+_p_s[_l].length,_m.length)}}}var _s_mdc,_psl}set_mapdef_col(_mx,_my,_bit){let _this=this;if(void 0===_mx||void 0===_my||void 0===_bit)return;let _p_s=_bit.split(",");for(let _l=0;_l<_p_s.length;_l++){let _s_mapdef_col=_this.mapdef_col[_my+_l];_this.mapdef_col[_my+_l]=_s_mapdef_col.substr(0,_mx)+_p_s[_l]+_s_mapdef_col.substr(_mx+_p_s[_l].length)}}getX(_x){return _x+-1*_BACKGROUND_SPEED}getY(_y){return this.map_infinite?_y-_MAP.map_backgroundY_speed<-250?750+(250+_y-_MAP.map_backgroundY_speed):_y-_MAP.map_backgroundY_speed>750?-250-(750-_y+_MAP.map_backgroundY_speed):(_y-_MAP.map_backgroundY_speed)%1e3:_y}getShotY(_y){return _y-_MAP.map_backgroundY_speed}setCollisionBit(_pb,_mcb){let _s="";for(let _i=0;_i<_pb.length;_i++)"0"!==_pb[_i]?_s+="1":_s+=_mcb[_i];return _s}getCollisionFlag(){return this.collision}setBackGroundSpeedY(_v){this.map_backgroundY_speed=_v}getBackGroundSpeed(){return this.map_background_speed}getBackGroundSpeedY(){return this.map_backgroundY_speed}get_stage_map_pattern(_n){return this.map_pettern}getMapXToPx(_mx){return _mx*this.t+this.initx-_MAP_SCROLL_POSITION_X}getMapYToPx(_y){return _y}getMapX(_x){return parseInt((_x+_MAP_SCROLL_POSITION_X-this.initx)/this.t)}getMapY(_y,_debug){return!0===_debug&&(console.log("_y:"+_y),console.log("_MAP_SCROLL_POSITION_Y:"+_MAP_SCROLL_POSITION_Y)),parseInt((_y+_MAP_SCROLL_POSITION_Y)%1e3/this.t)}isCollisionBit(_bit){return null!==_bit.match(this.collision)}isEnemiesBit(_bit){return null!==_bit.match(this.collision_enemies)}isMapDouble(_s){return null!==_s.match(this.collision_map_d)}isMapBefore(_mx,_my){return _mx<0}isMapLastSide(_mx,_my){return void 0!==this.mapdef[_my]&&(void 0===this.mapdef[_my][_mx]||_mx===this.mapdef[_my].length-1)}isMapOver(_mx,_my){return void 0!==this.mapdef[_my]&&(void 0===this.mapdef[_my][_mx]||_mx>this.mapdef[_my].length-1)}isMapCollision(_mx,_my){return void 0!==this.mapdef_col[_my]&&(void 0!==this.mapdef_col[_my][_mx]&&!!this.isCollisionBit(this.mapdef_col[_my][_mx]))}setPlayersShotAbleCollision(_mx,_my,_shot){let _mp=_MAP_THEME[this.map_theme]._map;if(void 0===_mp)return;let _md=this.mapdef[_my][_mx];if(void 0===_mp[_md])return;let _obj=_mp[_md].objs[_mx+","+_my];void 0!==_obj&&_obj.is_able_collision&&_obj.collision(_shot)}isPlayersShotCollision(){for(let _i=0;_i<_PLAYERS_SHOTS[_SHOTTYPE].length;_i++){let _ps=_PLAYERS_SHOTS[_SHOTTYPE][_i];for(let _j=0;_j<_ps.shots.length;_j++){let _pss=_ps.shots[_j];_pss._shot_alive&&_ps.map_collition(_pss)}}for(let _i=0;_i<_PLAYERS_MISSILE.length;_i++){let _pm=_PLAYERS_MISSILE[_i];if(_pm.player.isalive())for(let _j=0;_j<_pm.shots.length;_j++){let _pms=_pm.shots[_j];_pms._shot_alive&&(_pms._c>0||_pm.map_collition(_pms))}}}show(){}showMapForStageselect(_m){let _this=this;if(null==_m)return;let _m_length=_m._map.length;for(let _i=0;_i<(_m_length>20?20:_m_length);_i++){let _ml=_m._map[_i].length;for(let _j=0;_j<(_ml>30?30:_ml);_j++){let _k=_m._map[_i][_j];if("0"!==_k)if(null!==_k.match(_this.collision_enemies)){let _img=_MAP_THEME[_m._theme]._enemies[_k]._o.obj;_CONTEXT.drawImage(_img,50+10*_j,130+10*_i,_img.width/2.5,_img.height/2.5)}else{let _img=_MAP_THEME[_m._theme]._map[_k]._o.obj;_CONTEXT.drawImage(_img,50+10*_j,130+10*_i,_img.width/2.5,_img.height/2.5)}}}_CONTEXT.fillStyle="rgba(0,0,0,1)",_CONTEXT.fillRect(351,130,_CANVAS.width,200),_CONTEXT.fillRect(0,341,_CANVAS.width,500)}map_draw(){let _this=this;for(let _i=0;_i<_this.mapdef.length;_i++)for(let _j=0;_j<_this.mapdef[_i].length;_j++){let _k=_this.mapdef[_i][_j];if(!_this.isCollisionBit(_k))continue;if(_this.x+_j*_this.t<-500||_this.x+_j*_this.t>_CANVAS.width+100)continue;let _p=_MAP_THEME[_this.map_theme]._map[_k];_p.objs[_j+","+_i].moveDraw(_this.x+_j*_this.t,_this.y+_i*_this.t),_this.map_infinite&&_p.objs[_j+","+_i].moveDraw(_this.x+_j*_this.t,_this.y+_i*_this.t+(_this.y>0?-1e3:1e3))}}set_mapdef_col_clear(){let _this=this;for(let _i=0;_i<_this.mapdef_col.length;_i++){let _m=_this.mapdef_col[_i];_this.mapdef_col[_i]=_m.replace(/1/gi,"0")}}set_scroll_on_x(){_BACKGROUND_SPEED=this.map_background_speed}set_scroll_off_x(){_BACKGROUND_SPEED=0}move(){let _this=this;_MAP_SCROLL_POSITION_X+_CANVAS.width>_this.mapdef[0].length*_this.t+_this.initx&&(_this.isboss=!0),_MAP_SCROLL_POSITION_X-100>_this.mapdef[0].length*_this.t+_this.initx&&(_BACKGROUND_SPEED=0),_this.x+=-1*_BACKGROUND_SPEED,_MAP_SCROLL_POSITION_X+=_BACKGROUND_SPEED,_this.y=_this.getY(_this.y),_MAP_SCROLL_POSITION_Y=function(){let _posy=_MAP_SCROLL_POSITION_Y+_this.map_backgroundY_speed;return _posy<0?(1e3+_posy)%1e3:_posy%1e3}()}}const _MAP=new GameObject_MAP;let $_pb=null,$_ab=null,$_mp=null,$_mn=null,$_bm=null;_MAP_PETTERN=0;const _AJAX=function(_url,_type,_f){let _r=new XMLHttpRequest;_r.onreadystatechange=function(){4===_r.readyState&&(200===_r.status?(console.log("OK"),_f(_r.response)):console.log("NG"))},_r.open("GET",_url+"?date="+(new Date).getTime()),_r.responseType=_type||"json",_r.send(null)},_DATAAPI={_data_api:"",_blog_id:2,_url:"http://localhost:8080/mt6/mt-data-api.cgi",_init:function(_this){_this._data_api=new MT.DataAPI({baseUrl:_this._url,clientId:"api11entries"}),_this._data_api.getToken(function(res){if(res.error)return 401===res.error.code&&(console.log("reload after 401 error occuered in updating."),location.href=_this._data_api.getAuthorizationUrl(location.href)),!1;_GAME_STAGEEDIT._init_images(_CANVAS_IMGS,_GAME_STAGEEDIT._init)})},_set_entryupdate:function(_ed){let _this=this;_this._data_api.updateEntry(_this._blog_id,_ed._eid,_ed,function(_r){if(_r.error)return alert("エントリ更新に失敗しました。"),void(401===_r.error.code&&(location.href=_this._data_api.getAuthorizationUrl(location.href)));alert("エントリ更新しました。"),_MAP.init(function(){_MAP_PETTERN=function(){for(let _i=0;_i<_MAPDEFS.length;_i++)if(_MAPDEFS[_i]._eid===_ed._eid)return _i}(),_GAME_STAGEEDIT._setData(_MAP_PETTERN);const $_ap_pb=document.querySelectorAll("#area_parts .parts_block");for(var _i=0;_i<$_ap_pb.length;_i++)$_ap_pb[_i].setAttribute("draggable",!0),$_ap_pb[_i].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),$_ap_pb[_i].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1);const $_fg_range=document.querySelectorAll('.form_group .col_r input[type="range"]');for(_i=0;_i<$_fg_range.length;_i++)$_fg_range[_i].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),$_fg_range[_i].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();const $_qsa=document.querySelectorAll(".parts_block_wrapper .text");for(let _i=0;_i<$_qsa.length;_i++)_GAME_STAGEEDIT._setTextToFont($_qsa[_i],$_qsa[_i].innerText,14)})})}},_GAME_STAGEEDIT={_ac:new(window.AudioContext||window.webkitAudioContext),_as:null,_theme:0,_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_setInitMap:function(_m){this._theme=_m._theme;let _mo=_m._map,_str="";for(let _i=0;_i<_mo.length;_i++){_str+='<div class="area_blocks_rows">';for(let _j=0;_j<_mo[_i].length;_j++)_str+='<div class="area_block" data-val="'+_mo[_i][_j]+'" onmouseover="_GAME_STAGEEDIT_EVENTS._f_as_mouseover(event);" onmouseout="_GAME_STAGEEDIT_EVENTS._f_as_mouseout(event);" ondragenter="_GAME_STAGEEDIT_EVENTS._f_as_dragenter(event);" ondrop="_GAME_STAGEEDIT_EVENTS._f_as_drop(event);">'+function(_k){if("0"===_k)return"";let _s="";if(null!==_k.match(_MAP.collision_enemies)){let _o=_MAP_THEME[_m._theme]._enemies[_k]._o.obj;_s='<div class="parts_block" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">';let _st=_MAP_THEME[_m._theme]._enemies[_k]._st;_s+="<img"+(""===_st?"":' style="'+_st+'"')+' width="'+parseInt(.8*_o.width)+'" height="'+parseInt(.8*_o.height)+'" src="'+_o.src+'">',_s+="</div>"}else if(null!==_k.match(_MAP.collision_map)){let _o=_MAP_THEME[_m._theme]._map[_k]._obj;_s='<div class="parts_block" style="width:'+parseInt(.8*_o.width)+"px;height:"+parseInt(.8*_o.height)+'px" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">',_s+='<img src="'+_o.img.src+'">',_s+="</div>"}return _s}(_mo[_i][_j])+"</div>\x3c!-- /.area_block --\x3e";_str+="</div>\x3c!-- /.area_blocks_rows --\x3e"}document.querySelector(".area_blocks.drop").innerHTML=_str},_setAudioInit:function(_obj,_func){let _this=this,_audioLoadedCount=0;for(let _i in _obj){let _r=new XMLHttpRequest;_r.open("GET",_obj[_i].src,!0),_r.responseType="arraybuffer",_r.onload=function(){_this._ac.decodeAudioData(_r.response,function(_buf){_obj[_i].buf=_buf,++_audioLoadedCount>=Object.keys(_obj).length&&_func(_DATAAPI)},function(_error){alert("一部音声読み込みに失敗しました。再度立ち上げなおしてください:"+_error)})},_r.send()}},_setAudioStop(_obj){null!==this._as&&(this._as.stop(),this._as=null)},_setAudioPlay(_obj){if(null!=_obj&&null===this._as){var _s=this._ac.createBufferSource();_s.buffer=_obj.buf,_s.loop=!1,_s.connect(this._ac.destination),_s.start(0),this._as=_s}},_setInitPartsBlocksWrapper:function(_m){_m._map;let _str="";for(let[_k,_v]of Object.entries(_MAP_THEME[_m._theme]._enemies))_str+='<div class="parts_block_wrapper" data-val="'+_k+'"><div class="text">enemy '+_k+'</div><div class="parts_block"><img'+(""===_v._st?"":' style="'+_v._st+'"')+' src="'+_v._o.src+'"></div></div>\x3c!-- /.parts_block_wrapper --\x3e';document.querySelector(".parts_blocks_wrapper.enemy .parts_blocks").innerHTML=_str,_str="";for(let[_k,_v]of Object.entries(_MAP_THEME[_m._theme]._map)){let _o=_v._obj;_str+='<div class="parts_block_wrapper" data-val="'+_k+'"><div class="text">MAP '+_k+'</div><div class="parts_block" style="width:100px;height:'+parseInt(100*_o.height/_o.width)+'px"><img src="'+_v._o.src+'"></div></div>\x3c!-- /.parts_block_wrapper --\x3e'}document.querySelector(".parts_blocks_wrapper.map .parts_blocks").innerHTML=_str},_clearMap:function(){document.querySelector(".area_blocks.drop").textContent=null},_getTextToFont:function($_obj){let _str="",$_o=$_obj.children;for(let _i=0;_i<$_o.length;_i++)_str+=$_o[_i];return _str},_setTextToFont:function(_o,_str,_w){if(null==_o)return;_w=_w||60;let _s="";for(let _i=0;_i<_str.length;_i++){if(":"===_str[_i])continue;if(" "===_str[_i]){_s+='<img src="./images/gradius_spacer.png" width="'+_w+'">';continue}_s+='<div style="background:url(./images/gradius_font.png) no-repeat;background-size:cover;background-position:'+parseInt(this._txt[_str[_i].toLowerCase()])*(_w/60)*-1+"px 0px;display:inline-block;width:"+_w+"px;height:"+_w+'px;"></div>'}_o.innerHTML=_s},_clearData:function(){},_setData:function(_pt){let _data=_MAPDEFS[_pt];this._setInitMap(_data),this._setInitPartsBlocksWrapper(_data),document.querySelector('#title input[name="title"]').value=_data._title,document.querySelector('#body textarea[name="body"]').value=_data._body;const $_bgmusic=document.querySelector("#bgmusic select");for(let _i=0;_i<$_bgmusic.length;_i++)if($_bgmusic[_i].value===_data._bgmusic){$_bgmusic[_i].selected=!0;break}$_bgmusic.addEventListener("click",function(){_GAME_STAGEEDIT._setAudioStop()});const $_boss=document.querySelector("#boss select");for(let _i=0;_i<$_boss.length;_i++)if($_boss[_i].value===_data._boss){$_boss[_i].selected=!0;break}const $_init=document.querySelector('#init input[name="init"]'),$_init_v=document.querySelector("#init .col_r .val");$_init.value=_data._initx,$_init_v.setAttribute("data-val",_data._initx),this._setTextToFont($_init_v,_data._initx,20);const $_speed=document.querySelector('#speed input[name="speed"]'),$_speed_v=document.querySelector("#speed .col_r .val");$_speed.value=_data._speed,$_speed_v.setAttribute("data-val",_data._speed),this._setTextToFont($_speed_v,_data._speed,20);const $_difficult=document.querySelector('#difficult input[name="difficult"]'),$_difficult_v=document.querySelector("#difficult .col_r .val");$_difficult.value=_data._difficult,$_difficult_v.setAttribute("data-val",_data._difficult),this._setTextToFont($_difficult_v,_data._difficult,20);const $_map_infinite=document.querySelector('#map_infinite input[name="map_infinite"]'),$_map_infinite_v=document.querySelector("#map_infinite .col_r .val");$_map_infinite.value="true"===_data._map_infinite?"1":"0",$_map_infinite_v.setAttribute("data-val",_data._map_infinite),this._setTextToFont($_map_infinite_v,_data._map_infinite,20)},setDataForDataApi:function(){let _d=function(_m){let _str="";_str+='"_map":[';let $_abr=document.querySelectorAll(".area_blocks_rows");for(let _i=0;_i<$_abr.length;_i++){let $_ab=$_abr[_i].children;_str+='"';for(let _j=0;_j<$_ab.length;_j++)_str+=$_ab[_j].getAttribute("data-val");_str+=_i===$_abr.length-1?'"':'",'}return _str+="],",_str+='"_theme":"'+_m._theme+'",',_str+='"_body":"'+document.querySelector('#body textarea[name="body"]').value+'",',_str+='"_initx":"'+document.querySelector("#init .col_r .val").getAttribute("data-val")+'",',_str+='"_bgmusic":"'+document.querySelector("#bgmusic select").value+'",',_str+='"_boss":"'+document.querySelector("#boss select").value+'",',_str+='"_speed":"'+document.querySelector("#speed .col_r .val").getAttribute("data-val")+'",',_str+='"_difficult":"'+document.querySelector("#difficult .col_r .val").getAttribute("data-val")+'",',_str+='"_map_infinite":"'+document.querySelector("#map_infinite .col_r .val").getAttribute("data-val")+'"'}(_MAPDEFS[_MAP_PETTERN]),_ed={title:document.querySelector('#title input[name="title"]').value,status:"Publish",_eid:_MAPDEFS[_MAP_PETTERN]._eid,body:_d};_DATAAPI._set_entryupdate(_ed)},_setEntryLink:function(){$_mp.classList.remove("off"),$_mn.classList.remove("off"),0===_MAP_PETTERN&&$_mp.classList.add("off"),_MAP_PETTERN>=_MAPDEFS.length-1&&$_mn.classList.add("off")},_setPartsBlockEvent:function(){const $_ap_pb=document.querySelectorAll("#area_parts .parts_block");for(var _i=0;_i<$_ap_pb.length;_i++)$_ap_pb[_i].setAttribute("draggable",!0),$_ap_pb[_i].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),$_ap_pb[_i].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1)},_init_images:function(_obj,_func){let _imgLoadedCount=0;for(let _i in _obj){let _o=_obj[_i];_o.obj.src=_obj[_i].src,_o.obj.onload=function(){_o.obj.width*=_o.rate,_o.obj.height*=_o.rate,++_imgLoadedCount>=Object.keys(_obj).length&&_func()}}},_init:()=>{const _this=_GAME_STAGEEDIT,$bgm=document.querySelector("#bgmusic select");Object.keys(_CANVAS_AUDIOS).forEach(function(_k){if(-1!==_k.indexOf("bg_type")){var _op=document.createElement("option");_op.setAttribute("value",_k.replace("bg_","")),_op.innerHTML=_k.replace("bg_",""),$bgm.appendChild(_op)}});const $boss=document.querySelector("#boss select");Object.keys(_MAP_ENEMIES_BOSS).forEach(function(_k){var _op=document.createElement("option");_op.setAttribute("value",_k),_op.innerHTML=_k,$boss.appendChild(_op)}),_MAP.init(()=>{console.log("success"),_this._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setPartsBlockEvent();const $_fg_range=document.querySelectorAll('.form_group .col_r input[type="range"]');for(var _i=0;_i<$_fg_range.length;_i++)$_fg_range[_i].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),$_fg_range[_i].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();let $_qsa=document.querySelectorAll("h1");for(let _i=0;_i<$_qsa.length;_i++)_this._setTextToFont($_qsa[_i],$_qsa[_i].innerText,40);$_qsa=document.querySelectorAll("h2,h3,#map_bts a,#entrylink a,label.col_l,div.col_r label span, #menu_inner a");for(let _i=0;_i<$_qsa.length;_i++)_this._setTextToFont($_qsa[_i],$_qsa[_i].innerText,20);$_qsa=document.querySelectorAll(".parts_block_wrapper .text");for(let _i=0;_i<$_qsa.length;_i++)_this._setTextToFont($_qsa[_i],$_qsa[_i].innerText,14)})}},_GAME_STAGEEDIT_EVENTS={$_do_area_parts_obj:null,$_start_area_parts_obj:null,$_mouseover_area_parts_obj:null,_e_entrylink_prev:function(e){if(0===_MAP_PETTERN)return;_MAP_PETTERN--,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const $_qsa=document.querySelectorAll(".parts_block_wrapper .text");for(let _i=0;_i<$_qsa.length;_i++)_GAME_STAGEEDIT._setTextToFont($_qsa[_i],$_qsa[_i].innerText,14);return!1},_e_entrylink_next:function(e){if(_MAP_PETTERN>=_MAPDEFS.length-1)return;_MAP_PETTERN++,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const $_qsa=document.querySelectorAll(".parts_block_wrapper .text");for(let _i=0;_i<$_qsa.length;_i++)_GAME_STAGEEDIT._setTextToFont($_qsa[_i],$_qsa[_i].innerText,14);return!1},_e_update:function(){return confirm("更新しますか?")?_GAME_STAGEEDIT.setDataForDataApi():console.log("false"),!1},_e_scroll:function(e){const $_b=document.body,_wih=document.body.clientHeight,_mh=document.getElementById("menu").offsetHeight;$_b.scrollTop+window.innerHeight>_wih-_mh/2?$_b.classList.remove("ismenu"):$_b.classList.add("ismenu")},_f_fg_range:function(e){let $_t_val=e.target.parentNode.previousElementSibling,_val="map_infinite"!==e.target.name?e.target.value:"1"===e.target.value?"true":"false";$_t_val.setAttribute("data-val",_val),$_t_val.innerText=_val,_GAME_STAGEEDIT._setTextToFont($_t_val,_val,20)},_f_map_add:function(e){const $_abr=document.querySelectorAll(".area_blocks_rows");for(let _i=0;_i<$_abr.length;_i++){let $_ab=$_abr[_i].lastElementChild.cloneNode(!0);$_abr[_i].appendChild($_ab),$_ab.children.length}return e.stopPropagation(),e.preventDefault(),!1},_f_map_remove:function(e){const $_abr=document.querySelectorAll(".area_blocks_rows");for(let _i=0;_i<$_abr.length;_i++)$_abr[_i].lastElementChild.remove();return e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseover:function(e){return"IMG"===e.target.tagName&&(_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj=e.target,e.target.classList.add("over")),e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseout:function(e){if(null!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj&&void 0!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj)return _GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj.classList.remove("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_dragenter:function(e){return null!==this.$_do_area_parts_obj&&this.$_do_area_parts_obj.classList.remove("over"),this.$_do_area_parts_obj=e.target,this.$_do_area_parts_obj.classList.add("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_drop:function(e){console.log("as_drop");let _o=e.dataTransfer.getData("text"),$_ect=e.currentTarget,$_e=this.$_start_area_parts_obj;if($_ect.classList.remove("over"),0!==$_ect.childNodes.length&&($_ect.textContent=null),"move"===e.dataTransfer.effectAllowed)$_ect.appendChild(this.$_start_area_parts_obj);else{let $_cn=$_e.cloneNode(!0);if($_ect.appendChild($_cn),null!==_o.match(_MAP.collision_enemies)){let _obj=_MAP_THEME[_GAME_STAGEEDIT._theme]._enemies[_o]._o.obj;$_cn.children[0].width=parseInt(.8*_obj.width),$_cn.children[0].height=parseInt(.8*_obj.height)}if(null!==_o.match(_MAP.collision_map)){let _obj=_MAP_THEME[_GAME_STAGEEDIT._theme]._map[_o]._obj;$_cn.setAttribute("style","width:"+parseInt(.8*_obj.width)+"px;height:"+parseInt(.8*_obj.height)+"px")}$_ect.children[0].addEventListener("dragstart",this._f_pb_dragstart,!1)}return $_ect.setAttribute("data-val",_o),e.stopPropagation(),e.preventDefault(),!1},_f_i_dragover:function(e){return e.stopPropagation(),e.preventDefault(),!1},_f_i_drop:function(e){return console.log("form_inner drop"),"move"===e.dataTransfer.effectAllowed&&(this.$_start_area_parts_obj.parentNode.textContent=null,!1)},_f_ap_dragstart:function(e){_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),console.log("_f_ap_start")},_f_ap_dragend:function(e){return e.target.parentNode.classList.remove("drag"),e.stopPropagation(),e.preventDefault(),!1},_f_pb_dragstart:function(e){console.log("_f_pb_dragstart"),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),e.currentTarget.parentNode.setAttribute("data-val",0)},_f_bgmusic_play:function(e){let _b=document.querySelector("#bgmusic select").value;_GAME_STAGEEDIT._setAudioPlay(_CANVAS_AUDIOS["bg_"+_b])},_f_bgmusic_stop:function(e){_GAME_STAGEEDIT._setAudioStop()}};document.addEventListener("scroll",()=>{_GAME_STAGEEDIT_EVENTS._e_scroll()}),window.addEventListener("load",()=>{$_pb=document.getElementsByClassName("parts_block"),$_ab=document.getElementsByClassName("area_block"),$_mp=document.querySelector("#menu .prev"),$_mn=document.querySelector("#menu .next"),$_bm=document.querySelector("#bgmusic"),_GAME_STAGEEDIT._setAudioInit(_CANVAS_AUDIOS,_DATAAPI._init)});