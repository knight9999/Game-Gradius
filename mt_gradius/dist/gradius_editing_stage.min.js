"use strict";const _CANVAS_IMGS={vicviper1:{src:"images/gradius_vicviper1.png",rate:.26,obj:new Image},vicviper2:{src:"images/gradius_vicviper2.png",rate:.26,obj:new Image},vicviper3:{src:"images/gradius_vicviper3.png",rate:.26,obj:new Image},vicviper4:{src:"images/gradius_vicviper4.png",rate:.26,obj:new Image},vicviper5:{src:"images/gradius_vicviper5.png",rate:.26,obj:new Image},vicviper1_e:{src:"images/gradius_vicviper1_e.png",rate:.26,obj:new Image},vicviper2_e:{src:"images/gradius_vicviper2_e.png",rate:.26,obj:new Image},vicviper3_e:{src:"images/gradius_vicviper3_e.png",rate:.26,obj:new Image},vicviper4_e:{src:"images/gradius_vicviper4_e.png",rate:.26,obj:new Image},vicviper5_e:{src:"images/gradius_vicviper5_e.png",rate:.26,obj:new Image},vicviper_back1:{src:"images/gradius_vicviper_back1.png",rate:.26,obj:new Image},vicviper_back2:{src:"images/gradius_vicviper_back2.png",rate:.26,obj:new Image},vicviper_back3:{src:"images/gradius_vicviper_back3.png",rate:.26,obj:new Image},vicviper_back1_e:{src:"images/gradius_vicviper_back1_e.png",rate:.26,obj:new Image},vicviper_bomb:{src:"images/gradius_vicviper_bomb.png",rate:1,obj:new Image},vicviper_bomb_red:{src:"images/gradius_vicviper_bomb_red.png",rate:1,obj:new Image},option:{src:"images/option.png",rate:.3,obj:new Image},missile1:{src:"images/missile1.png",rate:.48,obj:new Image},missile2:{src:"images/missile2.png",rate:.48,obj:new Image},missile3:{src:"images/missile3.png",rate:.48,obj:new Image},missile4:{src:"images/missile4.png",rate:.48,obj:new Image},missile5:{src:"images/missile5.png",rate:.48,obj:new Image},missile6:{src:"images/missile6.png",rate:.48,obj:new Image},missile7:{src:"images/missile7.png",rate:.48,obj:new Image},missile8:{src:"images/missile8.png",rate:.48,obj:new Image},shot1:{src:"images/gradius_shot1.png",rate:.4,obj:new Image},shot2:{src:"images/gradius_shot2.png",rate:.4,obj:new Image},shot3:{src:"images/gradius_shot3.png",rate:.4,obj:new Image},meter:{src:"images/gradius_meter.png",rate:.5,obj:new Image},meter_c_speedup:{src:"images/gradius_meter_c_speedup.png",rate:.5,obj:new Image},meter_c_missile:{src:"images/gradius_meter_c_missile.png",rate:.5,obj:new Image},meter_c_double:{src:"images/gradius_meter_c_double.png",rate:.5,obj:new Image},meter_c_laser:{src:"images/gradius_meter_c_laser.png",rate:.5,obj:new Image},meter_c_option:{src:"images/gradius_meter_c_option.png",rate:.5,obj:new Image},meter_c_shield:{src:"images/gradius_meter_c_shield.png",rate:.5,obj:new Image},meter_blank:{src:"images/gradius_meter_blank.png",rate:.5,obj:new Image},meter_c_blank:{src:"images/gradius_meter_c_blank.png",rate:.5,obj:new Image},forcefield1:{src:"images/gradius_forcefield1.png",rate:1,obj:new Image},forcefield2:{src:"images/gradius_forcefield2.png",rate:1,obj:new Image},forcefield_red1:{src:"images/gradius_forcefield_red1.png",rate:1,obj:new Image},forcefield_red2:{src:"images/gradius_forcefield_red2.png",rate:1,obj:new Image},shield1:{src:"images/gradius_shield1.png",rate:.4,obj:new Image},shield2:{src:"images/gradius_shield2.png",rate:.4,obj:new Image},shield_red1:{src:"images/gradius_shield_red1.png",rate:.4,obj:new Image},shield_red2:{src:"images/gradius_shield_red2.png",rate:.4,obj:new Image},enemy_a_1:{src:"images/gradius_enemy_a_1.png",rate:.52,obj:new Image},enemy_a_2:{src:"images/gradius_enemy_a_2.png",rate:.52,obj:new Image},enemy_b_1:{src:"images/gradius_enemy_b_1.png",rate:.52,obj:new Image},enemy_b_2:{src:"images/gradius_enemy_b_2.png",rate:.52,obj:new Image},enemy_c_1:{src:"images/gradius_enemy_c_1.png",rate:.4,obj:new Image},enemy_c_2:{src:"images/gradius_enemy_c_2.png",rate:.4,obj:new Image},enemy_c_3:{src:"images/gradius_enemy_c_3.png",rate:.4,obj:new Image},enemy_c_4:{src:"images/gradius_enemy_c_4.png",rate:.4,obj:new Image},enemy_d_1:{src:"images/gradius_enemy_d_1.png",rate:.2,obj:new Image},enemy_d_2:{src:"images/gradius_enemy_d_2.png",rate:.2,obj:new Image},enemy_d_3:{src:"images/gradius_enemy_d_3.png",rate:.2,obj:new Image},enemy_d_4:{src:"images/gradius_enemy_d_4.png",rate:.2,obj:new Image},enemy_e_1:{src:"images/gradius_enemy_e_1.png",rate:.2,obj:new Image},enemy_e_2:{src:"images/gradius_enemy_e_2.png",rate:.2,obj:new Image},enemy_e_3:{src:"images/gradius_enemy_e_3.png",rate:.2,obj:new Image},enemy_e_4:{src:"images/gradius_enemy_e_4.png",rate:.2,obj:new Image},enemy_f_1:{src:"images/gradius_enemy_f_1.png",rate:.4,obj:new Image},enemy_f_2:{src:"images/gradius_enemy_f_2.png",rate:.4,obj:new Image},enemy_f_3:{src:"images/gradius_enemy_f_3.png",rate:.4,obj:new Image},enemy_f_4:{src:"images/gradius_enemy_f_4.png",rate:.4,obj:new Image},enemy_g_1:{src:"images/gradius_enemy_g_1.png",rate:.4,obj:new Image},enemy_g_2:{src:"images/gradius_enemy_g_2.png",rate:.4,obj:new Image},enemy_g_3:{src:"images/gradius_enemy_g_3.png",rate:.4,obj:new Image},enemy_g_4:{src:"images/gradius_enemy_g_4.png",rate:.4,obj:new Image},enemy_m_1:{src:"images/gradius_enemy_m_1.png",rate:.24,obj:new Image},enemy_m_2:{src:"images/gradius_enemy_m_2.png",rate:.24,obj:new Image},enemy_m_3:{src:"images/gradius_enemy_m_3.png",rate:.24,obj:new Image},enemy_m_4:{src:"images/gradius_enemy_m_4.png",rate:.24,obj:new Image},enemy_m_5:{src:"images/gradius_enemy_m_5.png",rate:.24,obj:new Image},enemy_m_6:{src:"images/gradius_enemy_m_6.png",rate:.24,obj:new Image},enemy_m_7:{src:"images/gradius_enemy_m_7.png",rate:.24,obj:new Image},enemy_m_8:{src:"images/gradius_enemy_m_8.png",rate:.24,obj:new Image},enemy_m_11:{src:"images/gradius_enemy_m_11.png",rate:.22,obj:new Image},enemy_m_12:{src:"images/gradius_enemy_m_12.png",rate:.22,obj:new Image},enemy_m_13:{src:"images/gradius_enemy_m_13.png",rate:.22,obj:new Image},enemy_m_14:{src:"images/gradius_enemy_m_14.png",rate:.22,obj:new Image},enemy_m_15:{src:"images/gradius_enemy_m_15.png",rate:.22,obj:new Image},enemy_m_16:{src:"images/gradius_enemy_m_16.png",rate:.22,obj:new Image},enemy_m_17:{src:"images/gradius_enemy_m_17.png",rate:.22,obj:new Image},enemy_o_1:{src:"images/gradius_enemy_o_1.png",rate:.3,obj:new Image},enemy_o_2:{src:"images/gradius_enemy_o_2.png",rate:.3,obj:new Image},enemy_p_1:{src:"images/gradius_enemy_p_1.png",rate:.26,obj:new Image},enemy_p_2:{src:"images/gradius_enemy_p_2.png",rate:.3,obj:new Image},enemy_p_3:{src:"images/gradius_enemy_p_3.png",rate:.3,obj:new Image},enemy_p_4:{src:"images/gradius_enemy_p_4.png",rate:.3,obj:new Image},enemy_p_5:{src:"images/gradius_enemy_p_5.png",rate:.3,obj:new Image},enemy_z:{src:"images/gradius_enemy_z_core.png",rate:.6,obj:new Image},enemy_z_1:{src:"images/gradius_enemy_z_core_1.png",rate:.6,obj:new Image},enemy_z_2:{src:"images/gradius_enemy_z_core_2.png",rate:.6,obj:new Image},enemy_z_3:{src:"images/gradius_enemy_z_core_3.png",rate:.6,obj:new Image},enemy_z_4_1:{src:"images/gradius_enemy_z_core_4_1.png",rate:.6,obj:new Image},enemy_z_4_2:{src:"images/gradius_enemy_z_core_4_2.png",rate:.6,obj:new Image},enemy_z_4_3:{src:"images/gradius_enemy_z_core_4_3.png",rate:.6,obj:new Image},enemy_z_4_4:{src:"images/gradius_enemy_z_core_4_4.png",rate:.6,obj:new Image},enemy_z_4_5:{src:"images/gradius_enemy_z_core_4_5.png",rate:.6,obj:new Image},enemy_collapes1:{src:"images/gradius_enemy_collapes1.png",rate:1,obj:new Image},enemy_collapes2:{src:"images/gradius_enemy_collapes2.png",rate:1,obj:new Image},enemy_collapes11:{src:"images/gradius_enemy_collapes11.png",rate:.2,obj:new Image},enemy_collapes12:{src:"images/gradius_enemy_collapes12.png",rate:.2,obj:new Image},enemy_collapes13:{src:"images/gradius_enemy_collapes13.png",rate:.2,obj:new Image},enemy_collapes91:{src:"images/gradius_enemy_collapes91.png",rate:.2,obj:new Image},enemy_collapes92:{src:"images/gradius_enemy_collapes92.png",rate:.2,obj:new Image},enemy_collapes93:{src:"images/gradius_enemy_collapes93.png",rate:.2,obj:new Image},enemy_collapes94:{src:"images/gradius_enemy_collapes94.png",rate:.2,obj:new Image},enemy_collapes95:{src:"images/gradius_enemy_collapes95.png",rate:.2,obj:new Image},enemy_collapes96:{src:"images/gradius_enemy_collapes96.png",rate:.2,obj:new Image},enemy_bullet1:{src:"images/gradius_enemy_bullet1.png",rate:.8,obj:new Image},enemy_bullet2:{src:"images/gradius_enemy_bullet2.png",rate:.8,obj:new Image},enemy_bullet_z:{src:"images/gradius_enemy_bullet_z.png",rate:.2,obj:new Image},pc1:{src:"images/gradius_pc1.png",rate:.5,obj:new Image},pc2:{src:"images/gradius_pc2.png",rate:.5,obj:new Image},pc3:{src:"images/gradius_pc3.png",rate:.5,obj:new Image},pc4:{src:"images/gradius_pc4.png",rate:.5,obj:new Image},pc5:{src:"images/gradius_pc5.png",rate:.5,obj:new Image},map_c_A:{src:"images/gradius_map_c_A.png",rate:1,obj:new Image},map_f_A:{src:"images/gradius_map_f_A.png",rate:1,obj:new Image},map_f_B:{src:"images/gradius_map_f_B.png",rate:1,obj:new Image},map_f_C:{src:"images/gradius_map_f_C.png",rate:1,obj:new Image},map_f_D:{src:"images/gradius_map_f_D.png",rate:1,obj:new Image},map_f_E:{src:"images/gradius_map_f_E.png",rate:1,obj:new Image},map_f_F:{src:"images/gradius_map_f_F.png",rate:1,obj:new Image},map_f_G:{src:"images/gradius_map_f_G.png",rate:1,obj:new Image},map_f_H:{src:"images/gradius_map_f_H.png",rate:1,obj:new Image},map_f_I:{src:"images/gradius_map_f_I.png",rate:1,obj:new Image},map_f_J:{src:"images/gradius_map_f_J.png",rate:1,obj:new Image},map_f_K:{src:"images/gradius_map_f_K.png",rate:1,obj:new Image},map_f_L:{src:"images/gradius_map_f_L.png",rate:1,obj:new Image},map_f_M:{src:"images/gradius_map_f_M.png",rate:1,obj:new Image},map_f_N:{src:"images/gradius_map_f_N.png",rate:1,obj:new Image},map_f_O:{src:"images/gradius_map_f_O.png",rate:1,obj:new Image},map_f_P:{src:"images/gradius_map_f_P.png",rate:1,obj:new Image}},_CANVAS_IMGS_INIT={font_0:{src:"images/gradius_font_0.png",rate:1,obj:new Image},font_1:{src:"images/gradius_font_1.png",rate:1,obj:new Image},font_2:{src:"images/gradius_font_2.png",rate:1,obj:new Image},font_3:{src:"images/gradius_font_3.png",rate:1,obj:new Image},font_4:{src:"images/gradius_font_4.png",rate:1,obj:new Image},font_5:{src:"images/gradius_font_5.png",rate:1,obj:new Image},font_6:{src:"images/gradius_font_6.png",rate:1,obj:new Image},font_7:{src:"images/gradius_font_7.png",rate:1,obj:new Image},font_8:{src:"images/gradius_font_8.png",rate:1,obj:new Image},font_9:{src:"images/gradius_font_9.png",rate:1,obj:new Image},font_a:{src:"images/gradius_font_a.png",rate:1,obj:new Image},font_b:{src:"images/gradius_font_b.png",rate:1,obj:new Image},font_c:{src:"images/gradius_font_c.png",rate:1,obj:new Image},font_d:{src:"images/gradius_font_d.png",rate:1,obj:new Image},font_e:{src:"images/gradius_font_e.png",rate:1,obj:new Image},font_f:{src:"images/gradius_font_f.png",rate:1,obj:new Image},font_g:{src:"images/gradius_font_g.png",rate:1,obj:new Image},font_h:{src:"images/gradius_font_h.png",rate:1,obj:new Image},font_i:{src:"images/gradius_font_i.png",rate:1,obj:new Image},font_j:{src:"images/gradius_font_j.png",rate:1,obj:new Image},font_k:{src:"images/gradius_font_k.png",rate:1,obj:new Image},font_l:{src:"images/gradius_font_l.png",rate:1,obj:new Image},font_m:{src:"images/gradius_font_m.png",rate:1,obj:new Image},font_n:{src:"images/gradius_font_n.png",rate:1,obj:new Image},font_o:{src:"images/gradius_font_o.png",rate:1,obj:new Image},font_p:{src:"images/gradius_font_p.png",rate:1,obj:new Image},font_q:{src:"images/gradius_font_q.png",rate:1,obj:new Image},font_r:{src:"images/gradius_font_r.png",rate:1,obj:new Image},font_s:{src:"images/gradius_font_s.png",rate:1,obj:new Image},font_t:{src:"images/gradius_font_t.png",rate:1,obj:new Image},font_u:{src:"images/gradius_font_u.png",rate:1,obj:new Image},font_v:{src:"images/gradius_font_v.png",rate:1,obj:new Image},font_w:{src:"images/gradius_font_w.png",rate:1,obj:new Image},font_x:{src:"images/gradius_font_x.png",rate:1,obj:new Image},font_y:{src:"images/gradius_font_y.png",rate:1,obj:new Image},font_z:{src:"images/gradius_font_z.png",rate:1,obj:new Image},"font_:":{src:"images/gradius_font_27.png",rate:1,obj:new Image},gradius_powermeterselect:{src:"images/gradius_powermeterselect.png",rate:.28,obj:new Image},gradius_powermeterselect_shield:{src:"images/gradius_powermeterselect_shield.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_:{src:"images/gradius_powermeterselect_shield_.png",rate:.28,obj:new Image},gradius_powermeterselect_0:{src:"images/gradius_powermeterselect_0.png",rate:.28,obj:new Image},gradius_powermeterselect_1:{src:"images/gradius_powermeterselect_1.png",rate:.28,obj:new Image},gradius_powermeterselect_2:{src:"images/gradius_powermeterselect_2.png",rate:.28,obj:new Image},gradius_powermeterselect_3:{src:"images/gradius_powermeterselect_3.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_0:{src:"images/gradius_powermeterselect_shield_0.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_1:{src:"images/gradius_powermeterselect_shield_1.png",rate:.28,obj:new Image}};let _MAPDEFS="",_MAPDEF="",_MAP_PETTERN=1,_BACKGROUND_SPEED=0;const _MAP_ENEMIES={_DEF_DIR:{_U:0,_D:1,_R:2,_L:3},_setDir:function(e,_){let t=this,a=_MAP.isMapCollision(e,_-1)?t._DEF_DIR._U:t._DEF_DIR._D;return a=_MAP.isMapCollision(e,_+1)?t._DEF_DIR._D:t._DEF_DIR._U},_ENEMIES:{a:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_a(e,_,t))},_o:_CANVAS_IMGS.enemy_a_1},b:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_b(e,_,t))},_o:_CANVAS_IMGS.enemy_b_1},c:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_c(e,_,t))},_o:_CANVAS_IMGS.enemy_c_1},d:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_d(e,_,t))},_o:_CANVAS_IMGS.enemy_d_1},e:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_e(e,_,t))},_o:_CANVAS_IMGS.enemy_e_1},f:{_f:function(e,_,t){t=_<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_f(e,_,t))},_o:_CANVAS_IMGS.enemy_f_1},g:{_f:function(e,_,t){t=_<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_g(e,_,t))},_o:_CANVAS_IMGS.enemy_g_1},m:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_m(e,_,t))},_o:_CANVAS_IMGS.enemy_m_1},n:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_n(e,_))},_o:_CANVAS_IMGS.enemy_o_1},o:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_o(e,_))},_o:_CANVAS_IMGS.enemy_o_1},p:{_f:function(e,_,t){let a=new ENEMY_p(e,_);_ENEMIES.push(a),_ENEMIES_BOUNDS.push(a)},_o:_CANVAS_IMGS.enemy_p_1},z:{_f:function(e,_,t){_ENEMIES.push(new ENEMY_BOSS_BOGCORE(_x,_y,_d))},_o:_CANVAS_IMGS.enemy_z}}},_MAP_THEME={_THEME1:{_p:{},_enemies:{}},_THEME2:{_p:{A:{_o:_CANVAS_IMGS.map_f_A,_s:"111111111,111111111,000000000",_mx:function(e){return e},_my:function(e){return e}},B:{_o:_CANVAS_IMGS.map_f_B,_s:"111111111,111111111,000000000",_mx:function(e){return e},_my:function(e){return e}},C:{_o:_CANVAS_IMGS.map_f_C,_s:"000000000,111111111,111111111",_mx:function(e){return e},_my:function(e){return e}},D:{_o:_CANVAS_IMGS.map_f_D,_s:"000000000,111111111,111111111",_mx:function(e){return e},_my:function(e){return e}},E:{_o:_CANVAS_IMGS.map_f_E,_s:"1",_mx:function(e){return e},_my:function(e){return e}},F:{_o:_CANVAS_IMGS.map_f_F,_s:"000110000,000110000,001111000,011111100,011111110,111111111",_mx:function(e){return e},_my:function(e){return e}},G:{_o:_CANVAS_IMGS.map_f_G,_s:"111111110,011111110,011111100,001111000,000110000,000110000",_mx:function(e){return e},_my:function(e){return e}},H:{_o:_CANVAS_IMGS.map_f_H,_s:"00000000000000000000,00000111111111111110,00000111111110000000,00000000011110000000,00000000001100000000,00000000001100000000,00000000001100000000,11111111111111111100,01111111111111111100,00000000011000000000,00000000011000000000,00000000111000000000,00000001111110000000",_mx:function(e){return e},_my:function(e){return e}},I:{_o:_CANVAS_IMGS.map_f_I,_s:"000000010000000,000000010000000,000000111000000,000001111100000,000011111110000,000111111111000,001111111111100,001111111111100,011111111111110,111111111111111",_mx:function(e){return e},_my:function(e){return e}},J:{_o:_CANVAS_IMGS.map_f_J,_s:"111111111111111,011111111111110,001111111111100,001111111111100,000111111111000,000011111110000,000001111100000,000000111000000,000000010000000,000000010000000",_mx:function(e){return e},_my:function(e){return e}},K:{_o:_CANVAS_IMGS.map_f_K,_s:"010",_mx:function(e){return e},_my:function(e){return e}},L:{_o:_CANVAS_IMGS.map_f_L,_s:"010",_mx:function(e){return e},_my:function(e){return e}},M:{_o:_CANVAS_IMGS.map_f_M,_s:"0111,1111",_mx:function(e){return e},_my:function(e){return e}},N:{_o:_CANVAS_IMGS.map_f_N,_s:"1111,0111",_mx:function(e){return e},_my:function(e){return e}},O:{_o:_CANVAS_IMGS.map_f_O,_s:"1111,1110",_mx:function(e){return e},_my:function(e){return e}},P:{_o:_CANVAS_IMGS.map_f_P,_s:"1110,1111",_mx:function(e){return e},_my:function(e){return e}}},_enemies:{}},_THEME3:{_p:{A:{_o:_CANVAS_IMGS.map_c_A,_s:"1",_mx:function(e){return e},_my:function(e){return e}},H:{_o:_CANVAS_IMGS.map_f_H,_s:"00000000000000000000,00000111111111111110,00000111111110000000,00000000011110000000,00000000001100000000,00000000001100000000,00000000001100000000,11111111111111111100,01111111111111111100,00000000011000000000,00000000011000000000,00000000111000000000,00000001111110000000",_mx:function(e){return e},_my:function(e){return e}},M:{_o:_CANVAS_IMGS.map_f_M,_s:"0111,1111",_mx:function(e){return e},_my:function(e){return e}},N:{_o:_CANVAS_IMGS.map_f_N,_s:"1111,0111",_mx:function(e){return e},_my:function(e){return e}},O:{_o:_CANVAS_IMGS.map_f_O,_s:"1111,1110",_mx:function(e){return e},_my:function(e){return e}},P:{_o:_CANVAS_IMGS.map_f_P,_s:"1110,1111",_mx:function(e){return e},_my:function(e){return e}}},_enemies:{}}};class GameObject_MAP{constructor(e){this.pt=e||0,this.initx=0,this.x=this.initx,this.collision=new RegExp("[1A-Z]"),this.collision_enemies=new RegExp("[a-z]","g"),this.collision_map=new RegExp("[A-Z]"),this.collision_map_d=new RegExp("[BD]"),this.t=25,this.mapdef=new Array,this.mapdef_col=new Array,this.map_theme=0,this.map_pettern=0,this.map_difficult=0,this.map_background_speed=0}init(e){_AJAX("./gradius_map.json","json",function(_){_MAPDEFS=_,e()})}set_stage_map_pattern(e){this.map_pettern=e}init_stage_map(){this.x=parseInt(_MAPDEFS[this.map_pettern]._initx),this.initx=parseInt(_MAPDEFS[this.map_pettern]._initx),this.mapdef=_MAPDEFS[this.map_pettern]._map,this.map_difficult=parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,_ENEMY_DIFFICULT=_ISDEBUG?_ENEMY_DIFFICULT:parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,this.map_background_speed=parseInt(_MAPDEFS[this.map_pettern]._speed),_BACKGROUND_SPEED=parseInt(_MAPDEFS[this.map_pettern]._speed),_MAP_PETTERN=this.map_pettern,this.map_theme=_MAPDEFS[this.map_pettern]._theme,this.init_mapdef_col()}init_enemies_location(){let e=this;for(let _=0;_<e.mapdef.length;_++)for(let t=0;t<e.mapdef[_].length;t++){let a=e.mapdef[_][t];if(e.isCollisionBit(a))continue;if("0"===a)continue;let n=_MAP_ENEMIES._setDir(t,_);_MAP_ENEMIES._ENEMIES[a]._f(e.x+t*e.t,_*e.t,n)}}init_mapdef_col(){let e=this;Object.assign(e.mapdef_col,e.mapdef);for(let _=0;_<e.mapdef_col.length;_++)e.mapdef_col[_]=e.mapdef_col[_].replace(/[a-zA-Z]/gi,"0");for(let _=0;_<e.mapdef.length;_++){let t=e.mapdef[_];for(let a=0;a<t.length;a++){if(!e.isCollisionBit(t[a]))continue;if("1"===t[a])continue;let n=_MAP_THEME[e.map_theme]._p[t[a]];void 0===n&&console.log("テーマ:"+e.map_theme+"に対して "+t[a]+"の定義がありません。");let r=n._s.split(",");for(let n=0;n<r.length;n++){let s=e.mapdef_col[_+n],i=e.mapdef[_+n];e.mapdef_col[_+n]=s.substr(0,a)+function(_,t,a){return e.setCollisionBit(a,t)}(i.substr(a,r[n].length),s.substr(a,r[n].length),r[n])+s.substr(a+r[n].length,t.length)}}}}setCollisionBit(e,_){let t="";for(let a=0;a<e.length;a++)"0"!==e[a]?t+="1":t+=_[a];return t}getCollisionFlag(){return this.collision}getBackGroundSpeed(){return this.map_background_speed}get_stage_map_pattern(e){return this.map_pettern}getMapXToPx(e){return e*this.t}getMapYToPx(e){return e*this.t}getMapX(e){return parseInt((e+_SCROLL_POSITION-this.initx)/this.t)}getMapY(e){return parseInt(e/this.t)}isCollisionBit(e){return null!==e.match(this.collision)}isEnemiesBit(e){return null!==e.match(this.collision_enemies)}isMapDouble(e){return null!==e.match(this.collision_map_d)}isMapBefore(e,_){return e<0}isMapLastSide(e,_){let t=this;return void 0!==t.mapdef[_]&&(void 0===t.mapdef[_][e]||e===t.mapdef[_].length-1)}isMapOver(e,_){let t=this;return void 0!==t.mapdef[_]&&(void 0===t.mapdef[_][e]||e>t.mapdef[_].length-1)}isMapCollision(e,_){let t=this;return void 0!==t.mapdef_col[_]&&(void 0!==t.mapdef_col[_][e]&&!!t.isCollisionBit(t.mapdef_col[_][e]))}isPlayersShotCollision(){for(let e=0;e<_PLAYERS_SHOTS[_SHOTTYPE].length;e++){let _=_PLAYERS_SHOTS[_SHOTTYPE][e];for(let e=0;e<_.shots.length;e++){let t=_.shots[e];t._shot_alive&&(t.x<this.initx-_SCROLL_POSITION||t.x>this.mapdef[0].length*this.t+this.initx-_SCROLL_POSITION||_.map_collition(t))}}for(let e=0;e<_PLAYERS_MISSILE.length;e++){let _=_PLAYERS_MISSILE[e];if(_.player.isalive())for(let e=0;e<_.shots.length;e++){let t=_.shots[e];t._shot_alive&&(t._c>0||_.map_collition(t))}}}show(){}showMapForStageselect(e){let _=this;if(null!==e&&void 0!==e){for(let t=0;t<e._map.length;t++){let a=e._map[t].length;for(let n=0;n<(a>30?30:a);n++){let a=e._map[t][n];if("0"!==a)if(null!==a.match(_.collision_enemies)){let e=_CANVAS_IMGS["enemy_"+a+"_1"].obj;_CONTEXT.drawImage(e,50+10*n,130+10*t,e.width/2.5,e.height/2.5)}else{let _=_MAP_THEME[e._theme]._p[a],r=_._o.obj;_CONTEXT.drawImage(r,50+10*n,130+10*_._my(t),r.width/2.5,r.height/2.5)}}}_CONTEXT.fillStyle="rgba(0,0,0,1)",_CONTEXT.fillRect(351,130,_CANVAS.width,200)}}move(){let e=this;e.x-=e.map_background_speed;for(let _=0;_<e.mapdef.length;_++)for(let t=0;t<e.mapdef[_].length;t++){let a=e.mapdef[_][t];if(!e.isCollisionBit(a))continue;if(e.x+t*e.t<-500||e.x+t*e.t>_CANVAS.width+100)continue;let n=_MAP_THEME[e.map_theme]._p[a],r=n._o.obj;_CONTEXT.drawImage(r,e.x+n._mx(t)*e.t,n._my(_)*e.t,r.width,r.height)}}}const _MAP=new GameObject_MAP;let $_pb=null,$_ab=null,$_mp=null,$_mn=null;_MAP_PETTERN=0;const _AJAX=function(e,_,t){let a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&(200===a.status?(console.log("OK"),t(a.response)):console.log("NG"))},a.open("GET",e),a.responseType=_||"json",a.send(null)},_DATAAPI={_data_api:"",_blog_id:3,_init:function(){let e=this;e._data_api=new MT.DataAPI({baseUrl:"http://localhost/mt/mt-data-api.cgi",clientId:"api11entries"}),e._data_api.getToken(function(_){if(_.error)return 401===_.error.code&&(console.log("reload after 401 error occuered in updating."),location.href=e._data_api.getAuthorizationUrl(location.href)),!1;_GAME_STAGEEDIT._init_images(_CANVAS_IMGS,_GAME_STAGEEDIT._init)})},_set_entryupdate:function(e){let _=this;_._data_api.updateEntry(_._blog_id,e._eid,e,function(e){if(e.error)return alert("エントリ更新に失敗しました。"),void(401===e.error.code&&(location.href=_._data_api.getAuthorizationUrl(location.href)));alert("エントリ更新しました。"),_MAP.init(function(){_MAP_PETTERN=0,_GAME_STAGEEDIT._setData(_MAP_PETTERN);const e=document.querySelectorAll("#area_parts .parts_block");for(t=0;t<e.length;t++)e[t].setAttribute("draggable",!0),e[t].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),e[t].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1);const _=document.querySelectorAll('.form_group .col_r input[type="range"]');for(var t=0;t<_.length;t++)_[t].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),_[t].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();const a=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<a.length;e++)_GAME_STAGEEDIT._setTextToFont(a[e],a[e].innerText,20)})})}},_GAME_STAGEEDIT={_theme:0,_setInitMap:function(e){this._theme=e._theme;let _=e._map,t="";for(let a=0;a<_.length;a++){t+='<div class="area_blocks_rows">';for(let n=0;n<_[a].length;n++)t+='<div class="area_block" data-val="'+_[a][n]+'" onmouseover="_GAME_STAGEEDIT_EVENTS._f_as_mouseover(event);" onmouseout="_GAME_STAGEEDIT_EVENTS._f_as_mouseout(event);" ondragenter="_GAME_STAGEEDIT_EVENTS._f_as_dragenter(event);" ondrop="_GAME_STAGEEDIT_EVENTS._f_as_drop(event);">'+function(_){if("0"===_)return"";let t='<div class="parts_block" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">';if(null!==_.match(_MAP.collision_enemies)){let e=_MAP_ENEMIES._ENEMIES[_]._o.obj;t+='<img width="'+parseInt(.67*e.width)+'" height="'+parseInt(.67*e.height)+'" src="'+e.src+'">'}else if(null!==_.match(_MAP.collision_map)){let a=_MAP_THEME[e._theme]._p[_]._o.obj;t+='<img width="'+parseInt(.8*a.width)+'" height="'+parseInt(.8*a.height)+'" src="'+a.src+'">'}return t+"</div>"}(_[a][n])+"</div>\x3c!-- /.area_block --\x3e";t+="</div>\x3c!-- /.area_blocks_rows --\x3e"}document.querySelector(".area_blocks.drop").innerHTML=t},_setInitPartsBlocksWrapper:function(e){e._map;let _="";for(let[e,t]of Object.entries(_MAP_ENEMIES._ENEMIES))_+='<div class="parts_block_wrapper" data-val="'+e+'"><div class="text">enemy '+e+'</div><div class="parts_block"><img src="'+t._o.src+'"></div></div>\x3c!-- /.parts_block_wrapper --\x3e';document.querySelector(".parts_blocks_wrapper.enemy .parts_blocks").innerHTML=_,_="";for(let[t,a]of Object.entries(_MAP_THEME[e._theme]._p))_+='<div class="parts_block_wrapper" data-val="'+t+'"><div class="text">MAP '+t+'</div><div class="parts_block"><img src="'+a._o.src+'"></div></div>\x3c!-- /.parts_block_wrapper --\x3e';document.querySelector(".parts_blocks_wrapper.map .parts_blocks").innerHTML=_},_clearMap:function(){document.querySelector(".area_blocks.drop").textContent=null},_getTextToFont:function(e){let _="",t=e.children;for(let e=0;e<t.length;e++)_+=t[e];return _},_setTextToFont:function(e,_,t){if(void 0===e||null===e)return;t=t||30;let a="";for(let e=0;e<_.length;e++)" "!==_[e]?":"!==_[e]&&(a+='<img src="./images/gradius_font_'+_[e]+'.png" width="'+t+'">'):a+='<img src="./images/gradius_spacer.png" width="'+t+'">';e.innerHTML=a},_clearData:function(){},_setData:function(e){let _=this,t=_MAPDEFS[e];_._setInitMap(t),_._setInitPartsBlocksWrapper(t),document.querySelector('#title input[name="title"]').value=t._title,document.querySelector('#body textarea[name="body"]').value=t._body;const a=document.querySelector('#init input[name="init"]'),n=document.querySelector("#init .col_r .val");a.value=t._initx,n.setAttribute("data-val",t._initx),_._setTextToFont(n,t._initx,20);const r=document.querySelector('#speed input[name="speed"]'),s=document.querySelector("#speed .col_r .val");r.value=t._speed,s.setAttribute("data-val",t._speed),_._setTextToFont(s,t._speed,20);const i=document.querySelector('#difficult input[name="difficult"]'),o=document.querySelector("#difficult .col_r .val");i.value=t._difficult,o.setAttribute("data-val",t._difficult),_._setTextToFont(o,t._difficult,20)},setDataForDataApi:function(){let e=function(e){let _="";_+='"_map":[';let t=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<t.length;e++){let a=t[e].children;_+='"';for(let e=0;e<a.length;e++)_+=a[e].getAttribute("data-val");_+=e===t.length-1?'"':'",'}return _+="],",_+='"_title":"'+document.querySelector('#title input[name="title"]').value+'",',_+='"_eid":"'+e._eid+'",',_+='"_theme":"'+e._theme+'",',_+='"_body":"'+document.querySelector('#body textarea[name="body"]').value+'",',_+='"_initx":"'+document.querySelector("#init .col_r .val").getAttribute("data-val")+'",',_+='"_speed":"'+document.querySelector("#speed .col_r .val").getAttribute("data-val")+'",',_+='"_difficult":"'+document.querySelector("#difficult .col_r .val").getAttribute("data-val")+'"'}(_MAPDEFS[_MAP_PETTERN]),_={title:document.querySelector('#title input[name="title"]').value,status:"Publish",_eid:_MAPDEFS[_MAP_PETTERN]._eid,body:e};_DATAAPI._set_entryupdate(_)},_setEntryLink:function(){$_mp.classList.remove("off"),$_mn.classList.remove("off"),0===_MAP_PETTERN&&$_mp.classList.add("off"),_MAP_PETTERN>=_MAPDEFS.length-1&&$_mn.classList.add("off")},_init_images:function(e,_){let t=0;for(let a in e){let n=e[a];n.obj.src=e[a].src,n.obj.onload=function(){n.obj.width*=n.rate,n.obj.height*=n.rate,++t>=Object.keys(e).length&&_()}}},_init:function(){const e=_GAME_STAGEEDIT;_MAP.init(function(){console.log("success"),e._setData(_MAP_PETTERN);const _=document.querySelectorAll("#area_parts .parts_block");for(a=0;a<_.length;a++)_[a].setAttribute("draggable",!0),_[a].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),_[a].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1);const t=document.querySelectorAll('.form_group .col_r input[type="range"]');for(var a=0;a<t.length;a++)t[a].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),t[a].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();const n=document.querySelectorAll("h1,h2,h3,#map_bts a,#entrylink a,label.col_l,div.col_r .val,div.col_r label span, .parts_block_wrapper .text, #menu_inner a");for(let _=0;_<n.length;_++)e._setTextToFont(n[_],n[_].innerText,20)})}},_GAME_STAGEEDIT_EVENTS={$_do_area_parts_obj:null,$_start_area_parts_obj:null,$_mouseover_area_parts_obj:null,_e_entrylink_prev:function(e){if(0===_MAP_PETTERN)return;_MAP_PETTERN--,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink();const _=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<_.length;e++)_GAME_STAGEEDIT._setTextToFont(_[e],_[e].innerText,20);return!1},_e_entrylink_next:function(e){if(_MAP_PETTERN>=_MAPDEFS.length-1)return;_MAP_PETTERN++,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink();const _=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<_.length;e++)_GAME_STAGEEDIT._setTextToFont(_[e],_[e].innerText,20);return!1},_e_update:function(){return confirm("更新しますか?")?_GAME_STAGEEDIT.setDataForDataApi():console.log("false"),!1},_e_scroll:function(e){const _=document.body,t=document.body.clientHeight,a=document.getElementById("menu").offsetHeight;_.scrollTop+window.innerHeight>t-a/2?_.classList.remove("ismenu"):_.classList.add("ismenu")},_f_fg_range:function(e){let _=e.target.parentNode.previousElementSibling,t=e.target.value;_.setAttribute("data-val",t),_.innerText=t,_GAME_STAGEEDIT._setTextToFont(_,t,20)},_f_map_add:function(e){const _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++){let t=_[e].lastElementChild.cloneNode(!0);_[e].appendChild(t),t.children.length}return e.stopPropagation(),e.preventDefault(),!1},_f_map_remove:function(e){const _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++)_[e].lastElementChild.remove();return e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseover:function(e){return"IMG"===e.target.tagName&&(_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj=e.target,e.target.classList.add("over")),e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseout:function(e){if(null!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj&&void 0!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj)return _GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj.classList.remove("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_dragenter:function(e){return null!==this.$_do_area_parts_obj&&this.$_do_area_parts_obj.classList.remove("over"),this.$_do_area_parts_obj=e.target,this.$_do_area_parts_obj.classList.add("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_drop:function(e){console.log("as_drop");let _=e.dataTransfer.getData("text"),t=e.currentTarget,a=this.$_start_area_parts_obj;if(t.classList.remove("over"),0!==t.childNodes.length&&(t.textContent=null),"move"===e.dataTransfer.effectAllowed)t.appendChild(this.$_start_area_parts_obj);else{let e=a.cloneNode(!0);if(t.appendChild(e),null!==_.match(_MAP.collision_enemies)){let t=_MAP_ENEMIES._ENEMIES[_]._o.obj;e.children[0].width=parseInt(.67*t.width),e.children[0].height=parseInt(.67*t.height)}if(null!==_.match(_MAP.collision_map)){let t=_MAP_THEME[_GAME_STAGEEDIT._theme]._p[_]._o.obj;e.children[0].width=parseInt(.8*t.width),e.children[0].height=parseInt(.8*t.height)}t.children[0].addEventListener("dragstart",this._f_pb_dragstart,!1)}return t.setAttribute("data-val",_),e.stopPropagation(),e.preventDefault(),!1},_f_i_dragover:function(e){return e.stopPropagation(),e.preventDefault(),!1},_f_i_drop:function(e){return console.log("form_inner drop"),"move"===e.dataTransfer.effectAllowed&&(this.$_start_area_parts_obj.parentNode.textContent=null,!1)},_f_ap_dragstart:function(e){_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),console.log("_f_ap_start")},_f_ap_dragend:function(e){return e.target.parentNode.classList.remove("drag"),e.stopPropagation(),e.preventDefault(),!1},_f_pb_dragstart:function(e){console.log("_f_pb_dragstart"),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),e.currentTarget.parentNode.setAttribute("data-val",0)}};window.onload=function(){$_pb=document.getElementsByClassName("parts_block"),$_ab=document.getElementsByClassName("area_block"),$_mp=document.querySelector("#menu .prev"),$_mn=document.querySelector("#menu .next"),_DATAAPI._init()};