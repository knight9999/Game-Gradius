"use strict";const _CANVAS_IMGS={vicviper:{src:"images/gradius_vicviper.png",rate:1,obj:new Image},vicviper_back:{src:"images/gradius_vicviper_back.png",rate:1,obj:new Image},vicviper_bomb:{src:"images/gradius_vicviper_bomb.png",rate:1,obj:new Image},vicviper_bomb_red:{src:"images/gradius_vicviper_bomb_red.png",rate:1,obj:new Image},option:{src:"images/option.png",rate:1,obj:new Image},forcefield:{src:"images/gradius_forcefield.png",rate:1,obj:new Image},shield:{src:"images/gradius_shield.png",rate:1,obj:new Image},gradius_missile:{src:"images/gradius_missile.png",rate:1,obj:new Image},shot1:{src:"images/gradius_shot1.png",rate:.4,obj:new Image},shot2:{src:"images/gradius_shot2.png",rate:.4,obj:new Image},shot3:{src:"images/gradius_shot3.png",rate:.4,obj:new Image},shot_laser_col:{src:"images/gradius_shot_laser_col.png",rate:1,obj:new Image},meter:{src:"images/gradius_meter.png",rate:1,obj:new Image},meter_c:{src:"images/gradius_meter_c.png",rate:1,obj:new Image},enemy_fan:{src:"images/gradius_enemy_fan.png",rate:1,obj:new Image},enemy_a_1:{src:"images/gradius_enemy_a_1.png",rate:.55,obj:new Image},enemy_a_2:{src:"images/gradius_enemy_a_2.png",rate:.55,obj:new Image},enemy_b_1:{src:"images/gradius_enemy_b_1.png",rate:.55,obj:new Image},enemy_b_2:{src:"images/gradius_enemy_b_2.png",rate:.55,obj:new Image},enemy_c_1:{src:"images/gradius_enemy_c_1.png",rate:.4,obj:new Image},enemy_c_2:{src:"images/gradius_enemy_c_2.png",rate:.4,obj:new Image},enemy_c_3:{src:"images/gradius_enemy_c_3.png",rate:.4,obj:new Image},enemy_c_4:{src:"images/gradius_enemy_c_4.png",rate:.4,obj:new Image},enemy_d_1:{src:"images/gradius_enemy_d_1.png",rate:.2,obj:new Image},enemy_d_2:{src:"images/gradius_enemy_d_2.png",rate:.2,obj:new Image},enemy_d_3:{src:"images/gradius_enemy_d_3.png",rate:.2,obj:new Image},enemy_d_4:{src:"images/gradius_enemy_d_4.png",rate:.2,obj:new Image},enemy_e_1:{src:"images/gradius_enemy_e_1.png",rate:.2,obj:new Image},enemy_e_2:{src:"images/gradius_enemy_e_2.png",rate:.2,obj:new Image},enemy_e_3:{src:"images/gradius_enemy_e_3.png",rate:.2,obj:new Image},enemy_e_4:{src:"images/gradius_enemy_e_4.png",rate:.2,obj:new Image},enemy_f_1:{src:"images/gradius_enemy_f_1.png",rate:.4,obj:new Image},enemy_f_2:{src:"images/gradius_enemy_f_2.png",rate:.4,obj:new Image},enemy_f_3:{src:"images/gradius_enemy_f_3.png",rate:.4,obj:new Image},enemy_f_4:{src:"images/gradius_enemy_f_4.png",rate:.4,obj:new Image},enemy_g_1:{src:"images/gradius_enemy_g_1.png",rate:.4,obj:new Image},enemy_g_2:{src:"images/gradius_enemy_g_2.png",rate:.4,obj:new Image},enemy_g_3:{src:"images/gradius_enemy_g_3.png",rate:.4,obj:new Image},enemy_g_4:{src:"images/gradius_enemy_g_4.png",rate:.4,obj:new Image},enemy_m_1:{src:"images/gradius_enemy_m_1.png",rate:.24,obj:new Image},enemy_m_2:{src:"images/gradius_enemy_m_2.png",rate:.24,obj:new Image},enemy_m_3:{src:"images/gradius_enemy_m_3.png",rate:.24,obj:new Image},enemy_m_4:{src:"images/gradius_enemy_m_4.png",rate:.24,obj:new Image},enemy_m_5:{src:"images/gradius_enemy_m_5.png",rate:.24,obj:new Image},enemy_m_6:{src:"images/gradius_enemy_m_6.png",rate:.24,obj:new Image},enemy_m_7:{src:"images/gradius_enemy_m_7.png",rate:.24,obj:new Image},enemy_m_8:{src:"images/gradius_enemy_m_8.png",rate:.24,obj:new Image},enemy_m_group:{src:"images/gradius_enemy_m_group.png",rate:1,obj:new Image},enemy_o_1:{src:"images/gradius_enemy_o_1.png",rate:.3,obj:new Image},enemy_o_2:{src:"images/gradius_enemy_o_2.png",rate:.3,obj:new Image},enemy_p_1:{src:"images/gradius_enemy_p_1.png",rate:1,obj:new Image},enemy_p_2:{src:"images/gradius_enemy_p_2.png",rate:.3,obj:new Image},enemy_p_3:{src:"images/gradius_enemy_p_3.png",rate:.3,obj:new Image},enemy_p_4:{src:"images/gradius_enemy_p_4.png",rate:.3,obj:new Image},enemy_p_5:{src:"images/gradius_enemy_p_5.png",rate:.3,obj:new Image},enemy_m_a_1:{src:"images/gradius_enemy_m_a_1.png",rate:.25,obj:new Image},enemy_m_a_2:{src:"images/gradius_enemy_m_a_2.png",rate:.25,obj:new Image},enemy_m_b_1:{src:"images/gradius_enemy_m_b_1.png",rate:.25,obj:new Image},enemy_m_b_2:{src:"images/gradius_enemy_m_b_2.png",rate:.25,obj:new Image},enemy_m_z:{src:"images/gradius_enemy_m_z.png",rate:.25,obj:new Image},enemy_moai_ring:{src:"images/gradius_enemy_moai_ring.png",rate:1,obj:new Image},enemy_cell_boss:{src:"images/gradius_enemy_cell_boss.png",rate:1,obj:new Image},enemy_cell_boss_eye:{src:"images/gradius_enemy_cell_boss_eye.png",rate:1,obj:new Image},enemy_cell_core:{src:"images/gradius_enemy_cell_core.png",rate:1,obj:new Image},enemy_cell_hand_1:{src:"images/gradius_enemy_cell_hand_1.png",rate:1,obj:new Image},enemy_cell_hand_2:{src:"images/gradius_enemy_cell_hand_2.png",rate:1,obj:new Image},enemy_cell_hand_3:{src:"images/gradius_enemy_cell_hand_3.png",rate:1,obj:new Image},enemy_cell_a_1:{src:"images/gradius_enemy_cell_a_1.png",rate:1,obj:new Image},enemy_cell_a_2:{src:"images/gradius_enemy_cell_a_2.png",rate:1,obj:new Image},enemy_cell_b_1:{src:"images/gradius_enemy_cell_b_1.png",rate:1,obj:new Image},enemy_cell_b_2:{src:"images/gradius_enemy_cell_b_2.png",rate:1,obj:new Image},enemy_frame_1:{src:"images/gradius_enemy_frame_1.png",rate:1,obj:new Image},enemy_frame_2:{src:"images/gradius_enemy_frame_2.png",rate:1,obj:new Image},enemy_frame_3:{src:"images/gradius_enemy_frame_3.png",rate:1,obj:new Image},enemy_frame_4:{src:"images/gradius_enemy_frame_4.png",rate:1,obj:new Image},enemy_frame_5:{src:"images/gradius_enemy_frame_5.png",rate:1,obj:new Image},enemy_frame_6:{src:"images/gradius_enemy_frame_6.png",rate:1,obj:new Image},enemy_frame_head1:{src:"images/gradius_enemy_frame_head_1.png",rate:1,obj:new Image},enemy_frame_head2:{src:"images/gradius_enemy_frame_head_2.png",rate:1,obj:new Image},enemy_frame_head3:{src:"images/gradius_enemy_frame_head_3.png",rate:1,obj:new Image},enemy_frame_head4:{src:"images/gradius_enemy_frame_head_4.png",rate:1,obj:new Image},enemy_frame_body1:{src:"images/gradius_enemy_frame_body_1.png",rate:1,obj:new Image},enemy_bigcore:{src:"images/gradius_enemy_bigcore.png",rate:.6,obj:new Image},enemy_bigcore_1:{src:"images/gradius_enemy_bigcore_1.png",rate:.6,obj:new Image},enemy_bigcore_2:{src:"images/gradius_enemy_bigcore_2.png",rate:.6,obj:new Image},enemy_bigcore_3:{src:"images/gradius_enemy_bigcore_3.png",rate:.6,obj:new Image},enemy_bigcore_4_1:{src:"images/gradius_enemy_bigcore_4_1.png",rate:.6,obj:new Image},enemy_bigcore_4_2:{src:"images/gradius_enemy_bigcore_4_2.png",rate:.6,obj:new Image},enemy_bigcore_4_3:{src:"images/gradius_enemy_bigcore_4_3.png",rate:.6,obj:new Image},enemy_bigcore_4_4:{src:"images/gradius_enemy_bigcore_4_4.png",rate:.6,obj:new Image},enemy_bigcore_4_5:{src:"images/gradius_enemy_bigcore_4_5.png",rate:.6,obj:new Image},enemy_cristalcore:{src:"images/gradius_enemy_cristalcore.png",rate:1,obj:new Image},enemy_cristalcore_hand1:{src:"images/gradius_enemy_cristalcore_hand1.png",rate:.3,obj:new Image},enemy_cristalcore_hand2:{src:"images/gradius_enemy_cristalcore_hand2.png",rate:.4,obj:new Image},enemy_cristalcore_wall1:{src:"images/gradius_enemy_cristalcore_wall1.png",rate:1,obj:new Image},enemy_cristalcore_wall2:{src:"images/gradius_enemy_cristalcore_wall2.png",rate:1,obj:new Image},enemy_cristalcore_shot:{src:"images/gradius_enemy_cristalcore_shot.png",rate:1,obj:new Image},enemy_cube:{src:"images/gradius_enemy_cube.png",rate:1,obj:new Image},enemy_bigcore2:{src:"images/gradius_enemy_bigcore2.png",rate:1,obj:new Image},enemy_bigcore2_hand:{src:"images/gradius_enemy_bigcore2_hand.png",rate:1,obj:new Image},enemy_bigcore2_wall:{src:"images/gradius_enemy_bigcore2_wall.png",rate:1,obj:new Image},enemy_bigcore2_core:{src:"images/gradius_enemy_bigcore2_core.png",rate:1,obj:new Image},enemy_bigcore2_back:{src:"images/gradius_enemy_bigcore2_back.png",rate:1,obj:new Image},enemy_death:{src:"images/gradius_enemy_death.png",rate:1,obj:new Image},enemy_death_front:{src:"images/gradius_enemy_death_front.png",rate:1,obj:new Image},enemy_death_shot:{src:"images/gradius_enemy_death_shot.png",rate:1,obj:new Image},enemy_death_shot2:{src:"images/gradius_enemy_death_shot2.png",rate:1,obj:new Image},enemy_collapes0:{src:"images/gradius_enemy_collapes0.png",rate:1,obj:new Image},enemy_collapes1:{src:"images/gradius_enemy_collapes1.png",rate:1,obj:new Image},enemy_collapes2:{src:"images/gradius_enemy_collapes2.png",rate:1,obj:new Image},enemy_collapes8:{src:"images/gradius_enemy_collapes8.png",rate:1,obj:new Image},enemy_collapes9:{src:"images/gradius_enemy_collapes9.png",rate:1,obj:new Image},enemy_bullet:{src:"images/gradius_enemy_bullet.png",rate:1,obj:new Image},enemy_bullet_cell:{src:"images/gradius_enemy_bullet_cell.png",rate:1,obj:new Image},enemy_bullet_z:{src:"images/gradius_enemy_bullet_z.png",rate:1,obj:new Image},enemy_bullet_laser:{src:"images/gradius_enemy_bullet_laser.png",rate:1,obj:new Image},pc_red:{src:"images/gradius_pc_red.png",rate:1,obj:new Image},pc_blue:{src:"images/gradius_pc_blue.png",rate:1,obj:new Image},map_cube_A:{src:"images/gradius_map_cube_A.png",rate:1,obj:new Image},map_moai_A:{src:"images/gradius_map_moai_A.png",rate:1,obj:new Image},map_moai_B:{src:"images/gradius_map_moai_B.png",rate:1,obj:new Image},map_volcano_A:{src:"images/gradius_map_volcano_A.png",rate:1,obj:new Image},map_volcano_B:{src:"images/gradius_map_volcano_B.png",rate:1,obj:new Image},map_volcano_C:{src:"images/gradius_map_volcano_C.png",rate:1,obj:new Image},map_volcano_D:{src:"images/gradius_map_volcano_D.png",rate:1,obj:new Image},map_volcano_E:{src:"images/gradius_map_volcano_E.png",rate:1,obj:new Image},map_volcano_F:{src:"images/gradius_map_volcano_F.png",rate:1,obj:new Image},map_volcano_G:{src:"images/gradius_map_volcano_G.png",rate:1,obj:new Image},map_volcano_H:{src:"images/gradius_map_volcano_H.png",rate:1,obj:new Image},map_volcano_I:{src:"images/gradius_map_volcano_I.png",rate:1,obj:new Image},map_volcano_J:{src:"images/gradius_map_volcano_J.png",rate:1,obj:new Image},map_volcano_K:{src:"images/gradius_map_volcano_K.png",rate:1,obj:new Image},map_volcano_L:{src:"images/gradius_map_volcano_L.png",rate:1,obj:new Image},map_volcano_M:{src:"images/gradius_map_volcano_M.png",rate:1,obj:new Image},map_volcano_N:{src:"images/gradius_map_volcano_N.png",rate:1,obj:new Image},map_volcano_O:{src:"images/gradius_map_volcano_O.png",rate:1,obj:new Image},map_volcano_P:{src:"images/gradius_map_volcano_P.png",rate:1,obj:new Image},map_frame_A:{src:"images/gradius_map_frame_A.png",rate:1,obj:new Image},map_frame_B:{src:"images/gradius_map_frame_B.png",rate:1,obj:new Image},map_frame_C:{src:"images/gradius_map_frame_C.png",rate:1,obj:new Image},map_frame_D:{src:"images/gradius_map_frame_D.png",rate:1,obj:new Image},map_frame_E:{src:"images/gradius_map_frame_E.png",rate:1,obj:new Image},map_frame_F:{src:"images/gradius_map_frame_F.png",rate:1,obj:new Image},map_cell_A:{src:"images/gradius_map_cell_A.png",rate:1,obj:new Image},map_cell_B:{src:"images/gradius_map_cell_B.png",rate:1,obj:new Image},map_cell_C:{src:"images/gradius_map_cell_C.png",rate:1,obj:new Image},map_cell_D:{src:"images/gradius_map_cell_D.png",rate:1,obj:new Image},map_cell_V:{src:"images/gradius_map_cell_V.png",rate:1,obj:new Image},map_cell_W:{src:"images/gradius_map_cell_W.png",rate:1,obj:new Image},map_cell_Y:{src:"images/gradius_map_cell_Y.png",rate:1,obj:new Image},map_cell_Z:{src:"images/gradius_map_cell_Z.png",rate:1,obj:new Image},map_cell_wall:{src:"images/gradius_map_cell_wall.png",rate:1,obj:new Image}},_CANVAS_IMGS_INIT={font:{src:"images/gradius_font.png",rate:1,obj:new Image},gradius_powermeterselect:{src:"images/gradius_powermeterselect.png",rate:.28,obj:new Image},gradius_powermeterselect_shield:{src:"images/gradius_powermeterselect_shield.png",rate:.28,obj:new Image},gradius_powermeterselect_0:{src:"images/gradius_powermeterselect_0.png",rate:.28,obj:new Image},gradius_powermeterselect_1:{src:"images/gradius_powermeterselect_1.png",rate:.28,obj:new Image},gradius_powermeterselect_2:{src:"images/gradius_powermeterselect_2.png",rate:.28,obj:new Image},gradius_powermeterselect_3:{src:"images/gradius_powermeterselect_3.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_0:{src:"images/gradius_powermeterselect_shield_0.png",rate:.28,obj:new Image},gradius_powermeterselect_shield_1:{src:"images/gradius_powermeterselect_shield_1.png",rate:.28,obj:new Image}},_CANVAS_AUDIOS={shot_laser:{src:"audios/shot_laser.mp3",volume:1,obj:null,buf:new Object},missile:{src:"audios/missile.mp3",volume:1,obj:null,buf:new Object},shot_normal:{src:"audios/shot_normal.mp3",volume:1,obj:null,buf:new Object},shot_ripple:{src:"audios/shot_ripple.mp3",volume:1,obj:null,buf:new Object},vicviper_bomb:{src:"audios/vicviper_bomb.mp3",volume:1,obj:null,buf:new Object},vicviper_shield_reduce:{src:"audios/vicviper_shield_reduce.mp3",volume:1,obj:null,buf:new Object},pc:{src:"audios/pc.mp3",volume:1,obj:null,buf:new Object},playerset:{src:"audios/playerset.mp3",volume:1,obj:null,buf:new Object},pms_select:{src:"audios/pms_select.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser:{src:"audios/enemy_bullet_laser.mp3",volume:1,obj:null,buf:new Object},enemy_bullet_laser_long:{src:"audios/enemy_bullet_laser_long.mp3",volume:1,obj:null,buf:new Object},enemy_collision1:{src:"audios/enemy_collision1.mp3",volume:1,obj:null,buf:new Object},enemy_collision2:{src:"audios/enemy_collision2.mp3",volume:1,obj:null,buf:new Object},enemy_collision3:{src:"audios/enemy_collision3.mp3",volume:1,obj:null,buf:new Object},enemy_collision4:{src:"audios/enemy_collision4.mp3",volume:1,obj:null,buf:new Object},enemy_collision5:{src:"audios/enemy_collision5.mp3",volume:1,obj:null,buf:new Object},enemy_collision6:{src:"audios/enemy_collision6.mp3",volume:1,obj:null,buf:new Object},enemy_collision7:{src:"audios/enemy_collision7.mp3",volume:1,obj:null,buf:new Object},enemy_all_out:{src:"audios/enemy_all_out.mp3",volume:1,obj:null,buf:new Object},enemy_cube:{src:"audios/enemy_cube.mp3",volume:1,obj:null,buf:new Object},map_cell_wall:{src:"audios/map_cell_wall.mp3",volume:1,obj:null,buf:new Object},bg_powermeterselect:{src:"audios/bg_powermeterselect.mp3",volume:1,obj:null,buf:new Object},bg_boss:{src:"audios/bg_boss.mp3",volume:1,obj:null,buf:new Object},bg_type1:{src:"audios/bg_moai.mp3",volume:1,obj:null,buf:new Object},bg_type2:{src:"audios/bg_volcano.mp3",volume:1,obj:null,buf:new Object},bg_type3:{src:"audios/bg_crystal.mp3",volume:1,obj:null,buf:new Object},bg_type4:{src:"audios/bg_frame.mp3",volume:1,obj:null,buf:new Object},bg_type5:{src:"audios/bg_thunderbolt.mp3",volume:1,obj:null,buf:new Object},bg_type6:{src:"audios/bg_cell.mp3",volume:1,obj:null,buf:new Object}};let _ISDEBUG=!1,_PLAYERS_POWER_METER=0,_PLAYERS_POWER_METER_SHIELD=0,_DRAW_SETINTERVAL=null,_DRAW_GAMESTART_SETINTERVAL=null,_PLAYERS_SHOTS_SETINTERVAL=null,_EVENT_POWERMETER_FLAG=!1,_EVENT_SELECT_STAGE_FLAG=!1,_DRAW_IS_MATCH_BOSS=!1,_DRAW_IS_MATCH_BOSS_COUNT=0;const _ISSP=null===window.ontouchstart,_EVENT_KEYDOWN=null===window.ontouchstart?"touchstart":"keydown",_EVENT_KEYUP=null===window.ontouchstart?"touchend":"keyup",_FPS=60;let _CANVAS,_CONTEXT,_DRAW_IS_GAMECLEAR=!1;const _SHOTTYPE_MISSILE="_SHOTTYPE_MISSILE",_SHOTTYPE_NORMAL="_SHOTTYPE_NORMAL",_SHOTTYPE_DOUBLE="_SHOTTYPE_DOUBLE",_SHOTTYPE_LASER="_SHOTTYPE_LASER",_SHOTTYPE_RIPPLE_LASER="_SHOTTYPE_RIPPLE_LASER";let _SHOTTYPE=_SHOTTYPE_NORMAL,_SCORE="",_PLAYERS_MAIN="",_PLAYERS_MAIN_FORCE="",_PLAYERS_OPTION=new Array,_PLAYERS_OPTION_ISALIVE=0;const _PLAYERS_OPTION_MAX=4,_PLAYERS_MOVE_DRAW_MAX=100;let _PLAYERS_MOVE_FLAG=!1,_PLAYERS_MOVE_DRAW_X=new Array,_PLAYERS_MOVE_DRAW_Y=new Array;const _PLAYERS_MAX=5,_PLAYERS_SHOTS_MAX=2;let _PLAYERS_SHOTS={_SHOTTYPE_NORMAL:new Array,_SHOTTYPE_DOUBLE:new Array,_SHOTTYPE_LASER:new Array},_PLAYERS_MISSILE=new Array,_PLAYERS_MISSILE_ISALIVE=!1,_ENEMIES=new Array,_ENEMIES_SHOTS=new Array,_ENEMIES_COLLISIONS=new Array,_ENEMY_DIFFICULT=4,_POWERCAPSELLS=new Array,_POWERMETER="",_STAGESELECT="",_MAP="",_BACKGROUND=new Array;const _BACKGROUND_STAR_MAX=70;let _KEYSAFTERPAUSE=new Array,_DEF_KEYSAFTERPAUSE="38,38,40,40,37,39,37,39,66,65";const _DEF_DIFFICULT=[{_ENEMY_SHOT_RATE:1e-4,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:5e-4,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.002,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.005,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:1},{_ENEMY_SHOT_RATE:.01,_ENEMY_SHOT_SPEED:3,_ENEMY_SPEED:2}],_IS_SQ_COL=0,_IS_SQ_COL_NONE=1,_IS_SQ_NOTCOL=2,_AUDIO_CONTEXT=new(window.AudioContext||window.webkitAudioContext);let _MAPDEFS="",_MAPDEF="",_MAP_PETTERN=3,_BACKGROUND_SPEED=0,_MAP_SCROLL_POSITION_X=0,_MAP_SCROLL_POSITION_Y=0;const _MAP_ENEMIES={_DEF_DIR:{_U:0,_D:1,_R:2,_L:3,_LU:4,_LD:5,_RU:6,_RD:7},_setDir:function(e,_){let t=_MAP.isMapCollision(e,_-1)?this._DEF_DIR._U:this._DEF_DIR._D;return t=_MAP.isMapCollision(e,_+1)?this._DEF_DIR._D:this._DEF_DIR._U},_ENEMIES:{a:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_a(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_a_1,_obj:new ENEMY_a},b:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_b(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_b_1,_obj:new ENEMY_b},c:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_c(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_c_1,_obj:new ENEMY_c},d:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_d(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_d_1,_obj:new ENEMY_d},e:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_e(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_e_1,_obj:new ENEMY_e},f:{_gamestart:function(e,_,t){t=_<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_f(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_f_1,_obj:new ENEMY_f},g:{_gamestart:function(e,_,t){t=_<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_g(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_g_1,_obj:new ENEMY_g},m:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_m(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_m_1,_obj:new ENEMY_m},n:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_n(e,_))},_st:"",_o:_CANVAS_IMGS.enemy_o_1,_obj:new ENEMY_n},o:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_o(e,_))},_st:"",_o:_CANVAS_IMGS.enemy_o_1,_obj:new ENEMY_o},p:{_gamestart:function(e,_,t){let n=new ENEMY_p(e,_);_ENEMIES.push(n)},_st:"",_o:_CANVAS_IMGS.enemy_p_1,_obj:new ENEMY_p},z:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_FAN(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_fan,_obj:new ENEMY_FAN}}},_MAP_ENEMIES_BOSS={enemy_cristalcore:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE(700,800)}},enemy_bigcore:{_f:function(){return new ENEMY_BOSS_BIGCORE(_CANVAS.width+200,200)}},enemy_cristalcore_pt2:{_f:function(){return new ENEMY_BOSS_CRYSTALCORE_PT2(700,800)}},enemy_bigcore2:{_f:function(){return new ENEMY_BOSS_BIGCORE2(_CANVAS.width+200,200)}},enemy_frame:{_f:function(){return new ENEMY_BOSS_FRAME(1e3,200)}},enemy_cell:{_f:function(){return new ENEMY_BOSS_CELL(_CANVAS.width+200,200)}},enemy_death:{_f:function(){return new ENEMY_BOSS_DEATH(_CANVAS.width+200,200)}}},_MAP_THEME={_THEME1:{_map:{A:{_o:(new MAP_CRISTAL).img,_gamestart:function(e){this.objs[e]=new MAP_CRISTAL},objs:{},_obj:new MAP_CRISTAL}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME2:{_map:{A:{_o:(new MAP_VOLCANO_A).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_A},objs:{},_obj:new MAP_VOLCANO_A},B:{_o:(new MAP_VOLCANO_B).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_B},objs:{},_obj:new MAP_VOLCANO_B},C:{_o:(new MAP_VOLCANO_C).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_C},objs:{},_obj:new MAP_VOLCANO_C},D:{_o:(new MAP_VOLCANO_D).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_D},objs:{},_obj:new MAP_VOLCANO_D},F:{_o:(new MAP_VOLCANO_F).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_F},objs:{},_obj:new MAP_VOLCANO_F},G:{_o:(new MAP_VOLCANO_G).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_G},objs:{},_obj:new MAP_VOLCANO_G},H:{_o:(new MAP_VOLCANO_H).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_H},objs:{},_obj:new MAP_VOLCANO_H},I:{_o:(new MAP_VOLCANO_I).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_I},objs:{},_obj:new MAP_VOLCANO_I},J:{_o:(new MAP_VOLCANO_J).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_J},objs:{},_obj:new MAP_VOLCANO_J},K:{_o:(new MAP_VOLCANO_K).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_K},objs:{},_obj:new MAP_VOLCANO_K},L:{_o:(new MAP_VOLCANO_L).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_L},objs:{},_obj:new MAP_VOLCANO_L},M:{_o:(new MAP_VOLCANO_M).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_M},objs:{},_obj:new MAP_VOLCANO_M},N:{_o:(new MAP_VOLCANO_N).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_N},objs:{},_obj:new MAP_VOLCANO_N},O:{_o:(new MAP_VOLCANO_O).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_O},objs:{},_obj:new MAP_VOLCANO_O},P:{_o:(new MAP_VOLCANO_P).img,_gamestart:function(e){this.objs[e]=new MAP_VOLCANO_P},objs:{},_obj:new MAP_VOLCANO_P}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME3:{_map:{A:{_o:(new MAP_CUBE_A).img,_gamestart:function(e){this.objs[e]=new MAP_CUBE_A},objs:{},_obj:new MAP_CUBE_A}},_enemies:_MAP_ENEMIES._ENEMIES},_THEME5:{_map:{B:{_o:(new MAP_MOAI_A).img,_gamestart:function(e){this.objs[e]=new MAP_MOAI_A},objs:{},_obj:new MAP_MOAI_A},C:{_o:(new MAP_MOAI_B).img,_gamestart:function(e){this.objs[e]=new MAP_MOAI_B},objs:{},_obj:new MAP_MOAI_B}},_enemies:{a:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_a(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_a_1,_obj:new ENEMY_a},b:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_b(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_b_1,_obj:new ENEMY_b},c:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_c(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_c_1,_obj:new ENEMY_c},d:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_d(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_d_1,_obj:new ENEMY_d},e:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_e(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_e_1,_obj:new ENEMY_e},f:{_gamestart:function(e,_,t){t=_<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_f(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_f_1,_obj:new ENEMY_f},g:{_gamestart:function(e,_,t){t=_<_CANVAS.height/2?_MAP_ENEMIES._DEF_DIR._U:_MAP_ENEMIES._DEF_DIR._D,_ENEMIES.push(new ENEMY_g(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_g_1,_obj:new ENEMY_g},m:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_m(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_m_1,_obj:new ENEMY_m},l:{_gamestart:function(e,_,t){let n=new ENEMY_q(e,_,_MAP_ENEMIES._DEF_DIR._U);_ENEMIES.push(n)},_st:"transform:scale(1,-1);",_o:_CANVAS_IMGS.enemy_m_a_1,_obj:new ENEMY_q(0,0,_MAP_ENEMIES._DEF_DIR._U)},n:{_gamestart:function(e,_,t){let n=new ENEMY_q(e,_,_MAP_ENEMIES._DEF_DIR._D);_ENEMIES.push(n)},_st:"",_o:_CANVAS_IMGS.enemy_m_a_1,_obj:new ENEMY_q(0,0,_MAP_ENEMIES._DEF_DIR._D)},o:{_gamestart:function(e,_,t){let n=new ENEMY_r(e,_,_MAP_ENEMIES._DEF_DIR._U);_ENEMIES.push(n)},_st:"transform:scale(1,-1);",_o:_CANVAS_IMGS.enemy_m_b_1,_obj:new ENEMY_r(0,0,_MAP_ENEMIES._DEF_DIR._U)},p:{_gamestart:function(e,_,t){let n=new ENEMY_r(e,_,_MAP_ENEMIES._DEF_DIR._D);_ENEMIES.push(n)},_st:"",_o:_CANVAS_IMGS.enemy_m_b_2,_obj:new ENEMY_r(0,0,_MAP_ENEMIES._DEF_DIR._D)},q:{_gamestart:function(e,_,t){let n=new ENEMY_q(e,_,_MAP_ENEMIES._DEF_DIR._LD);_ENEMIES.push(n)},_st:"transform:scale(-1,1);",_o:_CANVAS_IMGS.enemy_m_a_1,_obj:new ENEMY_q(0,0,_MAP_ENEMIES._DEF_DIR._LD)},r:{_gamestart:function(e,_,t){let n=new ENEMY_q(e,_,_MAP_ENEMIES._DEF_DIR._LU);_ENEMIES.push(n)},_st:"transform:scale(-1,-1);",_o:_CANVAS_IMGS.enemy_m_a_1,_obj:new ENEMY_q(0,0,_MAP_ENEMIES._DEF_DIR._ENEMY_DIFFICULT)},z:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_FAN(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_fan,_obj:new ENEMY_FAN}}},_THEME6:{_map:{A:{_o:(new MAP_FRAME_A).img,_gamestart:function(e){this.objs[e]=new MAP_FRAME_A},objs:{},_obj:new MAP_FRAME_A},B:{_o:(new MAP_FRAME_B).img,_gamestart:function(e){this.objs[e]=new MAP_FRAME_B},objs:{},_obj:new MAP_FRAME_B},C:{_o:(new MAP_FRAME_C).img,_gamestart:function(e){this.objs[e]=new MAP_FRAME_C},objs:{},_obj:new MAP_FRAME_C},D:{_o:(new MAP_FRAME_D).img,_gamestart:function(e){this.objs[e]=new MAP_FRAME_D},objs:{},_obj:new MAP_FRAME_D},E:{_o:(new MAP_FRAME_E).img,_gamestart:function(e){this.objs[e]=new MAP_FRAME_E},objs:{},_obj:new MAP_FRAME_E},F:{_o:(new MAP_FRAME_F).img,_gamestart:function(e){this.objs[e]=new MAP_FRAME_F},objs:{},_obj:new MAP_FRAME_F}},_enemies:{a:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_frame_1(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_frame_1,_obj:new ENEMY_frame_1},d:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_d(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_d_1,_obj:new ENEMY_d},e:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_e(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_e_1,_obj:new ENEMY_e},z:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_FAN(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_fan,_obj:new ENEMY_FAN}}},_THEME7:{_map:{A:{_o:(new MAP_CELL_A).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_A},objs:{},_obj:new MAP_CELL_A},B:{_o:(new MAP_CELL_B).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_B},objs:{},_obj:new MAP_CELL_B},C:{_o:(new MAP_CELL_C).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_C},objs:{},_obj:new MAP_CELL_C},D:{_o:(new MAP_CELL_D).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_D},objs:{},_obj:new MAP_CELL_D},G:{_o:(new MAP_CELL_G).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_G},objs:{},_obj:new MAP_CELL_G},H:{_o:(new MAP_CELL_H).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_H},objs:{},_obj:new MAP_CELL_H},I:{_o:(new MAP_CELL_I).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_I},objs:{},_obj:new MAP_CELL_I},J:{_o:(new MAP_CELL_J).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_J},objs:{},_obj:new MAP_CELL_J},K:{_o:(new MAP_CELL_K).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_K},objs:{},_obj:new MAP_CELL_K},L:{_o:(new MAP_CELL_L).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_L},objs:{},_obj:new MAP_CELL_L},M:{_o:(new MAP_CELL_M).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_M},objs:{},_obj:new MAP_CELL_M},N:{_o:(new MAP_CELL_N).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_N},objs:{},_obj:new MAP_CELL_N},O:{_o:(new MAP_CELL_O).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_O},objs:{},_obj:new MAP_CELL_O},V:{_o:(new MAP_CELL_V).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_V},objs:{},_obj:new MAP_CELL_V},W:{_o:(new MAP_CELL_W).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_W},objs:{},_obj:new MAP_CELL_W},Y:{_o:(new MAP_CELL_Y).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_Y},objs:{},_obj:new MAP_CELL_Y},Z:{_o:(new MAP_CELL_Z).img,_gamestart:function(e){this.objs[e]=new MAP_CELL_Z},objs:{},_obj:new MAP_CELL_Z}},_enemies:{a:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_cell_core(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_cell_core,_obj:new ENEMY_cell_core},b:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_CELL_A(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_cell_a_1,_obj:new ENEMY_CELL_A},c:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_CELL_B(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_cell_b_1,_obj:new ENEMY_CELL_B},d:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_d(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_d_1,_obj:new ENEMY_d},e:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_e(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_e_1,_obj:new ENEMY_e},z:{_gamestart:function(e,_,t){_ENEMIES.push(new ENEMY_FAN(e,_,t))},_st:"",_o:_CANVAS_IMGS.enemy_fan,_obj:new ENEMY_FAN}}}};class GameObject_MAP{constructor(e){this.pt=e||0,this.initx=0,this.inity=0,this.x=this.initx,this.y=this.inity,this.collision=new RegExp("[1A-Z]"),this.collision_enemies=new RegExp("[a-z]","g"),this.collision_map=new RegExp("[A-Z]"),this.collision_map_d=new RegExp("[BD]"),this.t=25,this.mapdef=new Array,this.mapdef_col=new Array,this.map_theme=0,this.map_pettern=0,this.map_difficult=0,this.map_background_speed=0,this.map_backgroundY_speed=0,this.map_infinite=!1,this.map_bgmusic="",this.map_boss="",this.isboss=!1}init(e){_AJAX("./gradius_map.json","json",function(_){_MAPDEFS=_,e()})}setInifinite(e){this.map_infinite=e}set_stage_map_pattern(e){this.map_pettern=e}set_gamestart(){this.map_backgroundY_speed=0,this.x=parseInt(_MAPDEFS[this.map_pettern]._initx),this.y=this.inity,this.initx=parseInt(_MAPDEFS[this.map_pettern]._initx),this.mapdef=_MAPDEFS[this.map_pettern]._map,this.map_difficult=parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,_ENEMY_DIFFICULT=_ISDEBUG?_ENEMY_DIFFICULT:parseInt(_MAPDEFS[this.map_pettern]._difficult)-1,this.map_background_speed=parseInt(_MAPDEFS[this.map_pettern]._speed),_BACKGROUND_SPEED=parseInt(_MAPDEFS[this.map_pettern]._speed),_MAP_PETTERN=this.map_pettern,this.map_theme=_MAPDEFS[this.map_pettern]._theme,this.map_infinite="true"===_MAPDEFS[this.map_pettern]._map_infinite,this.map_bgmusic=_MAPDEFS[this.map_pettern]._bgmusic,this.map_boss=_MAPDEFS[this.map_pettern]._boss,this.isboss=!1,this.set_gamestart_mapdef_col(),this.set_gamestart_map_theme_objs()}set_gamestart_map_theme_objs(){let e=this;for(let _=0;_<e.mapdef.length;_++){let t=e.mapdef[_];for(let n=0;n<t.length;n++)if(e.isEnemiesBit(t[n])){let a=_MAP_ENEMIES._setDir(n,_);_MAP_THEME[e.map_theme]._enemies[t[n]]._gamestart(e.x+n*e.t,_*e.t,a)}else e.isCollisionBit(t[n])&&_MAP_THEME[e.map_theme]._map[t[n]]._gamestart(n+","+_)}}set_gamestart_mapdef_col(){let e=this;Object.assign(e.mapdef_col,e.mapdef);for(let _=0;_<e.mapdef_col.length;_++)e.mapdef_col[_]=e.mapdef_col[_].replace(/[a-zA-Z]/gi,"0");for(let n=0;n<e.mapdef.length;n++){let a=e.mapdef[n];for(let s=0;s<a.length;s++){if(null===a[s].match(/[A-Za-z]/))continue;let o=e.isEnemiesBit(a[s])?_MAP_THEME[e.map_theme]._enemies[a[s]]._obj:_MAP_THEME[e.map_theme]._map[a[s]]._obj;void 0===o&&console.log("テーマ:"+e.map_theme+"に対して "+a[s]+"の定義がありません。");let r=o._s.split(",");for(let o=0;o<r.length;o++){let i=e.mapdef_col[n+o],m=e.mapdef[n+o];e.mapdef_col[n+o]=i.substr(0,s)+(m.substr(s,r[o].length),_=i.substr(s,r[o].length),t=r[o],e.setCollisionBit(t,_))+i.substr(s+r[o].length,a.length)}}}var _,t}set_mapdef_col(e,_,t){let n=this;if(void 0===e||void 0===_||void 0===t)return;let a=t.split(",");for(let t=0;t<a.length;t++){let s=n.mapdef_col[_+t];n.mapdef_col[_+t]=s.substr(0,e)+a[t]+s.substr(e+a[t].length)}}getX(e){return e+-1*_BACKGROUND_SPEED}getY(e){return this.map_infinite?e-_MAP.map_backgroundY_speed<-250?750+(250+e-_MAP.map_backgroundY_speed):e-_MAP.map_backgroundY_speed>750?-250-(750-e+_MAP.map_backgroundY_speed):(e-_MAP.map_backgroundY_speed)%1e3:e}getShotY(e){return e-_MAP.map_backgroundY_speed}setCollisionBit(e,_){let t="";for(let n=0;n<e.length;n++)"0"!==e[n]?t+="1":t+=_[n];return t}getCollisionFlag(){return this.collision}setBackGroundSpeedY(e){this.map_backgroundY_speed=e}getBackGroundSpeed(){return this.map_background_speed}getBackGroundSpeedY(){return this.map_backgroundY_speed}get_stage_map_pattern(e){return this.map_pettern}getMapXToPx(e){return e*this.t+this.initx-_MAP_SCROLL_POSITION_X}getMapYToPx(e){return e}getMapX(e){return Math.floor((e+_MAP_SCROLL_POSITION_X-this.initx)/this.t)}getMapY(e,_){return!0===_&&(console.log("_y:"+e),console.log("_MAP_SCROLL_POSITION_Y:"+_MAP_SCROLL_POSITION_Y)),Math.floor((e+_MAP_SCROLL_POSITION_Y)%1e3/this.t)}isCollisionBit(e){return null!==e.match(this.collision)}isEnemiesBit(e){return null!==e.match(this.collision_enemies)}isMapDouble(e){return null!==e.match(this.collision_map_d)}isMapBefore(e,_){return e<0}isMapLastSide(e,_){return void 0!==this.mapdef[_]&&(void 0===this.mapdef[_][e]||e===this.mapdef[_].length-1)}isMapOver(e,_){return void 0!==this.mapdef[_]&&(void 0===this.mapdef[_][e]||e>this.mapdef[_].length-1)}isMapCollision(e,_){return void 0!==this.mapdef_col[_]&&(void 0!==this.mapdef_col[_][e]&&!!this.isCollisionBit(this.mapdef_col[_][e]))}setPlayersShotAbleCollision(e,_,t){let n=_MAP_THEME[this.map_theme]._map;if(void 0===n)return;let a=this.mapdef[_][e];if(void 0===n[a])return;let s=n[a].objs[e+","+_];void 0!==s&&s.is_able_collision&&s.collision(t)}isPlayersShotCollision(){for(let e=0;e<_PLAYERS_SHOTS[_SHOTTYPE].length;e++){let _=_PLAYERS_SHOTS[_SHOTTYPE][e];for(let e=0;e<_.shots.length;e++){let t=_.shots[e];t._shot_alive&&_.map_collition(t)}}for(let e=0;e<_PLAYERS_MISSILE.length;e++){let _=_PLAYERS_MISSILE[e];if(_.player.isalive())for(let e=0;e<_.shots.length;e++){let t=_.shots[e];t._shot_alive&&(t._c>0||_.map_collition(t))}}}show(){}showMapForStageselect(e){let _=this;if(null==e)return;let t=e._map.length;for(let n=0;n<(t>20?20:t);n++){let t=e._map[n].length;for(let a=0;a<(t>30?30:t);a++){let t=e._map[n][a+20];if(void 0!==t&&"0"!==t)if(null!==t.match(_.collision_enemies)){let _=_MAP_THEME[e._theme]._enemies[t]._o.obj;_CONTEXT.drawImage(_,50+10*a,130+10*n,_.width/2.5,_.height/2.5)}else{let _=_MAP_THEME[e._theme]._map[t];_._o.obj;_CONTEXT.save(),_CONTEXT.translate(50+10*a,130+10*n),_CONTEXT.scale(.25,.25),_CONTEXT.drawImage(_._obj.img,_._obj.imgPos[0],0,_._obj.width,_._obj.height,0,0,1.6*_._obj.width,1.6*_._obj.height),_CONTEXT.restore()}}}_CONTEXT.fillStyle="rgba(0,0,0,1)",_CONTEXT.fillRect(350,130,500,500),_CONTEXT.fillRect(50,330,500,500)}map_draw(){let e=this;for(let _=0;_<e.mapdef.length;_++)for(let t=0;t<e.mapdef[_].length;t++){let n=e.mapdef[_][t];if(!e.isCollisionBit(n))continue;if(e.x+t*e.t<-500||e.x+t*e.t>_CANVAS.width+100)continue;let a=_MAP_THEME[e.map_theme]._map[n];a.objs[t+","+_].moveDraw(e.x+t*e.t,e.y+_*e.t),e.map_infinite&&a.objs[t+","+_].moveDraw(e.x+t*e.t,e.y+_*e.t+(e.y>0?-1e3:1e3))}}set_mapdef_col_clear(){let e=this;for(let _=0;_<e.mapdef_col.length;_++){let t=e.mapdef_col[_];e.mapdef_col[_]=t.replace(/1/gi,"0")}}set_scroll_on_x(){_BACKGROUND_SPEED=this.map_background_speed}set_scroll_off_x(){_BACKGROUND_SPEED=0}move(){let e=this;_MAP_SCROLL_POSITION_X+_CANVAS.width>e.mapdef[0].length*e.t+e.initx&&(e.isboss=!0),_MAP_SCROLL_POSITION_X-100>e.mapdef[0].length*e.t+e.initx&&(_BACKGROUND_SPEED=0),e.x+=-1*_BACKGROUND_SPEED,_MAP_SCROLL_POSITION_X+=_BACKGROUND_SPEED,e.y=e.getY(e.y),_MAP_SCROLL_POSITION_Y=function(){let _=_MAP_SCROLL_POSITION_Y+e.map_backgroundY_speed;return _<0?(1e3+_)%1e3:_%1e3}()}}_MAP=new GameObject_MAP;let $_pb=null,$_ab=null,$_mp=null,$_mn=null,$_bm=null;_MAP_PETTERN=0;const _AJAX=function(e,_,t){let n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(console.log("OK"),t(n.response)):console.log("NG"))},n.open("GET",e+"?date="+(new Date).getTime()),n.responseType=_||"json",n.send(null)},_DATAAPI={_data_api:"",_blog_id:2,_url:"/mt6/mt-data-api.cgi",_init:function(e){e._data_api=new MT.DataAPI({baseUrl:e._url,clientId:"api11entries"}),e._data_api.getToken(_=>_.error?(401===_.error.code&&(console.log("reload after 401 error occuered in updating."),location.href=e._data_api.getAuthorizationUrl(location.href)),!1):_.accessToken?void _GAME_STAGEEDIT._init_images(_CANVAS_IMGS,_GAME_STAGEEDIT._init):(alert("An accessToken error occurred."),void(location.href=e._data_api.getAuthorizationUrl(location.href))))},_set_entryupdate:function(e){let _=this;_._data_api.updateEntry(_._blog_id,e._eid,e,function(t){if(t.error)return alert("エントリ更新に失敗しました。"),void(401===t.error.code&&(location.href=_._data_api.getAuthorizationUrl(location.href)));alert("エントリ更新しました。"),_MAP.init(function(){_MAP_PETTERN=function(){for(let _=0;_<_MAPDEFS.length;_++)if(_MAPDEFS[_]._eid===e._eid)return _}(),_GAME_STAGEEDIT._setData(_MAP_PETTERN);const _=document.querySelectorAll("#area_parts .parts_block");for(var t=0;t<_.length;t++)_[t].setAttribute("draggable",!0),_[t].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),_[t].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1);const n=document.querySelectorAll('.form_group .col_r input[type="range"]');for(t=0;t<n.length;t++)n[t].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),n[t].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();const a=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<a.length;e++)_GAME_STAGEEDIT._setTextToFont(a[e],a[e].innerText,14)})})}},_GAME_STAGEEDIT={_ac:new(window.AudioContext||window.webkitAudioContext),_as:null,_theme:0,_txt:{0:"0",1:"60",2:"120",3:"180",4:"240",5:"300",6:"360",7:"420",8:"480",9:"540",a:"600",b:"660",c:"720",d:"780",e:"840",f:"900",g:"960",h:"1020",i:"1080",j:"1140",k:"1200",l:"1260",m:"1320",n:"1380",o:"1440",p:"1500",q:"1560",r:"1620",s:"1680",t:"1740",u:"1800",v:"1860",w:"1920",x:"1980",y:"2040",z:"2100",":":"2160"},_setInitMap:function(e){this._theme=e._theme;let _=e._map,t="";for(let n=0;n<_.length;n++){t+='<div class="area_blocks_rows">';for(let a=0;a<_[n].length;a++)t+='<div class="area_block" data-val="'+_[n][a]+'" onmouseover="_GAME_STAGEEDIT_EVENTS._f_as_mouseover(event);" onmouseout="_GAME_STAGEEDIT_EVENTS._f_as_mouseout(event);" ondragenter="_GAME_STAGEEDIT_EVENTS._f_as_dragenter(event);" ondrop="_GAME_STAGEEDIT_EVENTS._f_as_drop(event);">'+function(_){if("0"===_)return"";let t="";if(null!==_.match(_MAP.collision_enemies)){let n=_MAP_THEME[e._theme]._enemies[_]._o.obj;t='<div class="parts_block" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">';let a=_MAP_THEME[e._theme]._enemies[_]._st;t+="<img"+(""===a?"":' style="'+a+'"')+' width="'+parseInt(.8*n.width)+'" height="'+parseInt(.8*n.height)+'" src="'+n.src+'">',t+="</div>"}else if(null!==_.match(_MAP.collision_map)){let n=_MAP_THEME[e._theme]._map[_]._obj;t='<div class="parts_block" style="width:'+parseInt(.8*n.width)+"px;height:"+parseInt(.8*n.height)+"px;background:url("+n.img.src+") no-repeat;background-size:cover;background-position:"+20/n.width*n.imgPos[0]*-1+'px 0px;" ondragstart="_GAME_STAGEEDIT_EVENTS._f_pb_dragstart(event);" draggable="true">',t+="</div>"}return t}(_[n][a])+"</div>\x3c!-- /.area_block --\x3e";t+="</div>\x3c!-- /.area_blocks_rows --\x3e"}document.querySelector(".area_blocks.drop").innerHTML=t},_setAudioInit:function(e,_){let t=this,n=0;for(let a in e){let s=new XMLHttpRequest;s.open("GET",e[a].src,!0),s.responseType="arraybuffer",s.onload=function(){t._ac.decodeAudioData(s.response,t=>{e[a].buf=t,++n>=Object.keys(e).length&&_(_DATAAPI)},e=>{alert("一部音声読み込みに失敗しました。再度立ち上げなおしてください:"+e)})},s.send()}},_setAudioStop(e){null!==this._as&&(this._as.stop(),this._as=null)},_setAudioPlay(e){if(null!=e&&null===this._as){var _=this._ac.createBufferSource();_.buffer=e.buf,_.loop=!1,_.connect(this._ac.destination),_.start(0),this._as=_}},_setInitPartsBlocksWrapper:function(e){e._map;let _="";for(let[t,n]of Object.entries(_MAP_THEME[e._theme]._enemies))_+='<div class="parts_block_wrapper" data-val="'+t+'"><div class="text">enemy '+t+'</div><div class="parts_block"><img'+(""===n._st?"":' style="'+n._st+'"')+' src="'+n._o.src+'"></div></div>\x3c!-- /.parts_block_wrapper --\x3e';document.querySelector(".parts_blocks_wrapper.enemy .parts_blocks").innerHTML=_,_="";for(let[t,n]of Object.entries(_MAP_THEME[e._theme]._map)){let e=n._obj;_+='<div class="parts_block_wrapper" data-val="'+t+'"><div class="text">MAP '+t+'</div><div class="parts_block" style="width:100px;height:'+parseInt(100*e.height/e.width)+"px;background:url("+n._o.src+") no-repeat;background-size:cover;background-position:"+100/e.width*e.imgPos[0]*-1+'px 0px;"></div></div>\x3c!-- /.parts_block_wrapper --\x3e'}document.querySelector(".parts_blocks_wrapper.map .parts_blocks").innerHTML=_},_clearMap:function(){document.querySelector(".area_blocks.drop").textContent=null},_getTextToFont:function(e){let _="",t=e.children;for(let e=0;e<t.length;e++)_+=t[e];return _},_setTextToFont:function(e,_,t){if(null==e)return;t=t||60;let n="";for(let e=0;e<_.length;e++){if(":"===_[e])continue;if(" "===_[e]){n+='<img src="./images/gradius_spacer.png" width="'+t+'">';continue}n+='<div style="background:url(./images/gradius_font.png) no-repeat;background-size:cover;background-position:'+parseInt(this._txt[_[e].toLowerCase()])*(t/60)*-1+"px 0px;display:inline-block;width:"+t+"px;height:"+t+'px;"></div>'}e.innerHTML=n},_clearData:function(){},_setData:function(e){let _=_MAPDEFS[e];this._setInitMap(_),this._setInitPartsBlocksWrapper(_),document.querySelector('#title input[name="title"]').value=_._title,document.querySelector('#body textarea[name="body"]').value=_._body;const t=document.querySelector("#bgmusic select");for(let e=0;e<t.length;e++)if(t[e].value===_._bgmusic){t[e].selected=!0;break}t.addEventListener("click",function(){_GAME_STAGEEDIT._setAudioStop()});const n=document.querySelector("#boss select");for(let e=0;e<n.length;e++)if(n[e].value===_._boss){n[e].selected=!0;break}const a=document.querySelector('#init input[name="init"]'),s=document.querySelector("#init .col_r .val");a.value=_._initx,s.setAttribute("data-val",_._initx),this._setTextToFont(s,_._initx,20);const o=document.querySelector('#speed input[name="speed"]'),r=document.querySelector("#speed .col_r .val");o.value=_._speed,r.setAttribute("data-val",_._speed),this._setTextToFont(r,_._speed,20);const i=document.querySelector('#difficult input[name="difficult"]'),m=document.querySelector("#difficult .col_r .val");i.value=_._difficult,m.setAttribute("data-val",_._difficult),this._setTextToFont(m,_._difficult,20);const g=document.querySelector('#map_infinite input[name="map_infinite"]'),l=document.querySelector("#map_infinite .col_r .val");g.value="true"===_._map_infinite?"1":"0",l.setAttribute("data-val",_._map_infinite),this._setTextToFont(l,_._map_infinite,20)},setDataForDataApi:function(){let e=function(e){let _="";_+='"_map":[';let t=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<t.length;e++){let n=t[e].children;_+='"';for(let e=0;e<n.length;e++)_+=n[e].getAttribute("data-val");_+=e===t.length-1?'"':'",'}return _+="],",_+='"_theme":"'+e._theme+'",',_+='"_body":"'+document.querySelector('#body textarea[name="body"]').value+'",',_+='"_initx":"'+document.querySelector("#init .col_r .val").getAttribute("data-val")+'",',_+='"_bgmusic":"'+document.querySelector("#bgmusic select").value+'",',_+='"_boss":"'+document.querySelector("#boss select").value+'",',_+='"_speed":"'+document.querySelector("#speed .col_r .val").getAttribute("data-val")+'",',_+='"_difficult":"'+document.querySelector("#difficult .col_r .val").getAttribute("data-val")+'",',_+='"_map_infinite":"'+document.querySelector("#map_infinite .col_r .val").getAttribute("data-val")+'"'}(_MAPDEFS[_MAP_PETTERN]),_={title:document.querySelector('#title input[name="title"]').value,status:"Publish",_eid:_MAPDEFS[_MAP_PETTERN]._eid,body:e};_DATAAPI._set_entryupdate(_)},_setEntryLink:function(){$_mp.classList.remove("off"),$_mn.classList.remove("off"),0===_MAP_PETTERN&&$_mp.classList.add("off"),_MAP_PETTERN>=_MAPDEFS.length-1&&$_mn.classList.add("off")},_setPartsBlockEvent:function(){const e=document.querySelectorAll("#area_parts .parts_block");for(var _=0;_<e.length;_++)e[_].setAttribute("draggable",!0),e[_].addEventListener("dragstart",_GAME_STAGEEDIT_EVENTS._f_ap_dragstart,!1),e[_].addEventListener("dragend",_GAME_STAGEEDIT_EVENTS._f_ap_dragend,!1)},_init_images:function(e,_){let t=0;for(let n in e){let a=e[n];a.obj.src=e[n].src,a.obj.onload=function(){a.obj.width*=a.rate,a.obj.height*=a.rate,++t>=Object.keys(e).length&&_()}}},_init:()=>{const e=_GAME_STAGEEDIT,_=document.querySelector("#bgmusic select");Object.keys(_CANVAS_AUDIOS).forEach(function(e){if(-1!==e.indexOf("bg_type")){var t=document.createElement("option");t.setAttribute("value",e.replace("bg_","")),t.innerHTML=e.replace("bg_",""),_.appendChild(t)}});const t=document.querySelector("#boss select");Object.keys(_MAP_ENEMIES_BOSS).forEach(function(e){var _=document.createElement("option");_.setAttribute("value",e),_.innerHTML=e,t.appendChild(_)}),_MAP.init(()=>{console.log("success"),e._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setPartsBlockEvent();const _=document.querySelectorAll('.form_group .col_r input[type="range"]');for(var t=0;t<_.length;t++)_[t].addEventListener("input",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1),_[t].addEventListener("change",_GAME_STAGEEDIT_EVENTS._f_fg_range,!1);document.querySelector("a.bgmusic_play").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_play),document.querySelector("a.bgmusic_stop").addEventListener("click",_GAME_STAGEEDIT_EVENTS._f_bgmusic_stop),document.body.classList.add("on"),document.body.classList.add("ismenu"),_GAME_STAGEEDIT._setEntryLink();let n=document.querySelectorAll("h1");for(let _=0;_<n.length;_++)e._setTextToFont(n[_],n[_].innerText,40);n=document.querySelectorAll("h2,h3,#map_bts a,#entrylink a,label.col_l,div.col_r label span, #menu_inner a");for(let _=0;_<n.length;_++)e._setTextToFont(n[_],n[_].innerText,20);n=document.querySelectorAll(".parts_block_wrapper .text");for(let _=0;_<n.length;_++)e._setTextToFont(n[_],n[_].innerText,14)})}},_GAME_STAGEEDIT_EVENTS={$_do_area_parts_obj:null,$_start_area_parts_obj:null,$_mouseover_area_parts_obj:null,_e_entrylink_prev:function(e){if(0===_MAP_PETTERN)return;_MAP_PETTERN--,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const _=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<_.length;e++)_GAME_STAGEEDIT._setTextToFont(_[e],_[e].innerText,14);return!1},_e_entrylink_next:function(e){if(_MAP_PETTERN>=_MAPDEFS.length-1)return;_MAP_PETTERN++,_GAME_STAGEEDIT._clearMap(),_GAME_STAGEEDIT._setData(_MAP_PETTERN),_GAME_STAGEEDIT._setEntryLink(),_GAME_STAGEEDIT._setPartsBlockEvent();const _=document.querySelectorAll(".parts_block_wrapper .text");for(let e=0;e<_.length;e++)_GAME_STAGEEDIT._setTextToFont(_[e],_[e].innerText,14);return!1},_e_update:function(){return confirm("更新しますか?")?_GAME_STAGEEDIT.setDataForDataApi():console.log("false"),!1},_e_scroll:function(e){const _=document.body,t=document.body.clientHeight,n=document.getElementById("menu").offsetHeight;_.scrollTop+window.innerHeight>t-n/2?_.classList.remove("ismenu"):_.classList.add("ismenu")},_f_fg_range:function(e){let _=e.target.parentNode.previousElementSibling,t="map_infinite"!==e.target.name?e.target.value:"1"===e.target.value?"true":"false";_.setAttribute("data-val",t),_.innerText=t,_GAME_STAGEEDIT._setTextToFont(_,t,20)},_f_map_add:function(e){const _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++){let t=_[e].lastElementChild.cloneNode(!0);_[e].appendChild(t),t.children.length}return e.stopPropagation(),e.preventDefault(),!1},_f_map_remove:function(e){const _=document.querySelectorAll(".area_blocks_rows");for(let e=0;e<_.length;e++)_[e].lastElementChild.remove();return e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseover:function(e){return"IMG"===e.target.tagName&&(_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj=e.target,e.target.classList.add("over")),e.stopPropagation(),e.preventDefault(),!1},_f_as_mouseout:function(e){if(null!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj&&void 0!==_GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj)return _GAME_STAGEEDIT_EVENTS.$_mouseover_area_parts_obj.classList.remove("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_dragenter:function(e){return null!==this.$_do_area_parts_obj&&this.$_do_area_parts_obj.classList.remove("over"),this.$_do_area_parts_obj=e.target,this.$_do_area_parts_obj.classList.add("over"),e.stopPropagation(),e.preventDefault(),!1},_f_as_drop:function(e){console.log("as_drop");let _=e.dataTransfer.getData("text"),t=e.currentTarget,n=this.$_start_area_parts_obj;if(t.classList.remove("over"),0!==t.childNodes.length&&(t.textContent=null),"move"===e.dataTransfer.effectAllowed)t.appendChild(this.$_start_area_parts_obj);else{let e=n.cloneNode(!0);if(t.appendChild(e),null!==_.match(_MAP.collision_enemies)){let t=_MAP_THEME[_GAME_STAGEEDIT._theme]._enemies[_]._o.obj;e.children[0].width=parseInt(.8*t.width),e.children[0].height=parseInt(.8*t.height)}if(null!==_.match(_MAP.collision_map)){let t=_MAP_THEME[_GAME_STAGEEDIT._theme]._map[_]._obj;e.setAttribute("style","width:"+parseInt(.8*t.width)+"px;height:"+parseInt(.8*t.height)+"px;background:url("+t.img.src+") no-repeat;background-size:cover;background-position:"+20/t.width*t.imgPos[0]*-1+"px 0px;")}t.children[0].addEventListener("dragstart",this._f_pb_dragstart,!1)}return t.setAttribute("data-val",_),e.stopPropagation(),e.preventDefault(),!1},_f_i_dragover:function(e){return e.stopPropagation(),e.preventDefault(),!1},_f_i_drop:function(e){return console.log("form_inner drop"),"move"===e.dataTransfer.effectAllowed&&(this.$_start_area_parts_obj.parentNode.textContent=null,!1)},_f_ap_dragstart:function(e){_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),console.log("_f_ap_start")},_f_ap_dragend:function(e){return e.target.parentNode.classList.remove("drag"),e.stopPropagation(),e.preventDefault(),!1},_f_pb_dragstart:function(e){console.log("_f_pb_dragstart"),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",_GAME_STAGEEDIT_EVENTS.$_start_area_parts_obj=e.currentTarget,e.dataTransfer.setData("text",e.currentTarget.parentNode.getAttribute("data-val")),e.currentTarget.parentNode.setAttribute("data-val",0)},_f_bgmusic_play:function(e){let _=document.querySelector("#bgmusic select").value;_GAME_STAGEEDIT._setAudioPlay(_CANVAS_AUDIOS["bg_"+_])},_f_bgmusic_stop:function(e){_GAME_STAGEEDIT._setAudioStop()}};document.addEventListener("scroll",()=>{_GAME_STAGEEDIT_EVENTS._e_scroll()}),window.addEventListener("load",()=>{$_pb=document.getElementsByClassName("parts_block"),$_ab=document.getElementsByClassName("area_block"),$_mp=document.querySelector("#menu .prev"),$_mn=document.querySelector("#menu .next"),$_bm=document.querySelector("#bgmusic"),_GAME_STAGEEDIT._setAudioInit(_CANVAS_AUDIOS,_DATAAPI._init)});